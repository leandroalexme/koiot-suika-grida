(function(bt,Qe){typeof exports=="object"&&typeof module<"u"?Qe(exports):typeof define=="function"&&define.amd?define(["exports"],Qe):(bt=typeof globalThis<"u"?globalThis:bt||self,Qe(bt.core={}))})(this,function(bt){"use strict";var Jf=Object.defineProperty;var Qf=(bt,Qe,Bn)=>Qe in bt?Jf(bt,Qe,{enumerable:!0,configurable:!0,writable:!0,value:Bn}):bt[Qe]=Bn;var S=(bt,Qe,Bn)=>Qf(bt,typeof Qe!="symbol"?Qe+"":Qe,Bn);function Qe(i,t){for(var e=0;e<t.length;e++){const r=t[e];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in i)){const o=Object.getOwnPropertyDescriptor(r,s);o&&Object.defineProperty(i,s,o.get?o:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}class Bn{constructor(t,e,r){this.desc=t,this.editor=e,this.elements=r}redo(){var t;for(const e of this.elements){e.setDeleted(!1);const r=e.getParent();r&&r.insertChild(e,(t=e.attrs.parentIndex)==null?void 0:t.position)}this.editor.selectedElements.setItems(this.elements)}undo(){this.elements.forEach(t=>{t.setDeleted(!0),t.removeFromParent()}),this.editor.selectedElements.clear()}}let ns;const Vc=new Uint8Array(16);function Nc(){if(!ns&&(ns=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!ns))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return ns(Vc)}const xe=[];for(let i=0;i<256;++i)xe.push((i+256).toString(16).slice(1));function Yc(i,t=0){return xe[i[t+0]]+xe[i[t+1]]+xe[i[t+2]]+xe[i[t+3]]+"-"+xe[i[t+4]]+xe[i[t+5]]+"-"+xe[i[t+6]]+xe[i[t+7]]+"-"+xe[i[t+8]]+xe[i[t+9]]+"-"+xe[i[t+10]]+xe[i[t+11]]+xe[i[t+12]]+xe[i[t+13]]+xe[i[t+14]]+xe[i[t+15]]}const ko={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Uc(i,t,e){if(ko.randomUUID&&!i)return ko.randomUUID();i=i||{};const r=i.random||(i.rng||Nc)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,Yc(r)}var $t=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Fn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Xc(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(r){var s=Object.getOwnPropertyDescriptor(i,r);Object.defineProperty(e,r,s.get?s:{enumerable:!0,get:function(){return i[r]}})}),e}var rs={exports:{}};rs.exports,function(i,t){var e=200,r="__lodash_hash_undefined__",s=9007199254740991,o="[object Arguments]",c="[object Array]",u="[object Boolean]",g="[object Date]",y="[object Error]",x="[object Function]",C="[object GeneratorFunction]",A="[object Map]",_="[object Number]",F="[object Object]",R="[object Promise]",z="[object RegExp]",G="[object Set]",V="[object String]",j="[object Symbol]",U="[object WeakMap]",N="[object ArrayBuffer]",Q="[object DataView]",Y="[object Float32Array]",Z="[object Float64Array]",wt="[object Int8Array]",ut="[object Int16Array]",rt="[object Int32Array]",dt="[object Uint8Array]",Ht="[object Uint8ClampedArray]",st="[object Uint16Array]",_t="[object Uint32Array]",mt=/[\\^$.*+?()[\]{}|]/g,Xt=/\w*$/,He=/^\[object .+?Constructor\]$/,Kt=/^(?:0|[1-9]\d*)$/,Tt={};Tt[o]=Tt[c]=Tt[N]=Tt[Q]=Tt[u]=Tt[g]=Tt[Y]=Tt[Z]=Tt[wt]=Tt[ut]=Tt[rt]=Tt[A]=Tt[_]=Tt[F]=Tt[z]=Tt[G]=Tt[V]=Tt[j]=Tt[dt]=Tt[Ht]=Tt[st]=Tt[_t]=!0,Tt[y]=Tt[x]=Tt[U]=!1;var We=typeof $t=="object"&&$t&&$t.Object===Object&&$t,Me=typeof self=="object"&&self&&self.Object===Object&&self,Zt=We||Me||Function("return this")(),Ke=t&&!t.nodeType&&t,Lt=Ke&&!0&&i&&!i.nodeType&&i,ar=Lt&&Lt.exports===Ke;function ai(p,P){return p.set(P[0],P[1]),p}function me(p,P){return p.add(P),p}function Fr(p,P){for(var L=-1,X=p?p.length:0;++L<X&&P(p[L],L,p)!==!1;);return p}function Lr(p,P){for(var L=-1,X=P.length,Mt=p.length;++L<X;)p[Mt+L]=P[L];return p}function Hr(p,P,L,X){for(var Mt=-1,gt=p?p.length:0;++Mt<gt;)L=P(L,p[Mt],Mt,p);return L}function cr(p,P){for(var L=-1,X=Array(p);++L<p;)X[L]=P(L);return X}function ci(p,P){return p==null?void 0:p[P]}function Wr(p){var P=!1;if(p!=null&&typeof p.toString!="function")try{P=!!(p+"")}catch{}return P}function hr(p){var P=-1,L=Array(p.size);return p.forEach(function(X,Mt){L[++P]=[Mt,X]}),L}function lr(p,P){return function(L){return p(P(L))}}function on(p){var P=-1,L=Array(p.size);return p.forEach(function(X){L[++P]=X}),L}var dr=Array.prototype,Or=Function.prototype,an=Object.prototype,cn=Zt["__core-js_shared__"],hn=function(){var p=/[^.]+$/.exec(cn&&cn.keys&&cn.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),$n=Or.toString,qe=an.hasOwnProperty,xn=an.toString,Oe=RegExp("^"+$n.call(qe).replace(mt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ln=ar?Zt.Buffer:void 0,jn=Zt.Symbol,Vt=Zt.Uint8Array,he=lr(Object.getPrototypeOf,Object),Rt=Object.create,hi=an.propertyIsEnumerable,$e=dr.splice,Vn=Object.getOwnPropertySymbols,In=ln?ln.isBuffer:void 0,Gr=lr(Object.keys,Object),Nn=Ye(Zt,"DataView"),_n=Ye(Zt,"Map"),je=Ye(Zt,"Promise"),dn=Ye(Zt,"Set"),Yn=Ye(Zt,"WeakMap"),Ze=Ye(Object,"create"),Sn=te(Nn),Un=te(_n),kn=te(je),Cn=te(dn),Ve=te(Yn),bn=jn?jn.prototype:void 0,ur=bn?bn.valueOf:void 0;function tn(p){var P=-1,L=p?p.length:0;for(this.clear();++P<L;){var X=p[P];this.set(X[0],X[1])}}function zr(){this.__data__=Ze?Ze(null):{}}function Hi(p){return this.has(p)&&delete this.__data__[p]}function Kr(p){var P=this.__data__;if(Ze){var L=P[p];return L===r?void 0:L}return qe.call(P,p)?P[p]:void 0}function li(p){var P=this.__data__;return Ze?P[p]!==void 0:qe.call(P,p)}function $r(p,P){var L=this.__data__;return L[p]=Ze&&P===void 0?r:P,this}tn.prototype.clear=zr,tn.prototype.delete=Hi,tn.prototype.get=Kr,tn.prototype.has=li,tn.prototype.set=$r;function le(p){var P=-1,L=p?p.length:0;for(this.clear();++P<L;){var X=p[P];this.set(X[0],X[1])}}function Ne(){this.__data__=[]}function di(p){var P=this.__data__,L=ve(P,p);if(L<0)return!1;var X=P.length-1;return L==X?P.pop():$e.call(P,L,1),!0}function Wi(p){var P=this.__data__,L=ve(P,p);return L<0?void 0:P[L][1]}function ce(p){return ve(this.__data__,p)>-1}function ui(p,P){var L=this.__data__,X=ve(L,p);return X<0?L.push([p,P]):L[X][1]=P,this}le.prototype.clear=Ne,le.prototype.delete=di,le.prototype.get=Wi,le.prototype.has=ce,le.prototype.set=ui;function de(p){var P=-1,L=p?p.length:0;for(this.clear();++P<L;){var X=p[P];this.set(X[0],X[1])}}function Xn(){this.__data__={hash:new tn,map:new(_n||le),string:new tn}}function fr(p){return qn(this,p).delete(p)}function gr(p){return qn(this,p).get(p)}function fi(p){return qn(this,p).has(p)}function Te(p,P){return qn(this,p).set(p,P),this}de.prototype.clear=Xn,de.prototype.delete=fr,de.prototype.get=gr,de.prototype.has=fi,de.prototype.set=Te;function ye(p){this.__data__=new le(p)}function Ae(){this.__data__=new le}function Ee(p){return this.__data__.delete(p)}function Oi(p){return this.__data__.get(p)}function Jn(p){return this.__data__.has(p)}function jr(p,P){var L=this.__data__;if(L instanceof le){var X=L.__data__;if(!_n||X.length<e-1)return X.push([p,P]),this;L=this.__data__=new de(X)}return L.set(p,P),this}ye.prototype.clear=Ae,ye.prototype.delete=Ee,ye.prototype.get=Oi,ye.prototype.has=Jn,ye.prototype.set=jr;function pr(p,P){var L=Gt(p)||Zn(p)?cr(p.length,String):[],X=L.length,Mt=!!X;for(var gt in p)qe.call(p,gt)&&!(Mt&&(gt=="length"||Ge(gt,X)))&&L.push(gt);return L}function gi(p,P,L){var X=p[P];(!(qe.call(p,P)&&Ur(X,L))||L===void 0&&!(P in p))&&(p[P]=L)}function ve(p,P){for(var L=p.length;L--;)if(Ur(p[L][0],P))return L;return-1}function re(p,P){return p&&vr(P,er(P),p)}function mr(p,P,L,X,Mt,gt,Bt){var Dt;if(X&&(Dt=gt?X(p,Mt,gt,Bt):X(p)),Dt!==void 0)return Dt;if(!St(p))return p;var Nt=Gt(p);if(Nt){if(Dt=wr(p),!P)return Yi(p,Dt)}else{var Wt=se(p),oe=Wt==x||Wt==C;if(mi(p))return yr(p,P);if(Wt==F||Wt==o||oe&&!gt){if(Wr(p))return gt?p:{};if(Dt=Ie(oe?{}:p),!P)return Ui(p,re(Dt,p))}else{if(!Tt[Wt])return gt?p:{};Dt=_e(p,Wt,mr,P)}}Bt||(Bt=new ye);var we=Bt.get(p);if(we)return we;if(Bt.set(p,Dt),!Nt)var Pt=L?Xi(p):er(p);return Fr(Pt||p,function(Jt,ee){Pt&&(ee=Jt,Jt=p[ee]),gi(Dt,ee,mr(Jt,P,L,X,ee,p,Bt))}),Dt}function Gi(p){return St(p)?Rt(p):{}}function zi(p,P,L){var X=P(p);return Gt(p)?X:Lr(X,L(p))}function Ki(p){return xn.call(p)}function $i(p){if(!St(p)||Xe(p))return!1;var P=Sr(p)||Wr(p)?Oe:He;return P.test(te(p))}function ji(p){if(!fn(p))return Gr(p);var P=[];for(var L in Object(p))qe.call(p,L)&&L!="constructor"&&P.push(L);return P}function yr(p,P){if(P)return p.slice();var L=new p.constructor(p.length);return p.copy(L),L}function Vr(p){var P=new p.constructor(p.byteLength);return new Vt(P).set(new Vt(p)),P}function un(p,P){var L=P?Vr(p.buffer):p.buffer;return new p.constructor(L,p.byteOffset,p.byteLength)}function Qn(p,P,L){var X=P?L(hr(p),!0):hr(p);return Hr(X,ai,new p.constructor)}function Nr(p){var P=new p.constructor(p.source,Xt.exec(p));return P.lastIndex=p.lastIndex,P}function Vi(p,P,L){var X=P?L(on(p),!0):on(p);return Hr(X,me,new p.constructor)}function Ni(p){return ur?Object(ur.call(p)):{}}function pi(p,P){var L=P?Vr(p.buffer):p.buffer;return new p.constructor(L,p.byteOffset,p.length)}function Yi(p,P){var L=-1,X=p.length;for(P||(P=Array(X));++L<X;)P[L]=p[L];return P}function vr(p,P,L,X){L||(L={});for(var Mt=-1,gt=P.length;++Mt<gt;){var Bt=P[Mt],Dt=void 0;gi(L,Bt,Dt===void 0?p[Bt]:Dt)}return L}function Ui(p,P){return vr(p,Ue(p),P)}function Xi(p){return zi(p,er,Ue)}function qn(p,P){var L=p.__data__;return xr(P)?L[typeof P=="string"?"string":"hash"]:L.map}function Ye(p,P){var L=ci(p,P);return $i(L)?L:void 0}var Ue=Vn?lr(Vn,Object):vi,se=Ki;(Nn&&se(new Nn(new ArrayBuffer(1)))!=Q||_n&&se(new _n)!=A||je&&se(je.resolve())!=R||dn&&se(new dn)!=G||Yn&&se(new Yn)!=U)&&(se=function(p){var P=xn.call(p),L=P==F?p.constructor:void 0,X=L?te(L):void 0;if(X)switch(X){case Sn:return Q;case Un:return A;case kn:return R;case Cn:return G;case Ve:return U}return P});function wr(p){var P=p.length,L=p.constructor(P);return P&&typeof p[0]=="string"&&qe.call(p,"index")&&(L.index=p.index,L.input=p.input),L}function Ie(p){return typeof p.constructor=="function"&&!fn(p)?Gi(he(p)):{}}function _e(p,P,L,X){var Mt=p.constructor;switch(P){case N:return Vr(p);case u:case g:return new Mt(+p);case Q:return un(p,X);case Y:case Z:case wt:case ut:case rt:case dt:case Ht:case st:case _t:return pi(p,X);case A:return Qn(p,X,L);case _:case V:return new Mt(p);case z:return Nr(p);case G:return Vi(p,X,L);case j:return Ni(p)}}function Ge(p,P){return P=P??s,!!P&&(typeof p=="number"||Kt.test(p))&&p>-1&&p%1==0&&p<P}function xr(p){var P=typeof p;return P=="string"||P=="number"||P=="symbol"||P=="boolean"?p!=="__proto__":p===null}function Xe(p){return!!hn&&hn in p}function fn(p){var P=p&&p.constructor,L=typeof P=="function"&&P.prototype||an;return p===L}function te(p){if(p!=null){try{return $n.call(p)}catch{}try{return p+""}catch{}}return""}function Yr(p){return mr(p,!0,!0)}function Ur(p,P){return p===P||p!==p&&P!==P}function Zn(p){return Ji(p)&&qe.call(p,"callee")&&(!hi.call(p,"callee")||xn.call(p)==o)}var Gt=Array.isArray;function en(p){return p!=null&&yi(p.length)&&!Sr(p)}function Ji(p){return tr(p)&&en(p)}var mi=In||Xr;function Sr(p){var P=St(p)?xn.call(p):"";return P==x||P==C}function yi(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=s}function St(p){var P=typeof p;return!!p&&(P=="object"||P=="function")}function tr(p){return!!p&&typeof p=="object"}function er(p){return en(p)?pr(p):ji(p)}function vi(){return[]}function Xr(){return!1}i.exports=Yr}(rs,rs.exports);var Jc=rs.exports;const ht=Fn(Jc);var Qc="Expected a function",Ro=NaN,qc="[object Symbol]",Zc=/^\s+|\s+$/g,th=/^[-+]0x[0-9a-f]+$/i,eh=/^0b[01]+$/i,nh=/^0o[0-7]+$/i,rh=parseInt,ih=typeof $t=="object"&&$t&&$t.Object===Object&&$t,sh=typeof self=="object"&&self&&self.Object===Object&&self,oh=ih||sh||Function("return this")(),ah=Object.prototype,ch=ah.toString,hh=Math.max,lh=Math.min,zs=function(){return oh.Date.now()};function dh(i,t,e){var r,s,o,c,u,g,y=0,x=!1,C=!1,A=!0;if(typeof i!="function")throw new TypeError(Qc);t=Do(t)||0,Ks(e)&&(x=!!e.leading,C="maxWait"in e,o=C?hh(Do(e.maxWait)||0,t):o,A="trailing"in e?!!e.trailing:A);function _(Q){var Y=r,Z=s;return r=s=void 0,y=Q,c=i.apply(Z,Y),c}function F(Q){return y=Q,u=setTimeout(G,t),x?_(Q):c}function R(Q){var Y=Q-g,Z=Q-y,wt=t-Y;return C?lh(wt,o-Z):wt}function z(Q){var Y=Q-g,Z=Q-y;return g===void 0||Y>=t||Y<0||C&&Z>=o}function G(){var Q=zs();if(z(Q))return V(Q);u=setTimeout(G,R(Q))}function V(Q){return u=void 0,A&&r?_(Q):(r=s=void 0,c)}function j(){u!==void 0&&clearTimeout(u),y=0,r=g=s=u=void 0}function U(){return u===void 0?c:V(zs())}function N(){var Q=zs(),Y=z(Q);if(r=arguments,s=this,g=Q,Y){if(u===void 0)return F(g);if(C)return u=setTimeout(G,t),_(g)}return u===void 0&&(u=setTimeout(G,t)),c}return N.cancel=j,N.flush=U,N}function Ks(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function uh(i){return!!i&&typeof i=="object"}function fh(i){return typeof i=="symbol"||uh(i)&&ch.call(i)==qc}function Do(i){if(typeof i=="number")return i;if(fh(i))return Ro;if(Ks(i)){var t=typeof i.valueOf=="function"?i.valueOf():i;i=Ks(t)?t+"":t}if(typeof i!="string")return i===0?i:+i;i=i.replace(Zc,"");var e=eh.test(i);return e||nh.test(i)?rh(i.slice(2),e?2:8):th.test(i)?Ro:+i}var gh=dh;const ph=Fn(gh);var is={exports:{}};is.exports,function(i,t){var e=200,r="__lodash_hash_undefined__",s=1,o=2,c=9007199254740991,u="[object Arguments]",g="[object Array]",y="[object AsyncFunction]",x="[object Boolean]",C="[object Date]",A="[object Error]",_="[object Function]",F="[object GeneratorFunction]",R="[object Map]",z="[object Number]",G="[object Null]",V="[object Object]",j="[object Promise]",U="[object Proxy]",N="[object RegExp]",Q="[object Set]",Y="[object String]",Z="[object Symbol]",wt="[object Undefined]",ut="[object WeakMap]",rt="[object ArrayBuffer]",dt="[object DataView]",Ht="[object Float32Array]",st="[object Float64Array]",_t="[object Int8Array]",mt="[object Int16Array]",Xt="[object Int32Array]",He="[object Uint8Array]",Kt="[object Uint8ClampedArray]",Tt="[object Uint16Array]",We="[object Uint32Array]",Me=/[\\^$.*+?()[\]{}|]/g,Zt=/^\[object .+?Constructor\]$/,Ke=/^(?:0|[1-9]\d*)$/,Lt={};Lt[Ht]=Lt[st]=Lt[_t]=Lt[mt]=Lt[Xt]=Lt[He]=Lt[Kt]=Lt[Tt]=Lt[We]=!0,Lt[u]=Lt[g]=Lt[rt]=Lt[x]=Lt[dt]=Lt[C]=Lt[A]=Lt[_]=Lt[R]=Lt[z]=Lt[V]=Lt[N]=Lt[Q]=Lt[Y]=Lt[ut]=!1;var ar=typeof $t=="object"&&$t&&$t.Object===Object&&$t,ai=typeof self=="object"&&self&&self.Object===Object&&self,me=ar||ai||Function("return this")(),Fr=t&&!t.nodeType&&t,Lr=Fr&&!0&&i&&!i.nodeType&&i,Hr=Lr&&Lr.exports===Fr,cr=Hr&&ar.process,ci=function(){try{return cr&&cr.binding&&cr.binding("util")}catch{}}(),Wr=ci&&ci.isTypedArray;function hr(p,P){for(var L=-1,X=p==null?0:p.length,Mt=0,gt=[];++L<X;){var Bt=p[L];P(Bt,L,p)&&(gt[Mt++]=Bt)}return gt}function lr(p,P){for(var L=-1,X=P.length,Mt=p.length;++L<X;)p[Mt+L]=P[L];return p}function on(p,P){for(var L=-1,X=p==null?0:p.length;++L<X;)if(P(p[L],L,p))return!0;return!1}function dr(p,P){for(var L=-1,X=Array(p);++L<p;)X[L]=P(L);return X}function Or(p){return function(P){return p(P)}}function an(p,P){return p.has(P)}function cn(p,P){return p==null?void 0:p[P]}function hn(p){var P=-1,L=Array(p.size);return p.forEach(function(X,Mt){L[++P]=[Mt,X]}),L}function $n(p,P){return function(L){return p(P(L))}}function qe(p){var P=-1,L=Array(p.size);return p.forEach(function(X){L[++P]=X}),L}var xn=Array.prototype,Oe=Function.prototype,ln=Object.prototype,jn=me["__core-js_shared__"],Vt=Oe.toString,he=ln.hasOwnProperty,Rt=function(){var p=/[^.]+$/.exec(jn&&jn.keys&&jn.keys.IE_PROTO||"");return p?"Symbol(src)_1."+p:""}(),hi=ln.toString,$e=RegExp("^"+Vt.call(he).replace(Me,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Vn=Hr?me.Buffer:void 0,In=me.Symbol,Gr=me.Uint8Array,Nn=ln.propertyIsEnumerable,_n=xn.splice,je=In?In.toStringTag:void 0,dn=Object.getOwnPropertySymbols,Yn=Vn?Vn.isBuffer:void 0,Ze=$n(Object.keys,Object),Sn=Ue(me,"DataView"),Un=Ue(me,"Map"),kn=Ue(me,"Promise"),Cn=Ue(me,"Set"),Ve=Ue(me,"WeakMap"),bn=Ue(Object,"create"),ur=te(Sn),tn=te(Un),zr=te(kn),Hi=te(Cn),Kr=te(Ve),li=In?In.prototype:void 0,$r=li?li.valueOf:void 0;function le(p){var P=-1,L=p==null?0:p.length;for(this.clear();++P<L;){var X=p[P];this.set(X[0],X[1])}}function Ne(){this.__data__=bn?bn(null):{},this.size=0}function di(p){var P=this.has(p)&&delete this.__data__[p];return this.size-=P?1:0,P}function Wi(p){var P=this.__data__;if(bn){var L=P[p];return L===r?void 0:L}return he.call(P,p)?P[p]:void 0}function ce(p){var P=this.__data__;return bn?P[p]!==void 0:he.call(P,p)}function ui(p,P){var L=this.__data__;return this.size+=this.has(p)?0:1,L[p]=bn&&P===void 0?r:P,this}le.prototype.clear=Ne,le.prototype.delete=di,le.prototype.get=Wi,le.prototype.has=ce,le.prototype.set=ui;function de(p){var P=-1,L=p==null?0:p.length;for(this.clear();++P<L;){var X=p[P];this.set(X[0],X[1])}}function Xn(){this.__data__=[],this.size=0}function fr(p){var P=this.__data__,L=yr(P,p);if(L<0)return!1;var X=P.length-1;return L==X?P.pop():_n.call(P,L,1),--this.size,!0}function gr(p){var P=this.__data__,L=yr(P,p);return L<0?void 0:P[L][1]}function fi(p){return yr(this.__data__,p)>-1}function Te(p,P){var L=this.__data__,X=yr(L,p);return X<0?(++this.size,L.push([p,P])):L[X][1]=P,this}de.prototype.clear=Xn,de.prototype.delete=fr,de.prototype.get=gr,de.prototype.has=fi,de.prototype.set=Te;function ye(p){var P=-1,L=p==null?0:p.length;for(this.clear();++P<L;){var X=p[P];this.set(X[0],X[1])}}function Ae(){this.size=0,this.__data__={hash:new le,map:new(Un||de),string:new le}}function Ee(p){var P=Ye(this,p).delete(p);return this.size-=P?1:0,P}function Oi(p){return Ye(this,p).get(p)}function Jn(p){return Ye(this,p).has(p)}function jr(p,P){var L=Ye(this,p),X=L.size;return L.set(p,P),this.size+=L.size==X?0:1,this}ye.prototype.clear=Ae,ye.prototype.delete=Ee,ye.prototype.get=Oi,ye.prototype.has=Jn,ye.prototype.set=jr;function pr(p){var P=-1,L=p==null?0:p.length;for(this.__data__=new ye;++P<L;)this.add(p[P])}function gi(p){return this.__data__.set(p,r),this}function ve(p){return this.__data__.has(p)}pr.prototype.add=pr.prototype.push=gi,pr.prototype.has=ve;function re(p){var P=this.__data__=new de(p);this.size=P.size}function mr(){this.__data__=new de,this.size=0}function Gi(p){var P=this.__data__,L=P.delete(p);return this.size=P.size,L}function zi(p){return this.__data__.get(p)}function Ki(p){return this.__data__.has(p)}function $i(p,P){var L=this.__data__;if(L instanceof de){var X=L.__data__;if(!Un||X.length<e-1)return X.push([p,P]),this.size=++L.size,this;L=this.__data__=new ye(X)}return L.set(p,P),this.size=L.size,this}re.prototype.clear=mr,re.prototype.delete=Gi,re.prototype.get=zi,re.prototype.has=Ki,re.prototype.set=$i;function ji(p,P){var L=Zn(p),X=!L&&Ur(p),Mt=!L&&!X&&en(p),gt=!L&&!X&&!Mt&&tr(p),Bt=L||X||Mt||gt,Dt=Bt?dr(p.length,String):[],Nt=Dt.length;for(var Wt in p)he.call(p,Wt)&&!(Bt&&(Wt=="length"||Mt&&(Wt=="offset"||Wt=="parent")||gt&&(Wt=="buffer"||Wt=="byteLength"||Wt=="byteOffset")||_e(Wt,Nt)))&&Dt.push(Wt);return Dt}function yr(p,P){for(var L=p.length;L--;)if(Yr(p[L][0],P))return L;return-1}function Vr(p,P,L){var X=P(p);return Zn(p)?X:lr(X,L(p))}function un(p){return p==null?p===void 0?wt:G:je&&je in Object(p)?se(p):fn(p)}function Qn(p){return St(p)&&un(p)==u}function Nr(p,P,L,X,Mt){return p===P?!0:p==null||P==null||!St(p)&&!St(P)?p!==p&&P!==P:Vi(p,P,L,X,Nr,Mt)}function Vi(p,P,L,X,Mt,gt){var Bt=Zn(p),Dt=Zn(P),Nt=Bt?g:Ie(p),Wt=Dt?g:Ie(P);Nt=Nt==u?V:Nt,Wt=Wt==u?V:Wt;var oe=Nt==V,we=Wt==V,Pt=Nt==Wt;if(Pt&&en(p)){if(!en(P))return!1;Bt=!0,oe=!1}if(Pt&&!oe)return gt||(gt=new re),Bt||tr(p)?vr(p,P,L,X,Mt,gt):Ui(p,P,Nt,L,X,Mt,gt);if(!(L&s)){var Jt=oe&&he.call(p,"__wrapped__"),ee=we&&he.call(P,"__wrapped__");if(Jt||ee){var nn=Jt?p.value():p,gn=ee?P.value():P;return gt||(gt=new re),Mt(nn,gn,L,X,gt)}}return Pt?(gt||(gt=new re),Xi(p,P,L,X,Mt,gt)):!1}function Ni(p){if(!yi(p)||xr(p))return!1;var P=mi(p)?$e:Zt;return P.test(te(p))}function pi(p){return St(p)&&Sr(p.length)&&!!Lt[un(p)]}function Yi(p){if(!Xe(p))return Ze(p);var P=[];for(var L in Object(p))he.call(p,L)&&L!="constructor"&&P.push(L);return P}function vr(p,P,L,X,Mt,gt){var Bt=L&s,Dt=p.length,Nt=P.length;if(Dt!=Nt&&!(Bt&&Nt>Dt))return!1;var Wt=gt.get(p);if(Wt&&gt.get(P))return Wt==P;var oe=-1,we=!0,Pt=L&o?new pr:void 0;for(gt.set(p,P),gt.set(P,p);++oe<Dt;){var Jt=p[oe],ee=P[oe];if(X)var nn=Bt?X(ee,Jt,oe,P,p,gt):X(Jt,ee,oe,p,P,gt);if(nn!==void 0){if(nn)continue;we=!1;break}if(Pt){if(!on(P,function(gn,Rn){if(!an(Pt,Rn)&&(Jt===gn||Mt(Jt,gn,L,X,gt)))return Pt.push(Rn)})){we=!1;break}}else if(!(Jt===ee||Mt(Jt,ee,L,X,gt))){we=!1;break}}return gt.delete(p),gt.delete(P),we}function Ui(p,P,L,X,Mt,gt,Bt){switch(L){case dt:if(p.byteLength!=P.byteLength||p.byteOffset!=P.byteOffset)return!1;p=p.buffer,P=P.buffer;case rt:return!(p.byteLength!=P.byteLength||!gt(new Gr(p),new Gr(P)));case x:case C:case z:return Yr(+p,+P);case A:return p.name==P.name&&p.message==P.message;case N:case Y:return p==P+"";case R:var Dt=hn;case Q:var Nt=X&s;if(Dt||(Dt=qe),p.size!=P.size&&!Nt)return!1;var Wt=Bt.get(p);if(Wt)return Wt==P;X|=o,Bt.set(p,P);var oe=vr(Dt(p),Dt(P),X,Mt,gt,Bt);return Bt.delete(p),oe;case Z:if($r)return $r.call(p)==$r.call(P)}return!1}function Xi(p,P,L,X,Mt,gt){var Bt=L&s,Dt=qn(p),Nt=Dt.length,Wt=qn(P),oe=Wt.length;if(Nt!=oe&&!Bt)return!1;for(var we=Nt;we--;){var Pt=Dt[we];if(!(Bt?Pt in P:he.call(P,Pt)))return!1}var Jt=gt.get(p);if(Jt&&gt.get(P))return Jt==P;var ee=!0;gt.set(p,P),gt.set(P,p);for(var nn=Bt;++we<Nt;){Pt=Dt[we];var gn=p[Pt],Rn=P[Pt];if(X)var Ls=Bt?X(Rn,gn,Pt,P,p,gt):X(gn,Rn,Pt,p,P,gt);if(!(Ls===void 0?gn===Rn||Mt(gn,Rn,L,X,gt):Ls)){ee=!1;break}nn||(nn=Pt=="constructor")}if(ee&&!nn){var wi=p.constructor,Jr=P.constructor;wi!=Jr&&"constructor"in p&&"constructor"in P&&!(typeof wi=="function"&&wi instanceof wi&&typeof Jr=="function"&&Jr instanceof Jr)&&(ee=!1)}return gt.delete(p),gt.delete(P),ee}function qn(p){return Vr(p,er,wr)}function Ye(p,P){var L=p.__data__;return Ge(P)?L[typeof P=="string"?"string":"hash"]:L.map}function Ue(p,P){var L=cn(p,P);return Ni(L)?L:void 0}function se(p){var P=he.call(p,je),L=p[je];try{p[je]=void 0;var X=!0}catch{}var Mt=hi.call(p);return X&&(P?p[je]=L:delete p[je]),Mt}var wr=dn?function(p){return p==null?[]:(p=Object(p),hr(dn(p),function(P){return Nn.call(p,P)}))}:vi,Ie=un;(Sn&&Ie(new Sn(new ArrayBuffer(1)))!=dt||Un&&Ie(new Un)!=R||kn&&Ie(kn.resolve())!=j||Cn&&Ie(new Cn)!=Q||Ve&&Ie(new Ve)!=ut)&&(Ie=function(p){var P=un(p),L=P==V?p.constructor:void 0,X=L?te(L):"";if(X)switch(X){case ur:return dt;case tn:return R;case zr:return j;case Hi:return Q;case Kr:return ut}return P});function _e(p,P){return P=P??c,!!P&&(typeof p=="number"||Ke.test(p))&&p>-1&&p%1==0&&p<P}function Ge(p){var P=typeof p;return P=="string"||P=="number"||P=="symbol"||P=="boolean"?p!=="__proto__":p===null}function xr(p){return!!Rt&&Rt in p}function Xe(p){var P=p&&p.constructor,L=typeof P=="function"&&P.prototype||ln;return p===L}function fn(p){return hi.call(p)}function te(p){if(p!=null){try{return Vt.call(p)}catch{}try{return p+""}catch{}}return""}function Yr(p,P){return p===P||p!==p&&P!==P}var Ur=Qn(function(){return arguments}())?Qn:function(p){return St(p)&&he.call(p,"callee")&&!Nn.call(p,"callee")},Zn=Array.isArray;function Gt(p){return p!=null&&Sr(p.length)&&!mi(p)}var en=Yn||Xr;function Ji(p,P){return Nr(p,P)}function mi(p){if(!yi(p))return!1;var P=un(p);return P==_||P==F||P==y||P==U}function Sr(p){return typeof p=="number"&&p>-1&&p%1==0&&p<=c}function yi(p){var P=typeof p;return p!=null&&(P=="object"||P=="function")}function St(p){return p!=null&&typeof p=="object"}var tr=Wr?Or(Wr):pi;function er(p){return Gt(p)?ji(p):Yi(p)}function vi(){return[]}function Xr(){return!1}i.exports=Ji}(is,is.exports);var mh=is.exports;const Si=Fn(mh);var yh=200,$s="__lodash_hash_undefined__",Bo=9007199254740991,vh="[object Arguments]",wh="[object Function]",xh="[object GeneratorFunction]",Sh="[object Symbol]",Ch=/[\\^$.*+?()[\]{}|]/g,bh=/^\[object .+?Constructor\]$/,Ph=/^(?:0|[1-9]\d*)$/,Mh=typeof $t=="object"&&$t&&$t.Object===Object&&$t,Th=typeof self=="object"&&self&&self.Object===Object&&self,js=Mh||Th||Function("return this")();function Ah(i,t,e){switch(e.length){case 0:return i.call(t);case 1:return i.call(t,e[0]);case 2:return i.call(t,e[0],e[1]);case 3:return i.call(t,e[0],e[1],e[2])}return i.apply(t,e)}function Eh(i,t){var e=i?i.length:0;return!!e&&kh(i,t,0)>-1}function Ih(i,t){for(var e=-1,r=i?i.length:0,s=Array(r);++e<r;)s[e]=t(i[e],e,i);return s}function Vs(i,t){for(var e=-1,r=t.length,s=i.length;++e<r;)i[s+e]=t[e];return i}function _h(i,t,e,r){for(var s=i.length,o=e+-1;++o<s;)if(t(i[o],o,i))return o;return-1}function kh(i,t,e){if(t!==t)return _h(i,Rh,e);for(var r=e-1,s=i.length;++r<s;)if(i[r]===t)return r;return-1}function Rh(i){return i!==i}function Dh(i,t){for(var e=-1,r=Array(i);++e<i;)r[e]=t(e);return r}function Bh(i,t){return i.has(t)}function Fh(i,t){return i==null?void 0:i[t]}function Lh(i){var t=!1;if(i!=null&&typeof i.toString!="function")try{t=!!(i+"")}catch{}return t}function Fo(i,t){return function(e){return i(t(e))}}var Hh=Array.prototype,Wh=Function.prototype,ss=Object.prototype,Ns=js["__core-js_shared__"],Lo=function(){var i=/[^.]+$/.exec(Ns&&Ns.keys&&Ns.keys.IE_PROTO||"");return i?"Symbol(src)_1."+i:""}(),Ho=Wh.toString,Ci=ss.hasOwnProperty,Ys=ss.toString,Oh=RegExp("^"+Ho.call(Ci).replace(Ch,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Wo=js.Symbol,Gh=Fo(Object.getPrototypeOf,Object),zh=ss.propertyIsEnumerable,Kh=Hh.splice,Oo=Wo?Wo.isConcatSpreadable:void 0,Us=Object.getOwnPropertySymbols,Go=Math.max,$h=zo(js,"Map"),bi=zo(Object,"create");function Pr(i){var t=-1,e=i?i.length:0;for(this.clear();++t<e;){var r=i[t];this.set(r[0],r[1])}}function jh(){this.__data__=bi?bi(null):{}}function Vh(i){return this.has(i)&&delete this.__data__[i]}function Nh(i){var t=this.__data__;if(bi){var e=t[i];return e===$s?void 0:e}return Ci.call(t,i)?t[i]:void 0}function Yh(i){var t=this.__data__;return bi?t[i]!==void 0:Ci.call(t,i)}function Uh(i,t){var e=this.__data__;return e[i]=bi&&t===void 0?$s:t,this}Pr.prototype.clear=jh,Pr.prototype.delete=Vh,Pr.prototype.get=Nh,Pr.prototype.has=Yh,Pr.prototype.set=Uh;function qr(i){var t=-1,e=i?i.length:0;for(this.clear();++t<e;){var r=i[t];this.set(r[0],r[1])}}function Xh(){this.__data__=[]}function Jh(i){var t=this.__data__,e=as(t,i);if(e<0)return!1;var r=t.length-1;return e==r?t.pop():Kh.call(t,e,1),!0}function Qh(i){var t=this.__data__,e=as(t,i);return e<0?void 0:t[e][1]}function qh(i){return as(this.__data__,i)>-1}function Zh(i,t){var e=this.__data__,r=as(e,i);return r<0?e.push([i,t]):e[r][1]=t,this}qr.prototype.clear=Xh,qr.prototype.delete=Jh,qr.prototype.get=Qh,qr.prototype.has=qh,qr.prototype.set=Zh;function Zr(i){var t=-1,e=i?i.length:0;for(this.clear();++t<e;){var r=i[t];this.set(r[0],r[1])}}function tl(){this.__data__={hash:new Pr,map:new($h||qr),string:new Pr}}function el(i){return cs(this,i).delete(i)}function nl(i){return cs(this,i).get(i)}function rl(i){return cs(this,i).has(i)}function il(i,t){return cs(this,i).set(i,t),this}Zr.prototype.clear=tl,Zr.prototype.delete=el,Zr.prototype.get=nl,Zr.prototype.has=rl,Zr.prototype.set=il;function os(i){var t=-1,e=i?i.length:0;for(this.__data__=new Zr;++t<e;)this.add(i[t])}function sl(i){return this.__data__.set(i,$s),this}function ol(i){return this.__data__.has(i)}os.prototype.add=os.prototype.push=sl,os.prototype.has=ol;function al(i,t){var e=Xs(i)||Ko(i)?Dh(i.length,String):[],r=e.length,s=!!r;for(var o in i)s&&(o=="length"||xl(o,r))||e.push(o);return e}function as(i,t){for(var e=i.length;e--;)if(Al(i[e][0],t))return e;return-1}function cl(i,t,e,r){var s=-1,o=Eh,c=!0,u=i.length,g=[],y=t.length;if(!u)return g;t.length>=yh&&(o=Bh,c=!1,t=new os(t));t:for(;++s<u;){var x=i[s],C=x;if(x=x!==0?x:0,c&&C===C){for(var A=y;A--;)if(t[A]===C)continue t;g.push(x)}else o(t,C,r)||g.push(x)}return g}function hl(i,t,e,r,s){var o=-1,c=i.length;for(e||(e=wl),s||(s=[]);++o<c;){var u=i[o];e(u)?Vs(s,u):s[s.length]=u}return s}function ll(i,t,e){var r=t(i);return Xs(i)?r:Vs(r,e(i))}function dl(i){if(!Js(i)||Cl(i))return!1;var t=jo(i)||Lh(i)?Oh:bh;return t.test(Tl(i))}function ul(i){if(!Js(i))return Pl(i);var t=bl(i),e=[];for(var r in i)r=="constructor"&&(t||!Ci.call(i,r))||e.push(r);return e}function fl(i,t){return i=Object(i),gl(i,t,function(e,r){return r in i})}function gl(i,t,e){for(var r=-1,s=t.length,o={};++r<s;){var c=t[r],u=i[c];e(u,c)&&(o[c]=u)}return o}function pl(i,t){return t=Go(t===void 0?i.length-1:t,0),function(){for(var e=arguments,r=-1,s=Go(e.length-t,0),o=Array(s);++r<s;)o[r]=e[t+r];r=-1;for(var c=Array(t+1);++r<t;)c[r]=e[r];return c[t]=o,Ah(i,this,c)}}function ml(i){return ll(i,kl,vl)}function cs(i,t){var e=i.__data__;return Sl(t)?e[typeof t=="string"?"string":"hash"]:e.map}function zo(i,t){var e=Fh(i,t);return dl(e)?e:void 0}var yl=Us?Fo(Us,Object):No,vl=Us?function(i){for(var t=[];i;)Vs(t,yl(i)),i=Gh(i);return t}:No;function wl(i){return Xs(i)||Ko(i)||!!(Oo&&i&&i[Oo])}function xl(i,t){return t=t??Bo,!!t&&(typeof i=="number"||Ph.test(i))&&i>-1&&i%1==0&&i<t}function Sl(i){var t=typeof i;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?i!=="__proto__":i===null}function Cl(i){return!!Lo&&Lo in i}function bl(i){var t=i&&i.constructor,e=typeof t=="function"&&t.prototype||ss;return i===e}function Pl(i){var t=[];if(i!=null)for(var e in Object(i))t.push(e);return t}function Ml(i){if(typeof i=="string"||_l(i))return i;var t=i+"";return t=="0"&&1/i==-1/0?"-0":t}function Tl(i){if(i!=null){try{return Ho.call(i)}catch{}try{return i+""}catch{}}return""}function Al(i,t){return i===t||i!==i&&t!==t}function Ko(i){return El(i)&&Ci.call(i,"callee")&&(!zh.call(i,"callee")||Ys.call(i)==vh)}var Xs=Array.isArray;function $o(i){return i!=null&&Il(i.length)&&!jo(i)}function El(i){return Vo(i)&&$o(i)}function jo(i){var t=Js(i)?Ys.call(i):"";return t==wh||t==xh}function Il(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=Bo}function Js(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function Vo(i){return!!i&&typeof i=="object"}function _l(i){return typeof i=="symbol"||Vo(i)&&Ys.call(i)==Sh}function kl(i){return $o(i)?al(i):ul(i)}var Rl=pl(function(i,t){return i==null?{}:(t=Ih(hl(t),Ml),fl(i,cl(ml(i),t)))});function No(){return[]}var Dl=Rl;const Bl=Fn(Dl);var Fl=9007199254740991,Ll="[object Arguments]",Hl="[object Function]",Wl="[object GeneratorFunction]",Ol="[object Symbol]",Gl=typeof $t=="object"&&$t&&$t.Object===Object&&$t,zl=typeof self=="object"&&self&&self.Object===Object&&self,Kl=Gl||zl||Function("return this")();function $l(i,t,e){switch(e.length){case 0:return i.call(t);case 1:return i.call(t,e[0]);case 2:return i.call(t,e[0],e[1]);case 3:return i.call(t,e[0],e[1],e[2])}return i.apply(t,e)}function jl(i,t){for(var e=-1,r=i?i.length:0,s=Array(r);++e<r;)s[e]=t(i[e],e,i);return s}function Vl(i,t){for(var e=-1,r=t.length,s=i.length;++e<r;)i[s+e]=t[e];return i}var Qs=Object.prototype,Nl=Qs.hasOwnProperty,qs=Qs.toString,Yo=Kl.Symbol,Yl=Qs.propertyIsEnumerable,Uo=Yo?Yo.isConcatSpreadable:void 0,Xo=Math.max;function Ul(i,t,e,r,s){var o=-1,c=i.length;for(e||(e=ql),s||(s=[]);++o<c;){var u=i[o];e(u)?Vl(s,u):s[s.length]=u}return s}function Xl(i,t){return i=Object(i),Jl(i,t,function(e,r){return r in i})}function Jl(i,t,e){for(var r=-1,s=t.length,o={};++r<s;){var c=t[r],u=i[c];e(u,c)&&(o[c]=u)}return o}function Ql(i,t){return t=Xo(t===void 0?i.length-1:t,0),function(){for(var e=arguments,r=-1,s=Xo(e.length-t,0),o=Array(s);++r<s;)o[r]=e[t+r];r=-1;for(var c=Array(t+1);++r<t;)c[r]=e[r];return c[t]=o,$l(i,this,c)}}function ql(i){return ed(i)||td(i)||!!(Uo&&i&&i[Uo])}function Zl(i){if(typeof i=="string"||ad(i))return i;var t=i+"";return t=="0"&&1/i==-1/0?"-0":t}function td(i){return rd(i)&&Nl.call(i,"callee")&&(!Yl.call(i,"callee")||qs.call(i)==Ll)}var ed=Array.isArray;function nd(i){return i!=null&&sd(i.length)&&!id(i)}function rd(i){return Jo(i)&&nd(i)}function id(i){var t=od(i)?qs.call(i):"";return t==Hl||t==Wl}function sd(i){return typeof i=="number"&&i>-1&&i%1==0&&i<=Fl}function od(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function Jo(i){return!!i&&typeof i=="object"}function ad(i){return typeof i=="symbol"||Jo(i)&&qs.call(i)==Ol}var cd=Ql(function(i,t){return i==null?{}:Xl(i,jl(Ul(t),Zl))}),hd=cd;const Qo=Fn(hd);var qo="Expected a function",Zo=NaN,ld="[object Symbol]",dd=/^\s+|\s+$/g,ud=/^[-+]0x[0-9a-f]+$/i,fd=/^0b[01]+$/i,gd=/^0o[0-7]+$/i,pd=parseInt,md=typeof $t=="object"&&$t&&$t.Object===Object&&$t,yd=typeof self=="object"&&self&&self.Object===Object&&self,vd=md||yd||Function("return this")(),wd=Object.prototype,xd=wd.toString,Sd=Math.max,Cd=Math.min,Zs=function(){return vd.Date.now()};function bd(i,t,e){var r,s,o,c,u,g,y=0,x=!1,C=!1,A=!0;if(typeof i!="function")throw new TypeError(qo);t=ta(t)||0,hs(e)&&(x=!!e.leading,C="maxWait"in e,o=C?Sd(ta(e.maxWait)||0,t):o,A="trailing"in e?!!e.trailing:A);function _(Q){var Y=r,Z=s;return r=s=void 0,y=Q,c=i.apply(Z,Y),c}function F(Q){return y=Q,u=setTimeout(G,t),x?_(Q):c}function R(Q){var Y=Q-g,Z=Q-y,wt=t-Y;return C?Cd(wt,o-Z):wt}function z(Q){var Y=Q-g,Z=Q-y;return g===void 0||Y>=t||Y<0||C&&Z>=o}function G(){var Q=Zs();if(z(Q))return V(Q);u=setTimeout(G,R(Q))}function V(Q){return u=void 0,A&&r?_(Q):(r=s=void 0,c)}function j(){u!==void 0&&clearTimeout(u),y=0,r=g=s=u=void 0}function U(){return u===void 0?c:V(Zs())}function N(){var Q=Zs(),Y=z(Q);if(r=arguments,s=this,g=Q,Y){if(u===void 0)return F(g);if(C)return u=setTimeout(G,t),_(g)}return u===void 0&&(u=setTimeout(G,t)),c}return N.cancel=j,N.flush=U,N}function Pd(i,t,e){var r=!0,s=!0;if(typeof i!="function")throw new TypeError(qo);return hs(e)&&(r="leading"in e?!!e.leading:r,s="trailing"in e?!!e.trailing:s),bd(i,t,{leading:r,maxWait:t,trailing:s})}function hs(i){var t=typeof i;return!!i&&(t=="object"||t=="function")}function Md(i){return!!i&&typeof i=="object"}function Td(i){return typeof i=="symbol"||Md(i)&&xd.call(i)==ld}function ta(i){if(typeof i=="number")return i;if(Td(i))return Zo;if(hs(i)){var t=typeof i.valueOf=="function"?i.valueOf():i;i=hs(t)?t+"":t}if(typeof i!="string")return i===0?i:+i;i=i.replace(dd,"");var e=fd.test(i);return e||gd.test(i)?pd(i.slice(2),e?2:8):ud.test(i)?Zo:+i}var Ad=Pd;const to=Fn(Ad);var Ed=Object.defineProperty,Id=(i,t,e)=>t in i?Ed(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,_d=(i,t,e)=>(Id(i,t+"",e),e),ea=(i,t)=>{for(let e=0,r=i.length;e<r;e++)t(i[e],e)},Mr=(i,t)=>{const e=[];for(let r=0,s=i.length;r<s;r++)e.push(t(i[r],r));return e},na=(i,t,e)=>{const r=i[t];i[t]=i[e],i[e]=r},Fe=({r:i,g:t,b:e,a:r})=>`rgba(${i},${t},${e},${r})`,kd=i=>{i=i.toUpperCase();const t=i.match(/[0-9A-F]{1,6}/);return t?(i=t[0],i.length===6?i:((i.length===4||i.length===5)&&(i=i.slice(0,3)),i.length===3?i.split("").map(e=>e+e).join(""):i.padEnd(6,i))):""},ls=i=>{const{r:t,g:e,b:r}=i;return(t<<16|e<<8|r).toString(16).toUpperCase().padStart(6,"0")},ge=i=>{if(i=kd(i),!i)return null;const t=parseInt(i.slice(0,2),16),e=parseInt(i.slice(2,4),16),r=parseInt(i.slice(4,6),16),s=i.slice(6,8),o=s?parseInt(s,16)/255:1;return{r:t,g:e,b:r,a:o}},Tr=()=>{},Pi=()=>Uc(),Rd=()=>{let i=0;return()=>{const t=String(i);return i++,t}},ra={maxIdxMap:new Map,gen(i){var t;let e=(t=this.maxIdxMap.get(i))!=null?t:0;return e++,this.maxIdxMap.set(i,e),`${i} ${e}`},setMaxIdx(i){var t;const e=i.match(/^(.*)\s+(\d+)$/);if(e){const[,r,s]=e,o=Number(s);this.maxIdxMap.set(r,Math.max((t=this.maxIdxMap.get(r))!=null?t:0,o))}}},ie=(i,t)=>{const e=Math.floor(i/t),r=t*e,s=t*(e+1);return i-r<=s-i?r:s},ia=(i,t,e,r,s,o=!1)=>{let c=r+i/e,u=s+t/e;return o&&(c=Math.round(c),u=Math.round(u)),{x:c,y:u}},Dd=(i,t,e,r,s)=>({x:(i-r)*e,y:(t-s)*e}),ds=i=>{const t=Math.floor(i),e=Math.ceil(i);return(i-t<e-i?t:e)+.5},Bd=(i,t)=>{if(i.length!==t.length)return!1;const e=new Map;for(let r=0,s=i.length;r<s;r++)e.set(i[r],!0);for(let r=0,s=t.length;r<s;r++)if(!e.get(t[r]))return!1;return!0},sa=(i,t=2)=>Number(i.toFixed(t)),eo=()=>window.devicePixelRatio||1,Fd=(i,t,e,r)=>{if(i===0||t===0)return 1;const s=e/i,o=r/t;return Math.max(s,o)},oa=(i,t)=>{if(i.length===0)throw new Error("sortedArr can not be empty");if(i.length===1)return i[0];let e=0,r=i.length-1;for(;e<=r;){const s=Math.floor((e+r)/2);if(i[s]===t)return i[s];i[s]<t?e=s+1:r=s-1}return e>=i.length?i[r]:r<0?i[e]:Math.abs(i[r]-t)<=Math.abs(i[e]-t)?i[r]:i[e]},Ld=()=>navigator.platform.toLowerCase().includes("win")||navigator.userAgent.includes("Windows"),Hd=i=>typeof i=="string"?i.replace(/<|&|>/g,t=>({"<":"&lt;",">":"&gt;","&":"&amp;"})[t]):"",Le=class{constructor(){_d(this,"eventMap",{})}on(i,t){return this.eventMap[i]||(this.eventMap[i]=[]),this.eventMap[i].push(t),this}emit(i,...t){const e=this.eventMap[i];return!e||e.length===0?!1:(e.forEach(r=>{r(...t)}),!0)}off(i,t){return this.eventMap[i]&&(this.eventMap[i]=this.eventMap[i].filter(e=>e!==t)),this}};class aa{constructor(t){S(this,"redoStack",[]);S(this,"undoStack",[]);S(this,"isEnableRedoUndo",!0);S(this,"emitter",new Le);S(this,"isBatching",!1);this.editor=t}redo(){var t,e;if(this.isEnableRedoUndo&&this.redoStack.length>0){const r=this.redoStack.pop(),s=r.isBatched,o=[r];if(s){for(;this.redoStack.length>0&&this.redoStack.at(-1).isBatched;){const c=this.redoStack.pop();o.push(c)}console.log("------- [redo] batched start -----")}for(const c of o){const u=c.command;console.log(`%c Redo %c [${u.desc}]`,"background: #f04; color: #ee0",""),this.undoStack.push(c),(e=(t=c.hooks)==null?void 0:t.beforeRedo)==null||e.call(t),u.redo()}s&&console.log("------- [redo] batched end -----"),this.editor.render(),this.emitStatusChange()}}undo(){var t,e;if(this.isEnableRedoUndo&&this.undoStack.length>0){const r=this.undoStack.pop(),s=r.isBatched,o=[r];if(s){for(;this.undoStack.length>0&&this.undoStack.at(-1).isBatched;){const c=this.undoStack.pop();o.push(c)}console.log("------- [undo] batched start -----")}for(const c of o){const u=c.command;console.log(`%c Undo %c [${u.desc}]`,"background: #40f; color: #eee",""),this.redoStack.push(c),(e=(t=c.hooks)==null?void 0:t.beforeUndo)==null||e.call(t),u.undo()}s&&console.log("------- [undo] batched end -----"),this.editor.render(),this.emitStatusChange()}}enableRedoUndo(){this.isEnableRedoUndo=!0}disableRedoUndo(){this.isEnableRedoUndo=!1}batchCommandStart(){this.isBatching=!0}batchCommandEnd(){this.isBatching=!1}pushCommand(t,e){this.emitter.emit("beforeExecCmd"),console.log(`%c Exec %c [${t.desc}]`,"background: #222; color: #bada55","");const r={command:t};this.isBatching&&(r.isBatched=!0),e&&(r.hooks=e),this.undoStack.push(r),this.redoStack=[],this.emitStatusChange()}emitStatusChange(){this.emitter.emit("change",{canRedo:this.redoStack.length>0,canUndo:this.undoStack.length>0})}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}clearRecords(){this.redoStack=[],this.undoStack=[],this.emitStatusChange()}}class Wd{constructor(t,e){this.desc=t,this.cmds=e}redo(){for(const t of this.cmds)t.redo()}undo(){for(let t=this.cmds.length-1;t>=0;t--)this.cmds[t].undo()}}class Ln{constructor(t,e,r,s){if(this.desc=t,this.elements=e,this.attrs=r,this.prevAttrs=s,e.length!==s.length)throw new Error(`elements 和 preAttrs 数量不匹配 ${e.length} ${s.length}`)}redo(){var r;const{elements:t,attrs:e}=this;for(let s=0,o=this.elements.length;s<o;s++){const c=Array.isArray(e)?e[s]:ht(e),u=t[s];if(c.parentIndex&&u.removeFromParent(),u.updateAttrs(c),c.parentIndex){const g=u.getParent();g&&g.insertChild(u,(r=u.attrs.parentIndex)==null?void 0:r.position)}}}undo(){var r;const{elements:t,prevAttrs:e}=this;for(let s=0,o=this.elements.length;s<o;s++){const c=t[s],u=e[s];if(t[s].updateAttrs(e[s]),"parentIndex"in u&&u.parentIndex===void 0)c.removeFromParent();else if(u.parentIndex){const g=c.getParent();g&&g.insertChild(c,(r=c.attrs.parentIndex)==null?void 0:r.position)}}}}S(Ln,"type","SetElementsAttrs");class Mi{constructor(t,e,r,s,o=new Set,c=new Set){this.desc=t,this.editor=e,this.originAttrsMap=r,this.updatedAttrsMap=s,this.removedIds=o,this.newIds=c,r.size!==s.size&&(console.warn(`originAttrsMap 和 updatedAttrsMap 数量不匹配 ${r.size} ${s.size}`),console.log("origin:",r),console.log("update:",s))}redo(){var r;const t=this.updatedAttrsMap,e=this.editor.doc;for(const[s,o]of t){const c=e.getGraphicsById(s);if(!c){console.warn(`graphics ${s} is lost.`);return}o.parentIndex&&c.removeFromParent(),c.updateAttrs(o),o.parentIndex&&c.insertAtParent(c.attrs.parentIndex.position)}for(const s of this.removedIds){const o=e.getGraphicsById(s);o&&(o.setDeleted(!0),o.removeFromParent())}for(const s of this.newIds){const o=e.getGraphicsById(s);if(o){o.setDeleted(!1);const c=(r=o.attrs.parentIndex)==null?void 0:r.position;c?o.insertAtParent(c):console.error("position lost")}}}undo(){var r;const t=this.originAttrsMap,e=this.editor.doc;for(const[s,o]of t){const c=e.getGraphicsById(s);if(!c){console.warn(`graphics ${s} is lost.`);return}o.parentIndex&&c.removeFromParent(),c.updateAttrs(o),o.parentIndex&&c.insertAtParent(c.attrs.parentIndex.position)}for(const s of this.removedIds){const o=e.getGraphicsById(s);if(o){o.setDeleted(!1);const c=(r=o.attrs.parentIndex)==null?void 0:r.position;c?o.insertAtParent(c):console.error("position lost")}}for(const s of this.newIds){const o=e.getGraphicsById(s);o&&(o.setDeleted(!0),o.removeFromParent())}this.newIds.size!==0&&this.editor.selectedElements.clear()}}S(Mi,"type","UpdateGraphicsAttrs");var ca={exports:{}};(function(i,t){(function(e,r){r(i)})($t,function(e){function r(G,V){if(!(G instanceof V))throw new TypeError("Cannot call a class as a function")}/**
 *  @preserve  JavaScript implementation of
 *  Algorithm for Automatically Fitting Digitized Curves
 *  by Philip J. Schneider
 *  "Graphics Gems", Academic Press, 1990
 *
 *  The MIT License (MIT)
 *
 *  https://github.com/soswow/fit-curves
 */function s(G,V,j){if(!Array.isArray(G))throw new TypeError("First argument should be an array");if(G.forEach(function(Y){if(!Array.isArray(Y)||Y.some(function(Z){return typeof Z!="number"})||Y.length!==G[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),G=G.filter(function(Y,Z){return Z===0||!Y.every(function(wt,ut){return wt===G[Z-1][ut]})}),G.length<2)return[];var U=G.length,N=F(G[1],G[0]),Q=F(G[U-2],G[U-1]);return o(G,N,Q,V,j)}function o(G,V,j,U,N){var Q=20,Y,Z,wt,ut,rt,dt,Ht,st,_t,mt,Xt,He,Kt;if(G.length===2)return He=R.vectorLen(R.subtract(G[0],G[1]))/3,Y=[G[0],R.addArrays(G[0],R.mulItems(V,He)),R.addArrays(G[1],R.mulItems(j,He)),G[1]],[Y];Z=x(G);var Tt=c(G,Z,Z,V,j,N);if(Y=Tt[0],ut=Tt[1],dt=Tt[2],ut===0||ut<U)return[Y];if(ut<U*U)for(wt=Z,rt=ut,Ht=dt,Kt=0;Kt<Q;Kt++){wt=g(Y,G,wt);var We=c(G,Z,wt,V,j,N);if(Y=We[0],ut=We[1],dt=We[2],ut<U)return[Y];if(dt===Ht){var Me=ut/rt;if(Me>.9999&&Me<1.0001)break}rt=ut,Ht=dt}if(Xt=[],st=R.subtract(G[dt-1],G[dt+1]),st.every(function(Ke){return Ke===0})){st=R.subtract(G[dt-1],G[dt]);var Zt=[-st[1],st[0]];st[0]=Zt[0],st[1]=Zt[1]}return _t=R.normalize(st),mt=R.mulItems(_t,-1),Xt=Xt.concat(o(G.slice(0,dt+1),V,_t,U,N)),Xt=Xt.concat(o(G.slice(dt),mt,j,U,N)),Xt}function c(G,V,j,U,N,Q){var Y,Z,wt;Y=u(G,j,U,N);var ut=C(G,Y,V);return Z=ut[0],wt=ut[1],Q&&Q({bez:Y,points:G,params:V,maxErr:Z,maxPoint:wt}),[Y,Z,wt]}function u(G,V,j,U){var N,Q,Y,Z,wt,ut,rt,dt,Ht,st,_t,mt,Xt,He,Kt,Tt,We,Me=G[0],Zt=G[G.length-1];for(N=[Me,null,null,Zt],Q=R.zeros_Xx2x2(V.length),Xt=0,He=V.length;Xt<He;Xt++)Tt=V[Xt],We=1-Tt,Y=Q[Xt],Y[0]=R.mulItems(j,3*Tt*(We*We)),Y[1]=R.mulItems(U,3*We*(Tt*Tt));for(Z=[[0,0],[0,0]],wt=[0,0],Xt=0,He=G.length;Xt<He;Xt++)Tt=V[Xt],Y=Q[Xt],Z[0][0]+=R.dot(Y[0],Y[0]),Z[0][1]+=R.dot(Y[0],Y[1]),Z[1][0]+=R.dot(Y[0],Y[1]),Z[1][1]+=R.dot(Y[1],Y[1]),Kt=R.subtract(G[Xt],z.q([Me,Me,Zt,Zt],Tt)),wt[0]+=R.dot(Y[0],Kt),wt[1]+=R.dot(Y[1],Kt);return ut=Z[0][0]*Z[1][1]-Z[1][0]*Z[0][1],rt=Z[0][0]*wt[1]-Z[1][0]*wt[0],dt=wt[0]*Z[1][1]-wt[1]*Z[0][1],Ht=ut===0?0:dt/ut,st=ut===0?0:rt/ut,mt=R.vectorLen(R.subtract(Me,Zt)),_t=1e-6*mt,Ht<_t||st<_t?(N[1]=R.addArrays(Me,R.mulItems(j,mt/3)),N[2]=R.addArrays(Zt,R.mulItems(U,mt/3))):(N[1]=R.addArrays(Me,R.mulItems(j,Ht)),N[2]=R.addArrays(Zt,R.mulItems(U,st))),N}function g(G,V,j){return j.map(function(U,N){return y(G,V[N],U)})}function y(G,V,j){var U=R.subtract(z.q(G,j),V),N=z.qprime(G,j),Q=R.mulMatrix(U,N),Y=R.sum(R.squareItems(N))+2*R.mulMatrix(U,z.qprimeprime(G,j));return Y===0?j:j-Q/Y}function x(G){var V=[],j,U,N;return G.forEach(function(Q,Y){j=Y?U+R.vectorLen(R.subtract(Q,N)):0,V.push(j),U=j,N=Q}),V=V.map(function(Q){return Q/U}),V}function C(G,V,j){var U,N,Q,Y,Z,wt,ut,rt;N=0,Q=Math.floor(G.length/2);var dt=A(V,10);for(Z=0,wt=G.length;Z<wt;Z++)ut=G[Z],rt=_(V,j[Z],dt,10),Y=R.subtract(z.q(V,rt),ut),U=Y[0]*Y[0]+Y[1]*Y[1],U>N&&(N=U,Q=Z);return[N,Q]}var A=function(V,j){for(var U,N=[0],Q=V[0],Y=0,Z=1;Z<=j;Z++)U=z.q(V,Z/j),Y+=R.vectorLen(R.subtract(U,Q)),N.push(Y),Q=U;return N=N.map(function(wt){return wt/Y}),N};function _(G,V,j,U){if(V<0)return 0;if(V>1)return 1;for(var N,Q,Y,Z,wt,ut=1;ut<=U;ut++)if(V<=j[ut]){Z=(ut-1)/U,Y=ut/U,Q=j[ut-1],N=j[ut],wt=(V-Q)/(N-Q)*(Y-Z)+Z;break}return wt}function F(G,V){return R.normalize(R.subtract(G,V))}var R=function(){function G(){r(this,G)}return G.zeros_Xx2x2=function(j){for(var U=[];j--;)U.push([0,0]);return U},G.mulItems=function(j,U){return j.map(function(N){return N*U})},G.mulMatrix=function(j,U){return j.reduce(function(N,Q,Y){return N+Q*U[Y]},0)},G.subtract=function(j,U){return j.map(function(N,Q){return N-U[Q]})},G.addArrays=function(j,U){return j.map(function(N,Q){return N+U[Q]})},G.addItems=function(j,U){return j.map(function(N){return N+U})},G.sum=function(j){return j.reduce(function(U,N){return U+N})},G.dot=function(j,U){return G.mulMatrix(j,U)},G.vectorLen=function(j){return Math.hypot.apply(Math,j)},G.divItems=function(j,U){return j.map(function(N){return N/U})},G.squareItems=function(j){return j.map(function(U){return U*U})},G.normalize=function(j){return this.divItems(j,this.vectorLen(j))},G}(),z=function(){function G(){r(this,G)}return G.q=function(j,U){var N=1-U,Q=R.mulItems(j[0],N*N*N),Y=R.mulItems(j[1],3*N*N*U),Z=R.mulItems(j[2],3*N*U*U),wt=R.mulItems(j[3],U*U*U);return R.addArrays(R.addArrays(Q,Y),R.addArrays(Z,wt))},G.qprime=function(j,U){var N=1-U,Q=R.mulItems(R.subtract(j[1],j[0]),3*N*N),Y=R.mulItems(R.subtract(j[2],j[1]),6*N*U),Z=R.mulItems(R.subtract(j[3],j[2]),3*U*U);return R.addArrays(R.addArrays(Q,Y),Z)},G.qprimeprime=function(j,U){return R.addArrays(R.mulItems(R.addArrays(R.subtract(j[2],R.mulItems(j[1],2)),j[0]),6*(1-U)),R.mulItems(R.addArrays(R.subtract(j[3],R.mulItems(j[2],2)),j[1]),6*U))},G}();e.exports=s,e.exports.fitCubic=o,e.exports.createTangent=F})})(ca);var Od=ca.exports;const ha=Fn(Od);var Gd=Object.defineProperty,la=Object.getOwnPropertySymbols,zd=Object.prototype.hasOwnProperty,Kd=Object.prototype.propertyIsEnumerable,sn=Math.pow,no=(i,t,e)=>t in i?Gd(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e,da=(i,t)=>{for(var e in t||(t={}))zd.call(t,e)&&no(i,e,t[e]);if(la)for(var e of la(t))Kd.call(t,e)&&no(i,e,t[e]);return i},yn=(i,t,e)=>(no(i,typeof t!="symbol"?t+"":t,e),e),lt=class{constructor(i=1,t=0,e=0,r=1,s=0,o=0){yn(this,"a"),yn(this,"b"),yn(this,"c"),yn(this,"d"),yn(this,"tx"),yn(this,"ty"),this.a=i,this.b=t,this.c=e,this.d=r,this.tx=s,this.ty=o}set(i,t,e,r,s,o){return this.a=i,this.b=t,this.c=e,this.d=r,this.tx=s,this.ty=o,this}getArray(){return[this.a,this.b,this.c,this.d,this.tx,this.ty]}apply(i){const t=i.x,e=i.y;return{x:this.a*t+this.c*e+this.tx,y:this.b*t+this.d*e+this.ty}}applyInverse(i){const t=this.a,e=this.b,r=this.c,s=this.d,o=this.tx,c=this.ty,u=1/(t*s+r*-e),g=i.x,y=i.y;return{x:s*u*g+-r*u*y+(c*r-o*s)*u,y:t*u*y+-e*u*g+(-c*t+o*e)*u}}translate(i,t){return this.tx+=i,this.ty+=t,this}scale(i,t){return this.a*=i,this.d*=t,this.c*=i,this.b*=t,this.tx*=i,this.ty*=t,this}rotate(i){const t=Math.cos(i),e=Math.sin(i),r=this.a,s=this.c,o=this.tx;return this.a=r*t-this.b*e,this.b=r*e+this.b*t,this.c=s*t-this.d*e,this.d=s*e+this.d*t,this.tx=o*t-this.ty*e,this.ty=o*e+this.ty*t,this}append(i){const t=this.a,e=this.b,r=this.c,s=this.d;return this.a=i.a*t+i.b*r,this.b=i.a*e+i.b*s,this.c=i.c*t+i.d*r,this.d=i.c*e+i.d*s,this.tx=i.tx*t+i.ty*r+this.tx,this.ty=i.tx*e+i.ty*s+this.ty,this}appendFrom(i,t){const e=i.a,r=i.b,s=i.c,o=i.d,c=i.tx,u=i.ty,g=t.a,y=t.b,x=t.c,C=t.d;return this.a=e*g+r*x,this.b=e*y+r*C,this.c=s*g+o*x,this.d=s*y+o*C,this.tx=c*g+u*x+t.tx,this.ty=c*y+u*C+t.ty,this}prepend(i){const t=this.tx;if(i.a!==1||i.b!==0||i.c!==0||i.d!==1){const e=this.a,r=this.c;this.a=e*i.a+this.b*i.c,this.b=e*i.b+this.b*i.d,this.c=r*i.a+this.d*i.c,this.d=r*i.b+this.d*i.d}return this.tx=t*i.a+this.ty*i.c+i.tx,this.ty=t*i.b+this.ty*i.d+i.ty,this}invert(){const i=this.a,t=this.b,e=this.c,r=this.d,s=this.tx,o=i*r-t*e;return this.a=r/o,this.b=-t/o,this.c=-e/o,this.d=i/o,this.tx=(e*this.ty-r*s)/o,this.ty=-(i*this.ty-t*s)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const i=new lt;return i.a=this.a,i.b=this.b,i.c=this.c,i.d=this.d,i.tx=this.tx,i.ty=this.ty,i}copyTo(i){return i.a=this.a,i.b=this.b,i.c=this.c,i.d=this.d,i.tx=this.tx,i.ty=this.ty,i}copyFrom(i){return this.a=i.a,this.b=i.b,this.c=i.c,this.d=i.d,this.tx=i.tx,this.ty=i.ty,this}equals(i){return i.a===this.a&&i.b===this.b&&i.c===this.c&&i.d===this.d&&i.tx===this.tx&&i.ty===this.ty}toString(){return`[Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}},ro=Math.PI*2;function Ti(i){return i*180/Math.PI}var ua=i=>(i=i%ro,i<0&&(i+=ro),i),io=i=>(i=i%360,i<0&&(i+=360),i),$d=(i,t)=>{const e=i.x*t.x+i.y*t.y,r=Math.sqrt(i.x*i.x+i.y*i.y)*Math.sqrt(t.x*t.x+t.y*t.y);let s=e/r;return s>1?s=1:s<-1&&(s=-1),Math.acos(s)},vn=(i,t,e)=>{const r=i.x*t.x+i.y*t.y,s=Math.sqrt(i.x*i.x+i.y*i.y)*Math.sqrt(t.x*t.x+t.y*t.y);let o=r/s;o>1?o=1:o<-1&&(o=-1);let c=Math.acos(o);const u=i.x*t.y-i.y*t.x;return(e?u>0:u<0)&&(c=ro-c),c},ti=(i,t={x:0,y:-1})=>{const r=new lt(i[0],i[1],i[2],i[3],0,0).apply(t);return vn(t,r)},fa=i=>i[0]*i[3]-i[1]*i[2]<0,so=(i,t)=>({x:(i.x+t.x)/2,y:(i.y+t.y)/2}),Mn=(i,t)=>({x:i.x+t.x,y:i.y+t.y}),Hn=(i,t)=>({x:i.x-t.x,y:i.y-t.y}),us=i=>i.x===0&&i.y===0,jd=1e-10,oo=(i,t,e=jd)=>Math.abs(i.x-t.x)<e&&Math.abs(i.y-t.y)<e,ne=(i,t)=>Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2)),fs=(i,t,e)=>i*(1-e)+t*e,rr=(i,t,e)=>({x:fs(i.x,t.x,e),y:fs(i.y,t.y,e)}),Ai=i=>{const t=Math.sqrt(i.x*i.x+i.y*i.y);return{x:i.x/t,y:i.y/t}},Vd=(i,t,e)=>{const r=Hn(i[1],i[0]),s={x:-r.y,y:r.x},o=Ai(s),c={x:t.x+o.x*e,y:t.y+o.y*e},u={x:t.x-o.x*e,y:t.y-o.y*e};return[c,u]},gs=(i,t)=>{if(i.length===4){const[e,r,s,o]=i,c=t*t,u=1-t,g=u*u,y=g*u,x=3*t*g,C=3*c*u,A=c*t;return{x:y*e.x+x*r.x+C*s.x+A*o.x,y:y*e.y+x*r.y+C*s.y+A*o.y}}for(;i.length>1;){const e=[];for(let r=0,s=i.length-1;r<s;r++)e.push(rr(i[r],i[r+1],t));i=e}return i[0]},Nd=(i,t,e)=>{const r=i.point,s=t.point,o=Mn(i.point,i.out),c=Mn(t.point,t.in),u=rr(r,o,e),g=rr(o,c,e),y=rr(c,s,e),x=rr(u,g,e),C=rr(g,y,e),A=rr(x,C,e);return[{point:i.point,in:i.in,out:Hn(u,i.point)},{point:A,in:Hn(x,A),out:Hn(C,A)},{point:t.point,in:Hn(y,t.point),out:t.out}]},ao=()=>[1,0,0,1,0,0],ze=(i,t)=>{const e=i[0],r=i[1],s=i[2],o=i[3];return[t[0]*e+t[1]*s,t[0]*r+t[1]*o,t[2]*e+t[3]*s,t[2]*r+t[3]*o,t[4]*e+t[5]*s+i[4],t[4]*r+t[5]*o+i[5]]},Ar=(i,t)=>({x:t.x*i[0]+t.y*i[2]+i[4],y:t.x*i[1]+t.y*i[3]+i[5]}),co=(i,t)=>Ar(wn(i),t),wn=i=>{const t=i[0],e=i[1],r=i[2],s=i[3],o=i[4],c=t*s-e*r;return[s/c,-e/c,-r/c,t/c,(r*i[5]-s*o)/c,-(t*i[5]-e*o)/c]},Yd=(i,t,e,r,s)=>{if(!e)return{x:i,y:t};const o=Math.cos(e),c=Math.sin(e);return{x:(i-r)*o-(t-s)*c+r,y:(i-r)*c+(t-s)*o+s}},ga=.5522847498307936,ho=(i,t)=>({x:Math.min(i.x,t.x),y:Math.min(i.y,t.y),width:Math.abs(i.x-t.x),height:Math.abs(i.y-t.y)}),lo=(i,t,e=0)=>(t.transform&&(i=new lt(...t.transform).applyInverse(i)),i.x>=-e&&i.y>=-e&&i.x<=t.width+e&&i.y<=t.height+e),pa=(i,t,e,r=0)=>{const s=t.x-r,o=t.y-r,c=t.width+r*2,u=t.height+r*2;return i.x>=s&&i.y>=o&&i.x<=s+c&&i.y<=o+u?i.x<=s+e[0]&&i.y<=o+e[0]?sn(i.x-s-e[0],2)+sn(i.y-o-e[0],2)<=sn(e[0],2):i.x>=s+c-e[1]&&i.y<=o+e[1]?sn(i.x-s-c+e[1],2)+sn(i.y-o-e[1],2)<=sn(e[1],2):i.x>=s+c-e[2]&&i.y>=o+u-e[2]?sn(i.x-s-c+e[2],2)+sn(i.y-o-u+e[2],2)<=sn(e[2],2):i.x<=s+e[3]&&i.y>=o+u-e[3]?sn(i.x-s-e[3],2)+sn(i.y-o-u+e[3],2)<=sn(e[3],2):!0:!1},Er=({x:i,y:t,width:e,height:r})=>{const s=i+e,o=t+r;return ho({x:i,y:t},{x:s,y:o})},Ud=(i,t)=>i.x<=t.x+t.width&&i.x+i.width>=t.x&&i.y<=t.y+t.height&&i.y+i.height>=t.y,uo=(i,t)=>{typeof t=="number"&&(t=[t,t,t,t]);const{x:e,y:r,width:s,height:o}=i;return{x:e-t[3],y:r-t[0],width:s+t[1]+t[3],height:o+t[0]+t[2]}},Xd=i=>{const{x:t,y:e,width:r,height:s}=i,o=r/2,c=s/2;return[{x:t+o,y:e},{x:t+r,y:e+c},{x:t+o,y:e+s},{x:t,y:e+c}]},Jd=(i,t)=>{const{x:e,y:r}=i,s=t.x-i.x,o=t.y-i.y,c=ua(Math.atan2(o,s)),u=e+s/2,g=r+o/2,y=Yd(e,r,-c,u,g);return{x:y.x,y:y.y,width:Math.sqrt(s*s+o*o),height:0,rotation:c}},ir=(i,t)=>{const{x:e,y:r,width:s,height:o}=i;let c=[{x:e,y:r},{x:e+s,y:r},{x:e+s,y:r+o},{x:e,y:r+o}];if(t){const u=new lt(...t);c=c.map(g=>{const y=u.apply(g);return{x:y.x,y:y.y}})}return c},ma=i=>{const t=new lt(i.transform[0],i.transform[1],i.transform[2],i.transform[3],0,0),e=t.apply({x:i.width,y:0}),r=t.apply({x:0,y:i.height}),s={x:0,y:0};return{width:ne(e,s),height:ne(r,s)}},ps=i=>{const t=ma(i),e=t.width?i.width/t.width:1,r=t.height?i.height/t.height:1,s=new lt().scale(e,r),o=new lt(...i.transform).append(s);return{width:t.width,height:t.height,transform:o.getArray()}},fo=i=>({minX:i.x,minY:i.y,maxX:i.x+i.width,maxY:i.y+i.height}),Wn=i=>({x:i.minX,y:i.minY,width:i.maxX-i.minX,height:i.maxY-i.minY}),Qd=(i,t=0)=>{const{minX:e,minY:r,maxX:s,maxY:o}=fo(i);if(t<=0)return[{type:"M",points:[{x:e,y:r}]},{type:"L",points:[{x:s,y:r}]},{type:"L",points:[{x:s,y:o}]},{type:"L",points:[{x:e,y:o}]},{type:"Z",points:[]}];const c=i.width/2,u=i.height/2,g=Math.min(t,c,u),y=g===c,x=g===u,C=g*ga,A=g*ga,_=[{type:"M",points:[{x:e,y:r+g}]},{type:"C",points:[{x:e,y:r+g-A},{x:e+g-C,y:r},{x:e+g,y:r}]}];return y||_.push({type:"L",points:[{x:s-g,y:r}]}),_.push({type:"C",points:[{x:s-g+C,y:r},{x:s,y:r+g-A},{x:s,y:r+g}]}),x||_.push({type:"L",points:[{x:s,y:o-g}]}),_.push({type:"C",points:[{x:s,y:o-g+A},{x:s-g+C,y:o},{x:s-g,y:o}]}),y||_.push({type:"L",points:[{x:e+g,y:o}]}),_.push({type:"C",points:[{x:e+g-C,y:o},{x:e,y:o-g+A},{x:e,y:o-g}]}),x||_.push({type:"L",points:[{x:e,y:r+g}]}),_.push({type:"Z",points:[]}),_},ya=(i,t,e=0)=>t.x>=i.minX-e&&t.y>=i.minY-e&&t.x<=i.maxX+e&&t.y<=i.maxY+e,On=i=>{if(i.length===0)throw new Error("the count of boxes can not be 0");let t=1/0,e=1/0,r=-1/0,s=-1/0;for(const o of i)t=Math.min(t,o.minX),e=Math.min(e,o.minY),r=Math.max(r,o.maxX),s=Math.max(s,o.maxY);return{minX:t,minY:e,maxX:r,maxY:s}},go=(i,t)=>i.minX<=t.maxX&&i.maxX>=t.minX&&i.minY<=t.maxY&&i.maxY>=t.minY,va=(i,t)=>i.minX<=t.minX&&i.minY<=t.minY&&i.maxX>=t.maxX&&i.maxY>=t.maxY,Ei=i=>{let t=1/0,e=1/0,r=-1/0,s=-1/0;for(const o of i)t=Math.min(t,o.x),e=Math.min(e,o.y),r=Math.max(r,o.x),s=Math.max(s,o.y);return{minX:t,minY:e,maxX:r,maxY:s}},Ii=(i,t)=>{let e=0,r=0,s=i.width,o=i.height;t&&(e-=t,r-=t,s+=t*2,o+=t*2);const c=i.transform,u=ir({x:e,y:r,width:s,height:o}).map(g=>Ar(c,g));return Ei(u)},qd=i=>{const t=.5522847498307936,{minX:e,minY:r,maxX:s,maxY:o}=fo(i),c=(e+s)/2,u=(r+o)/2,g=i.width/2,y=i.height/2,x=g*t,C=y*t;return[{type:"M",points:[{x:s,y:u}]},{type:"C",points:[{x:s,y:u+C},{x:c+x,y:o},{x:c,y:o}]},{type:"C",points:[{x:c-x,y:o},{x:e,y:u+C},{x:e,y:u}]},{type:"C",points:[{x:e,y:u-C},{x:c-x,y:r},{x:c,y:r}]},{type:"C",points:[{x:s,y:u-C},{x:c+x,y:r},{x:s,y:u}]},{type:"Z",points:[]}]},po=(i,t,e,r=!0)=>{if(i.x===t.x&&i.y===t.y)return{t:0,point:{x:i.x,y:i.y}};const s=t.x-i.x,o=t.y-i.y;let c=((e.x-i.x)*s+(e.y-i.y)*o)/(s*s+o*o);r||(c=Math.max(0,Math.min(1,c)));const u={x:i.x+c*s,y:i.y+c*o};return{t:c,point:u}},Zd=(i,t,e=4)=>{let r={x:0,y:0},s=1/0;for(let o=1;o<=e;o++){const c=Math.PI/e*o,u={x:i.x+Math.cos(c),y:i.y+Math.sin(c)},{point:g}=po(i,u,t),y=ne(g,t);if(y===0)return g;y<s&&(s=y,r=g)}return r},tu=(i,t,e,r)=>{const{x:s,y:o}=i,{x:c,y:u}=t,{x:g,y}=e,{x,y:C}=r,A=u-o,_=s-c,F=s*u-c*o,R=C-y,z=g-x,G=g*C-x*y,V=A*z-_*R;if(Math.abs(V)<1e-9)return null;const j=(F*z-G*_)/V,U=(A*G-F*R)/V;return{x:j,y:U}},eu=(i,t)=>{const e=ha(i.map(({point:s})=>[s.x,s.y]),t),r=[];for(let s=0,o=e.length;s<=o;s++){const c=e[s],u=e[s-1],g=c?{x:c[0][0],y:c[0][1]}:{x:u[3][0],y:u[3][1]},y=c?{x:c[1][0]-g.x,y:c[1][1]-g.y}:{x:0,y:0},x=u?{x:u[2][0]-g.x,y:u[2][1]-g.y}:{x:0,y:0};r.push({point:g,in:x,out:y})}return r},nu=(i,t,e)=>{const r=i.segs;if(!i.closed&&(t<0||t>=r.length-1))return r.splice(t,1),i;let o=t+1;i.closed&&(o%=r.length);const c=r[t],u=r[o],g=Nd(c,u,e);return o===0?(i.segs.splice(t,1,g[0],g[1]),i.segs.splice(0,1,g[2])):i.segs.splice(t,2,...g),i},ru=(i,t)=>{const e=i.segs;if(e.length<=1)return i.segs=[],i;if(!i.closed&&(t<=0||t>=e.length-1))return e.splice(t,1),i;let s=t-1,o=t+1;i.closed&&(s%=e.length,o%=e.length);const c=e[t],u=e[s],g=e[o];if(us(u.out)&&us(g.in)&&us(c.in)&&us(c.out))return e.splice(t,1),i;const x=[u.point,Mn(u.out,u.point),Mn(c.in,c.point),c.point],C=[c.point,Mn(c.out,c.point),Mn(g.in,g.point),g.point],A=[gs(x,.3),gs(x,.6)],_=[gs(C,.3),gs(C,.6)],F=ha([u.point,...A,c.point,..._,g.point].map(({x:N,y:Q})=>[N,Q]),9999)[0],R=Hn({x:F[1][0],y:F[1][1]},u.point),z=Hn({x:F[2][0],y:F[2][1]},g.point);let G=Ai(u.out);(Number.isNaN(G.x)||Number.isNaN(G.y))&&(G=Ai(R));let V=Ai(g.in);(Number.isNaN(V.x)||Number.isNaN(V.y))&&(V=Ai(z));const j=ne({x:0,y:0},R),U=ne({x:0,y:0},z);return u.out={x:G.x*j,y:G.y*j},g.in={x:V.x*U,y:V.y*U},e.splice(t,1),i},iu=class{constructor(i){yn(this,"points"),yn(this,"dpoints",[]),yn(this,"_bbox",null),yn(this,"lut",[]),this.points=i,this.dpoints[0]={x:3*(i[1].x-i[0].x),y:3*(i[1].y-i[0].y)},this.dpoints[1]={x:3*(i[2].x-i[1].x),y:3*(i[2].y-i[1].y)},this.dpoints[2]={x:3*(i[3].x-i[2].x),y:3*(i[3].y-i[2].y)}}compute(i){const t=i*i,e=1-i,r=e*e,s=r*e,o=3*i*r,c=3*t*e,u=t*i,[g,y,x,C]=this.points;return{x:s*g.x+o*y.x+c*x.x+u*C.x,y:s*g.y+o*y.y+c*x.y+u*C.y}}extrema(){const i=this.dpoints,t=[...wa(i[0].x,i[1].x,i[2].x),...wa(i[0].y,i[1].y,i[2].y)].filter(e=>e>=0&&e<=1);return Array.from(new Set(t))}getBbox(){if(!this._bbox){const i=this.extrema().map(t=>this.compute(t));this._bbox=Ei([...i,this.points[0],this.points[3]])}return this._bbox}hitTest(i,t){if(!ya(this.getBbox(),i,t))return!1;const e=this.getLookupTable();let r=Number.MAX_SAFE_INTEGER,s=-1;for(let y=0;y<e.length;y++){const x=e[y],C=ne(i,x.pt);if(C<=t)return!0;C<r&&(r=C,s=y)}const o=e[s].t,c=s>0?e[s-1].t:o,u=s<e.length-1?e[s+1].t:o,g=.001;for(let y=c;y<=u;y+=g){const x=this.compute(y);if(ne(i,x)<=t)return!0}return!1}getLookupTable(){if(this.lut.length===0)for(let t=0;t<=100;t++){const e=t/100,r=this.compute(e);this.lut[t]={t:e,pt:r}}return this.lut}project(i){const t=this.getLookupTable();let e=Number.MAX_SAFE_INTEGER,r=-1;for(let y=0;y<t.length;y++){const x=t[y],C=ne(i,x.pt);if(C<e&&(e=C,r=y,C===0))break}if(e===0){const y=this.compute(t[r].t);return{point:y,t:t[r].t,dist:ne(i,y)}}let s=t[r].t;const o=r>0?t[r-1].t:s,c=r<t.length-1?t[r+1].t:s,u=.001;for(let y=o;y<=c;y+=u){const x=this.compute(y),C=ne(i,x);if(C<e&&(e=C,s=y,C===0))break}s<0&&(s=0),s>1&&(s=1);const g=this.compute(s);return{point:g,t:s,dist:ne(i,g)}}toCommand(){const[i,t,e,r]=this.points;return i.x===t.x&&t.x===e.x&&e.x===r.x?[{type:"M",points:[i]},{type:"C",points:[t,e,r]}]:[{type:"M",points:[i]},{type:"C",points:[t,e,r]}]}},wa=(i,t,e)=>{const r=i-2*t+e;if(r!==0){const s=t*t-i*e;if(s<0)return[];const o=Math.sqrt(s),c=i-t;return o===0?[(c-o)/r]:[(c-o)/r,(c+o)/r]}else return i!==t?[i/(i-t)/2]:[]},ms=class{constructor(i){yn(this,"bezierLists");const t=[];for(let e=0;e<i.length;e++){const r=i[e],s=r.segs;t[e]={isClosed:r.closed,curves:[]};for(let o=1;o<=s.length;o++){if(o===s.length&&!r.closed)continue;const c=s[o%s.length],u=s[o-1];t[e].curves.push(new iu([u.point,ms.getHandleOut(u),ms.getHandleIn(c),c.point]))}}this.bezierLists=t}static getHandleIn(i){return Mn(i.point,i.in)}static getHandleOut(i){return Mn(i.point,i.out)}getBbox(){let i=1/0,t=1/0,e=-1/0,r=-1/0;for(const{curves:s}of this.bezierLists)for(const o of s){const c=o.getBbox();i=Math.min(i,c.minX),t=Math.min(t,c.minY),e=Math.max(e,c.maxX),r=Math.max(r,c.maxY)}return{minX:i,minY:t,maxX:e,maxY:r}}getBRect(){const i=this.getBbox();return i.minX===1/0?{x:0,y:0,width:100,height:100}:{x:i.minX,y:i.minY,width:i.maxX-i.minX,height:i.maxY-i.minY}}hitTest(i,t){for(const{curves:e}of this.bezierLists)for(const r of e)if(r.hitTest(i,t))return!0;return!1}project(i,t=1/0){const e={dist:t,point:{x:0,y:0},index:[-1,-1],t:-1};for(let r=0;r<this.bezierLists.length;r++){const{curves:s}=this.bezierLists[r];for(let o=0;o<s.length;o++){const u=s[o].project(i);if(u.dist<e.dist&&(e.dist=u.dist,e.point=u.point,e.index=[r,o],e.t=u.t),u.dist===0)break}}return e.index[0]===-1?null:e}toCommands(){const i=[];for(const{isClosed:t,curves:e}of this.bezierLists){for(let r=0;r<e.length;r++){const o=e[r].toCommand();r===0?i.push(...o):i.push(...o.slice(1))}t&&i.push({type:"Z",points:[]})}return i}},Ir=(i,t)=>i.map(e=>e.type+e.points.map(r=>xa(r.x,t)+" "+xa(r.y,t)).join(" ")).join(" "),xa=(i,t=2)=>Number(i.toFixed(t)),su=({center:i,r:t,startAngle:e,endAngle:r,angleDir:s=!0})=>{s===!1&&([e,r]=[r,e]);const o=(r-e+Math.PI*2)%(Math.PI*2),c=o/2,u=4*(1-Math.cos(c))/(3*Math.sin(c)),g=new lt().rotate(e).scale(t,t).translate(i.x,i.y);r-=e,e=0;const y=g.apply({x:1,y:0}),x=g.apply({x:1,y:u}),C=g.apply({x:Math.cos(o)+u*Math.sin(o),y:Math.sin(o)-u*Math.cos(o)}),A=g.apply({x:Math.cos(o),y:Math.sin(o)});return s?[y,x,C,A]:[A,C,x,y]},ou=(i,t)=>{const e=i.width/2,r=i.height/2,s=[{x:e,y:0}],o=Math.PI*2/t,c=new lt().translate(-e,-r).rotate(o).translate(e,r);let u=s[0];for(let y=1;y<t;y++){const{x,y:C}=c.apply(u),A={x,y:C};s.push(A),u=A}const g=i.width/i.height;for(let y=1;y<t;y++){const x=s[y];x.x=fs(e,x.x,g)}return s},au=(i,t)=>{let e;for(let r=0;r<i.length;r++){const s=i[r],o=i[(r+1)%i.length],c={x:o.x-s.x,y:o.y-s.y},u={x:t.x-s.x,y:t.y-s.y},g=Math.sign(c.x*u.y-c.y*u.x);if(g!==0){if(e===void 0)e=g;else if(e!==g)return!1}}return!0},cu=(i,t)=>{let e=!1;for(let r=0;r<i.length;r++){let s=i[r],o=i[(r+1)%i.length];if(s.y>o.y&&([s,o]=[o,s]),s.y<=t.y&&o.y>t.y){const c=(t.x-s.x)*(o.y-s.y)-(o.x-s.x)*(t.y-s.y);if(c===0)return!0;c>0&&(e=!e)}}return e},Sa=(i,t)=>{const e=[];for(let r=0;r<i.length;r++){const s=i[(r-1+i.length)%i.length],o=i[r],c=i[(r+1)%i.length],u=hu(so(s,o),o,so(o,c),t),g=lu([s,o],[o,c],u);if(r===0)e.push({type:"M",points:[g.start]});else{const x=e[e.length-1].points,C=x[x.length-1];oo(g.start,C)||e.push({type:"L",points:[g.start]})}const y=su({center:g.center,r:u,startAngle:g.startAngle,endAngle:g.endAngle,angleDir:g.angleDir});e.push({type:"C",points:[y[1],y[2],y[3]]})}return e.push({type:"Z",points:[]}),e},hu=(i,t,e,r)=>{const s={x:t.x-i.x,y:t.y-i.y},o={x:t.x-e.x,y:t.y-e.y},c=$d(s,o)/2,u=Math.tan(c)*ne(i,t),g=Math.tan(c)*ne(t,e);return Math.min(r,u,g)},lu=(i,t,e)=>{const r=i[0],s=i[1],o=t[0],c=t[1],u={x:r.x-s.x,y:r.y-s.y},g={x:c.x-o.x,y:c.y-o.y},y=u.x*g.y-g.x*u.y;if(y===0)return null;let x,C;y<0?(x={x:u.y,y:-u.x},C={x:-g.y,y:g.x}):(x={x:-u.y,y:u.x},C={x:g.y,y:-g.x});const A=e/ne(r,s),_={x:x.x*A,y:x.y*A},F=[{x:r.x+_.x,y:r.y+_.y},{x:s.x+_.x,y:s.y+_.y}],R=e/ne(o,c),z={x:C.x*R,y:C.y*R},G=[{x:o.x+z.x,y:o.y+z.y},{x:c.x+z.x,y:c.y+z.y}],V=tu(F[0],F[1],G[0],G[1]),{point:j}=po(r,s,V,!0),{point:U}=po(o,c,V,!0),N={x:1,y:0},Q=vn(N,{x:j.x-V.x,y:j.y-V.y}),Y=vn(N,{x:U.x-V.x,y:U.y-V.y});return{center:V,start:j,end:U,startAngle:Q,endAngle:Y,angleDir:y<0}},Ca=(i,t,e,r={keepPolarSnap:!1,scaleFromCenter:!1})=>{if(!["se","ne","nw","sw"].includes(i))throw new Error(`invalid type "${i}"`);const s=i==="se"||i==="ne";let o={x:0,y:0};r.scaleFromCenter?o=new lt(...e.transform).apply({x:e.width/2,y:e.height/2}):s?o={x:e.transform[4],y:e.transform[5]}:o=new lt(...e.transform).apply({x:e.width,y:e.height}),r.keepPolarSnap&&(t=Zd(o,t));let c=ne(t,o);if(r.scaleFromCenter&&(c*=2),s){const u={x:t.x-o.x,y:t.y-o.y},g=vn({x:1,y:0},{x:t.x-o.x,y:t.y-o.y}),y=new lt().rotate(g).translate(o.x,o.y);return r.scaleFromCenter&&y.translate(-u.x,-u.y),{width:c,height:0,transform:y.getArray()}}else{const u={x:o.x-t.x,y:o.y-t.y},g=vn({x:1,y:0},u),y=new lt().rotate(g),x=y.apply({x:c,y:e.height});return y.translate(o.x-x.x,o.y-x.y),r.scaleFromCenter&&y.translate(u.x,u.y),{width:c,height:0,transform:y.getArray()}}},ys=(i,t)=>({width:i*2,height:t*2}),du={sw:{getLocalOrigin:i=>({x:i,y:0}),getNewSize:(i,t)=>({width:t.x-i.x,height:i.y-t.y}),isBaseWidthWhenKeepRatio:i=>i,getSizeWhenScaleFromCenter:ys},se:{getLocalOrigin:()=>({x:0,y:0}),getNewSize:(i,t)=>({width:i.x-t.x,height:i.y-t.y}),isBaseWidthWhenKeepRatio:i=>i,getSizeWhenScaleFromCenter:ys},nw:{getLocalOrigin:(i,t)=>({x:i,y:t}),getNewSize:(i,t)=>({width:t.x-i.x,height:t.y-i.y}),isBaseWidthWhenKeepRatio:i=>i,getSizeWhenScaleFromCenter:ys},ne:{getLocalOrigin:(i,t)=>({x:0,y:t}),getNewSize:(i,t)=>({width:i.x-t.x,height:t.y-i.y}),isBaseWidthWhenKeepRatio:i=>i,getSizeWhenScaleFromCenter:ys},n:{getLocalOrigin:(i,t)=>({x:i/2,y:t}),getNewSize:(i,t,e)=>({width:e.width,height:t.y-i.y}),isBaseWidthWhenKeepRatio:()=>!1,getSizeWhenScaleFromCenter:(i,t)=>({width:i,height:t*2})},s:{getLocalOrigin:i=>({x:i/2,y:0}),getNewSize:(i,t,e)=>({width:e.width,height:i.y-t.y}),isBaseWidthWhenKeepRatio:()=>!1,getSizeWhenScaleFromCenter:(i,t)=>({width:i,height:t*2})},e:{getLocalOrigin:(i,t)=>({x:0,y:t/2}),getNewSize:(i,t,e)=>({width:i.x-t.x,height:e.height}),isBaseWidthWhenKeepRatio:()=>!0,getSizeWhenScaleFromCenter:(i,t)=>({width:i*2,height:t})},w:{getLocalOrigin:(i,t)=>({x:i,y:t/2}),getNewSize:(i,t,e)=>({width:t.x-i.x,height:e.height}),isBaseWidthWhenKeepRatio:()=>!0,getSizeWhenScaleFromCenter:(i,t)=>({width:i*2,height:t})}},vs=(i,t,e,r)=>{const s=du[i];if(!s)throw new Error(`resize type ${i} is invalid`);const{keepRatio:o,scaleFromCenter:c,noChangeWidthAndHeight:u,flip:g=!0}=r??{},y=new lt(...e.transform),x={width:0,height:0,transform:y.clone()},C=c?{x:e.width/2,y:e.height/2}:s.getLocalOrigin(e.width,e.height),A=y.applyInverse(t);let _=s.getNewSize(A,C,e);if(c&&(_=s.getSizeWhenScaleFromCenter(_.width,_.height)),o){const U=e.width/e.height,Q=Math.abs(_.width/_.height)>U;s.isBaseWidthWhenKeepRatio(Q)?_.height=Math.sign(_.height)*Math.abs(_.width)/U:_.width=Math.sign(_.width)*Math.abs(_.height)*U}const F=new lt,R=Math.sign(_.width)||1,z=Math.sign(_.height)||1;u?(F.scale(_.width/e.width,_.height/e.height),x.width=e.width,x.height=e.height):(x.width=Math.abs(_.width),x.height=Math.abs(_.height),F.scale(R,z)),x.transform=x.transform.append(F);const G=x.transform.apply(c?{x:x.width/2,y:x.height/2}:s.getLocalOrigin(x.width,x.height)),V=y.apply(C),j={x:V.x-G.x,y:V.y-G.y};if(x.transform.prepend(new lt().translate(j.x,j.y)),!g){const U=new lt().translate(-x.width/2,-x.height/2).scale(R,z).translate(x.width/2,x.height/2);x.transform.append(U)}return{width:x.width,height:x.height,transform:x.transform.getArray()}},uu=(i,t,e)=>{const r=i.width/2,s=i.height/2,o=new Array(t*2);o[0]={x:r,y:0};const c=Math.PI*2/t,u=new lt().translate(-r,-s).rotate(c).translate(r,s);let g=o[0];for(let C=1;C<t;C++){const{x:A,y:_}=u.apply(g),F={x:A,y:_};o[C*2]=F,g=F}const y=new lt().translate(-r,-s).rotate(c/2).translate(r,s);g=rr({x:r,y:s},y.apply(o[0]),e),o[1]=g;for(let C=1;C<t;C++){const{x:A,y:_}=u.apply(g),F={x:A,y:_};o[C*2+1]=F,g=F}const x=i.width/i.height;for(let C=1;C<o.length;C++){const A=o[C];A.x=fs(r,A.x,x)}return o},_i=null,ba=()=>_i||(_i=document.createElement("canvas").getContext("2d"),_i.fontKerning="none",_i),fu=(i,t)=>{const e=[],r={x:0,y:0},s=ba();s.font=`${t.fontSize}px ${t.fontFamily}`;for(const o of i){const c=s.measureText(o);e.push({position:da({},r),width:c.width,height:c.fontBoundingBoxAscent+c.fontBoundingBoxDescent,fontBoundingBoxAscent:c.fontBoundingBoxAscent}),r.x+=c.width}return e.push({position:da({},r),width:0,height:0,fontBoundingBoxAscent:0}),e},gu=(i,t)=>{const e=ba();e.font=`${t.fontSize}px ${t.fontFamily}`;const r=e.measureText(i);return{width:r.width,height:r.fontBoundingBoxAscent+r.fontBoundingBoxDescent,fontBoundingBoxAscent:r.fontBoundingBoxAscent}};const Pa=Math.PI*2,Tn=Math.PI/2;var vt=(i=>(i.Solid="Solid",i.Image="Image",i))(vt||{});const Ma={type:"Solid",attrs:{r:217,g:217,b:217,a:1},visible:!0},Ta={type:"Image",attrs:{},visible:!0},pu={Solid:Ma,Image:Ta},mo=(()=>{const i=document.createElement("canvas");i.width=4,i.height=4;const t=i.getContext("2d");for(let e=0;e<i.width;e++)for(let r=0;r<i.height;r++){const s=(e+r)%2===0?"black":"white";t.fillStyle=s,t.fillRect(e,r,1,1)}return i})(),mu=mo.toDataURL(),yo=i=>{if(!i||i.length===0)return!1;for(const t of i)if(t.visible!==!1&&(t.type==="Solid"&&t.attrs.a!==0||t.type==="Image"&&t.attrs.opacity!==0))return!0;return!1};var At=(i=>(i.Graph="Graph",i.Rect="Rect",i.Ellipse="Ellipse",i.Text="Text",i.Line="Line",i.Path="Path",i.RegularPolygon="RegularPolygon",i.Star="Star",i.Frame="Frame",i.Canvas="Canvas",i.Document="Document",i))(At||{}),ae=(i=>(i.Left="Left",i.HCenter="HCenter",i.Right="Right",i.Top="Top",i.VCenter="VCenter",i.Bottom="Bottom",i))(ae||{}),An=(i=>(i.Front="Front",i.Back="Back",i.Forward="Forward",i.Backward="Backward",i))(An||{});const Aa="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function ei(i,t,e){const r=e[0];if(t!=null&&i>=t)throw new Error(i+" >= "+t);if(i.slice(-1)===r||t&&t.slice(-1)===r)throw new Error("trailing zero");if(t){let c=0;for(;(i[c]||r)===t[c];)c++;if(c>0)return t.slice(0,c)+ei(i.slice(c),t.slice(c),e)}const s=i?e.indexOf(i[0]):0,o=t!=null?e.indexOf(t[0]):e.length;if(o-s>1){const c=Math.round(.5*(s+o));return e[c]}else return t&&t.length>1?t.slice(0,1):e[s]+ei(i.slice(1),null,e)}function Ea(i){if(i.length!==Ia(i[0]))throw new Error("invalid integer part of order key: "+i)}function Ia(i){if(i>="a"&&i<="z")return i.charCodeAt(0)-97+2;if(i>="A"&&i<="Z")return 90-i.charCodeAt(0)+2;throw new Error("invalid order key head: "+i)}function ki(i){const t=Ia(i[0]);if(t>i.length)throw new Error("invalid order key: "+i);return i.slice(0,t)}function _a(i,t){if(i==="A"+t[0].repeat(26))throw new Error("invalid order key: "+i);const e=ki(i);if(i.slice(e.length).slice(-1)===t[0])throw new Error("invalid order key: "+i)}function ka(i,t){Ea(i);const[e,...r]=i.split("");let s=!0;for(let o=r.length-1;s&&o>=0;o--){const c=t.indexOf(r[o])+1;c===t.length?r[o]=t[0]:(r[o]=t[c],s=!1)}if(s){if(e==="Z")return"a"+t[0];if(e==="z")return null;const o=String.fromCharCode(e.charCodeAt(0)+1);return o>"a"?r.push(t[0]):r.pop(),o+r.join("")}else return e+r.join("")}function yu(i,t){Ea(i);const[e,...r]=i.split("");let s=!0;for(let o=r.length-1;s&&o>=0;o--){const c=t.indexOf(r[o])-1;c===-1?r[o]=t.slice(-1):(r[o]=t[c],s=!1)}if(s){if(e==="a")return"Z"+t.slice(-1);if(e==="A")return null;const o=String.fromCharCode(e.charCodeAt(0)-1);return o<"Z"?r.push(t.slice(-1)):r.pop(),o+r.join("")}else return e+r.join("")}function Gn(i,t,e=Aa){if(i!=null&&_a(i,e),t!=null&&_a(t,e),i!=null&&t!=null&&i>=t)throw new Error(i+" >= "+t);if(i==null){if(t==null)return"a"+e[0];const g=ki(t),y=t.slice(g.length);if(g==="A"+e[0].repeat(26))return g+ei("",y,e);if(g<t)return g;const x=yu(g,e);if(x==null)throw new Error("cannot decrement any more");return x}if(t==null){const g=ki(i),y=i.slice(g.length),x=ka(g,e);return x??g+ei(y,null,e)}const r=ki(i),s=i.slice(r.length),o=ki(t),c=t.slice(o.length);if(r===o)return r+ei(s,c,e);const u=ka(r,e);if(u==null)throw new Error("cannot increment any more");return u<t?u:r+ei(s,null,e)}function _r(i,t,e,r=Aa){if(e===0)return[];if(e===1)return[Gn(i,t,r)];if(t==null){let c=Gn(i,t,r);const u=[c];for(let g=0;g<e-1;g++)c=Gn(c,t,r),u.push(c);return u}if(i==null){let c=Gn(i,t,r);const u=[c];for(let g=0;g<e-1;g++)c=Gn(i,c,r),u.push(c);return u.reverse(),u}const s=Math.floor(e/2),o=Gn(i,t,r);return[..._r(i,o,s,r),o,..._r(o,t,e-s-1,r)]}const Ra=(i,t,e,r)=>{const s=[t-r/2,e-r/2],o=[t+r/2,e-r/2],c=[t-r/2,e+r/2],u=[t+r/2,e+r/2];ws(i,s[0],s[1],u[0],u[1]),ws(i,o[0],o[1],c[0],c[1])},ws=(i,t,e,r,s)=>{i.beginPath(),i.moveTo(t,e),i.lineTo(r,s),i.closePath(),i.stroke()},Da=(i,t,e,r)=>{i.translate(e,r),i.rotate(t),i.translate(-e,-r)},vu=(i,t,e,r,s,o)=>{i.beginPath(),i.moveTo(t+o,e),i.lineTo(t+r-o,e),i.arcTo(t+r,e,t+r,e+o,o),i.lineTo(t+r,e+s-o),i.arcTo(t+r,e+s,t+r-o,e+s,o),i.lineTo(t+o,e+s),i.arcTo(t,e+s,t,e+s-o,o),i.lineTo(t,e+o),i.arcTo(t,e,t+o,e,o),i.closePath()},zn=(i,t)=>{const e=i.getChildren();let r=0;const s=new RegExp(`^${t}\\s+(\\d+)`);for(const o of e){const c=o.attrs.objectName.match(s);if(c){const u=parseInt(c[1]);u>r&&(r=u)}}return`${t} ${r+1}`},Ba=i=>{i.sort(([e],[r])=>e-r);const t=[];for(const[e,r]of i){const s=t.at(-1);s&&s[1]>=e?s[1]=Math.max(r,s[1]):t.push([e,r])}return t},Ri=(i,t,e)=>{for(let r=t.length-1;r>=0;r--){const s=t[r];if(!(e!=null&&e(s))&&Pe(s)&&!s.isGroup()&&s.hitTest(i))return Ri(i,s.getChildren(),e)||s}return null},Fa=i=>({...i,midX:i.minX/2+i.maxX/2,midY:i.minY/2+i.maxY/2}),wu=i=>({x:i.minX/2+i.maxX/2,y:i.minY/2+i.maxY/2}),La=i=>{const t=new Map;for(const e of i){const{x:r,y:s}=e;t.has(r)||t.set(r,[]),t.get(r).push(s)}return t},Ha=i=>{const t=new Map;for(const e of i){const{x:r,y:s}=e;t.has(s)||t.set(s,[]),t.get(s).push(r)}return t},xu=i=>{const t=vn({x:0,y:-1},{x:i.width,y:i.height}),{width:e,height:r}=i,s=t%Tn;if(s<Math.PI/8||s>Math.PI*3/8)Math.abs(e)>Math.abs(r)?i.height=0:i.width=0;else{const o=Math.min(Math.abs(e),Math.abs(r)),c=Math.max(Math.abs(e),Math.abs(r)),u=o+(c-o)/2;i.height=(Math.sign(r)||1)*u,i.width=(Math.sign(e)||1)*u}return i},sr=i=>i.reduce((t,e)=>{const r=new Set;for(const s of e.getFrameParentIds()){if(t.has(s))break;r.add(s)}return r.size===0?t:(t.forEach(s=>{r.add(s)}),r)},new Set),xs=(i,t=!1)=>{const e=new Set;for(const r of i){if(e.has(r))return e;t&&e.add(r),Pe(r)&&xs(r.getChildren(),!0).forEach(o=>{e.add(o)})}return e},Di=(i,t,e,r)=>{for(const s of t){const o=i.doc.getGraphicsById(s);o&&Pe(o)&&o.isGroup()&&!o.isEmpty()&&o.updateSizeByChildren(e,r)}},Su=i=>{let t;const e=function(...r){t===void 0&&(t=requestAnimationFrame(()=>{t=void 0,i(r)}))};return e.cancel=()=>{t!==void 0&&cancelAnimationFrame(t),t=void 0},e},Wa=i=>{var t;return i&&typeof i.getContext>"u"&&typeof i.save=="function"&&"canvas"in i?i:i&&typeof i.getOriginalContext=="function"&&((t=i.getOriginalContext)==null?void 0:t.call(i))||null},Bi=i=>{const{originCtx:t,viewSize:e,draw:r}=i,s=Wa(t);if(!s){console.warn("drawLayer: impossível extrair CanvasRenderingContext2D, pulando layer drawing");return}s.save();const o=document.createElement("canvas");o.width=e.width,o.height=e.height;const c=o.getContext("2d");return c.setTransform(s.getTransform()),r(c),s.resetTransform(),s.drawImage(o,0,0),s.restore(),o};class Qt{constructor(t,e){S(this,"type",At.Graph);S(this,"attrs");S(this,"doc");S(this,"_cacheBboxWithStroke",null);S(this,"_cacheBbox",null);S(this,"_cacheMinBbox",null);S(this,"noRender",!1);S(this,"_deleted",!1);S(this,"_sortDirty",!1);S(this,"noCollectUpdate");S(this,"updatedKeys",new Set);S(this,"children",[]);S(this,"isContainer",!1);var o,c;this.doc=e.doc;const r=t.transform??ao(),s=e.advancedAttrs;s&&!t.transform&&(s.x!==void 0&&(r[4]=s.x),s.y!==void 0&&(r[5]=s.y)),this.attrs={...t},(o=this.attrs).id??(o.id=Pi()),this.attrs.transform=r,(c=this.attrs).strokeWidth??(c.strokeWidth=1),this.attrs.objectName?ra.setMaxIdx(t.objectName):this.attrs.objectName=ra.gen(this.attrs.type??""),this.noCollectUpdate=!!(e!=null&&e.noCollectUpdate)}getAttrs(){return ht(this.attrs)}shouldUpdateBbox(t){return t.x!==void 0||t.y!==void 0||t.width!==void 0||t.height!==void 0||t.transform!==void 0||"strokeWidth"in t||"parentIndex"in t}clearBboxCache(){this._cacheBbox=null,this._cacheBboxWithStroke=null,this._cacheMinBbox=null}getUpdatedAttrs(){const t=Qo(this.attrs,[...this.updatedKeys]);return this.updatedKeys.clear(),t}updateAttrs(t,e){if(this.shouldUpdateBbox(t)&&this.clearBboxCache(),"strokeWidth"in t&&t.strokeWidth===void 0&&(t.strokeWidth=1),!t.transform&&(t.x!==void 0||t.y!==void 0)){const r=ht(this.attrs.transform);t.x&&(r[4]=t.x),t.y&&(r[5]=t.y),this.attrs.transform=r,this.updatedKeys.add("transform")}t.rotate!==void 0&&this.setRotate(t.rotate),t=Bl(t,"x","y","rotate");for(const r in t)this.updatedKeys.add(r),this.attrs[r]=t[r];(!this.noCollectUpdate||this.attrs.parentIndex)&&this.doc.collectUpdatedGraphics(this.attrs.id)}cancelCollectUpdate(){this.noCollectUpdate=!0}getStrokeWidth(){var t;return(t=this.attrs.stroke)!=null&&t.length?this.attrs.strokeWidth??0:0}getBboxWithStroke(){if(this._cacheBboxWithStroke)return this._cacheBboxWithStroke;const t=Ii({...this.getSize(),transform:this.getWorldTransform()},this.getStrokeWidth()/2);return this._cacheBboxWithStroke=t,t}getBbox(){return Ii({...this.getSize(),transform:this.getWorldTransform()})}getLocalBbox(){if(this._cacheBbox)return this._cacheBbox;const t=Ii({...this.getSize(),transform:this.attrs.transform});return this._cacheBbox=t,t}getMinBbox(){return this.getBbox()}getWorldBboxVerts(){const t={x:0,y:0,width:this.attrs.width,height:this.attrs.height};return ir(t,this.getWorldTransform())}getLocalPosition(){return{x:this.attrs.transform[4],y:this.attrs.transform[5]}}getWorldPosition(){const t=this.getWorldTransform();return{x:t[4],y:t[5]}}getX(){return this.attrs.transform[4]}getY(){return this.attrs.transform[5]}getSize(){return{width:this.attrs.width,height:this.attrs.height}}getOpacity(){return this.attrs.opacity??1}getRect(){return{...this.getLocalPosition(),width:this.attrs.width,height:this.attrs.height}}getTransformedSize(){return ma(this.attrs)}getLocalCenter(){return new lt(...this.attrs.transform).apply({x:this.attrs.width/2,y:this.attrs.height/2})}getWorldCenter(){return new lt(...this.getWorldTransform()).apply({x:this.attrs.width/2,y:this.attrs.height/2})}isStrokeShouldRender(){return yo(this.attrs.stroke)}isFillShouldRender(){return yo(this.attrs.fill)}hitTest(t,e=0){return lo(t,{...this.getSize(),transform:this.getWorldTransform()},e+this.getStrokeWidth()/2)}getHitGraphics(t,e){const{tol:r=0}=e;return!this.isVisible()||this.isLock()||!this.isFillShouldRender()&&!this.isStrokeShouldRender()?null:this.hitTest(t,r)?this:null}hitTestChildren(t,e=0){if(!this.isContainer)return this.hitTest(t,e);if(!this.hitTest(t,e))return!1;const r=this.getChildren();for(let s=r.length-1;s>=0;s--)if(r[s].hitTest(t,e))return!0;return!1}intersectWithChildrenBox(t){if(!this.isContainer)return this.intersectWithBox(t);if(!this.intersectWithBox(t))return!1;const e=this.getChildren();for(const r of e)if(r.isVisible()&&r.intersectWithBox(t))return!0;return!1}strokeAABBIntersectWithBox(t){return go(t,this.getBboxWithStroke())}intersectWithBox(t){let e=!1;if(!go(t,this.getMinBbox()))e=!1;else{const r=this.getRotate();if(!r||r%Tn==0)e=!0;else{const[s,o,c,u]=ir(Wn(t),wn(this.getWorldTransform())),g=Math.min(s.x,o.x,c.x,u.x),y=Math.min(s.y,o.y,c.y,u.y),x=Math.max(s.x,o.x,c.x,u.x),C=Math.max(s.y,o.y,c.y,u.y),A={x:g,y,width:x-g,height:C-y};e=Ud(A,{x:0,y:0,...this.getSize()})}}return e}containWithBox(t){const e=this.getMinBbox();return va(t,e)||va(e,t)}calcNewAttrsByControlHandle(t,e,r,s,o=!1,c=!1,u){const g=this.getParentWorldTransform();r={width:r.width,height:r.height,transform:s};const y=this.attrs.height===0?Ca(t,e,r,{keepPolarSnap:o,scaleFromCenter:c}):vs(t,e,r,{keepRatio:o,scaleFromCenter:c,flip:u});return y.transform=ze(wn(g),y.transform),y}updateByControlHandle(t,e,r,s,o=!1,c=!1,u){const g=this.calcNewAttrsByControlHandle(t,e,r,s,o,c,u);this.updateAttrs(g,{finishRecomputed:!0})}shouldSkipDraw(t){return!!(!this.isVisible()||this.getOpacity()*(t.opacity??1)===0||t.viewportArea&&!this.strokeAABBIntersectWithBox(t.viewportArea))}draw(t){if(this.shouldSkipDraw(t))return;const{ctx:e}=t;e.save(),e.transform(...this.attrs.transform);for(const r of this.children)r.draw(t);e.restore()}drawOutline(t,e,r){const{width:s,height:o}=this.attrs;t.transform(...this.getWorldTransform()),t.strokeStyle=e,t.lineWidth=r,t.beginPath(),t.rect(0,0,s,o),t.stroke(),t.closePath()}fillImage(t,e,r,s=!0,o=0){const c=e.attrs.src,u=this.attrs.width,g=this.attrs.height,y=0,x=0;let C;if(t.imageSmoothingEnabled=s,c?(r.addImg(c),C=r.getImg(c)):(t.imageSmoothingEnabled=!1,C=mo),!C)return;const A=Fd(C.width,C.height,u,g),_=C.width/2-u/A/2,F=C.height/2-g/A/2;o&&(t.save(),vu(t,y,x,u,g,o),t.clip()),t.drawImage(C,_,F,u/A,g/A,y,x,u,g),o&&t.restore()}getCanvas2DContext(t){return Wa(t)}static dMove(t,e,r){for(const s of t){const o=s.getWorldTransform();o[4]+=e,o[5]+=r,s.setWorldTransform(o)}}toJSON(){return{...this.attrs}}isVisible(){return this.attrs.visible??!0}isLock(){return this.attrs.lock??!1}isDeleted(){return this._deleted}setDeleted(t){this._deleted=t,this.doc.collectDeletedGraphics(this)}toObject(){return{type:this.type,id:this.attrs.id,name:this.attrs.objectName,visible:this.isVisible(),lock:this.isLock(),children:this.children.map(t=>t.toObject())}}getControlHandles(t,e){return[]}getRotate(){return ti(this.getWorldTransform())}getRotateDegree(){return Ti(ua(this.getRotate()))}setRotate(t,e){const r=this.getRotate(),s=t-r;e??(e=this.getWorldCenter());const o=new lt().translate(-e.x,-e.y).rotate(s).translate(e.x,e.y);this.prependWorldTransform(o.getArray())}prependWorldTransform(t){const e=this.getParentWorldTransform(),r=ze(t,ze(e,this.attrs.transform));this.updateAttrs(ps({...this.getSize(),transform:ze(wn(e),r)}))}dRotate(t,e,r){const o=new lt().translate(-r.x,-r.y).rotate(t).translate(r.x,r.y).append(new lt(...e)).getArray();this.setWorldTransform(o)}getInfoPanelAttrs(){const t=this.getTransformedSize(),e=this.getWorldPosition();return[{label:"X",key:"x",value:e.x,uiType:"number"},{label:"Y",key:"y",value:e.y,uiType:"number"},{label:"W",key:"width",value:t.width,uiType:"number"},{label:"H",key:"height",value:t.height,uiType:"number"},{label:"R",key:"rotation",value:this.getRotateDegree(),suffixValue:"°",uiType:"number"}]}toSVGSegment(t){const e=this.getSVGTagHead(t);if(!e)return console.warn(`please implement getSVGTagHead method of "${this.type}" type`),"";const r=[],{fillPaints:s,strokePaints:o}=this.getFillAndStrokesToSVG();if(s.length<=1&&o.length<=1){const x=s[0];if(x){const A={};if(x.type===vt.Solid){A.fill="#"+ls(x.attrs);const _=x.attrs.a;_!==1&&(A["fill-opacity"]=_)}r.push(A)}const C=o[0];if(C){const A={};if(C.type===vt.Solid){A.stroke="#"+ls(C.attrs);const _=C.attrs.a;_!==1&&(A["stroke-opacity"]=_)}r.push(A)}}else{for(const x of s)if(x&&x.type===vt.Solid){const C={fill:"#"+ls(x.attrs)},A=x.attrs.a;A!==1&&(C["fill-opacity"]=A),r.push(C)}for(const x of o)if(x&&x.type===vt.Solid){const C={stroke:"#"+ls(x.attrs)},A=x.attrs.a;A!==1&&(C["stroke-opacity"]=A),r.push(C)}}const c=this.attrs.strokeWidth??0,u=c>1?` stroke-width="${c}"`:"";let g="";const y=this.getSVGTagTail();for(const x of r){let C="",A;for(A in x)C+=` ${A}="${x[A]}"`;g+=e+C+u+y}return g}getSVGTagHead(t){return""}getSVGTagTail(){return`/>
`}getFillAndStrokesToSVG(){return{fillPaints:this.attrs.fill??[],strokePaints:this.attrs.stroke??[]}}getLayerIconPath(){return"M0.5 0.5H11.5V11.5H0.5V0.5Z"}getWorldTransform(){const t=this.getParent();return t?ze(t.getWorldTransform(),this.attrs.transform):[...this.attrs.transform]}getChildren(){return this.isContainer?(this._sortDirty&&this.sortChildren(),[...this.children]):[]}getChildrenCount(){return this.children.length}setChildren(t){if(!this.isContainer)return;const e=_r(null,null,t.length);for(let r=0;r<t.length;r++)t[r].updateAttrs({parentIndex:{guid:this.attrs.id,position:e[r]}})}insertAtParent(t){const e=this.getParent();e&&e.insertChild(this,t)}insertChild(t,e){if(!this.isContainer){console.warn(`graphics "${this.type}" is not container`);return}if(this.children.some(s=>s.attrs.id===t.attrs.id)){e&&this.sortChildren();return}if(!e){const s=this.getMaxChildIndex();e=Gn(s,null)}t.removeFromParent();const r={guid:this.attrs.id,position:e};Si(t.attrs.parentIndex,r)||t.updateAttrs({parentIndex:r}),this.children.push(t),e&&this.sortChildren()}removeChild(t){this.children=this.children.filter(e=>e.attrs.id!==t.attrs.id)}markSortDirty(){this._sortDirty=!0}sortChildren(){Qt.sortGraphicsArray(this.children)}static sortGraphicsArray(t){return t.sort((e,r)=>{var s,o;return(((s=e.attrs.parentIndex)==null?void 0:s.position)??"")<(((o=r.attrs.parentIndex)==null?void 0:o.position)??"")?-1:1}),t}getParentId(){var t;return(t=this.attrs.parentIndex)==null?void 0:t.guid}getParent(){const t=this.getParentId();if(t)return this.doc.getGraphicsById(t)}getParentWorldTransform(){const t=this.getParent();return t?t.getWorldTransform():ao()}removeFromParent(){const t=this.getParent();t&&t.removeChild(this)}getMaxChildIndex(){if(this.children.length===0)return null;if(!this._sortDirty)return this.children.at(-1).getSortIndex()??null;let t=this.children[0].getSortIndex();for(let e=1;e<this.children.length;e++){const r=this.children[e].getSortIndex();r>t&&(t=r)}return t}getMinChildIndex(){if(this.children.length===0)return null;if(!this._sortDirty)return this.children.at(0).getSortIndex()??null;let t=this.children[0].getSortIndex();for(let e=1;e<this.children.length;e++){const r=this.children[e].getSortIndex();r<t&&(t=r)}return t}getSortIndex(){var t;return((t=this.attrs.parentIndex)==null?void 0:t.position)??""}getNextSibling(){const t=this.getParent();if(!t)return null;const e=t.getChildren(),r=e.findIndex(s=>s===this);return r==-1&&console.warn("index should not be -1!"),e[r+1]??null}getSortIndexPath(){const t=[];let e=this;for(;e;)t.push(e.getSortIndex()),e=e.getParent();return t.reverse(),t}static sortGraphics(t){const e=t.map(r=>({path:r.getSortIndexPath(),val:r}));return e.sort((r,s)=>{const o=Math.max(r.path.length,s.path.length);for(let c=0;c<o;c++){const u=r.path[c],g=s.path[c];if(u!==g)return u<g?-1:1}return r.path.length<s.path.length?-1:1}),e.map(r=>r.val)}containAncestor(t){let e=this;for(;e;){if(e.attrs.id===t)return!0;e=e.getParent()}return!1}forEachParent(t){let e=!1;const r=()=>{e=!0};let s=this.getParent();for(;s&&(t(s,r),!e);)s=s.getParent()}getParentIds(){const t=[];return this.forEachParent(e=>{t.push(e.attrs.id)}),t}getFrameParentIds(){const t=[];return this.forEachParent((e,r)=>{if(e.type===At.Canvas){r();return}t.push(e.attrs.id)}),t}setWorldTransform(t){const e=this.getParentWorldTransform(),r=ze(wn(e),t);this.updateAttrs({transform:r})}forEachVisibleChildNode(t){if(this.isVisible()){for(const e of this.children)e.forEachVisibleChildNode(t);t(this)}}}class ni extends Qt{constructor(e,r){super({...e,type:At.Ellipse},r);S(this,"type",At.Ellipse)}hitTest(e,r=0){const s=this.attrs,o=s.width/2,c=s.height/2,u=this.getStrokeWidth();r=r+u/2;const g=s.width/2+r,y=s.height/2+r,C=new lt(...this.getWorldTransform()).applyInverse(e);return(C.x-o)**2/g**2+(C.y-c)**2/y**2<=1}draw(e){if(this.shouldSkipDraw(e))return;const r=this.getOpacity()*(e.opacity??1),{ctx:s,imgManager:o,smooth:c}=e,u=this.attrs,g=u.width/2,y=u.height/2;s.save(),s.transform(...u.transform),r<1&&(s.globalAlpha=r);const x=C=>{C.beginPath(),C.ellipse(g,y,u.width/2,u.height/2,0,0,Pa);for(const A of u.fill??[])A.visible!==!1&&(A.type===vt.Solid?(C.fillStyle=Fe(A.attrs),C.fill()):A.type===vt.Image&&(o?(C.clip(),this.fillImage(C,A,o,c)):console.warn("ImgManager is not provided")));if(u.strokeWidth){C.lineWidth=u.strokeWidth;for(const A of u.stroke??[])A.visible!==!1&&(A.type===vt.Solid?(C.strokeStyle=Fe(A.attrs),C.stroke()):(A.type,vt.Image))}C.closePath()};if(r!==1)Bi({originCtx:s,viewSize:this.doc.getDeviceViewSize(),draw:x});else{const C=this.getCanvas2DContext(s);C?x(C):console.warn("Ellipse drawing requer CanvasRenderingContext2D - operação não suportada")}s.restore()}drawOutline(e,r,s){const{width:o,height:c}=this.attrs,u=o/2,g=c/2;e.transform(...this.getWorldTransform()),e.strokeStyle=r,e.lineWidth=s,e.beginPath(),e.ellipse(u,g,o/2,c/2,0,0,Pa),e.stroke(),e.closePath()}getSVGTagHead(e){const r=[...this.attrs.transform];e&&(r[4]+=e.x,r[5]+=e.y);const s=this.attrs.width/2,o=this.attrs.height/2;return this.attrs.width===this.attrs.height?`<circle cx="${s}" cy="${o}" r="${s}" transform="matrix(${r.join(" ")})"`:`<ellipse cx="${s}" cy="${o}" rx="${s}" ry="${o}" transform="matrix(${r.join(" ")})"`}getLayerIconPath(){const c=this.getBbox(),u=c.maxX-c.minX,g=c.maxY-c.minY,y=11/Math.max(u,g),x=new lt().prepend(new lt(...this.getWorldTransform())).translate(-c.minX-u/2,-c.minY-g/2).scale(y,y).translate(12/2,12/2),C=this.attrs,A=qd({x:0,y:0,width:C.width,height:C.height});return A.forEach(_=>{_.points.forEach((F,R)=>{_.points[R]=x.apply(F)})}),Ir(A,5)}}class ri extends Qt{constructor(e,r){super({...e,type:At.Frame},r);S(this,"type",At.Frame);S(this,"isContainer",!0)}updateSizeByChildren(e,r){const s=Wn(On(this.children.filter(y=>y.isVisible()).map(y=>y.getLocalBbox())));if(s.x===0&&s.y===0&&s.width===this.attrs.width&&s.height===this.attrs.height)return;for(const y of this.children){const x=y.attrs.id;e.set(x,Object.assign({transform:[...y.attrs.transform]},e.get(x)??{}));const C=new lt(...y.attrs.transform).translate(-s.x,-s.y);y.updateAttrs({transform:C.getArray()});const A=Object.assign(r.get(x)??{},{transform:[...y.attrs.transform]});r.set(x,A)}const o=new lt().translate(s.x,s.y),c=new lt(...this.attrs.transform).append(o),u=this.attrs.id;e.has(u)||e.set(u,{width:this.attrs.width,height:this.attrs.height,transform:[...this.attrs.transform]});const g={width:s.width,height:s.height,transform:c.getArray()};this.updateAttrs(g),r.set(u,g)}isEmpty(){return this.children.length===0}isFillShouldRender(){return!0}_realDraw(e,r){const s=this.attrs,{fill:o,strokeWidth:c,stroke:u,transform:g}=r||this.attrs,{ctx:y,imgManager:x,smooth:C}=e;y.save(),y.transform(...g);const A=e.opacity??1;A<1&&(y.globalAlpha=A),y.beginPath(),y.rect(0,0,s.width,s.height);for(const _ of o??[])if(_.visible!==!1)switch(_.type){case vt.Solid:{y.fillStyle=Fe(_.attrs),y.fill();break}case vt.Image:if(x){const F=this.getCanvas2DContext(y);F?this.fillImage(F,_,x,C):console.warn("fillImage requer CanvasRenderingContext2D - operação não suportada")}else console.warn("ImgManager is not provided")}if(c){y.lineWidth=c;for(const _ of u??[])if(_.visible!==!1)switch(_.type){case vt.Solid:{y.strokeStyle=Fe(_.attrs),y.stroke();break}case vt.Image:}}y.closePath(),y.restore()}isGroup(){return this.attrs.resizeToFit}drawText(e,r,s){if(!this.isVisible())return;const o=this.getRotate(),c=new lt().translate(-r,-s).rotate(o).translate(r,s);e.save(),e.fillStyle="#acacac",e.font="11px sans-serif",e.transform(...c.getArray()),e.fillText(this.attrs.objectName,r,s),e.restore()}draw(e){if(this.shouldSkipDraw(e))return;const r=this.getOpacity()*(e.opacity??1);e={...e,opacity:r},this.isGroup()||this._realDraw(e);const{ctx:s}=e;this.isGroup()||(s.save(),s.clip()),super.draw(e),this.isGroup()||s.restore()}hitTest(e,r=0){const o=new lt(...this.getWorldTransform()).applyInverse(e);return ya({minX:0,minY:0,maxX:this.attrs.width,maxY:this.attrs.height},o,r+(this.attrs.strokeWidth??0)/2)}getHitGraphics(e,r){if(!this.isVisible()||this.isLock())return null;const{parentIdSet:s}=r,o=this.getChildren();if(this.isGroup()){for(let c=o.length-1;c>=0;c--){const g=o[c].getHitGraphics(e,r);if(g){const y=g.getParent();return y&&!s.has(y.attrs.id)?y:g}}if(this.isHitTitle(e,r))return this}else{if(o.length===0)return super.getHitGraphics(e,r);for(let c=o.length-1;c>=0;c--){const g=o[c].getHitGraphics(e,r);if(g)return g}if(this.isHitTitle(e,r))return this}return null}isHitTitle(e,r){const o=12/r.zoom,c=80/r.zoom,u=new lt(...this.getWorldTransform()).append(new lt().translate(0,-o)),g={width:c,height:o,transform:u.getArray()};return lo(e,g,r.tol)}getLayerIconPath(){return this.isGroup()?"M7 1H5V2H7V1ZM9.5 10H10V9.5H11V11H9.5V10ZM2 5V7H1V5H2ZM10 2.5V2H9.5V1H11V2.5H10ZM10 5V7H11V5H10ZM2 2.5V2H2.5V1H1V2.5H2ZM1 9.5H2V10H2.5V11H1V9.5ZM7 10H5V11H7V10Z":"M4 0.5V3H8V0.5H9V3H11.5V4H9V8H11.5V9H9V11.5H8V9H4V11.5H3V9H0.5V8H3V4H0.5V3H3V0.5H4ZM8 8V4H4V8H8Z"}}const Pe=i=>i instanceof ri;class Ss extends Qt{constructor(e,r){super({...e,height:0,type:At.Line},r);S(this,"type",At.Line)}draw(e){if(this.shouldSkipDraw(e))return;const r=this.getOpacity()*(e.opacity??1),{ctx:s}=e,{width:o,transform:c,stroke:u,strokeWidth:g}=this.attrs;if(s.save(),s.transform(...c),r<1&&(s.globalAlpha=r),s.beginPath(),s.moveTo(0,0),s.lineTo(o,0),g){s.lineWidth=g;for(const y of u??[])switch(y.type){case vt.Solid:{s.strokeStyle=Fe(y.attrs),s.stroke();break}case vt.Image:}s.closePath(),s.restore()}}drawOutline(e,r,s){e.transform(...this.getWorldTransform()),e.beginPath(),e.moveTo(0,0),e.lineTo(this.attrs.width,0),e.lineWidth=s,e.strokeStyle=r,e.stroke(),e.closePath()}getSVGTagHead(e){const r=[...this.attrs.transform];e&&(r[4]+=e.x,r[5]+=e.y);const s=this.getTransformedSize();return`<line x1="0" y1="0" x2="${s.width}" y2="${s.height}" transform="matrix(${r.join(" ")})"`}getFillAndStrokesToSVG(){return{fillPaints:[],strokePaints:this.attrs.stroke??[]}}getLayerIconPath(){const c=this.getWorldTransform();let u=[Ar(c,{x:0,y:0}),Ar(c,{x:this.attrs.width,y:0})];const g=Ei(u),y=g.maxX-g.minX,x=g.maxY-g.minY,C=11/Math.max(y,x),A=new lt().translate(-g.minX-y/2,-g.minY-x/2).scale(C,C).translate(11/2,11/2);return u=u.map(_=>A.apply(_)),`M${u[0].x.toFixed(5)} ${u[0].y.toFixed(5)} L${u[1].x.toFixed(5)} ${u[1].y.toFixed(5)}`}}class Se extends Qt{constructor(e,r){super({...e,type:At.Path},r);S(this,"type",At.Path);S(this,"geoPath",null)}static computeRect(e){return new ms(e).getBRect()}static recomputeAttrs(e,r){const s=Se.computeRect(e);for(const c of e)for(const u of c.segs)u.point={x:u.point.x-s.x,y:u.point.y-s.y};const o=new lt(...r).apply(s);return{x:o.x,y:o.y,width:s.width,height:s.height,pathData:e}}checkAndFixUpdatedAttrs(e){("width"in e||"height"in e)&&"pathData"in e&&(delete e.width,delete e.height,console.warn("width or height and pathData cannot coexist when updating attribute, removed width and height"))}clearBboxCache(){super.clearBboxCache(),this.geoPath=null}getGeoPath(){return this.geoPath||(this.geoPath=new ms(this.attrs.pathData)),this.geoPath}updateAttrs(e,r){if(r!=null&&r.finishRecomputed){super.updateAttrs(e);return}e=ht(e),this.checkAndFixUpdatedAttrs(e);const s=Object.keys(e);if(e.pathData){const o=e.transform??this.attrs.transform;this.attrs.pathData=e.pathData,e={...e,...Se.recomputeAttrs(e.pathData,o)}}if(s.includes("width")||s.includes("height")){const o=this.recomputedPathData(e.width??this.attrs.width,e.height??this.attrs.height);this.attrs.pathData=o}super.updateAttrs(e)}calcNewAttrsByControlHandle(e,r,s,o,c,u,g){const y=this.getParentWorldTransform();s={width:s.width,height:s.height,transform:o};const x=this.attrs.height===0?Ca(e,r,s,{keepPolarSnap:c,scaleFromCenter:u}):vs(e,r,s,{keepRatio:c,scaleFromCenter:u,flip:g});x.transform=ze(wn(y),x.transform);const C=x,A=this.recomputedPathData(x.width,x.height);return{...C,pathData:A}}recomputedPathData(e,r){const s=e/(this.attrs.width||1),o=r/(this.attrs.height||1),c=ht(this.attrs.pathData);for(const u of c)for(const g of u.segs)g.point.x*=s,g.point.y*=o,g.in.x*=s,g.in.y*=o,g.out.x*=s,g.out.y*=o;return c}draw(e){if(this.shouldSkipDraw(e))return;const r=this.getOpacity()*(e.opacity??1);this._realDraw({...e,opacity:r})}drawOutline(e,r,s){this._realDraw({ctx:e},{stroke:[{type:vt.Solid,attrs:ge(r)}],strokeWidth:s,transform:this.getWorldTransform()})}_realDraw(e,r){const{pathData:s}=this.attrs,o=(r==null?void 0:r.transform)??this.attrs.transform,{fill:c,strokeWidth:u,stroke:g}=r||this.attrs,{ctx:y,imgManager:x,smooth:C}=e;y.save(),y.transform(...o);const A=e.opacity??1;A<1&&(y.globalAlpha=A);const _=F=>{F.beginPath();for(const R of s){const z=R.segs[0];if(!z)continue;F.moveTo(z.point.x,z.point.y);const G=R.segs;for(let V=1;V<=G.length;V++){if(V===G.length&&!R.closed)continue;const j=G[V%G.length],U=G[V-1],N=j.point.x,Q=j.point.y,Y=Se.getHandleOut(U),Z=Se.getHandleIn(j);!Y&&!Z?F.lineTo(N,Q):F.bezierCurveTo(Y.x,Y.y,Z.x,Z.y,N,Q)}R.closed&&F.closePath()}for(const R of c??[])if(R.visible!==!1)switch(R.type){case vt.Solid:{F.fillStyle=Fe(R.attrs),F.fill();break}case vt.Image:x?(F.clip(),this.fillImage(F,R,x,C)):console.warn("ImgManager is not provided")}if(u){F.lineWidth=u;for(const R of g??[])if(R.visible!==!1)switch(R.type){case vt.Solid:{F.strokeStyle=Fe(R.attrs),F.stroke();break}case vt.Image:}}F.closePath()};if(A!==1)Bi({originCtx:y,viewSize:this.doc.getDeviceViewSize(),draw:_});else{const F=this.getCanvas2DContext(y);F?_(F):console.warn("Path drawing requer CanvasRenderingContext2D - operação não suportada")}y.restore()}hitTest(e,r=0){var u;if(!super.hitTest(e,r))return!1;if((u=this.attrs.fill)!=null&&u.length)return!0;const o=new lt(...this.getWorldTransform()).applyInverse(e);return this.getGeoPath().hitTest(o,r+this.getStrokeWidth()/2)}toJSON(){return{...super.toJSON(),pathData:this.attrs.pathData}}static getHandleIn(e){return Mn(e.point,e.in)}static getHandleOut(e){return Mn(e.point,e.out)}static getSeg(e,r,s){const o=e[r];return o?o.segs[s]??null:null}getLastSeg(e,r){const s=this.getSegCount(e)-1;return this.getSeg(e,s,r)}getSeg(e,r,s){let o=Se.getSeg(this.attrs.pathData,e,r);if(o=ht(o),o&&(s!=null&&s.applyTransform)){const c=new lt(...this.getWorldTransform()),u=c.apply(o.point);o.point.x=u.x,o.point.y=u.y,c.tx=0,c.ty=0;const g=c.apply(o.in);o.in.x=g.x,o.in.y=g.y;const y=c.apply(o.out);o.out.x=y.x,o.out.y=y.y}return o}getClosestAnchor(e){const r=new lt(...this.getWorldTransform()),s=r.applyInverse(e.point),o=this.attrs.pathData;let c=1/0,u=null,g=-1,y=-1;for(let x=0;x<o.length;x++){const C=o[x];for(let A=C.segs.length-1;A>=0;A--){const _=C.segs[A],F=ne(_.point,s);F<e.tol&&(c=F,u=_.point,g=A,y=x)}}return u?{pathItemIndex:y,segIndex:g,dist:c,point:r.apply(u)}:null}project(e,r=1/0){const s=this.getGeoPath(),o=new lt(...this.getWorldTransform());e=o.applyInverse(e);const c=s.project(e,r);return c?{dist:c.dist,point:o.apply(c.point),pathItemIndex:c.index[0],segIndex:c.index[1],t:c.t}:null}setSeg(e,r,s){const o=this.attrs.pathData,c={...o[e]},u=this.getSeg(e,r);if(!u)throw new Error(`can not find pathIdx ${e} segIdx ${r}`);s=ht(s);const g=this.getWorldTransform();if(s.point){const x=new lt(...g).invert().apply(s.point);s.point.x=x.x,s.point.y=x.y}if(s.in||s.out){const y=new lt(g[0],g[1],g[2],g[3],0,0).invert();if(s.in){const x=y.apply(s.in);s.in.x=x.x,s.in.y=x.y}if(s.out){const x=y.apply(s.out);s.out.x=x.x,s.out.y=x.y}}c.segs[r]={...u,...s},this.updateAttrs({pathData:o})}addSeg(e,r){const s=this.attrs.pathData,o=s[e];if(!o)throw new Error(`pathIdx ${e} is out of range`);const u=new lt(...this.getWorldTransform()).invert().apply(r.point);o.segs.push({point:u,in:r.in,out:r.out}),this.updateAttrs({pathData:s})}addEmptyPath(){const e=this.attrs.pathData;e.push({segs:[],closed:!1}),this.updateAttrs({pathData:e})}setPathItemClosed(e,r){const s=this.attrs.pathData,o=s[e];if(!o)throw new Error(`pathIdx ${e} is out of range`);o.closed=r,this.updateAttrs({pathData:s})}checkPathItemClosed(e){const s=this.attrs.pathData[e];if(!s)throw new Error(`pathIdx ${e} is out of range`);return s.closed}getPathItemCount(){return this.attrs.pathData.length}hasPath(e){return!!this.attrs.pathData[e]}getSegCount(e){const r=this.attrs.pathData[e];return r?r.segs.length:0}deleteSegAndHeal(e,r){const s=ht(this.attrs.pathData),o=s[e];if(!o)throw new Error(`can not find pathIdx ${e}`);ru(o,r),this.updateAttrs({pathData:s})}insertSeg(e,r,s){const o=ht(this.attrs.pathData),c=o[e];if(!c)throw new Error(`can not find pathIdx ${e}`);nu(c,r,s),this.updateAttrs({pathData:o})}getSVGTagHead(e){const r=[...this.attrs.transform];e&&(r[4]+=e.x,r[5]+=e.y);let s="";for(const o of this.attrs.pathData){const c=o.segs[0];if(!c)continue;s+=`M${c.point.x} ${c.point.y}`;const u=o.segs;for(let g=1;g<=u.length;g++){if(g===u.length&&!o.closed)continue;const y=u[g%u.length],x=u[g-1],C=y.point.x,A=y.point.y,_=Se.getHandleOut(x),F=Se.getHandleIn(y);!_&&!F?s+=`L${C} ${A}`:s+=`C${_.x} ${_.y} ${F.x} ${F.y} ${C} ${A}`}o.closed&&(s+="Z")}return`<path d="${s}" transform="matrix(${r.join(" ")})"`}getLayerIconPath(){const c=this.getBbox(),u=c.maxX-c.minX,g=c.maxY-c.minY,y=11/Math.max(u,g),x=new lt().prepend(new lt(...this.getWorldTransform())).translate(-c.minX-u/2,-c.minY-g/2).scale(y,y).translate(12/2,12/2),A=this.getGeoPath().toCommands();return A.forEach(_=>{_.points.forEach((F,R)=>{_.points[R]=x.apply(F)})}),Ir(A,5)}}class pe{constructor(t){S(this,"cx");S(this,"cy");S(this,"rotation");S(this,"transform");S(this,"type");S(this,"graphics");S(this,"padding");S(this,"isTransformHandle");S(this,"hitTest");S(this,"getCursor");this.cx=t.cx??0,this.cy=t.cy??0,t.rotation!==void 0&&(this.rotation=t.rotation),t.transform&&(this.transform=t.transform),this.type=t.type,this.padding=t.padding??0,this.graphics=t.graphics,this.getCursor=t.getCursor,t.hitTest&&(this.hitTest=t.hitTest),this.isTransformHandle=t.isTransformHandle??!1,this.graphics.cancelCollectUpdate()}}const or=(i,t)=>{if(!t)return"default";if(t.height===0)return"move";if(i==="n"||i==="s"){const c=new lt().rotate(Tn).prepend(new lt(...t.transform)).rotate(Tn),u=ti([c.a,c.b,c.c,c.d,c.tx,c.ty]);return{type:"resize",degree:Ti(u)}}const e=ti(t.transform),r=fa(t.transform);let s=0;switch(i){case"se":case"nw":s=-45;break;case"ne":case"sw":s=45;break;case"e":case"w":s=90;break;default:console.warn("unknown type",i)}return{type:"resize",degree:Ti(e)+(r?-s:s)}},Fi=(i,t)=>{if(!t)return"default";const e=ti(t.transform),r=fa(t.transform);let s=0;return t.height===0?s={neRotation:90,seRotation:90,swRotation:270,nwRotation:270}[i]:s={neRotation:45,seRotation:135,swRotation:225,nwRotation:315}[i],{type:"rotation",degree:io(Ti(e)+(r?-s:s))}},Cu=(i,t)=>{const e=()=>({width:i.size,height:i.size,fill:[{type:vt.Solid,attrs:ge(i.fill)}],stroke:[{type:vt.Solid,attrs:ge(i.stroke)}],strokeWidth:1}),r={doc:t,noCollectChange:!0},s=new pe({graphics:new Ce({objectName:"nw",...e()},r),type:"nw",padding:3,getCursor:or,isTransformHandle:!0}),o=new pe({graphics:new Ce({objectName:"ne",...e()},r),type:"ne",padding:3,getCursor:or,isTransformHandle:!0}),c=new pe({graphics:new Ce({objectName:"se",...e()},r),type:"se",padding:3,getCursor:or,isTransformHandle:!0}),u=new pe({graphics:new Ce({objectName:"sw",...e()},r),type:"sw",padding:3,getCursor:or,isTransformHandle:!0}),g=i.size*2.5,y=new pe({graphics:new Ce({objectName:"nwRotation",...e(),width:g,height:g,visible:!1},r),type:"nwRotation",getCursor:Fi,isTransformHandle:!0}),x=new pe({graphics:new Ce({objectName:"neRotation",...e(),width:g,height:g,visible:!1},r),type:"neRotation",getCursor:Fi,isTransformHandle:!0}),C=new pe({graphics:new Ce({objectName:"seRotation",...e(),width:g,height:g,visible:!1},r),type:"seRotation",getCursor:Fi,isTransformHandle:!0}),A=new pe({graphics:new Ce({objectName:"swRotation",...e(),width:g,height:g,visible:!1},r),type:"swRotation",getCursor:Fi,isTransformHandle:!0}),_=function(V,j,U){return!U||U.width===0||U.height===0?!1:this.graphics.hitTest(V,j)},F=new pe({graphics:new Ce({objectName:"n",...e(),visible:!1},r),type:"n",hitTest:_,getCursor:or,isTransformHandle:!0}),R=new pe({graphics:new Ce({objectName:"e",...e(),visible:!1},r),type:"e",hitTest:_,getCursor:or,isTransformHandle:!0}),z=new pe({graphics:new Ce({objectName:"s",...e(),visible:!1},r),type:"s",hitTest:_,getCursor:or,isTransformHandle:!0}),G=new pe({graphics:new Ce({objectName:"w",...e(),visible:!1},r),type:"w",hitTest:_,getCursor:or,isTransformHandle:!0});return new Map([["n",F],["e",R],["s",z],["w",G],["nwRotation",y],["neRotation",x],["seRotation",C],["swRotation",A],["nw",s],["ne",o],["se",c],["sw",u]])},Oa=["n","e","s","w","nwRotation","neRotation","seRotation","swRotation","nw","ne","se","sw"];class bu{constructor(t){S(this,"transformHandles");S(this,"customHandlesVisible",!1);S(this,"customHandles",[]);S(this,"selectedBoxRect",null);S(this,"enableTransformControl",!0);S(this,"onHoverItemChange",()=>{if(!this.editor.pathEditor.isActive()){const t=this.editor.selectedElements.getHoverItem(),e=this.editor.selectedElements.size()===1,r=e?this.editor.selectedElements.getItems()[0]:null,s=this.editor.selectedBox.isHover();if(e&&r&&(t===r||s)){const o=this.editor.zoomManager.getZoom();this.setCustomHandles(r.getControlHandles(o,!0))}else this.setCustomHandles([])}this.editor.render()});this.editor=t;const e=t.setting;this.transformHandles=Cu({size:e.get("handleSize"),fill:e.get("handleFill"),stroke:e.get("handleStroke"),strokeWidth:e.get("handleStrokeWidth")},t.doc)}bindEvents(){this.editor.selectedElements.on("hoverItemChange",this.onHoverItemChange),this.editor.selectedBox.on("hoverChange",this.onHoverItemChange),this.editor.zoomManager.on("zoomChange",this.onHoverItemChange),this.editor.commandManager.on("change",this.onHoverItemChange)}unbindEvents(){this.editor.selectedElements.off("hoverItemChange",this.onHoverItemChange),this.editor.selectedBox.off("hoverChange",this.onHoverItemChange),this.editor.zoomManager.off("zoomChange",this.onHoverItemChange),this.editor.commandManager.off("change",this.onHoverItemChange)}updateTransformHandles(t){const e=this.editor.zoomManager.getZoom(),r=this.editor.setting.get("handleSize"),s=this.editor.setting.get("handleStrokeWidth"),o=this.editor.setting.get("neswHandleWidth"),c={x:0,y:0,width:t.width,height:t.height},u=(()=>{const F=ir(c,t.transform),R=r/2/e,z=ir(uo(c,R),t.transform),G=40,V=new Array(4).fill(0);t.width*e<G&&(V[1]=V[3]=o/2/e),t.height*e<G&&(V[0]=V[2]=o/2/e);const j=uo(c,V),U=new lt(...t.transform),N=Xd(j).map(Q=>{const{x:Y,y:Z}=U.apply(Q);return{x:Y,y:Z}});return{nw:F[0],ne:F[1],se:F[2],sw:F[3],n:N[0],e:N[1],s:N[2],w:N[3],nwRotation:z[0],neRotation:z[1],seRotation:z[2],swRotation:z[3]}})();for(const F of Oa){const R=u[F],z=this.transformHandles.get(F);if(!z){console.warn(`handle ${F} not found`);continue}z.cx=R.x,z.cy=R.y}const g=this.transformHandles.get("n"),y=this.transformHandles.get("s"),x=this.transformHandles.get("w"),C=this.transformHandles.get("e");g.graphics.attrs.width=y.graphics.attrs.width=t.width*e-r-s,x.graphics.attrs.height=C.graphics.attrs.height=t.height*e-r-s,g.graphics.attrs.height=y.graphics.attrs.height=x.graphics.attrs.width=C.graphics.attrs.width=o;const A=new lt().rotate(Tn).prepend(new lt(...t.transform)).rotate(Tn),_=ti([A.a,A.b,A.c,A.d,A.tx,A.ty]);g.rotation=_,y.rotation=_}checkEnableRender(t){const e=ir({x:0,y:0,width:t.width,height:t.height},t.transform).map(s=>this.editor.toViewportPt(s.x,s.y)),r=this.editor.setting.get("sizeIndicatorMinSize");return!(ne(e[0],e[1])<r&&ne(e[1],e[2])<r)}draw(t){if(this.selectedBoxRect=t,t){if(!this.checkEnableRender(t))return;this.updateTransformHandles(t)}const e=[];this.shouldRenderTransformControl()&&e.push(...Array.from(this.transformHandles.values())),this.customHandlesVisible&&e.push(...this.customHandles);const r=this.editor.ctx,s=t?ti(t.transform):0;e.forEach(o=>{const c=o.graphics;if(c.type!==At.Path){const{x:u,y:g}=this.editor.toViewportPt(o.cx,o.cy);c.updateAttrs({transform:[1,0,0,1,u-c.attrs.width/2,g-c.attrs.height/2]})}t&&o.isTransformHandle&&c.setRotate(s),o.rotation!==void 0&&c.setRotate(o.rotation),c.isVisible()&&(r.save(),c.draw({ctx:r}),r.restore())})}getHandleInfoByPoint(t){const e=[];if(this.shouldRenderTransformControl()&&e.push(...Array.from(this.transformHandles.values())),this.customHandlesVisible&&e.push(...this.customHandles),e.length===0)return null;const r=this.editor.toViewportPt(t.x,t.y),s=this.editor.selectedBox.getBox();for(let o=e.length-1;o>=0;o--){const c=e[o],u=c.type;if(!c){console.warn(`handle ${u} not found`);continue}if(c.hitTest?c.hitTest(r,c.padding,s):c.graphics.hitTest(r,c.padding))return{handleName:u,cursor:c.getCursor(u,s)}}return null}shouldRenderTransformControl(){return this.selectedBoxRect&&this.enableTransformControl}setCustomHandles(t){this.customHandles=t}getCustomHandlesIntersectedWithRect(t){const e=this.editor.toViewportPt(t.x,t.y),r=this.editor.toViewportPt(t.x+t.width,t.y+t.height),s={minX:e.x,minY:e.y,maxX:r.x,maxY:r.y};return this.customHandles.filter(o=>o.graphics.intersectWithBox(s))}clearCustomHandles(){this.customHandles=[]}hasCustomHandles(){return this.customHandles.length>0}showCustomHandles(){this.customHandlesVisible||(this.customHandlesVisible=!0,this.editor.render())}hideCustomHandles(){this.customHandlesVisible&&(this.customHandlesVisible=!1,this.editor.render())}}const Ga=i=>Oa.includes(i);class Ce extends Qt{constructor(e,r){super({...e,type:At.Rect},r);S(this,"type",At.Rect)}getAttrs(){return ht({...this.attrs,cornerRadius:this.attrs.cornerRadius??0})}toJSON(){return{...super.toJSON(),cornerRadius:this.attrs.cornerRadius}}getMaxCornerRadius(){return Math.min(this.attrs.width,this.attrs.height)/2}_realDraw(e,r){const{ctx:s,imgManager:o,smooth:c}=e,u=this.attrs,{fill:g,strokeWidth:y,stroke:x,transform:C}=r||this.attrs;s.save(),s.transform(...C);const A=F=>{F.beginPath(),u.cornerRadius?F.roundRect(0,0,u.width,u.height,u.cornerRadius):F.rect(0,0,u.width,u.height);for(const R of g??[])if(R.visible!==!1)switch(R.type){case vt.Solid:{F.fillStyle=Fe(R.attrs),F.fill();break}case vt.Image:if(o){const z=this.getMaxCornerRadius(),G=Math.min(u.cornerRadius??0,z);this.fillImage(F,R,o,c,G)}else console.warn("ImgManager is not provided")}if(y){F.lineWidth=y;for(const R of x??[])if(R.visible!==!1)switch(R.type){case vt.Solid:{F.strokeStyle=Fe(R.attrs),F.stroke();break}case vt.Image:}}F.closePath()},_=e.opacity??1;if(_<1&&(s.globalAlpha=_),_!==1)Bi({originCtx:s,viewSize:this.doc.getDeviceViewSize(),draw:A});else{const F=this.getCanvas2DContext(s);F?A(F):console.warn("Rect drawing requer CanvasRenderingContext2D - operação não suportada")}s.restore()}draw(e){if(this.shouldSkipDraw(e))return;const r=this.getOpacity()*(e.opacity??1);this._realDraw({...e,opacity:r})}drawOutline(e,r,s){this._realDraw({ctx:e},{stroke:[{type:vt.Solid,attrs:ge(r)}],strokeWidth:s,transform:this.getWorldTransform()})}getRect(){return{...this.getLocalPosition(),width:this.attrs.width,height:this.attrs.height}}createCornerRadiusHandleGraph(){return new ni({objectName:"cornerRadius",width:8,height:8,fill:[{type:vt.Solid,attrs:ge("#fff")}],stroke:[{type:vt.Solid,attrs:ge("#1592fe")}],strokeWidth:1},{doc:this.doc})}hitTest(e,r=0){const o=new lt(...this.getWorldTransform()).applyInverse(e),c=this.getMaxCornerRadius(),u=new Array(4).fill(Math.min(this.attrs.cornerRadius??0,c)),y=this.getStrokeWidth()/2,x={x:0,y:0,width:this.attrs.width,height:this.attrs.height},C=pa(o,x,u,r+y);return this.isFillShouldRender()?C:C?!pa(o,x,u.map(A=>Math.max(0,A-y)),-y-r):!1}getControlHandles(e,r){let s=0;r&&(s=14/e);const o=108,c=this.attrs;if(c.width*e<o||c.height*e<o)return[];const u=Math.min(c.width,c.height)/2,g=c.cornerRadius??0,y=[g,g,g,g],x=[],C={x:0,y:0,width:c.width,height:c.height},A=[{type:"nwCornerRadius",origin:{x:C.x,y:C.y},direction:{x:1,y:1},cornerRadius:y[0]},{type:"neCornerRadius",origin:{x:C.x+C.width,y:C.y},direction:{x:-1,y:1},cornerRadius:y[1]},{type:"seCornerRadius",origin:{x:C.x+C.width,y:C.y+C.height},direction:{x:-1,y:-1},cornerRadius:y[2]},{type:"swCornerRadius",origin:{x:C.x,y:C.y+C.height},direction:{x:1,y:-1},cornerRadius:y[3]}];for(let _=0;_<A.length;_++){const F=A[_];let R=F.cornerRadius;R<s?R=s:R>u&&(R=u);let z=F.origin.x+F.direction.x*R,G=F.origin.y+F.direction.y*R;const j=new lt(...this.getWorldTransform()).apply({x:z,y:G});z=j.x,G=j.y;const U=new pe({cx:z,cy:G,type:F.type,graphics:this.createCornerRadiusHandleGraph(),getCursor:()=>"default"});x.push(U)}return x}calcNewAttrsByControlHandle(e,r,s,o,c,u,g){const y={};if(e.endsWith("CornerRadius")){const x=this.attrs,A=new lt(...o).applyInverse(r);let _={x:0,y:0},F={x:0,y:0};const R={x:0,y:0,width:x.width,height:x.height};switch(e){case"nwCornerRadius":{_={x:1,y:1},F={x:A.x-R.x,y:A.y-R.y};break}case"neCornerRadius":{_={x:-1,y:1},F={x:A.x-(R.x+R.width),y:A.y-R.y};break}case"seCornerRadius":{_={x:-1,y:-1},F={x:A.x-(R.x+R.width),y:A.y-(R.y+R.height)};break}case"swCornerRadius":{_={x:1,y:-1},F={x:A.x-R.x,y:A.y-(R.y+R.height)};break}}const z=(_.x*F.x+_.y*F.y)/Math.sqrt(_.x*_.x+_.y*_.y);y.cornerRadius=Math.min(this.getMaxCornerRadius(),Math.round(Math.max(z,0)*Math.cos(Math.PI/4)))}else Object.assign(y,super.calcNewAttrsByControlHandle(e,r,s,o,c,u,g));return y}getInfoPanelAttrs(){return[...super.getInfoPanelAttrs(),{label:"C",key:"cornerRadius",value:this.attrs.cornerRadius??0,uiType:"number"}]}getSVGTagHead(e){const r=[...this.attrs.transform];e&&(r[4]+=e.x,r[5]+=e.y);const s=this.attrs.cornerRadius??0,o=s>1?` rx="${s}"`:"";return`<rect width="${this.attrs.width}" height="${this.attrs.height}" transform="matrix(${r.join(" ")})"${o}`}getLayerIconPath(){const c=this.getBbox(),u=c.maxX-c.minX,g=c.maxY-c.minY,y=11/Math.max(u,g),x=new lt().prepend(new lt(...this.getWorldTransform())).translate(-c.minX-u/2,-c.minY-g/2).scale(y,y).translate(12/2,12/2),C=this.attrs,A=Qd({x:0,y:0,width:C.width,height:C.height},this.attrs.cornerRadius);return A.forEach(_=>{_.points.forEach((F,R)=>{_.points[R]=x.apply(F)})}),Ir(A,5)}}class Cs extends Qt{constructor(e,r){super({...e,type:At.RegularPolygon},r);S(this,"type",At.RegularPolygon)}getAttrs(){return ht({...this.attrs,count:this.attrs.count})}toJSON(){return{...super.toJSON(),count:this.attrs.count}}getPoints(){return ou(this.getSize(),this.attrs.count)}getMinBbox(){if(this._cacheMinBbox)return this._cacheMinBbox;const e=new lt(...this.attrs.transform),r=this.getPoints().map(o=>e.apply(o)),s=Ei(r);return this._cacheMinBbox=s,s}draw(e){if(this.shouldSkipDraw(e))return;const r=this.getOpacity()*(e.opacity??1);this._realDraw({...e,opacity:r})}drawOutline(e,r,s){this._realDraw({ctx:e},{stroke:[{type:vt.Solid,attrs:ge(r)}],strokeWidth:s,transform:this.getWorldTransform()})}_realDraw(e,r){const s=this.attrs,{fill:o,strokeWidth:c,stroke:u,transform:g}=r||this.attrs,{ctx:y,imgManager:x,smooth:C}=e;y.save(),y.transform(...g??s.transform);const A=e.opacity??1;A<1&&(y.globalAlpha=A);const _=F=>{const R=this.toPathCmds();F.beginPath();for(const z of R)z.type==="M"?F.moveTo(z.points[0].x,z.points[0].y):z.type==="L"?F.lineTo(z.points[0].x,z.points[0].y):z.type==="C"?F.bezierCurveTo(z.points[0].x,z.points[0].y,z.points[1].x,z.points[1].y,z.points[2].x,z.points[2].y):z.type==="Z"&&F.closePath();for(const z of o??[])if(z.visible!==!1)switch(z.type){case vt.Solid:{F.fillStyle=Fe(z.attrs),F.fill();break}case vt.Image:x?(F.clip(),this.fillImage(F,z,x,C)):console.warn("ImgManager is not provided")}if(c){F.lineWidth=c;for(const z of u??[])if(z.visible!==!1)switch(z.type){case vt.Solid:{F.strokeStyle=Fe(z.attrs),F.stroke();break}case vt.Image:}}F.closePath()};if(A!==1)Bi({originCtx:y,viewSize:this.doc.getDeviceViewSize(),draw:_});else{const F=this.getCanvas2DContext(y);F?_(F):console.warn("RegularPolygon drawing requer CanvasRenderingContext2D - operação não suportada")}y.restore()}getInfoPanelAttrs(){return[...super.getInfoPanelAttrs(),{label:"N",key:"count",value:this.attrs.count,min:3,max:60,uiType:"number"},{label:"C",key:"cornerRadius",value:this.attrs.cornerRadius??0,min:0,max:100,uiType:"number"}]}updateAttrs(e,r){super.updateAttrs(e,r)}hitTest(e,r){const o=new lt(...this.getWorldTransform()).applyInverse(e);return au(this.getPoints(),o)}getSVGTagHead(e){const r=[...this.attrs.transform];return e&&(r[4]+=e.x,r[5]+=e.y),(this.attrs.cornerRadius??0)>0?`<path d="${Ir(this.toPathCmds(),10)}" transform="matrix(${r.join(" ")})"`:`<polygon points="${this.getPoints().map(c=>`${c.x},${c.y}`).join(" ")}" transform="matrix(${r.join(" ")})"`}toPathCmds(){let e=[];const r=this.getPoints(),s=this.attrs.cornerRadius??0;return s>0?e=Sa(r,s):(e=r.map((o,c)=>({type:c===0?"M":"L",points:[o]})),e.push({type:"Z",points:[]})),e}getLayerIconPath(){const c=this.getBbox(),u=c.maxX-c.minX,g=c.maxY-c.minY,y=11/Math.max(u,g),x=new lt().prepend(new lt(...this.getWorldTransform())).translate(-c.minX-u/2,-c.minY-g/2).scale(y,y).translate(12/2,12/2),C=this.toPathCmds();for(const A of C)A.points=A.points.map(_=>x.apply(_));return Ir(C,5)}}class vo extends Qt{constructor(e,r){super({...e,type:At.Star},r);S(this,"type",At.Star)}getAttrs(){return ht({...this.attrs,count:this.attrs.count})}toJSON(){return{...super.toJSON(),count:this.attrs.count}}getPoints(){return uu(this.getSize(),this.attrs.count,this.attrs.starInnerScale)}getMinBbox(){if(this._cacheMinBbox)return this._cacheMinBbox;const e=new lt(...this.attrs.transform),r=this.getPoints().map(o=>e.apply(o)),s=Ei(r);return this._cacheMinBbox=s,s}draw(e){if(this.shouldSkipDraw(e))return;const r=this.getOpacity()*(e.opacity??1);this._realDraw({...e,opacity:r})}drawOutline(e,r,s){this._realDraw({ctx:e},{stroke:[{type:vt.Solid,attrs:ge(r)}],strokeWidth:s,transform:this.getWorldTransform()})}_realDraw(e,r){const{fill:s,strokeWidth:o,stroke:c,transform:u}=r||this.attrs,{ctx:g,imgManager:y,smooth:x}=e;g.save(),g.transform(...u);const C=e.opacity??1;C<1&&(g.globalAlpha=C);const A=_=>{const F=this.toPathCmds();_.beginPath();for(const R of F)R.type==="M"?_.moveTo(R.points[0].x,R.points[0].y):R.type==="L"?_.lineTo(R.points[0].x,R.points[0].y):R.type==="C"?_.bezierCurveTo(R.points[0].x,R.points[0].y,R.points[1].x,R.points[1].y,R.points[2].x,R.points[2].y):R.type==="Z"&&_.closePath();for(const R of s??[])if(R.visible!==!1)switch(R.type){case vt.Solid:{_.fillStyle=Fe(R.attrs),_.fill();break}case vt.Image:y?(_.clip(),this.fillImage(_,R,y,x)):console.warn("ImgManager is not provided")}if(o){_.lineWidth=o;for(const R of c??[])if(R.visible!==!1)switch(R.type){case vt.Solid:{_.strokeStyle=Fe(R.attrs),_.stroke();break}case vt.Image:}}_.closePath()};if(C!==1)Bi({originCtx:g,viewSize:this.doc.getDeviceViewSize(),draw:A});else{const _=this.getCanvas2DContext(g);_?A(_):console.warn("Star drawing requer CanvasRenderingContext2D - operação não suportada")}g.restore()}getInfoPanelAttrs(){return[...super.getInfoPanelAttrs(),{label:"N",key:"count",value:this.attrs.count,min:3,max:60,uiType:"number"},{label:"C",key:"cornerRadius",value:this.attrs.cornerRadius??0,uiType:"number"},{label:"T",key:"starInnerScale",value:this.attrs.starInnerScale,min:.001,max:1,uiType:"percent"}]}updateAttrs(e,r){super.updateAttrs(e,r)}hitTest(e,r){const o=new lt(...this.getWorldTransform()).applyInverse(e);return cu(this.getPoints(),o)}getSVGTagHead(e){const r=[...this.attrs.transform];return e&&(r[4]+=e.x,r[5]+=e.y),(this.attrs.cornerRadius??0)>0?`<path d="${Ir(this.toPathCmds(),10)}" transform="matrix(${r.join(" ")})"`:`<polygon points="${this.getPoints().map(c=>`${c.x},${c.y}`).join(" ")}" transform="matrix(${r.join(" ")})"`}toPathCmds(){let e=[];const r=this.getPoints(),s=this.attrs.cornerRadius??0;return s>0?e=Sa(r,s):(e=r.map((o,c)=>({type:c===0?"M":"L",points:[o]})),e.push({type:"Z",points:[]})),e}getLayerIconPath(){const c=this.getBbox(),u=c.maxX-c.minX,g=c.maxY-c.minY,y=11/Math.max(u,g),x=new lt().prepend(new lt(...this.getWorldTransform())).translate(-c.minX-u/2,-c.minY-g/2).scale(y,y).translate(12/2,12/2),C=this.toPathCmds();for(const A of C)A.points=A.points.map(_=>x.apply(_));return Ir(C,5)}}function Pu(i,t={}){return{paragraphs:[{spans:[{text:i,style:t}],alignment:"left"}],defaultStyle:{fontSize:16,fontFamily:"Arial",color:"#000000",fontWeight:"normal",fontStyle:"normal",...t}}}function Mu(i,t={}){const e=[],r=/(\*\*(.+?)\*\*|\*(.+?)\*|__(.+?)__)|([^*_]+)/g;let s;for(;(s=r.exec(i))!==null;)s[2]?e.push({text:s[2],style:{...t,fontWeight:"bold"}}):s[3]?e.push({text:s[3],style:{...t,fontStyle:"italic"}}):s[4]?e.push({text:s[4],style:{...t,textDecoration:"underline"}}):s[5]&&e.push({text:s[5],style:t});return{paragraphs:[{spans:e.filter(o=>o.text.length>0),alignment:"left"}],defaultStyle:{fontSize:16,fontFamily:"Arial",color:"#000000",fontWeight:"normal",fontStyle:"normal",...t}}}class Tu{constructor(t){S(this,"canvasKit");this.canvasKit=t}renderRichText(t,e,r,s,o){var y;if((y=t.getOriginalContext)!=null&&y.call(t))throw new Error("RichTextRenderer requer CanvasKit - Canvas2D não suportado");const c=t;if(!c.canvas||!c.canvasKit)throw new Error("Renderer não é CanvasKit válido");let u=0,g=0;for(const x of e.paragraphs){const C=this.renderParagraph(c.canvas,x,e.defaultStyle,r,s+u,o);u+=C.height,g=Math.max(g,C.width)}return{width:g,height:u}}renderParagraph(t,e,r,s,o,c){const u=new this.canvasKit.ParagraphStyle({textAlign:this.getTextAlign(e.alignment||"left"),maxLines:e.maxLines,ellipsis:e.ellipsis,heightMultiplier:e.lineHeight||1}),g=this.canvasKit.ParagraphBuilder.Make(u);for(const _ of e.spans){const F=this.createTextStyle(_.style,r);g.pushStyle(F),g.addText(_.text),g.pop()}const y=g.build(),x=c||1e3;y.layout(x),y.paint(t,s,o);const C=y.getHeight(),A=Math.min(y.getMaxIntrinsicWidth(),x);return y.delete(),g.delete(),{width:A,height:C}}createTextStyle(t,e){const r={...e,...t};return new this.canvasKit.TextStyle({color:this.parseColor(r.color||"#000000"),fontSize:r.fontSize||16,fontFamilies:[r.fontFamily||"Arial"],fontWeight:this.getFontWeight(r.fontWeight||"normal"),fontStyle:this.getFontSlant(r.fontStyle||"normal"),decoration:this.getTextDecoration(r.textDecoration||"none"),letterSpacing:r.letterSpacing||0,wordSpacing:r.wordSpacing||0})}parseColor(t){if(t.startsWith("#")){const e=t.slice(1),r=parseInt(e.slice(0,2),16)/255,s=parseInt(e.slice(2,4),16)/255,o=parseInt(e.slice(4,6),16)/255;return Float32Array.from([r,s,o,1])}return Float32Array.from([0,0,0,1])}getTextAlign(t){switch(t){case"center":return this.canvasKit.TextAlign.Center;case"right":return this.canvasKit.TextAlign.Right;case"justify":return this.canvasKit.TextAlign.Justify;default:return this.canvasKit.TextAlign.Left}}getFontWeight(t){if(typeof t=="number")return t;switch(t){case"bold":return this.canvasKit.FontWeight.Bold;case"bolder":return this.canvasKit.FontWeight.ExtraBold;case"lighter":return this.canvasKit.FontWeight.Light;default:return this.canvasKit.FontWeight.Normal}}getFontSlant(t){switch(t){case"italic":return this.canvasKit.FontSlant.Italic;case"oblique":return this.canvasKit.FontSlant.Oblique;default:return this.canvasKit.FontSlant.Upright}}getTextDecoration(t){switch(t){case"underline":return this.canvasKit.TextDecoration.Underline;case"overline":return this.canvasKit.TextDecoration.Overline;case"line-through":return this.canvasKit.TextDecoration.LineThrough;default:return this.canvasKit.TextDecoration.NoDecoration}}measureRichText(t,e){let r=0,s=0;for(const o of t.paragraphs){const c=this.measureParagraph(o,t.defaultStyle,e);r+=c.height,s=Math.max(s,c.width)}return{width:s,height:r}}measureParagraph(t,e,r){const s=new this.canvasKit.ParagraphStyle({textAlign:this.getTextAlign(t.alignment||"left"),maxLines:t.maxLines,ellipsis:t.ellipsis,heightMultiplier:t.lineHeight||1}),o=this.canvasKit.ParagraphBuilder.Make(s);for(const x of t.spans){const C=this.createTextStyle(x.style,e);o.pushStyle(C),o.addText(x.text),o.pop()}const c=o.build(),u=r||1e3;c.layout(u);const g=c.getHeight(),y=Math.min(c.getMaxIntrinsicWidth(),u);return c.delete(),o.delete(),{width:y,height:g}}}const Au=80,Eu=30,za=document.createElement("canvas").getContext("2d");class kr extends Qt{constructor(e,r){super({...e,type:At.Text,width:e.width??Au,height:e.height??Eu},r);S(this,"type",At.Text);S(this,"_glyphs",null);S(this,"contentMetrics",null);S(this,"richTextRenderer",null);if(e.autoFit){za.font=`${e.fontSize}px ${e.fontFamily}`;const{width:s}=za.measureText(e.content);this.attrs.width=s,this.attrs.height=e.fontSize}}updateAttrs(e){const r="content"in e&&e.content!==this.attrs.content,s="fontSize"in e||"fontFamily"in e,o="fontFamily"in e&&e.fontFamily!==this.attrs.fontFamily;(r||s||o)&&(this._glyphs=null),super.updateAttrs(e)}draw(e){if(this.shouldSkipDraw(e))return;const r=this.getOpacity()*(e.opacity??1),{transform:s,fill:o,fontSize:c,content:u,fontFamily:g,enableRichText:y,enableMarkdown:x}=this.attrs,{ctx:C}=e;C.save(),C.transform(...s),r<1&&(C.globalAlpha=r),(y||x)&&this.canUseRichText(C)?this.drawRichText(C,o):this.drawSimpleText(C,o,u,c,g),C.restore()}canUseRichText(e){return e&&typeof e.getOriginalContext=="function"&&e.getOriginalContext()===null}drawRichText(e,r){try{if(!e||!e.canvasKit)throw new Error("CanvasKit não disponível no contexto");this.richTextRenderer||(this.richTextRenderer=new Tu(e.canvasKit));const s=this.getRichTextDocument();this.richTextRenderer.renderRichText(e,s,0,0,this.attrs.width),console.log("✅ Rich text renderizado com CanvasKit nativo")}catch(s){console.warn("⚠️ Rich text falhou, usando fallback:",s),this.drawSimpleText(e,r,this.attrs.content,this.attrs.fontSize,this.attrs.fontFamily)}}drawSimpleText(e,r,s,o,c){e.beginPath(),e.font=`${o}px ${c??"sans-serif"}`;for(const u of r??[])switch(u.type){case vt.Solid:{e.fillStyle=Fe(u.attrs);break}case vt.Image:}e.fontKerning="none",e.translate(0,this.getContentMetrics().fontBoundingBoxAscent),e.fillText(s,0,0)}getRichTextDocument(){var s,o;if(this.attrs.richText)return this.attrs.richText;const e=((o=(s=this.attrs.fill)==null?void 0:s[0])==null?void 0:o.type)===vt.Solid?Fe(this.attrs.fill[0].attrs):"#000000",r={fontSize:this.attrs.fontSize,fontFamily:this.attrs.fontFamily,color:e,fontWeight:"normal",fontStyle:"normal"};return this.attrs.enableMarkdown?Mu(this.attrs.content,r):Pu(this.attrs.content,r)}getSVGTagHead(e){const r=[...this.attrs.transform];return r[5]+=this.attrs.fontSize,e&&(r[4]+=e.x,r[5]+=e.y),`<text x="0" y="0" transform="matrix(${r.join(" ")})"`}getSVGTagTail(){return`>${Hd(this.attrs.content)}</text>`}getLayerIconPath(){return"M0 0H11V3H10V1H6V9H7.5V10H3.5V9H5V1H1V3H0V0Z"}getGlyphs(){return this._glyphs?this._glyphs:(this._glyphs=fu(this.attrs.content,{fontSize:this.attrs.fontSize,fontFamily:this.attrs.fontFamily}),this._glyphs)}getContentMetrics(){return this.contentMetrics?this.contentMetrics:(this.contentMetrics=gu(this.attrs.content,{fontSize:this.attrs.fontSize,fontFamily:this.attrs.fontFamily}),this.contentMetrics)}getContentLength(){return this.getGlyphs().length-1}isFillShouldRender(){return!0}getCursorIndex(e){e=co(this.getWorldTransform(),e);const r=this.getGlyphs();let s=0,o=r.length-1;for(;s<=o;){const c=Math.floor((s+o)/2),u=r[c];e.x<u.position.x?o=c-1:s=c+1}return s===0?0:s>=r.length?r.length-1:r[s].position.x-e.x>e.x-r[o].position.x?o:s}}const En={Rect:"Rect",Ellipse:"Ellipse",Line:"Line",RegularPolygon:"Polygon",Star:"Star",Path:"Path",Text:"Text",Group:"Group",Frame:"Frame"};class qt{constructor(t){S(this,"originAttrsMap",new Map);S(this,"updatedAttrsMap",new Map);S(this,"removedIds",new Set);S(this,"newIds",new Set);S(this,"isCommitDone",!1);this.editor=t}recordOld(t,e){return this.originAttrsMap.set(t,e),this}update(t,e){return this.updatedAttrsMap.set(t,e),this}remove(t){return this.removedIds.add(t),this}addNewIds(t){for(const e of t)this.newIds.add(e);return this}updateParentSize(t){return Di(this.editor,sr(t),this.originAttrsMap,this.updatedAttrsMap),this}updateNodeSize(t){return Di(this.editor,t,this.originAttrsMap,this.updatedAttrsMap),this}commit(t){if(this.isCommitDone){console.error("It had committed before, can not commit again!");return}this.editor.commandManager.pushCommand(new Mi(t,this.editor,this.originAttrsMap,this.updatedAttrsMap,this.removedIds,this.newIds)),this.isCommitDone=!0}}const Iu=(i,t)=>{const r={[ae.Left]:c=>c.x,[ae.HCenter]:c=>c.x+c.width/2,[ae.Right]:c=>c.x+c.width,[ae.Top]:c=>c.y,[ae.VCenter]:c=>c.y+c.height/2,[ae.Bottom]:c=>c.y+c.height}[t];if(!r)return!1;const s=i.map(c=>Wn(c)),o=r(s[0]);return s.every(c=>r(c)===o)},Rr=(i,t)=>{if(i.selectedElements.size()<2){console.warn("can align zero or two elements, fail silently");return}const e=i.selectedElements.getItems(),r=e.map(g=>g.getBbox()),s=e.map(g=>g.getWorldTransform()),o=On(r);if(Iu(r,t))return;const c=new qt(i),u=(g,y,x,C)=>{c.recordOld(g.attrs.id,{transform:ht(g.attrs.transform)});const A=ht(y);A[4]+=x,A[5]+=C,g.setWorldTransform(A),c.update(g.attrs.id,{transform:ht(g.attrs.transform)})};switch(t){case ae.Left:{for(let g=0;g<e.length;g++){const y=e[g],x=o.minX-r[g].minX;x!==0&&u(y,s[g],x,0)}break}case ae.HCenter:{const g=o.minX/2+o.maxX/2;for(let y=0;y<e.length;y++){const x=e[y],C=g-(r[y].minX/2+r[y].maxX/2);C!==0&&u(x,s[y],C,0)}break}case ae.Right:{for(let g=0;g<e.length;g++){const y=e[g],x=o.maxX-r[g].maxX;x!==0&&u(y,s[g],x,0)}break}case ae.Top:{for(let g=0;g<e.length;g++){const y=e[g],x=o.minY-r[g].minY;x!==0&&u(y,s[g],0,x)}break}case ae.VCenter:{const g=o.minY/2+o.maxY/2;for(let y=0;y<e.length;y++){const x=e[y],C=g-(r[y].minY/2+r[y].maxY/2);C!==0&&u(x,s[y],0,C)}break}case ae.Bottom:{for(let g=0;g<e.length;g++){const y=e[g],x=o.maxY-r[g].maxY;x!==0&&u(y,s[g],0,x)}break}default:{console.warn("invalid type:",t);break}}c.updateParentSize(e),c.commit("Align "+t),i.render()},Li=(i,t)=>{i.selectedElements.size()===0&&console.warn("can't arrange, no element");const e=i.selectedElements.getItems(),r=new qt(i),s=new Map;for(const c of e){const u=c.getParent();s.has(u)||s.set(u,new Set),s.get(u).add(c)}let o=!0;switch(t){case An.Front:{o=_u(r,s);break}case An.Back:{o=ku(r,s);break}case An.Forward:{o=Ru(r,s);break}case An.Backward:{o=Du(r,s);break}default:console.warn(`invalid type ${t}`);break}o?(r.commit(`Arrange ${t}`),i.render()):console.log("No need to arrange.")},_u=(i,t)=>{let e=!1;for(const[r,s]of t){if(r.getChildrenCount()===s.size)continue;const{count:o}=$a(r.getChildren(),s);if(o===s.size)continue;e=!0;const c=r.getMaxChildIndex(),u=Qt.sortGraphicsArray(Array.from(s)),g=_r(c,null,u.length);for(let y=0;y<u.length;y++){const x=u[y];i.recordOld(x.attrs.id,{parentIndex:ht(x.attrs.parentIndex)}),x.updateAttrs({parentIndex:{guid:r.attrs.id,position:g[y]}}),i.update(x.attrs.id,{parentIndex:ht(x.attrs.parentIndex)})}r.markSortDirty(),r.sortChildren()}return e},ku=(i,t)=>{let e=!1;for(const[r,s]of t){if(r.getChildrenCount()===s.size)continue;const{count:o}=Ka(r.getChildren(),s);if(o===s.size)continue;e=!0;const c=r.getMinChildIndex(),u=Qt.sortGraphicsArray(Array.from(s)),g=_r(null,c,u.length);for(let y=0;y<u.length;y++){const x=u[y];i.recordOld(x.attrs.id,{parentIndex:ht(x.attrs.parentIndex)}),x.updateAttrs({parentIndex:{guid:r.attrs.id,position:g[y]}}),i.update(x.attrs.id,{parentIndex:ht(x.attrs.parentIndex)})}r.markSortDirty(),r.sortChildren()}return e},Ru=(i,t)=>{var r;let e=!1;for(const[s,o]of t){if(s.getChildrenCount()===o.size)continue;const c=s.getChildren(),{index:u,count:g}=$a(c,o);if(g!==o.size){e=!0;for(let y=u;y>=0;y--){const x=c[y];if(o.has(x)){const C=c[y+1].getSortIndex(),A=((r=c[y+2])==null?void 0:r.getSortIndex())??null,_=Gn(C,A);na(c,y,y+1),i.recordOld(x.attrs.id,{parentIndex:ht(x.attrs.parentIndex)}),x.updateAttrs({parentIndex:{guid:s.attrs.id,position:_}}),i.update(x.attrs.id,{parentIndex:ht(x.attrs.parentIndex)})}}s.markSortDirty(),s.sortChildren()}}return e},Du=(i,t)=>{var r;let e=!1;for(const[s,o]of t){if(s.getChildrenCount()===o.size)continue;const c=s.getChildren(),{index:u,count:g}=Ka(c,o);if(g!==o.size){e=!0;for(let y=u;y<=c.length;y++){const x=c[y];if(o.has(x)){const C=((r=c[y-2])==null?void 0:r.getSortIndex())??null,A=c[y-1].getSortIndex(),_=Gn(C,A);na(c,y,y-1),i.recordOld(x.attrs.id,{parentIndex:ht(x.attrs.parentIndex)}),x.updateAttrs({parentIndex:{guid:s.attrs.id,position:_}}),i.update(x.attrs.id,{parentIndex:ht(x.attrs.parentIndex)})}}s.markSortDirty(),s.sortChildren()}}return e},Ka=(i,t)=>{let e=0,r=0;for(;e<i.length&&t.has(i[e]);e++)r++;return{index:e,count:r}},$a=(i,t)=>{let e=i.length-1,r=0;for(;e>=0&&t.has(i[e]);e--)r++;return{index:e,count:r}},Bu={exportOriginFile:(i,t="design")=>{const e=i.sceneGraph.toJSON(),r=new Blob([e],{type:"application/json"});Fu(r,t+".suika")}},Fu=(i,t)=>{const e=URL.createObjectURL(i),r=document.createElement("a");r.href=e,r.setAttribute("download",t),r.click()},ja=(i,t)=>{Na(i,t,{x:-1,y:1})},Va=(i,t)=>{Na(i,t,{x:1,y:-1})},Na=(i,t,e)=>{const r=t.length;if(r===0){console.warn("graphics should not be empty");return}let s;r===1?s=t[0].getWorldCenter():s=wu(On(t.map(c=>c.getBbox())));const o=new lt().translate(-s.x,-s.y).scale(e.x,e.y).translate(s.x,s.y);Lu(i,t,o.getArray(),"Flip Vertical")},Lu=(i,t,e,r)=>{const s=new qt(i);for(const o of t)s.recordOld(o.attrs.id,{transform:ht(o.attrs.transform)}),o.prependWorldTransform(e),s.update(o.attrs.id,{transform:ht(o.attrs.transform)});s.updateParentSize(t),s.commit(r)},Ya=(i,t)=>{if(i.length===0){console.warn("graphics should not be empty");return}i=Qt.sortGraphics(i);const e=sr(i),r=i.at(-1),s=r.getParent(),o=wn(s.getWorldTransform()),c=r.getSortIndex(),u=Wn(On(i.map(C=>Ii({...C.getSize(),transform:ze(o,C.getWorldTransform())})))),g=new ri({objectName:zn(s,En.Group),width:u.width,height:u.height,resizeToFit:!0},{advancedAttrs:{x:u.x,y:u.y},doc:t.doc});s.insertChild(g,c);const y=wn(g.getWorldTransform()),x=new qt(t);x.addNewIds([g.attrs.id]);for(const C of i)x.recordOld(C.attrs.id,{parentIndex:ht(C.attrs.parentIndex),transform:ht(C.attrs.transform)}),C.updateAttrs({transform:ze(y,C.getWorldTransform())}),g.insertChild(C),x.update(C.attrs.id,{parentIndex:ht(C.attrs.parentIndex),transform:ht(C.attrs.transform)});x.updateNodeSize(e),x.commit("group"),t.sceneGraph.addItems([g]),t.selectedElements.setItems([g])},Hu={importOriginFile:i=>{Wu(".suika",t=>{i.setContents(JSON.parse(t))})}};function Wu(i,t){const e=document.createElement("input");e.type="file",e.accept=i,e.style.display="none",e.addEventListener("change",function(r){var c;const s=(c=r.target.files)==null?void 0:c[0];if(!s)return;const o=new FileReader;o.onload=function(u){var y;const g=(y=u.target)==null?void 0:y.result;g&&t(g)},o.readAsText(s)}),e.click()}const wo={setX({editor:i,graphicsArr:t,val:e,isDelta:r=!1}){if(t.length===0)return;const s=new qt(i);for(const o of t){s.recordOld(o.attrs.id,{transform:ht(o.attrs.transform)});const c=o.getWorldTransform(),u=r?c[4]+e:e;c[4]=u,o.setWorldTransform(c),s.update(o.attrs.id,{transform:ht(o.attrs.transform)})}s.updateParentSize(t),s.commit("Update X of Elements")},setY({editor:i,graphicsArr:t,val:e,isDelta:r=!1}){if(t.length===0)return;const s=new qt(i);for(const o of t){s.recordOld(o.attrs.id,{transform:ht(o.attrs.transform)});const c=o.getWorldTransform(),u=r?c[5]+e:e;c[5]=u,o.setWorldTransform(c),s.update(o.attrs.id,{transform:ht(o.attrs.transform)})}s.updateParentSize(t),s.commit("Update Y of Elements")},setWidth({editor:i,graphicsArr:t,val:e,isDelta:r=!1}){let s=!1;if(t.length===0)return!1;const o=new qt(i);for(const c of t){o.recordOld(c.attrs.id,{width:c.attrs.width});let u=r?c.attrs.width+e:e;u<=0&&(u=1e-7),u!==c.attrs.width&&(s=!0),c.updateAttrs({width:u}),o.update(c.attrs.id,{width:c.attrs.width})}return s&&(o.updateParentSize(t),o.commit("Update Width of Elements")),s},setHeight({editor:i,graphicsArr:t,val:e,isDelta:r=!1}){if(t.length===0)return!1;let s=!1;const o=new qt(i);for(const c of t){o.recordOld(c.attrs.id,{height:c.attrs.height});let u=r?c.attrs.height+e:e;u<=0&&(u=0),u!==c.attrs.height&&(s=!0),c.updateAttrs({height:u}),o.update(c.attrs.id,{height:c.attrs.height})}return s&&(o.updateParentSize(t),o.commit("Update Height of Elements")),s},setRotation({editor:i,graphicsArr:t,rotation:e,isDelta:r=!1}){if(t.length===0)return;const s=new qt(i);for(const o of t){s.recordOld(o.attrs.id,{transform:ht(o.attrs.transform)});const c=r?o.getRotate()+e:e;o.setRotate(c),s.update(o.attrs.id,{transform:ht(o.attrs.transform)})}s.updateParentSize(t),s.commit("Update Rotation")},setCornerRadius({editor:i,graphicsArr:t,val:e,isDelta:r=!1}){if(t.length===0)return!1;let s=!1;const o=t.filter(u=>u.type===At.Rect||u.type===At.RegularPolygon||u.type===At.Star),c=new qt(i);for(const u of o){c.recordOld(u.attrs.id,{cornerRadius:u.attrs.cornerRadius});const g=u.attrs.cornerRadius??0;let y=r?g+e:e;y<=0&&(y=0),y!==g&&(s=!0),u.updateAttrs({cornerRadius:y}),c.update(u.attrs.id,{cornerRadius:u.attrs.cornerRadius})}return s&&c.commit("Update CornerRadius of Elements"),s},setCount({editor:i,graphicsArr:t,val:e,isDelta:r=!1}){if(t.length===0)return;let s=!1;const o=t.filter(u=>u.type===At.RegularPolygon||u.type===At.Star),c=new qt(i);for(const u of o){c.recordOld(u.attrs.id,{count:u.attrs.count});const g=u.attrs.count??0;let y=r?g+e:e;y<=3&&(y=3),y!==g&&(s=!0),u.updateAttrs({count:y}),c.update(u.attrs.id,{count:u.attrs.count})}return s&&c.commit("Update Count of Elements"),s},setStarInnerScale({editor:i,graphicsArr:t,val:e,isDelta:r=!1}){if(t.length===0)return;let s=!1;const o=t.filter(u=>u.type===At.Star),c=new qt(i);for(const u of o){c.recordOld(u.attrs.id,{starInnerScale:u.attrs.starInnerScale});const g=u.attrs.starInnerScale??0;let y=r?g+e:e;y<=.001&&(y=.001),y!==g&&(s=!0),u.updateAttrs({starInnerScale:y}),c.update(u.attrs.id,{starInnerScale:u.attrs.starInnerScale})}return s&&c.commit("Update StarInnerScale of Elements"),s},toggleVisible(i,t){if(t.length===0)return;const e=t.some(s=>!s.isVisible()),r=new qt(i);for(const s of t)r.recordOld(s.attrs.id,{visible:s.attrs.visible}),s.updateAttrs({visible:e}),r.update(s.attrs.id,{visible:e});r.updateParentSize(t),r.commit("update visible of graphs")},toggleLock(i,t){if(t.length===0)return;const e=t.some(s=>!s.isLock()),r=t.map(s=>({lock:s.attrs.lock}));t.forEach(s=>{s.updateAttrs({lock:e})}),i.commandManager.pushCommand(new Ln("update lock of graphs",t,{lock:e},r))},setGraphName(i,t,e){const r=[{objectName:t.attrs.objectName}];t.updateAttrs({objectName:e}),i.commandManager.pushCommand(new Ln("update name of graphics",[t],{objectName:e},r))}},Ua=(i,t)=>{var u;const e=i.filter(g=>Pe(g));if(e.length===0){console.log("no frame graphics, no ungroup");return}const r=sr(i),s=new Map;for(const g of e){const y=g.getParentId();if(!y){console.warn(`graphics ${y} lost`);continue}s.has(y)||s.set(y,new Set),s.get(y).add(g)}const o=new qt(t);let c=[];for(const[g,y]of s){const C=t.doc.getGraphicsById(g).getChildren();for(let A=0;A<C.length;A++){const _=C[A];if(!Pe(_)||!y.has(_))continue;const F=((u=C[A-1])==null?void 0:u.getSortIndex())??null,R=_.getSortIndex();_.removeFromParent(),_.setDeleted(!0),o.remove(_.attrs.id);const z=Ou(o,g,_,F,R);c=c.concat(z)}}o.updateNodeSize(r),o.commit("ungroup"),t.selectedElements.setItems(c),t.selectedElements.setHoverItem(null)},Ou=(i,t,e,r,s)=>{const o=e.getChildren(),c=_r(r,s,o.length);for(let u=0;u<o.length;u++){const g=o[u],y=g.getWorldTransform();i.recordOld(g.attrs.id,{parentIndex:ht(g.attrs.parentIndex),transform:ht(g.attrs.transform)}),g.updateAttrs({parentIndex:{guid:t,position:c[u]}}),g.insertAtParent(c[u]),g.setWorldTransform(y),i.update(g.attrs.id,{parentIndex:ht(g.attrs.parentIndex),transform:ht(g.attrs.transform)})}return o};class Gu{constructor(t){S(this,"isBound",!1);this.editor=t}bindKey(){if(this.isBound){console.warn("CommandKeyBinding has been bound, please destroy it first");return}this.isBound=!0;const t=this.editor,e=()=>t.commandManager.undo();t.keybindingManager.register({key:{metaKey:!0,keyCode:"KeyZ"},winKey:{ctrlKey:!0,keyCode:"KeyZ"},when:rt=>!rt.isToolDragging,actionName:"Undo",action:e});const r=()=>t.commandManager.redo();t.keybindingManager.register({key:{metaKey:!0,shiftKey:!0,keyCode:"KeyZ"},winKey:{ctrlKey:!0,shiftKey:!0,keyCode:"KeyZ"},when:rt=>!rt.isToolDragging,actionName:"Redo",action:r});const s=()=>{t.hostEventManager.isEnableDelete&&t.selectedElements.removeFromScene()};t.keybindingManager.register({key:[{keyCode:"Backspace"},{keyCode:"Delete"}],when:rt=>!rt.isToolDragging,actionName:"Delete",action:s});const o=()=>{t.selectedElements.selectAll(),t.render()};t.keybindingManager.register({key:{metaKey:!0,keyCode:"KeyA"},winKey:{ctrlKey:!0,keyCode:"KeyA"},actionName:"Select All",action:o});const c=()=>{this.editor.toolManager.getActiveToolName()==="select"?t.selectedElements.clear():this.editor.toolManager.setActiveTool("select"),t.render()};t.keybindingManager.register({key:{keyCode:"Escape"},when:rt=>!rt.isToolDragging,actionName:"Back to Select Tool or Cancel Select",action:c});const u=()=>{t.setting.set("enableRuler",!t.setting.get("enableRuler")),t.render()};t.keybindingManager.register({key:{shiftKey:!0,keyCode:"KeyR"},actionName:"Toggle Rulers",action:u});const g=()=>{t.zoomManager.zoomToFit(),t.render()};t.keybindingManager.register({key:{shiftKey:!0,keyCode:"Digit1"},actionName:"Zoom To Fit",action:g});const y=()=>{t.zoomManager.zoomToSelection(),t.render()};t.keybindingManager.register({key:{shiftKey:!0,keyCode:"Digit2"},actionName:"Zoom To Selection",action:y});const x=()=>{t.zoomManager.zoomIn({isLevelZoom:!0}),t.render()};t.keybindingManager.register({key:[{metaKey:!0,keyCode:"Equal"},{keyCode:"Equal"}],winKey:{ctrlKey:!0,keyCode:"Equal"},actionName:"Zoom In",action:x});const C=()=>{t.zoomManager.zoomOut({isLevelZoom:!0}),t.render()};t.keybindingManager.register({key:[{metaKey:!0,keyCode:"Minus"},{keyCode:"Minus"}],winKey:{ctrlKey:!0,keyCode:"Minus"},actionName:"Zoom Out",action:C});const A=()=>{t.zoomManager.setZoomAndUpdateViewport(1),t.render()};t.keybindingManager.register({key:[{metaKey:!0,keyCode:"Digit0"},{shiftKey:!0,keyCode:"Digit0"}],winKey:[{ctrlKey:!0,keyCode:"Digit0"},{shiftKey:!0,keyCode:"Digit0"}],actionName:"Zoom To 100%",action:A});const _=()=>{t.setting.set("enablePixelGrid",!t.setting.get("enablePixelGrid")),t.render()};t.keybindingManager.register({key:{metaKey:!0,keyCode:"Quote"},winKey:{ctrlKey:!0,keyCode:"Quote"},actionName:"Toggle Grid",action:_});const F=()=>{t.setting.set("snapToGrid",!t.setting.get("snapToGrid")),t.render()};t.keybindingManager.register({key:{shiftKey:!0,metaKey:!0,keyCode:"Quote"},winKey:{shiftKey:!0,ctrlKey:!0,keyCode:"Quote"},actionName:"Snap To Grid",action:F});const R=()=>{Li(t,An.Front),t.render()};t.keybindingManager.register({key:{keyCode:"BracketRight"},when:rt=>!rt.isToolDragging,actionName:"Front",action:R});const z=()=>{Li(t,An.Back),t.render()};t.keybindingManager.register({key:{keyCode:"BracketLeft"},when:rt=>!rt.isToolDragging,actionName:"Back",action:z});const G=()=>{Li(t,An.Forward),t.render()};t.keybindingManager.register({key:{metaKey:!0,keyCode:"BracketRight"},winKey:{ctrlKey:!0,keyCode:"BracketRight"},when:rt=>!rt.isToolDragging,actionName:"Forward",action:G});const V=()=>{Li(t,An.Backward),t.render()};t.keybindingManager.register({key:{metaKey:!0,keyCode:"BracketLeft"},winKey:{ctrlKey:!0,keyCode:"BracketLeft"},when:rt=>!rt.isToolDragging,actionName:"Backward",action:V}),t.keybindingManager.register({key:{altKey:!0,keyCode:"KeyA"},when:rt=>!rt.isToolDragging,actionName:"AlignLeft",action:()=>{Rr(t,ae.Left)}}),t.keybindingManager.register({key:{altKey:!0,keyCode:"KeyH"},when:rt=>!rt.isToolDragging,actionName:"AlignHorizontalCenters",action:()=>{Rr(t,ae.HCenter)}}),t.keybindingManager.register({key:{altKey:!0,keyCode:"KeyD"},when:rt=>!rt.isToolDragging,actionName:"AlignRight",action:()=>{Rr(t,ae.Right)}}),t.keybindingManager.register({key:{altKey:!0,keyCode:"KeyW"},when:rt=>!rt.isToolDragging,actionName:"AlignTop",action:()=>{Rr(t,ae.Top)}}),t.keybindingManager.register({key:{altKey:!0,keyCode:"KeyV"},when:rt=>!rt.isToolDragging,actionName:"AlignVerticalCenters",action:()=>{Rr(t,ae.VCenter)}}),t.keybindingManager.register({key:{altKey:!0,keyCode:"KeyS"},when:rt=>!rt.isToolDragging,actionName:"AlignBottom",action:()=>{Rr(t,ae.Bottom)}});const j=()=>{Ya(this.editor.selectedElements.getItems(),t),t.render()};t.keybindingManager.register({key:{metaKey:!0,keyCode:"KeyG"},winKey:{ctrlKey:!0,keyCode:"KeyG"},when:rt=>!rt.isToolDragging,actionName:"Group",action:j});const U=()=>{Ua(this.editor.selectedElements.getItems(),t),t.render()};t.keybindingManager.register({key:{metaKey:!0,keyCode:"Backspace"},winKey:{ctrlKey:!0,keyCode:"Backspace"},when:rt=>!rt.isToolDragging,actionName:"Ungroup",action:U});const N=()=>{wo.toggleVisible(t,t.selectedElements.getItems()),t.render()};t.keybindingManager.register({key:{metaKey:!0,shiftKey:!0,keyCode:"KeyH"},winKey:{ctrlKey:!0,shiftKey:!0,keyCode:"KeyH"},when:rt=>!rt.isToolDragging,actionName:"Show/Hide",action:N});const Q=()=>{wo.toggleLock(t,t.selectedElements.getItems()),t.render()};t.keybindingManager.register({key:{metaKey:!0,shiftKey:!0,keyCode:"KeyL"},winKey:{ctrlKey:!0,shiftKey:!0,keyCode:"KeyL"},when:rt=>!rt.isToolDragging,actionName:"Lock/Unlock",action:Q});const Y=()=>{Va(t,t.selectedElements.getItems()),t.render()};t.keybindingManager.register({key:{shiftKey:!0,keyCode:"KeyV"},winKey:{shiftKey:!0,keyCode:"KeyV"},when:rt=>!rt.isToolDragging,actionName:"FlipVertical",action:Y});const Z=()=>{ja(t,t.selectedElements.getItems()),t.render()};t.keybindingManager.register({key:{shiftKey:!0,keyCode:"KeyH"},winKey:{shiftKey:!0,keyCode:"KeyH"},when:rt=>!rt.isToolDragging,actionName:"FlipHorizontal",action:Z});const wt=()=>{const rt=t.selectedElements.getItems(),dt=[];let Ht=!1;for(const st of rt)Pe(st)&&st.isGroup()?(dt.push(...st.getChildren()),Ht=!0):dt.push(st);Ht&&(t.selectedElements.setItems(dt),t.render())},ut=()=>{const rt=t.selectedElements.size();if(!(t.pathEditor.isActive()||rt===0))if(rt===1){const dt=t.selectedElements.getItems()[0];dt instanceof Se?t.pathEditor.active(dt):dt instanceof kr?t.textEditor.active({textGraphics:dt,pos:dt.getWorldPosition(),range:{start:0,end:dt.getContentLength()}}):dt instanceof kr?t.textEditor.active({textGraphics:dt,pos:dt.getWorldPosition()}):Pe(dt)&&dt.isGroup()&&wt()}else wt()};t.keybindingManager.register({key:{keyCode:"Enter"},when:rt=>!rt.isToolDragging,actionName:"EnterGraphEdit",action:ut})}destroy(){this.isBound=!1}}class zu{constructor(t){S(this,"unbindHandler",Tr);S(this,"hadBound",!1);S(this,"transaction");this.editor=t,this.transaction=new qt(t)}bindKey(){if(this.hadBound){console.warn("MoveGraphsKeyBinding had already bound, please unbind first");return}this.hadBound=!0;const t=this.editor;let e=!0;const r=ph(x=>{this.editor.controlHandleManager.showCustomHandles(),e=!0;for(const C of x)this.transaction.update(C.attrs.id,{transform:ht(C.attrs.transform)});this.editor.commandManager.enableRedoUndo(),this.transaction.commit("Move elements by direction key"),this.transaction=new qt(t)},t.setting.get("moveElementsDelay")),s=()=>{r.flush()},o={ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1},c=()=>o.ArrowLeft||o.ArrowRight||o.ArrowUp||o.ArrowDown,u=x=>{const C=t.selectedElements.getItems();if(C.length===0||(x.key in o&&(o[x.key]=!0),!c()))return;if(e){for(const _ of C)this.transaction.recordOld(_.attrs.id,{transform:ht(_.attrs.transform)});e=!1}let A=t.setting.get("smallNudge");x.shiftKey&&(A=t.setting.get("bigNudge")),o.ArrowLeft&&Qt.dMove(C,-A,0),o.ArrowRight&&Qt.dMove(C,A,0),o.ArrowUp&&Qt.dMove(C,0,-A),o.ArrowDown&&Qt.dMove(C,0,A),this.transaction.updateParentSize(C),this.editor.commandManager.disableRedoUndo(),this.editor.controlHandleManager.hideCustomHandles(),r(C),t.render()},g=x=>{const C=x.key;C in o&&(o[C]=!1)},y=["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"];this.editor.keybindingManager.register({key:[...y.map(x=>({keyCode:x})),...y.map(x=>({shiftKey:!0,keyCode:x}))],actionName:"Move Elements",action:u}),window.addEventListener("keyup",g),t.commandManager.on("beforeExecCmd",s),this.unbindHandler=()=>{window.removeEventListener("keyup",g),t.commandManager.off("beforeExecCmd",s)}}destroy(){this.unbindHandler(),this.hadBound=!1}}class Ku{constructor(t){S(this,"isShiftPressing",!1);S(this,"isCtrlPressing",!1);S(this,"isAltPressing",!1);S(this,"isCommandPressing",!1);S(this,"isSpacePressing",!1);S(this,"isWheelBtnPressing",!1);S(this,"isDraggingCanvasBySpace",!1);S(this,"isEnableDelete",!0);S(this,"isEnableContextMenu",!0);S(this,"moveGraphsKeyBinding");S(this,"commandKeyBinding");S(this,"eventEmitter",new Le);S(this,"unbindHandlers",[]);this.editor=t,this.moveGraphsKeyBinding=new zu(t),this.commandKeyBinding=new Gu(t)}bindHotkeys(){this.observeModifiersToggle(),this.bindWheelEvent(),this.bindContextMenu(),this.moveGraphsKeyBinding.bindKey(),this.commandKeyBinding.bindKey()}observeModifiersToggle(){const t=e=>{const r=this.isShiftPressing,s=this.isAltPressing,o=this.isSpacePressing;this.isShiftPressing=e.shiftKey,this.isCtrlPressing=e.ctrlKey,this.isAltPressing=e.altKey,this.isCommandPressing=e.metaKey,e.code==="Space"&&(this.isSpacePressing=e.type==="keydown"),r!==this.isShiftPressing&&this.eventEmitter.emit("shiftToggle",this.isShiftPressing),s!==this.isAltPressing&&this.eventEmitter.emit("altToggle",this.isAltPressing),o!==this.isSpacePressing&&this.eventEmitter.emit("spaceToggle",this.isSpacePressing)};document.addEventListener("keydown",t),document.addEventListener("keyup",t),this.unbindHandlers.push(()=>{document.removeEventListener("keydown",t),document.removeEventListener("keyup",t)})}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}bindWheelEvent(){const t=this.editor,e=s=>{if(s.ctrlKey||s.metaKey){s.preventDefault();const o=this.editor.getCursorXY(s);let c=s.deltaY>0;this.editor.setting.get("invertZoomDirection")&&(c=!c),c?t.zoomManager.zoomOut({center:o,deltaY:s.deltaY}):t.zoomManager.zoomIn({center:o,deltaY:s.deltaY}),t.render()}else{if(this.editor.canvasDragger.isActive()&&this.editor.canvasDragger.isPressing())return;const o=t.zoomManager.getZoom();t.viewportManager.translate(s.deltaX/o,s.deltaY/o),t.render()}},r=s=>{(s.ctrlKey||s.metaKey)&&s.preventDefault()};t.canvasElement.addEventListener("wheel",e),window.addEventListener("wheel",r,{passive:!1}),this.unbindHandlers.push(()=>{t.canvasElement.removeEventListener("wheel",e),window.removeEventListener("wheel",r)})}bindContextMenu(){const t=e=>{e.preventDefault(),this.isEnableContextMenu&&this.eventEmitter.emit("contextmenu",{x:e.clientX,y:e.clientY})};this.editor.canvasElement.addEventListener("contextmenu",t),this.unbindHandlers.push(()=>{this.editor.canvasElement.removeEventListener("contextmenu",t)})}enableDelete(){this.isEnableDelete=!0}disableDelete(){this.isEnableDelete=!1}enableContextmenu(){this.isEnableContextMenu=!0}disableContextmenu(){this.isEnableContextMenu=!1}destroy(){this.unbindHandlers.forEach(t=>t()),this.unbindHandlers=[],this.moveGraphsKeyBinding.destroy(),this.commandKeyBinding.destroy()}}var xo=(i=>(i[i.Left=0]="Left",i[i.Mid=1]="Mid",i))(xo||{});class $u{constructor(t){S(this,"isWheelBtnPressing",!1);S(this,"eventEmitter",new Le);S(this,"cursorPos",null);S(this,"startPos",{x:0,y:0});S(this,"isPressing",!1);S(this,"maxDragDistance",0);S(this,"onPointerdown",t=>{if(t.target!==this.editor.canvasElement)return;this.updateIsWheelBtnPressing(t),this.isPressing=!0;const{pos:e,vwPos:r}=this.getPosAndVwPos(t);this.startPos={...e};const s=this.checkIfComboClick(t),o={pos:e,vwPos:r,nativeEvent:t,isComboClick:s};this.eventEmitter.emit("start",o),s&&this.eventEmitter.emit("comboClick",o)});S(this,"onPointerMove",t=>{const e=t.target===this.editor.canvasElement;if(e||this.isPressing){const o=this.editor.getSceneCursorXY(t);this.setCursorPos(o)}const{pos:r,vwPos:s}=this.getPosAndVwPos(t);if(this.isPressing){const o=r.x-this.startPos.x,c=r.y-this.startPos.y,u=Math.max(Math.abs(o),Math.abs(c));this.maxDragDistance=Math.max(u,this.maxDragDistance),this.eventEmitter.emit("drag",{pos:r,vwPos:s,nativeEvent:t,isOutside:e,maxDragDistance:this.maxDragDistance})}else this.eventEmitter.emit("move",{pos:r,vwPos:s,nativeEvent:t,isOutside:e,maxDragDistance:this.maxDragDistance})});S(this,"onPointerUp",t=>{this.updateIsWheelBtnPressing(t),this.isPressing=!1,this.maxDragDistance=0,(t.target===this.editor.canvasElement||this.isPressing)&&this.eventEmitter.emit("end",{...this.getPosAndVwPos(t),nativeEvent:t})});S(this,"pointerDownTimeStamp",-1/0);S(this,"lastPointerDownPos",{x:-99,y:-99});S(this,"checkIfComboClick",t=>{if(t.button!==0)return!1;const e=new Date().getTime(),r={x:t.pageX,y:t.pageY},s=e-this.pointerDownTimeStamp,o=ne(r,this.lastPointerDownPos);return s<this.editor.setting.get("comboClickMaxGap")&&o<this.editor.setting.get("comboClickDistanceTol")?(this.pointerDownTimeStamp=e,!0):(this.pointerDownTimeStamp=e,this.lastPointerDownPos=r,!1)});this.editor=t,this.bindEvent()}getCursorPos(){return ht(this.cursorPos)}setCursorPos(t){const e=this.cursorPos;this.cursorPos=t&&{x:t.x,y:t.y},Si(e,this.cursorPos)||this.eventEmitter.emit("cursorPosUpdate",ht(t))}getPosAndVwPos(t){const e=this.editor.getCursorXY(t);return{pos:this.editor.toScenePt(e.x,e.y),vwPos:e}}updateIsWheelBtnPressing(t){if(t.button===1){const e=this.isWheelBtnPressing;t.type==="pointerdown"?this.isWheelBtnPressing=!0:t.type==="pointerup"&&(this.isWheelBtnPressing=!1),e!==this.isWheelBtnPressing&&this.eventEmitter.emit("wheelBtnToggle",this.isWheelBtnPressing,t)}}bindEvent(){window.addEventListener("pointerdown",this.onPointerdown),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp)}unbindEvent(){window.removeEventListener("pointerdown",this.onPointerdown),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp)}destroy(){this.unbindEvent()}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}class ju{constructor(t){S(this,"_active",!1);S(this,"inactiveAfterPointerUp",!1);S(this,"isEnableDragCanvasBySpace",!0);S(this,"_isPressing",!1);S(this,"startVwPos",{x:0,y:0});S(this,"startViewportPos",{x:0,y:0});S(this,"eventEmitter",new Le);S(this,"handleSpaceToggle",t=>{this.isEnableDragCanvasBySpace&&(t?this.active():this.inactive())});S(this,"handleWheelBtnToggle",(t,e)=>{this.isEnableDragCanvasBySpace&&(t?this.active(e):this.inactive())});S(this,"onStart",t=>{t.nativeEvent.button!==xo.Left&&t.nativeEvent.button!==xo.Mid||(this.editor.textEditor.isActive()&&t.nativeEvent.preventDefault(),this.editor.cursorManager.setCursor("grabbing"),this._isPressing=!0,this.startVwPos={...t.vwPos},this.startViewportPos=this.editor.viewportManager.getViewport())});S(this,"onDrag",t=>{if(!this._isPressing)return;const e=t.vwPos.x-this.startVwPos.x,r=t.vwPos.y-this.startVwPos.y,s=this.editor.setting.get("dragBlockStep"),o=this.editor.zoomManager.getZoom();if(t.maxDragDistance>s/o){const c=this.startViewportPos.x-e/o,u=this.startViewportPos.y-r/o;this.editor.viewportManager.setViewport({x:c,y:u}),this.editor.render()}});S(this,"onEnd",()=>{this.editor.cursorManager.setCursor("grab"),this._isPressing=!1,this.inactiveAfterPointerUp&&(this.inactiveAfterPointerUp=!1,this.inactive())});this.editor=t,this.editor.hostEventManager.on("spaceToggle",this.handleSpaceToggle),this.editor.mouseEventManager.on("wheelBtnToggle",this.handleWheelBtnToggle)}isPressing(){return this._isPressing}isActive(){return this._active}active(t){if(this._active){console.warn("CanvasDragger already active");return}if(this.eventEmitter.emit("activeChange",!0),this._active=!0,this.editor.setCursor("grab"),this.bindEventWhenActive(),t){this.editor.setCursor("grabbing");const e=this.editor.getCursorXY(t);this.onStart({pos:this.editor.toScenePt(e.x,e.y),vwPos:e,nativeEvent:t})}}inactive(){if(this._isPressing)this.inactiveAfterPointerUp=!0;else{if(!this._active)return;this.eventEmitter.emit("activeChange",!1),this._active=!1,this.unbindEventWhenInactive(),this.editor.toolManager.setCursorWhenActive()}}enableDragBySpace(){this.isEnableDragCanvasBySpace=!0}disableDragBySpace(){this.isEnableDragCanvasBySpace=!1}bindEventWhenActive(){this.editor.mouseEventManager.on("start",this.onStart),this.editor.mouseEventManager.on("drag",this.onDrag),this.editor.mouseEventManager.on("end",this.onEnd)}unbindEventWhenInactive(){this.editor.mouseEventManager.off("start",this.onStart),this.editor.mouseEventManager.off("drag",this.onDrag),this.editor.mouseEventManager.off("end",this.onEnd)}destroy(){this.editor.hostEventManager.off("spaceToggle",this.handleSpaceToggle),this.editor.mouseEventManager.off("wheelBtnToggle",this.handleWheelBtnToggle),this.unbindEventWhenInactive()}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}class ii extends Qt{constructor(e,r){super({...e,type:At.Canvas},r);S(this,"type",At.Canvas);S(this,"isContainer",!0)}getWorldTransform(){return ao()}getHitGraphics(e,r){const s=this.getChildren();for(let o=s.length-1;o>=0;o--){const u=s[o].getHitGraphics(e,r);if(u)return u}return null}shouldSkipDraw(){return!1}}const Xa=i=>i instanceof ii,Vu=i=>{const t=On(i.map(u=>u.getBboxWithStroke())),e=Wn(t),r={x:-t.minX,y:-t.minY},s=`<svg width="${e.width}" height="${e.height}" viewBox="0 0 ${e.width} ${e.height}" fill="none" xmlns="http://www.w3.org/2000/svg">
`,o="</svg>";let c="";for(const u of i)c+=u.toSVGSegment(r);return s+c+o};class Nu{constructor(t){S(this,"unbindEvents",Tr);S(this,"hasBindEvents",!1);this.editor=t}bindEvents(){if(this.hasBindEvents){console.log("ClipboardManager has bind events, please destroy first");return}this.hasBindEvents=!0;const t=()=>{this.copy()},e=r=>{const o=r.clipboardData;if(!o||this.editor.textEditor.isActive()||(r.target instanceof HTMLInputElement||r.target instanceof HTMLTextAreaElement)&&!this.editor.textEditor.isEditorInputDom(r.target))return;if(o.files.length>0){for(const u of o.files)if(u.type.includes("image")){const g=new FileReader;g.onload=y=>{var C;const x=(C=y.target)==null?void 0:C.result;this.createGraphicsWithImg(x)},g.readAsDataURL(u)}return}const c=o.getData("Text");this.addGraphsFromClipboard(c)};this.editor.keybindingManager.register({key:{metaKey:!0,keyCode:"KeyC"},winKey:{ctrlKey:!0,keyCode:"KeyC"},actionName:"Copy",action:t}),window.addEventListener("paste",e),this.unbindEvents=()=>{window.removeEventListener("paste",e)}}async createGraphicsWithImg(t){const e=this.editor;await e.imgManager.addImg(t);const r=e.imgManager.getImg(t),s=e.viewportManager.getCenter();if(r){const o=new Ce({objectName:"",width:r.width,height:r.height,fill:[{type:vt.Image,attrs:{src:t}}]},{advancedAttrs:{x:s.x-r.width/2,y:s.y-r.height/2},doc:e.doc});e.sceneGraph.addItems([o]),e.doc.getCanvas().insertChild(o),e.render()}}copy(){const t=this.getSelectedItemsSnapshot();t&&navigator.clipboard.writeText(t).then(()=>{console.log("copied")})}copyAsSVG(){const t=this.editor.selectedElements.getItems();if(t.length===0)return;const e=Vu(t);navigator.clipboard.writeText(e).then(()=>{console.log("SVG copied")})}pasteAt(t){navigator.clipboard.readText().then(e=>{this.addGraphsFromClipboard(e,t)})}getSelectedItemsSnapshot(){const t=Qt.sortGraphics(this.editor.selectedElements.getItems());if(t.length===0)return null;const e=Rd(),r=new Map,s=[];for(const c of t){const u=c.getAttrs();u.transform=c.getWorldTransform(),u.parentIndex=void 0;const g=e();r.set(u.id,g),u.id=g,s.push(u)}const o=xs(t);for(const c of o){const u=c.getAttrs(),g=e();r.set(u.id,g),u.id=g,u.parentIndex&&(u.parentIndex.guid=r.get(u.parentIndex.guid)),s.push(u)}return JSON.stringify({appVersion:this.editor.appVersion,paperId:this.editor.paperId,data:s})}updateAttrsParentIndex(t){let e=null,r=null;const s=Qt.sortGraphics(this.editor.selectedElements.getItems()).at(-1)??this.editor.doc.getCurrCanvas();let o=s;if(Xa(s)||Pe(s))e=s.getMaxChildIndex();else{o=s.getParent(),e=s.getSortIndex();const A=s.getNextSibling();r=A?A.getSortIndex():null}const c=o.attrs.id,u=wn(o.getWorldTransform());let g=0;for(;g<t.length&&!t[g].parentIndex;)g++;const y=g,x=_r(e,r,y),C=new Map;for(let A=0;A<y;A++){const _=t[A];_.parentIndex={guid:c,position:x[A]};const F=Pi();C.set(_.id,F),_.id=F,_.transform=ze(u,_.transform)}for(;g<t.length;){const A=t[g],_=Pi();C.set(A.id,_),A.id=_,A.parentIndex.guid=C.get(A.parentIndex.guid),g++}return y}addGraphsFromClipboard(t,e){let r=null;try{r=JSON.parse(t)}catch{return}if(!(r&&typeof r=="object"&&r.appVersion.startsWith("suika-editor")&&r.data))return;const s=this.editor;if(r.data.length===0)return;const o=this.updateAttrsParentIndex(r.data),c=s.sceneGraph.createGraphicsArr(r.data);s.sceneGraph.addItems(c),s.sceneGraph.initGraphicsTree(c);const u=c.slice(0,o);s.selectedElements.setItems(u);const g=Wn(On(u.map(x=>x.getBbox())));if(!e&&r.paperId!==s.paperId){const x=this.editor.viewportManager.getCenter();e={x:x.x-g.width/2,y:x.y-g.height/2}}if(e){const x=e.x-g.x,C=e.y-g.y;(x||C)&&Qt.dMove(u,x,C)}new qt(s).addNewIds(c.map(x=>x.attrs.id)).updateParentSize(u).commit("pasted graphs"),s.render()}destroy(){this.hasBindEvents=!1,this.unbindEvents()}}const Yu=i=>`<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g filter="url(#filter0_d_1139_2)" transform="rotate(${i} 16 16)"><path d="M4.38452 17.3499L9.68782 16.9963L7.78571 15.0942C8.84801 14.0319 10.1091 13.1892 11.4971 12.6143C12.8851 12.0394 14.3727 11.7435 15.875 11.7435C17.3773 11.7435 18.8649 12.0394 20.2529 12.6143C21.6409 13.1892 22.902 14.0319 23.9643 15.0942L22.0622 16.9963L27.3655 17.3499L27.0119 12.0466L25.0674 13.9911C23.8602 12.784 22.4271 11.8264 20.8499 11.1731C19.2727 10.5198 17.5822 10.1835 15.875 10.1835C14.1678 10.1835 12.4774 10.5198 10.9001 11.1731C9.32289 11.8264 7.88978 12.784 6.68262 13.9911L4.73807 12.0466L4.38452 17.3499Z" fill="#000000"/><path d="M9.72108 17.4952L10.8205 17.4219L10.0414 16.6428L8.5009 15.1023C9.43698 14.2481 10.5153 13.5622 11.6884 13.0763C13.0158 12.5265 14.4383 12.2435 15.875 12.2435C17.3117 12.2435 18.7343 12.5265 20.0616 13.0763C21.2347 13.5622 22.313 14.2481 23.2491 15.1023L21.7086 16.6428L20.9295 17.4219L22.0289 17.4952L27.3322 17.8488L27.9024 17.8868L27.8644 17.3166L27.5108 12.0133L27.4375 10.9139L26.6584 11.693L25.0608 13.2906C23.8859 12.1996 22.525 11.3257 21.0412 10.7111C19.4033 10.0327 17.6479 9.68351 15.875 9.68351C14.1022 9.68351 12.3467 10.0327 10.7088 10.7111C9.22503 11.3257 7.86411 12.1996 6.68917 13.2906L5.09163 11.693L4.31248 10.9139L4.23918 12.0133L3.88563 17.3166L3.84762 17.8868L4.41778 17.8488L9.72108 17.4952Z" stroke="white"/></g><defs><filter id="filter0_d_1139_2" x="1.3107" y="7.18351" width="29.1286" height="13.2402" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset/><feGaussianBlur stdDeviation="1"/><feComposite in2="hardAlpha" operator="out"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"/><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_1139_2"/><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1139_2" result="shape"/></filter></defs></svg>`,Uu=i=>`<svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><g filter="url(#filter0_d_1173_45)" transform="rotate(${i} 16 16)"><path d="M16 6L12.5 10H19.5L16 6Z" fill="#000000"/><path d="M16 26L12.5 22H19.5L16 26Z" fill="#000000"/><path d="M15.25 10H16.75V22H15.25V10Z" fill="#000000"/><path d="M12.1237 9.67075L11.3981 10.5H12.5H14.75V21.5H12.5H11.3981L12.1237 22.3293L15.6237 26.3293L16 26.7593L16.3763 26.3293L19.8763 22.3293L20.6019 21.5H19.5H17.25V10.5H19.5H20.6019L19.8763 9.67075L16.3763 5.67075L16 5.2407L15.6237 5.67075L12.1237 9.67075Z" stroke="white"/></g><defs><filter id="filter0_d_1173_45" x="8.29623" y="2.48141" width="15.4075" height="27.0372" filterUnits="userSpaceOnUse" color-interpolation-filters="sRGB"><feFlood flood-opacity="0" result="BackgroundImageFix"/><feColorMatrix in="SourceAlpha" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0" result="hardAlpha"/><feOffset/><feGaussianBlur stdDeviation="1"/><feComposite in2="hardAlpha" operator="out"/><feColorMatrix type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.2 0"/><feBlend mode="normal" in2="BackgroundImageFix" result="effect1_dropShadow_1173_45"/><feBlend mode="normal" in="SourceGraphic" in2="effect1_dropShadow_1173_45" result="shape"/></filter></defs></svg>`,So=new Map,Xu=(i,t)=>{const e=i+t;if(So.has(e))return So.get(e);let r="";switch(i){case"resize":r=Uu(t);break;case"rotation":r=Yu(t);break;default:console.warn("getIconSvgDataUrl: unknown type",i)}const s=`url("data:image/svg+xml,${r.replace(/"/g,"'").replace(/#/g,"%23")}") 16 16, auto`;return So.set(e,s),s};class Ju{constructor(t){S(this,"cursor");S(this,"customClassCursor",new Set(["default","move","move-ns","move-ew","pen","pen-close","pen-anchor-remove","pen-anchor-add","crosshair","pencil"]));this.editor=t,this.setCursor("default")}getCursor(){return this.cursor}normalizeCursor(t){return typeof t=="string"?t:t.type==="resize"?{type:t.type,degree:io(t.degree)%180}:t.type==="rotation"?{type:t.type,degree:io(Math.round(t.degree))}:t}setCursor(t){if(t=this.normalizeCursor(t),Si(t,this.cursor))return;this.cursor=t;const e="suika-cursor-",r=this.editor.canvasElement;if(r.classList.forEach(s=>{s.startsWith(e)&&r.classList.remove(s)}),this.editor.canvasElement.style.cursor="",this.customClassCursor.has(t)){const s=`${e}${t}`;this.editor.canvasElement.classList.add(s)}else typeof t=="string"?this.editor.canvasElement.style.cursor=t:(t.type==="resize"||t.type==="rotation")&&(this.editor.canvasElement.style.cursor=Xu(t.type,t.degree))}}const Qu=i=>typeof i=="object"&&(i==null?void 0:i.type)==="rotation";class qu{constructor(){S(this,"graphicsStore",new Map);S(this,"canvasStore",new Map);S(this,"frameStore",new Map)}add(t){const e=t.attrs.id,r=this.graphicsStore;r.has(e)&&console.warn(`graphics ${e} has added`),t instanceof ii?this.canvasStore.set(e,t):t instanceof ri&&this.frameStore.set(e,t),r.set(e,t)}get(t){return this.graphicsStore.get(t)}getAll(){const t=[];for(const[,e]of this.graphicsStore)e.isDeleted()||t.push(e);return t}getCanvas(){return Array.from(this.canvasStore.values())[0]}getFrames(){return Array.from(this.frameStore.values())}clear(){this.graphicsStore.clear(),this.canvasStore.clear(),this.frameStore.clear()}}class Ja extends Qt{constructor(e){super({...e,type:At.Document},{});S(this,"type",At.Document);S(this,"isContainer",!0);S(this,"graphicsStoreManager",new qu);S(this,"emitter",new Le);S(this,"changes",{added:new Map,deleted:new Set,updatedIds:new Set});S(this,"editor");S(this,"emitSceneChangeThrottle",to(()=>{const e=this.flushChanges();this.emitter.emit("sceneChange",e,"unknown")},100))}setEditor(e){this.editor=e}clear(){this.graphicsStoreManager.clear()}getCanvas(){return this.graphicsStoreManager.getCanvas()}getGraphicsById(e){return this.graphicsStoreManager.get(e)}getGraphicsArrByIds(e){const r=[];for(const s of e){const o=this.getGraphicsById(s);if(!o){console.warn(`id ${s} is no exist in graphics array`);continue}r.push(o)}return r}getAllGraphicsArr(){return this.graphicsStoreManager.getAll()}getCurrCanvas(){return this.graphicsStoreManager.getCanvas()}addGraphics(e){this.graphicsStoreManager.add(e),this.changes.added.set(e.attrs.id,e.getAttrs()),this.emitSceneChangeThrottle()}collectDeletedGraphics(e){const r=e.attrs.id;e.isDeleted()?(this.changes.deleted.add(r),this.changes.added.delete(r)):(this.changes.deleted.delete(r),this.changes.added.set(r,e.getAttrs())),this.emitSceneChangeThrottle()}collectUpdatedGraphics(e){this.changes.updatedIds.add(e),this.emitSceneChangeThrottle()}flushChanges(){const e=new Map;for(const s of this.changes.updatedIds){const o=this.getGraphicsById(s);if(!o){console.warn(`graphics ${s} is lost!`);continue}e.set(s,o.getUpdatedAttrs())}const r={added:this.changes.added,deleted:this.changes.deleted,update:e};return this.clearChanges(),r}clearChanges(){this.changes={added:new Map,deleted:new Set,updatedIds:new Set}}getDeviceViewSize(){const e=this.editor.canvasElement;return{width:e.width,height:e.height}}on(e,r){this.emitter.on(e,r)}off(e,r){this.emitter.off(e,r)}}class Zu{constructor(){S(this,"eventEmitter",new Le);S(this,"imgMap",new Map);S(this,"loadingImgSet",new Set)}async addImg(t){if(this.loadingImgSet.has(t)||this.getImg(t))return;const e=new Image;e.src=t,await new Promise(r=>{e.onload=()=>{this.loadingImgSet.delete(t),this.imgMap.set(t,e),this.eventEmitter.emit("added",e),r(e)}})}getImg(t){return this.imgMap.get(t)}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}const Qa=i=>{const{ctrlKey:t=!1,shiftKey:e=!1,altKey:r=!1,metaKey:s=!1}=i;return`${t?"ctrl+":""}${s?"meta+":""}${e?"shift+":""}${r?"alt+":""}${i.code}`};class tf{constructor(t){S(this,"keyBindingMap",new Map);S(this,"isBound",!1);S(this,"id",0);S(this,"handleAction",t=>{if(t.altKey&&t.preventDefault(),t.target instanceof HTMLInputElement||t.target instanceof HTMLTextAreaElement)return;let e=!1;const r={isToolDragging:this.editor.toolManager.isDragging()};for(const s of this.keyBindingMap.values())if((!s.when||s.when(r))&&(Ld()&&s.winKey?this.isKeyMatch(s.winKey,t)&&(e=!0):this.isKeyMatch(s.key,t)&&(e=!0)),e){t.preventDefault(),console.log(`[${Qa(t)}] => ${s.actionName}`),s.action(t);break}e||console.log(`[${Qa(t)}] => no match`)});this.editor=t}isKeyMatch(t,e){if(Array.isArray(t))return t.some(u=>this.isKeyMatch(u,e));if(t.keyCode=="*")return!0;const{ctrlKey:r=!1,shiftKey:s=!1,altKey:o=!1,metaKey:c=!1}=t;return r==e.ctrlKey&&s==e.shiftKey&&o==e.altKey&&c==e.metaKey&&t.keyCode==e.code}register(t){const e=this.id;return this.keyBindingMap.set(e,t),this.id++,e}registerWithHighPrior(t){const e=this.id,r=new Map;r.set(e,t);for(const[s,o]of this.keyBindingMap)r.set(s,o);return this.keyBindingMap=r,this.id++,e}unregister(t){this.keyBindingMap.delete(t)}bindEvent(){this.isBound||(this.isBound=!0,document.addEventListener("keydown",this.handleAction))}destroy(){this.isBound&&(this.keyBindingMap.clear(),document.removeEventListener("keydown",this.handleAction))}}const Co=(i,t)=>{const e=new Set;for(const u of t)u.removeFromParent(),u.setDeleted(!0),e.add(u.attrs.id);const r=sr(t);for(const u of r){const g=i.doc.getGraphicsById(u);g.isEmpty()&&(g.removeFromParent(),g.setDeleted(!0),e.add(u))}const s=xs(t);for(const u of s)u.setDeleted(!0),e.add(u.attrs.id);const o=new Map,c=new Map;Di(i,r,o,c),i.commandManager.pushCommand(new Mi("remove graphics",i,o,c,e))},qa="dragCanvas",Za="h";class bs{constructor(t){S(this,"type",qa);S(this,"hotkey",Za);S(this,"cursor","grab");this.editor=t}onActive(){this.editor.canvasDragger.disableDragBySpace(),this.editor.canvasDragger.active()}onInactive(){this.editor.canvasDragger.inactive(),this.editor.canvasDragger.enableDragBySpace()}onMoveExcludeDrag(){}onStart(){}onDrag(){}onEnd(){}afterEnd(){this.editor.canvasDragger.disableDragBySpace()}}S(bs,"type",qa),S(bs,"hotkey",Za);const Ps={getSnapPtBySetting(i,t){if(i={x:i.x,y:i.y},t.get("snapToGrid")){const r={x:t.get("gridSnapX"),y:t.get("gridSnapY")};return this.getGridSnapPt(i,r)}return i},getGridSnapPt(i,t){return{x:ie(i.x,t.x),y:ie(i.y,t.y)}}};class Kn{constructor(t){S(this,"type","");S(this,"hotkey","");S(this,"cursor","crosshair");S(this,"commandDesc","Add Graphics");S(this,"drawingGraphics",null);S(this,"startPoint",{x:-1,y:-1});S(this,"lastDragPoint");S(this,"lastDragPointInViewport");S(this,"lastMousePoint");S(this,"startPointWhenSpaceDown",null);S(this,"lastDragPointWhenSpaceDown",null);S(this,"isDragging",!1);S(this,"unbindEvent",Tr);this.editor=t}onActive(){const t=this.editor,e=t.hostEventManager,r=()=>{this.isDragging&&this.updateRect()};e.on("shiftToggle",r);const s=()=>{t.hostEventManager.isDraggingCanvasBySpace||this.isDragging&&this.editor.setting.get("snapToObjects")&&this.editor.refLine.cacheGraphicsRefLines({excludeItems:this.editor.selectedElements.getItems()})},o=()=>{t.hostEventManager.isDraggingCanvasBySpace||this.isDragging&&(this.lastDragPoint=t.toScenePt(this.lastDragPointInViewport.x,this.lastDragPointInViewport.y,this.editor.setting.get("snapToGrid")),this.updateRect())};t.viewportManager.on("xOrYChange",s),t.viewportManager.on("xOrYChange",o),this.unbindEvent=()=>{e.off("shiftToggle",r),t.viewportManager.off("xOrYChange",s),t.viewportManager.off("xOrYChange",o)}}onSpaceToggle(t){this.isDragging&&t?(this.startPointWhenSpaceDown=this.startPoint,this.lastDragPointWhenSpaceDown=this.lastMousePoint,this.updateRect()):(this.startPointWhenSpaceDown=null,this.lastDragPointWhenSpaceDown=null)}onAltToggle(){this.isDragging&&this.updateRect()}onInactive(){this.unbindEvent()}onMoveExcludeDrag(){}onStart(t){this.startPoint=Ps.getSnapPtBySetting(this.editor.getSceneCursorXY(t),this.editor.setting),this.drawingGraphics=null,this.isDragging=!1,this.startPointWhenSpaceDown=null,this.lastDragPointWhenSpaceDown=null}onDrag(t){if(this.editor.hostEventManager.disableDelete(),this.editor.hostEventManager.disableContextmenu(),this.editor.hostEventManager.isDraggingCanvasBySpace)return;this.lastDragPointInViewport=this.editor.getCursorXY(t),this.lastDragPoint=this.lastMousePoint=Ps.getSnapPtBySetting(this.editor.getSceneCursorXY(t),this.editor.setting),!this.isDragging&&this.editor.setting.get("snapToObjects")&&this.editor.refLine.cacheGraphicsRefLines();const e=this.editor.refLine.getGraphicsSnapOffset([this.lastDragPoint]);this.lastDragPoint={x:this.lastDragPoint.x+e.x,y:this.lastDragPoint.y+e.y},this.isDragging=!0,this.updateRect()}adjustSizeWhenShiftPressing(t){const{width:e,height:r}=t,s=Math.max(Math.abs(e),Math.abs(r));return t.height=(Math.sign(r)||1)*s,t.width=(Math.sign(e)||1)*s,t}updateGraphics(t){t=Er(t);const e=this.drawingGraphics,r=e.getParent();let s=t.x,o=t.y;if(r&&Pe(r)){const c=r.getWorldTransform(),u=co(c,t);s=u.x,o=u.y}e.updateAttrs({x:s,y:o,width:t.width,height:t.height})}updateRect(){if(!this.isDragging)return;const{x:t,y:e}=this.lastDragPoint,r=this.editor.sceneGraph;if(this.startPointWhenSpaceDown&&this.lastDragPointWhenSpaceDown){const{x:_,y:F}=this.startPointWhenSpaceDown,{x:R,y:z}=this.lastDragPointWhenSpaceDown,G=t-R,V=e-z;this.startPoint={x:_+G,y:F+V}}const{x:s,y:o}=this.startPoint;let c=t-s,u=e-o;if(c===0||u===0){const _=this.solveWidthOrHeightIsZero({width:c,height:u},{x:this.lastMousePoint.x-this.startPoint.x,y:this.lastMousePoint.y-this.startPoint.y});c=_.width,u=_.height}let g={x:s,y:o,width:c,height:u};const y=this.editor.hostEventManager.isAltPressing,x=this.editor.hostEventManager.isShiftPressing;let C=0,A=0;if(y&&(g={x:g.x-c,y:g.y-u,width:g.width*2,height:g.height*2},C=g.x+g.width/2,A=g.y+g.height/2),x&&(g=this.adjustSizeWhenShiftPressing(g)),y&&(g.x=C-g.width/2,g.y=A-g.height/2),this.drawingGraphics)this.updateGraphics(g);else{const _=this.editor.doc.getCurrCanvas(),F=Ri(this.startPoint,_.getChildren()),R=F||_,z=this.createGraphics(g,R);if(this.drawingGraphics=z,!z)return;if(r.addItems([z]),R.insertChild(z),F){const G=[...z.attrs.transform];z.setWorldTransform(G)}this.editor.selectedElements.setItems([z])}this.editor.render()}solveWidthOrHeightIsZero(t,e){const r={width:t.width,height:t.height};if(t.width===0){const s=Math.sign(e.x)||1;r.width=s*this.editor.setting.get("gridSnapX")}if(t.height===0){const s=Math.sign(e.y)||1;r.height=s*this.editor.setting.get("gridSnapY")}return r}onEnd(t){if(this.editor.hostEventManager.isDraggingCanvasBySpace)return;const e=Ps.getSnapPtBySetting(this.editor.getSceneCursorXY(t),this.editor.setting);if(this.drawingGraphics===null){const{x:r,y:s}=e,o=this.editor.setting.get("drawGraphDefaultWidth"),c=this.editor.setting.get("drawGraphDefaultHeight"),u=this.editor.doc.getCurrCanvas(),g=Ri(this.startPoint,u.getChildren()),y=g||u;if(this.drawingGraphics=this.createGraphics({x:r-o/2,y:s-c/2,width:o,height:c},y,!0),this.drawingGraphics){const x=this.drawingGraphics;if(this.editor.sceneGraph.addItems([x]),y.insertChild(x),g){const C=[...x.attrs.transform];x.setWorldTransform(C)}this.editor.selectedElements.setItems([x]),this.editor.render()}}this.drawingGraphics&&this.editor.commandManager.pushCommand(new Bn(this.commandDesc,this.editor,[this.drawingGraphics]))}afterEnd(){this.isDragging=!1,this.editor.hostEventManager.enableDelete(),this.editor.hostEventManager.enableContextmenu(),this.drawingGraphics&&!this.editor.setting.get("keepToolSelectedAfterUse")&&this.editor.toolManager.setActiveTool("select"),this.startPointWhenSpaceDown=null,this.lastDragPointWhenSpaceDown=null,this.editor.refLine.clear()}}S(Kn,"type",""),S(Kn,"hotkey","");const tc="drawEllipse",ec="o";class Ms extends Kn{constructor(e){super(e);S(this,"type",tc);S(this,"hotkey",ec);this.commandDesc="Add Ellipse"}createGraphics(e,r){return e=Er(e),new ni({objectName:zn(r,En.Ellipse),width:e.width,height:e.height,fill:[ht(this.editor.setting.get("firstFill"))]},{advancedAttrs:{x:e.x,y:e.y},doc:this.editor.doc})}}S(Ms,"type",tc),S(Ms,"hotkey",ec);const nc="drawFrame",rc="f";class Ts extends Kn{constructor(e){super(e);S(this,"type",nc);S(this,"hotkey",rc);this.commandDesc="Add Frame"}createGraphics(e,r){return e=Er(e),new ri({objectName:zn(r,En.Frame),width:e.width,height:e.height,fill:[ht(this.editor.setting.get("firstFrameFill"))],resizeToFit:!1},{advancedAttrs:{x:e.x,y:e.y},doc:this.editor.doc})}}S(Ts,"type",nc),S(Ts,"hotkey",rc);const ef=()=>new Promise(i=>{const t=document.createElement("input");t.type="file",t.accept="image/*",t.onchange=e=>{var o;const r=(o=e.target.files)==null?void 0:o[0];if(!r)return;const s=new FileReader;s.onload=c=>{var g;const u=(g=c.target)==null?void 0:g.result;setTimeout(()=>{i({url:u,name:r.name})})},s.readAsDataURL(r)},t.click()}),ic="drawImg",sc="";class As extends Kn{constructor(e){super(e);S(this,"type",ic);S(this,"hotkey",sc);S(this,"imgData",null);this.commandDesc="Add Image"}async enableActive(){try{const e=await ef();return await this.editor.imgManager.addImg(e.url),this.imgData=e,!0}catch{return!1}}createGraphics(e){return e=Er(e),new Ce({objectName:this.imgData.name,width:e.width,height:e.height,fill:[{type:vt.Image,attrs:{src:this.imgData.url}}]},{advancedAttrs:{x:e.x,y:e.y},doc:this.editor.doc})}}S(As,"type",ic),S(As,"hotkey",sc);const oc="drawLine",ac="l";class Es extends Kn{constructor(e){super(e);S(this,"type",oc);S(this,"hotkey",ac);this.commandDesc="Add Line"}createGraphics(e,r,s){if(s)return null;const o=this.calcAttrs(e);return new Ss({objectName:zn(r,En.Line),...o,height:0,stroke:[ht(this.editor.setting.get("firstStroke"))],strokeWidth:this.editor.setting.get("strokeWidth")},{doc:this.editor.doc})}adjustSizeWhenShiftPressing(e){return xu(e)}updateGraphics(e){const r=this.drawingGraphics.getParent();let s=e.x,o=e.y;if(r&&Pe(r)){const u=r.getWorldTransform(),g=co(u,e);s=g.x,o=g.y}const c=this.calcAttrs({x:s,y:o,width:e.width,height:e.height});this.drawingGraphics.updateAttrs({width:c.width,transform:c.transform})}solveWidthOrHeightIsZero(e,r){const s={width:e.width,height:e.height};if(e.width===0){const o=Math.sign(r.x)||1;s.width=o*this.editor.setting.get("gridSnapX")}return s}calcAttrs({x:e,y:r,width:s,height:o}){const c=vn({x:0,y:-1},{x:s,y:o})-Tn,u=e+s/2,g=r+o/2,y=new lt().translate(u,g).rotate(c).translate(-u,-g);return y.tx=e,y.ty=r,{width:Math.sqrt(s*s+o*o),transform:y.getArray()}}}S(Es,"type",oc),S(Es,"hotkey",ac);const cc="drawRect",hc="r";class Is extends Kn{constructor(e){super(e);S(this,"type",cc);S(this,"hotkey",hc);this.commandDesc="Add Rect"}createGraphics(e,r){return e=Er(e),new Ce({objectName:zn(r,En.Rect),width:e.width,height:e.height,fill:[ht(this.editor.setting.get("firstFill"))]},{advancedAttrs:{x:e.x,y:e.y},doc:this.editor.doc})}}S(Is,"type",cc),S(Is,"hotkey",hc);const lc="drawRegularPolygon",dc="";class _s extends Kn{constructor(e){super(e);S(this,"type",lc);S(this,"hotkey",dc);this.commandDesc="AddRegularPolygon"}createGraphics(e,r){return e=Er(e),new Cs({objectName:zn(r,En.RegularPolygon),width:e.width,height:e.height,fill:[ht(this.editor.setting.get("firstFill"))],count:3},{advancedAttrs:{x:e.x,y:e.y},doc:this.editor.doc})}}S(_s,"type",lc),S(_s,"hotkey",dc);const uc="drawStar",fc="";class ks extends Kn{constructor(e){super(e);S(this,"type",uc);S(this,"hotkey",fc);this.commandDesc="AddStar"}createGraphics(e,r){return e=Er(e),new vo({objectName:zn(r,En.Star),width:e.width,height:e.height,fill:[ht(this.editor.setting.get("firstFill"))],count:5,starInnerScale:this.editor.setting.get("defaultStarInnerScale")},{advancedAttrs:{x:e.x,y:e.y},doc:this.editor.doc})}}S(ks,"type",uc),S(ks,"hotkey",fc);const gc="drawText",pc="t";class Rs{constructor(t){S(this,"type",gc);S(this,"hotkey",pc);S(this,"cursor","crosshair");this.editor=t}onActive(){}onInactive(){}onMoveExcludeDrag(){}onStart(){}onDrag(){}onEnd(t){const e=this.editor.getSceneCursorXY(t);this.editor.textEditor.active({pos:e}),this.editor.setting.get("keepToolSelectedAfterUse")||this.editor.toolManager.setActiveTool("select")}afterEnd(){}}S(Rs,"type",gc),S(Rs,"hotkey",pc);const mc="pathSelect",yc="v";class bo{constructor(t){S(this,"type",mc);S(this,"hotkey",yc);S(this,"cursor","default");S(this,"startPoint",null);S(this,"prevAttrs",null);S(this,"selectedControls",[]);S(this,"startSegs",[]);this.editor=t}onActive(){}onInactive(){}onStart(t){const e=this.editor.pathEditor,r=this.startPoint=this.editor.getSceneCursorXY(t),s=this.editor.controlHandleManager.getHandleInfoByPoint(r);if(!s)return;const o=e.getPath();this.prevAttrs=ht({transform:o.attrs.transform,pathData:o.attrs.pathData});const c=Po.parseSelectedInfoStr(s.handleName);e.selectedControl.contains(c.type,c.pathIdx,c.segIdx)?this.selectedControls=e.selectedControl.getSelectedControls():this.selectedControls=[c],this.startSegs=this.selectedControls.map(({pathIdx:u,segIdx:g})=>e.getPath().getSeg(u,g,{applyTransform:!0})),e.selectedControl.setItems(this.selectedControls),e.drawControlHandles(),this.editor.render()}onDrag(t){if(!this.startPoint)return;const e=this.editor.getSceneCursorXY(t),r=e.x-this.startPoint.x,s=e.y-this.startPoint.y,o=this.editor.pathEditor.getPath();for(let c=0;c<this.selectedControls.length;c++){const{type:u,pathIdx:g,segIdx:y}=this.selectedControls[c];if(o.getSeg(g,y)){const C=this.startSegs[c];if(u==="anchor")o.setSeg(g,y,{point:{x:C.point.x+r,y:C.point.y+s}});else{if(this.editor.pathEditor.selectedControl.contains("anchor",g,y))continue;u==="in"?o.setSeg(g,y,{in:{x:C.in.x+r,y:C.in.y+s}}):u==="out"&&o.setSeg(g,y,{out:{x:C.out.x+r,y:C.out.y+s}})}this.editor.pathEditor.drawControlHandles(),this.editor.render()}}}onEnd(){const t=this.editor.pathEditor.getPath();this.editor.commandManager.pushCommand(new Ln("UpdatePathData",[t],[{transform:t.attrs.transform,pathData:t.attrs.pathData}],[this.prevAttrs])),this.editor.commandManager.batchCommandEnd()}onMoveExcludeDrag(){}afterEnd(){this.startPoint=null,this.prevAttrs=null,this.selectedControls=[],this.startSegs=[]}onCommandChange(){this.editor.pathEditor.drawControlHandles()}}S(bo,"type",mc),S(bo,"hotkey",yc);class nf{constructor(t){S(this,"lastPoint",{x:-1,y:-1});S(this,"isShiftPressingWhenStart",!1);S(this,"startSelectedControls",[]);S(this,"segControlsNeedDrawInStart",[]);this.editor=t}onActive(){}onInactive(){}onStart(){this.isShiftPressingWhenStart=!1;const t=this.editor,e=t.pathEditor;this.segControlsNeedDrawInStart=this.editor.pathEditor.selectedControl.getSegControlsNeedDraw(),t.hostEventManager.isShiftPressing?(this.isShiftPressingWhenStart=!0,this.startSelectedControls=t.pathEditor.selectedControl.getSelectedControls()):(this.startSelectedControls=e.selectedControl.getSelectedControls(),e.selectedControl.setNormalControls(e.selectedControl.getSelectedControls()),e.drawControlHandles()),this.lastPoint=t.toolManager.getCurrPoint(),t.render(),t.sceneGraph.setSelection(this.lastPoint)}onDrag(t){const e=this.editor.getSceneCursorXY(t),r=ho(this.lastPoint,e);this.editor.sceneGraph.setSelection(r);const o=this.editor.controlHandleManager.getCustomHandlesIntersectedWithRect(r).map(c=>Po.parseSelectedInfoStr(c.type)).filter(c=>{if(!c)return!1;const u=c.type;return u==="anchor"?!0:u==="in"||u==="out"?this.segControlsNeedDrawInStart.some(g=>Si(g,{pathIdx:c.pathIdx,segIdx:c.segIdx})):!1});this.isShiftPressingWhenStart?(this.editor.pathEditor.selectedControl.setItems([...this.startSelectedControls,...o]),this.editor.pathEditor.drawControlHandles()):(this.editor.pathEditor.selectedControl.setItems(o),this.editor.pathEditor.drawControlHandles()),this.editor.render()}onEnd(){}afterEnd(t,e){this.isShiftPressingWhenStart=!1,this.startSelectedControls=[],this.editor.pathEditor.selectedControl.setNormalControls([]),e||this.editor.pathEditor.selectedControl.clear(),this.editor.pathEditor.drawControlHandles(),this.editor.sceneGraph.selection=null,this.editor.render()}}const vc="pathSelect",wc="v";class Dr{constructor(t){S(this,"type",vc);S(this,"hotkey",wc);S(this,"cursor","default");S(this,"currStrategy",null);S(this,"strategyMove");S(this,"strategyDrawSelection");this.editor=t,this.strategyMove=new bo(t),this.strategyDrawSelection=new nf(t)}onActive(){}onInactive(){}onStart(t){const e=this.editor.getSceneCursorXY(t);if(this.editor.controlHandleManager.getHandleInfoByPoint(e)?this.currStrategy=this.strategyMove:this.currStrategy=this.strategyDrawSelection,this.currStrategy)this.currStrategy.onActive(),this.currStrategy.onStart(t);else throw new Error("no strategy found")}onDrag(t){if(this.currStrategy)this.currStrategy.onDrag(t);else throw new Error("no strategy found")}onEnd(t,e){if(this.editor.controlHandleManager.showCustomHandles(),this.editor.hostEventManager.isDraggingCanvasBySpace)return;const r=this.currStrategy;if(r)r.onEnd(t,e),r.onInactive();else throw new Error("no strategy found")}onMoveExcludeDrag(){}afterEnd(t,e){var r;this.editor.hostEventManager.isDraggingCanvasBySpace||this.editor.setCursor("default"),(r=this.currStrategy)==null||r.afterEnd(t,e),this.currStrategy=null}onCommandChange(){this.editor.pathEditor.drawControlHandles()}onViewportXOrYChange(){this.editor.hostEventManager.isSpacePressing?this.editor.pathEditor.drawControlHandles():this.editor.pathEditor.drawControlHandles(),this.editor.render()}}S(Dr,"type",vc),S(Dr,"hotkey",wc);class rf{constructor(t,e){this.editor=t,this.parentTool=e}onActive(){}onInactive(){}onStart(){const t=this.editor,e=this.parentTool.path,r=e.project(this.editor.toolManager.getCurrPoint(),this.editor.toSceneSize(5));if(!r)return;const s=ht({transform:e.attrs.transform,pathData:e.attrs.pathData});e.insertSeg(r.pathItemIndex,r.segIndex,r.t),t.commandManager.pushCommand(new Ln("Update Path Data",[e],[ht({transform:e.attrs.transform,pathData:e.attrs.pathData})],[s])),t.pathEditor.selectedControl.clear(),t.pathEditor.drawControlHandles(),t.render()}onDrag(){this.editor.setCursor("default")}onEnd(){this.editor.setCursor("pen")}afterEnd(){this.editor.setCursor("pen")}}class sf{constructor(t,e){S(this,"startPoint",null);S(this,"prevAttrs",null);this.editor=t,this.parentTool=e}onActive(){}onInactive(){}onAltToggle(){this.startPoint&&this.onDrag()}onStart(){const t=this.editor.pathEditor;if(this.startPoint=this.parentTool.getCorrectedPoint(),t.isActive()){const s=this.parentTool.path;this.prevAttrs=ht({transform:s.attrs.transform,pathData:s.attrs.pathData}),t.selectedControl.getSelectedControlsSize()===0&&(this.parentTool.pathIdx=s.getPathItemCount()),s.hasPath(this.parentTool.pathIdx)||s.addEmptyPath(),s.addSeg(this.parentTool.pathIdx,{point:this.startPoint,in:{x:0,y:0},out:{x:0,y:0}})}else{const s=[{segs:[{point:{x:0,y:0},in:{x:0,y:0},out:{x:0,y:0}}],closed:!1}],o=this.editor.doc.getCurrCanvas(),c=new Se({objectName:zn(o,En.Path),width:100,height:100,strokeWidth:1,stroke:[{type:vt.Solid,attrs:ge("#000")}],pathData:s},{advancedAttrs:this.startPoint,doc:this.editor.doc});this.parentTool.path=c,this.editor.sceneGraph.addItems([c]),this.editor.doc.getCurrCanvas().insertChild(c),this.editor.commandManager.batchCommandStart(),this.editor.commandManager.pushCommand(new Bn("Add Path",this.editor,[c]),{beforeRedo:()=>{this.editor.pathEditor.active(c),this.editor.toolManager.setActiveTool(Dr.type)},beforeUndo:()=>{this.editor.pathEditor.inactive("undo")}}),this.editor.selectedElements.setItems([c]),this.prevAttrs=ht({transform:c.attrs.transform,pathData:c.attrs.pathData}),t.active(c)}const r=this.parentTool.path.getSegCount(this.parentTool.pathIdx)-1;t.selectedControl.setItems([{type:"anchor",pathIdx:this.parentTool.pathIdx,segIdx:r}]),t.drawControlHandles(),this.editor.render()}onDrag(){if(!this.startPoint){console.warn("startPoint is null, check start()");return}const t=this.parentTool.getCorrectedPoint(),e=t.x-this.startPoint.x,r=t.y-this.startPoint.y,s=this.parentTool.path,o=s.getSegCount(this.parentTool.pathIdx)-1,c={out:{x:e,y:r}};!this.editor.hostEventManager.isAltPressing&&o!==0&&(c.in={x:-e,y:-r}),s.setSeg(this.parentTool.pathIdx,o,c),this.editor.pathEditor.drawControlHandles(),this.editor.render()}onEnd(){const t=this.parentTool.path;t.updateAttrs({pathData:t.attrs.pathData}),this.editor.commandManager.pushCommand(new Ln("Update Path Data",[t],[ht({transform:t.attrs.transform,pathData:t.attrs.pathData})],[this.prevAttrs])),this.editor.commandManager.batchCommandEnd()}afterEnd(){}}class of{constructor(t,e){S(this,"startPoint",null);S(this,"prevAttrs",null);this.editor=t,this.parentTool=e}onActive(){}onInactive(){}onStart(){this.startPoint=this.parentTool.getCorrectedPoint(),this.prevAttrs=ht({transform:this.parentTool.path.attrs.transform,pathData:this.parentTool.path.attrs.pathData});const t=this.parentTool.path;t.setPathItemClosed(this.parentTool.pathIdx,!0),t.setSeg(this.parentTool.pathIdx,0,{in:{x:0,y:0}})}onDrag(){const t=this.parentTool.getCorrectedPoint(),e=this.parentTool.path,r=this.startPoint,s=t.x-r.x,o=t.y-r.y,c=e.getSegCount(this.parentTool.pathIdx)-1,u={out:{x:s,y:o}};!this.editor.hostEventManager.isAltPressing&&c!==0&&(u.in={x:-s,y:-o}),e.setSeg(this.parentTool.pathIdx,0,u),this.editor.pathEditor.drawControlHandles(),this.editor.render()}onEnd(){this.editor.pathEditor.selectedControl.clear();const t=this.parentTool.path;t.updateAttrs({pathData:t.attrs.pathData}),this.editor.commandManager.pushCommand(new Ln("Update Path Data",[t],[ht({transform:t.attrs.transform,pathData:t.attrs.pathData})],[this.prevAttrs])),this.editor.commandManager.batchCommandEnd()}afterEnd(){}}class af{constructor(t,e){this.editor=t,this.parentTool=e}onActive(){}onInactive(){}onStart(){const t=this.editor,e=t.pathEditor,r=this.parentTool.path,s=t.toSceneSize(this.editor.setting.get("selectionHitPadding")),o=r?r.getClosestAnchor({point:t.toolManager.getCurrPoint(),tol:s}):null;if(!o)return;const c=ht({transform:r.attrs.transform,pathData:r.attrs.pathData});r.deleteSegAndHeal(o.pathItemIndex,o.segIndex),t.commandManager.pushCommand(new Ln("Update Path Data",[r],[ht({transform:r.attrs.transform,pathData:r.attrs.pathData})],[c])),t.pathEditor.selectedControl.clear(),e.drawControlHandles(),t.render()}onDrag(){this.editor.setCursor("default")}onEnd(){this.editor.setCursor("pen")}afterEnd(){this.editor.setCursor("pen")}}const xc="pen",Sc="p";class si{constructor(t){S(this,"type",xc);S(this,"hotkey",Sc);S(this,"cursor","pen");S(this,"path",null);S(this,"pathIdx",0);S(this,"childTool",null);this.editor=t}onActive(){this.editor.pathEditor.isActive()&&(this.path=this.editor.pathEditor.getPath(),this.pathIdx=this.path.attrs.pathData.length),this.updatePreviewHandles(this.getCorrectedPoint())}onInactive(){this.editor.commandManager.batchCommandEnd(),this.editor.pathEditor.drawControlHandles(),this.editor.render()}onMoveExcludeDrag(t,e){var s;const r=this.editor;if(e){r.pathEditor.drawControlHandles(),r.render();return}if(this.editor.canvasDragger.isActive())r.pathEditor.drawControlHandles();else{const o=this.path?this.path.getClosestAnchor({point:this.editor.toolManager.getCurrPoint(),tol:this.editor.toSceneSize(5)}):null;let c=null,u=!1;if(o)r.hostEventManager.isAltPressing?(c=o.point,r.setCursor("pen-anchor-remove"),u=!0):o.segIndex===0&&o.pathItemIndex===this.pathIdx?(r.setCursor("pen-close"),c=o.point):r.setCursor("pen");else{const g=(s=this.path)==null?void 0:s.project(this.editor.toolManager.getCurrPoint(),this.editor.toSceneSize(5));g&&r.hostEventManager.isAltPressing?(c=g.point,r.setCursor("pen-anchor-add"),u=!0):r.setCursor("pen")}this.updatePreviewHandles(c??this.getCorrectedPoint(),u)}}onStart(t){const e=this.editor.toSceneSize(this.editor.setting.get("selectionHitPadding")),r=this.path?this.path.getClosestAnchor({point:this.getCorrectedPoint(),tol:e}):null;r&&this.editor.hostEventManager.isAltPressing?this.childTool=new af(this.editor,this):r&&r.segIndex===0?this.childTool=new of(this.editor,this):(this.path?this.path.project(this.editor.toolManager.getCurrPoint(),e):null)&&this.editor.hostEventManager.isAltPressing?this.childTool=new rf(this.editor,this):this.childTool=new sf(this.editor,this),this.childTool.onStart(t)}onDrag(t){var e;(e=this.childTool)==null||e.onDrag(t)}onEnd(t,e){var r;(r=this.childTool)==null||r.onEnd(t,e)}afterEnd(){}onCommandChange(){this.updatePreviewHandles(this.getCorrectedPoint())}onCanvasDragActiveChange(t){t?this.editor.pathEditor.drawControlHandles():this.updatePreviewHandles(this.getCorrectedPoint()),this.editor.render()}getCorrectedPoint(){const t=this.editor.toolManager.getCurrPoint();return this.editor.setting.get("snapToGrid")&&(t.x=ie(t.x,.5),t.y=ie(t.y,.5)),t}onViewportXOrYChange(){this.editor.canvasDragger.isActive()?this.editor.pathEditor.drawControlHandles():this.updatePreviewHandles(this.getCorrectedPoint()),this.editor.render()}updatePreviewHandles(t,e=!1){const r=[];if(this.editor.pathEditor.selectedControl.getSelectedControlsSize()>0){const c=this.path;if(!c)return;const u=c.getLastSeg(this.pathIdx,{applyTransform:!0});if(u&&!e){const g=new pe({cx:t.x,cy:t.y,type:"path-preview-curve",getCursor:()=>"default",graphics:new Se({objectName:"path-preview-curve",width:0,height:0,pathData:[{segs:[{point:this.editor.toViewportPt(u.point.x,u.point.y),in:{x:this.editor.toViewportSize(u.in.x),y:this.editor.toViewportSize(u.in.y)},out:{x:this.editor.toViewportSize(u.out.x),y:this.editor.toViewportSize(u.out.y)}},{point:this.editor.toViewportPt(t.x,t.y),in:{x:0,y:0},out:{x:0,y:0}}],closed:!1}],stroke:[{type:vt.Solid,attrs:ge("#1592fe")}],strokeWidth:1},{doc:this.editor.doc})});r.push(g)}}const s=this.editor.setting.get("handleStroke"),o=new pe({cx:t.x,cy:t.y,type:"path-preview-anchor",getCursor:()=>"default",graphics:new ni({objectName:"path-preview-anchor",width:6,height:6,fill:[{type:vt.Solid,attrs:ge("#fff")}],stroke:[{type:vt.Solid,attrs:ge(s)}],strokeWidth:1},{advancedAttrs:t,doc:this.editor.doc})});r.push(o),this.editor.pathEditor.drawControlHandles(r),this.editor.render()}}S(si,"type",xc),S(si,"hotkey",Sc);const Cc="pencil",bc={shiftKey:!0,keyCode:"KeyP"};class Ds{constructor(t){S(this,"type",Cc);S(this,"hotkey",bc);S(this,"cursor","pencil");S(this,"commandDesc","draw by Pencil");S(this,"unbindEvent",Tr);S(this,"path",null);S(this,"isFirstDrag",!0);this.editor=t}onActive(){this.editor.selectedElements.clear()}onInactive(){this.unbindEvent()}onMoveExcludeDrag(){}onStart(t){this.path=new Se({objectName:zn(this.editor.doc.getCurrCanvas(),En.Path),width:0,height:0,pathData:[{segs:[],closed:!1}],stroke:[ht(this.editor.setting.get("firstStroke"))],strokeWidth:3},{doc:this.editor.doc});const e=this.editor.getSceneCursorXY(t);this.path.addSeg(0,{point:e,in:{x:0,y:0},out:{x:0,y:0}})}onDrag(t){const e=this.editor.getSceneCursorXY(t),r=this.path;r.addSeg(0,{point:e,in:{x:0,y:0},out:{x:0,y:0}}),this.isFirstDrag&&(this.editor.sceneGraph.addItems([r]),this.editor.doc.getCurrCanvas().insertChild(r),this.isFirstDrag=!1),this.editor.render()}onEnd(t,e){const r=this.path;if(e){const s=r.attrs.pathData[0].segs,o=eu(s,this.editor.setting.get("pencilCurveFitTolerance"));r.attrs.pathData[0].segs=o,this.editor.commandManager.pushCommand(new Bn("Add Path by pencil",this.editor,[r]))}else r.setDeleted(!0)}afterEnd(){this.path=null,this.isFirstDrag=!0}getDragBlockStep(){return 0}}S(Ds,"type",Cc),S(Ds,"hotkey",bc);class Br{constructor(t){S(this,"vRefLineMap",new Map);S(this,"hRefLineMap",new Map);S(this,"sortedXs",[]);S(this,"sortedYs",[]);S(this,"toDrawVLines",[]);S(this,"toDrawHLines",[]);this.editor=t}cacheGraphicsRefLines(t={excludeItems:[]}){this.clear();const e=t.excludeItems,r=this.vRefLineMap,s=this.hRefLineMap,o=this.editor.viewportManager.getBbox(),c=new Set;this.editor.doc.getCurrCanvas().forEachVisibleChildNode(g=>{Xa(g)||Pe(g)&&g.isGroup()||c.add(g)});for(const g of e)g.forEachVisibleChildNode(y=>{c.has(y)&&c.delete(y)});const u=new Set(e.map(g=>g.attrs.id));for(const g of c){if(u.has(g.attrs.id))continue;const y=Fa(g.getBbox());if(!go(o,y))continue;const x=this.editor.setting;if(x.get("snapToGrid")){const z=x.get("gridSnapX"),G=x.get("gridSnapY");y.minX=ie(y.minX,z),y.minY=ie(y.minY,G),y.midX=ie(y.midX,z),y.midY=ie(y.midY,G),y.maxX=ie(y.maxX,z),y.maxY=ie(y.maxY,G)}Br.addRefLinesToMap(r,y.midX,[y.minY,y.maxY]),Br.addRefLinesToMap(s,y.midY,[y.minX,y.maxX]);const C=g.getWorldBboxVerts();if(x.get("snapToGrid")){const z=x.get("gridSnapX"),G=x.get("gridSnapY");for(const V of C)V.x=ie(V.x,z),V.y=ie(V.y,G)}const A=C.filter(z=>z.x===y.minX),_=C.filter(z=>z.x===y.maxX),F=C.filter(z=>z.y===y.minY),R=C.filter(z=>z.y===y.maxY);for(const z of[...A,..._])Br.addRefLinesToMap(r,z.x,[z.y]);for(const z of[...F,...R])Br.addRefLinesToMap(s,z.y,[z.x])}this.sortedXs=Array.from(r.keys()).sort((g,y)=>g-y),this.sortedYs=Array.from(s.keys()).sort((g,y)=>g-y)}clear(){this.vRefLineMap.clear(),this.hRefLineMap.clear(),this.sortedXs=[],this.sortedYs=[],this.toDrawVLines=[],this.toDrawHLines=[]}static addRefLinesToMap(t,e,r){const s=t.get(e);if(s)for(const o of r)s.add(o);else t.set(e,new Set(r))}static getGraphicsTargetPoints(t){let e=[];if(t.size===1){const{width:r,height:s,transform:o}=Array.from(t.values())[0],c=ir({x:0,y:0,width:r,height:s},o);return c.push({x:(c[0].x+c[2].x)/2,y:(c[0].y+c[2].y)/2}),c}else{const r=Fa(On(Array.from(t.values()).map(s=>Ii(s))));e=[{x:r.minX,y:r.minY},{x:r.minX,y:r.maxY},{x:r.maxX,y:r.minY},{x:r.maxX,y:r.maxY},{x:r.midX,y:r.midY}]}return e}getGraphicsSnapOffset(t){this.toDrawVLines=[],this.toDrawHLines=[];let e=La(t),r=Array.from(e.keys()),s=Ha(t),o=Array.from(s.keys());const c=this.vRefLineMap,u=this.hRefLineMap,g=this.sortedXs,y=this.sortedYs;if(g.length===0&&y.length===0)return{x:0,y:0};let x,C;const A=Mr(r,N=>oa(g,N)),_=Mr(r,(N,Q)=>A[Q]-N),F=Math.min(...Mr(_,N=>Math.abs(N))),R=Mr(o,N=>oa(y,N)),z=Mr(o,(N,Q)=>R[Q]-N),G=Math.min(...Mr(z,N=>Math.abs(N))),V=(N,Q)=>Math.abs(N-Q)<1e-5,j=this.editor.setting.get("refLineTolerance")/this.editor.zoomManager.getZoom();if(F<=j){for(const N of _)if(V(F,Math.abs(N))){x=N;break}if(x===void 0)throw new Error("it should not reach here, please put a issue to us")}if(G<=j){for(const N of z)if(V(G,Math.abs(N))){C=N;break}if(C===void 0)throw new Error("it should not reach here, please put a issue to us")}const U=Mr(t,N=>({x:N.x+(x??0),y:N.y+(C??0)}));return e=La(U),r=Array.from(e.keys()),x!==void 0&&ea(r,(N,Q)=>{if(V(x,_[Q])){const Y={x:A[Q],ys:[]};Y.ys.push(...e.get(N)),Y.ys.push(...Array.from(c.get(N)??[])),this.toDrawVLines.push(Y)}}),C!==void 0&&(s=Ha(U),o=Array.from(s.keys()),ea(o,(N,Q)=>{if(V(C,z[Q])){const Y={y:R[Q],xs:[]};Y.xs.push(...s.get(N)),Y.xs.push(...Array.from(u.get(N)??[])),this.toDrawHLines.push(Y)}})),{x:x??0,y:C??0}}drawRefLine(t){t.save();const e=this.editor.setting.get("refLineStroke");t.fillStyle=e,t.strokeStyle=e,t.lineWidth=this.editor.setting.get("refLineStrokeWidth");const r=new Set,s=this.editor.setting.get("refLinePointSize");this.drawVerticalLines(t,s,r),this.drawHorizontalLines(t,s,r),t.restore()}drawVerticalLines(t,e,r){for(const s of this.toDrawVLines){let o=1/0,c=-1/0;const{x:u}=this.editor.toViewportPt(s.x,0);for(const g of s.ys){const{y}=this.editor.toViewportPt(0,g);o=Math.min(o,y),c=Math.max(c,y);const x=`${u},${y}`;r.has(x)||(r.add(x),Ra(t,u,y,e))}ws(t,u,o,u,c)}}drawHorizontalLines(t,e,r){for(const s of this.toDrawHLines){let o=1/0,c=-1/0;const{y:u}=this.editor.toViewportPt(0,s.y);for(const g of s.xs){const{x:y}=this.editor.toViewportPt(g,0);o=Math.min(o,y),c=Math.max(c,y);const x=`${y},${u}`;r.has(x)||(r.add(x),Ra(t,y,u,e))}ws(t,o,u,c,u)}}}const Bs=(i,t)=>{const e=i.zoomManager.getZoom(),r=i.setting.get("selectionHitPadding")/e,s=i.doc.getCurrCanvas(),o=i.selectedElements.getParentIdSet(),c={tol:r,parentIdSet:o,zoom:e};return s.getHitGraphics(t,c)},Pc=(i,t=new Set)=>{const e=i.sceneGraph.selection;if(e===null)return console.warn("selection 为 null，请确认在正确的时机调用当前方法"),[];const r=fo(e);return Mc(i,r,i.doc.getCurrCanvas(),t)},Mc=(i,t,e,r)=>{const s=[],o=e.getChildren();for(const c of o)!c.isVisible()||c.isLock()||(r.has(c.attrs.id)?s.push(...Mc(i,t,c,r)):c.intersectWithChildrenBox(t)&&s.push(c));return s};class cf{constructor(t){S(this,"originWorldTfMap",new Map);S(this,"originParentIndexMap",new Map);S(this,"transaction");S(this,"selectedItems",[]);S(this,"selectedFrameIdSet",new Set);S(this,"prevParent");S(this,"startPoint",{x:-1,y:-1});S(this,"dragPoint",null);S(this,"dx",0);S(this,"dy",0);S(this,"prevBBoxPos",{x:-1,y:-1});this.editor=t,this.transaction=new qt(t)}onActive(){}onInactive(){}onShiftToggle(){this.dragPoint&&this.move()}onStart(t){this.editor.controlHandleManager.hideCustomHandles(),this.startPoint=this.editor.getSceneCursorXY(t),this.selectedItems=this.editor.selectedElements.getItems({excludeLocked:!0});for(const s of this.selectedItems){const o=s.attrs.id;Pe(s)&&!s.isGroup()&&this.selectedFrameIdSet.add(o),this.transaction.recordOld(o,{transform:ht(s.attrs.transform),parentIndex:ht(s.attrs.parentIndex)}),this.originWorldTfMap.set(o,s.getWorldTransform()),this.originParentIndexMap.set(o,ht(s.attrs.parentIndex))}const e=this.editor.doc.getCanvas();this.prevParent=Ri(this.startPoint,e.getChildren(),s=>this.selectedFrameIdSet.has(s.attrs.id))??e;const r=this.editor.selectedElements.getBoundingRect();r?this.prevBBoxPos={x:r.x,y:r.y}:console.error("selected elements should't be empty when moving, please report us issue"),this.editor.setting.get("snapToObjects")&&this.editor.refLine.cacheGraphicsRefLines({excludeItems:this.selectedItems})}onDrag(t){this.dragPoint=this.editor.getCursorXY(t),this.move()}move(){this.editor.sceneGraph.showBoxAndHandleWhenSelected=!1,this.editor.sceneGraph.showSelectedGraphsOutline=!1;const t=this.editor.toScenePt(this.dragPoint.x,this.dragPoint.y);let e=t.x-this.startPoint.x,r=t.y-this.startPoint.y;this.editor.hostEventManager.isShiftPressing&&(Math.abs(e)>Math.abs(r)?r=0:e=0),this.editor.setting.get("snapToGrid")&&(e!==0&&(e=Math.round(this.prevBBoxPos.x+e)-this.prevBBoxPos.x),r!==0&&(r=Math.round(this.prevBBoxPos.y+r)-this.prevBBoxPos.y)),this.dx=e,this.dy=r;const s=this.selectedItems,o=new Map;for(const C of s){const A=ht(this.originWorldTfMap.get(C.attrs.id));A[4]+=e,A[5]+=r,o.set(C.attrs.id,{width:C.attrs.width,height:C.attrs.height,transform:A})}const c=Br.getGraphicsTargetPoints(o),u=this.editor.refLine.getGraphicsSnapOffset(c),g=this.editor.doc.getCanvas(),y=Ri(t,g.getChildren(),C=>this.selectedFrameIdSet.has(C.attrs.id))??g,x=y.attrs.id;for(const C of s){const A=ht(this.originWorldTfMap.get(C.attrs.id));A[4]+=e+u.x,A[5]+=r+u.y,this.prevParent!==y&&C.attrs.id!==x&&(C.getParentId()===x?C.updateAttrs({parentIndex:{guid:x,position:C.attrs.parentIndex.position}}):y.insertChild(C)),C.setWorldTransform(A)}this.prevParent=y;for(const C of s)this.transaction.update(C.attrs.id,{transform:ht(C.attrs.transform),parentIndex:ht(C.attrs.parentIndex)});this.updateCursor(),this.transaction.updateParentSize(s),this.editor.render()}updateCursor(){if(this.editor.hostEventManager.isShiftPressing){if(this.dx===0&&this.dy!==0){this.editor.setCursor("move-ns");return}if(this.dx!==0&&this.dy===0){this.editor.setCursor("move-ew");return}}this.editor.setCursor("default")}onEnd(t,e){const r=this.editor.selectedElements.getItems({excludeLocked:!0});if(r.length!==0){if(!e){const s=this.editor.getSceneCursorXY(t);!Bs(this.editor,s)&&!this.editor.hostEventManager.isShiftPressing&&this.editor.selectedElements.clear();return}(this.dx!==0||this.dy!==0)&&(this.transaction.commit("Update Graphics Attributes"),r.length===1&&this.editor.controlHandleManager.setCustomHandles(r[0].getControlHandles(this.editor.zoomManager.getZoom(),!0)))}}afterEnd(){this.transaction=new qt(this.editor),this.dragPoint=null,this.selectedFrameIdSet.clear(),this.editor.sceneGraph.showBoxAndHandleWhenSelected=!0,this.editor.sceneGraph.showSelectedGraphsOutline=!0,this.editor.refLine.clear(),this.editor.render()}}class hf{constructor(t){S(this,"startPoint",{x:-1,y:-1});S(this,"handleName");S(this,"startSelectBRect",null);S(this,"originAttrsMap",new Map);S(this,"originWorldTransforms",new Map);S(this,"childNodeSet",new Set);S(this,"updatedAttrsMap",new Map);S(this,"lastDragPoint",null);S(this,"prevLastPoint",null);S(this,"unbind",Tr);S(this,"isResizeOp",()=>["nw","ne","se","sw","n","e","s","w"].includes(this.handleName));S(this,"updateControls",t=>{const e=this.editor.controlHandleManager;if(!Ga(this.handleName)&&e.hasCustomHandles()){const r=t.getControlHandles(this.editor.zoomManager.getZoom());r&&e.setCustomHandles(r)}});this.editor=t}onActive(){const t=()=>{this.updateGraphics(),this.editor.render()};this.editor.hostEventManager.on("shiftToggle",t),this.editor.hostEventManager.on("altToggle",t),this.unbind=()=>{this.editor.hostEventManager.off("shiftToggle",t),this.editor.hostEventManager.off("altToggle",t)}}onInactive(){this.unbind(),this.unbind=Tr}onStart(t){this.startPoint=this.editor.getSceneCursorXY(t);const e=this.editor.controlHandleManager.getHandleInfoByPoint(this.startPoint);if(!e)throw new Error("handleName is invalid");const r=this.editor.selectedElements.getItems();r.forEach(o=>{this.originAttrsMap.set(o.attrs.id,o.getAttrs()),this.originWorldTransforms.set(o.attrs.id,[...o.getWorldTransform()])}),this.childNodeSet=xs(r);for(const o of this.childNodeSet)this.originAttrsMap.set(o.attrs.id,o.getAttrs()),this.originWorldTransforms.set(o.attrs.id,[...o.getWorldTransform()]);const s=this.editor.selectedElements.getBoundingRect();if(!s)throw new Error("startSelectBbox should not be null, please issue to us");this.startSelectBRect=s,Ga(e.handleName)&&this.editor.controlHandleManager.hideCustomHandles(),this.handleName=e.handleName}onDrag(t){this.editor.commandManager.disableRedoUndo(),this.editor.hostEventManager.disableDelete();const e=["nw","ne","se","sw"].includes(this.handleName),r=["n","e","s","w"].includes(this.handleName)&&(this.editor.selectedElements.size()>1||this.editor.selectedElements.getItems()[0].getRotate()%Tn===0);if(!this.lastDragPoint&&this.editor.setting.get("snapToObjects")&&this.editor.refLine.cacheGraphicsRefLines({excludeItems:this.editor.selectedElements.getItems()}),this.lastDragPoint=this.editor.getSceneCursorXY(t),e||r){this.editor.setting.get("snapToGrid")&&(this.lastDragPoint=Ps.getSnapPtBySetting(this.lastDragPoint,this.editor.setting));const o=this.editor.refLine.getGraphicsSnapOffset([this.lastDragPoint]);this.lastDragPoint={x:this.lastDragPoint.x+o.x,y:this.lastDragPoint.y+o.y}}const s=this.prevLastPoint;this.prevLastPoint=this.lastDragPoint,!Si(s,this.lastDragPoint)&&(this.updateGraphics(),this.editor.render())}checkEnableUpdate(t,e){var o,c;return!((e.width===0||((o=e==null?void 0:e.transform)==null?void 0:o[0])===0)&&(e.height===0||((c=e==null?void 0:e.transform)==null?void 0:c[3])===0)||!(t.width===0||t.height===0)&&(e.width===0||e.height===0||e.transform&&(e.transform[0]===0||e.transform[3])===0))}updateSingleGraphics(t){const e=t.calcNewAttrsByControlHandle(this.handleName,this.lastDragPoint,this.originAttrsMap.get(t.attrs.id),this.originWorldTransforms.get(t.attrs.id),this.editor.hostEventManager.isShiftPressing,this.editor.hostEventManager.isAltPressing,this.editor.setting.get("flipObjectsWhileResizing"));t.updateAttrs(e,{finishRecomputed:!0}),this.updatedAttrsMap.set(t.attrs.id,ht(e)),Di(this.editor,sr([t]),this.originAttrsMap,this.updatedAttrsMap),this.updateControls(t)}updateGraphics(){if(!this.lastDragPoint)return;let t=new lt;const e=this.editor.selectedElements.getItems();if(e.length===1){const r=e[0];if(!this.isResizeOp()||r.attrs.height===0){this.updateSingleGraphics(r);return}const s=this.originWorldTransforms.get(r.attrs.id),o=this.originAttrsMap.get(r.attrs.id),c=vs(this.handleName,this.lastDragPoint,{width:o.width,height:o.height,transform:s},{keepRatio:this.editor.hostEventManager.isShiftPressing,scaleFromCenter:this.editor.hostEventManager.isAltPressing,noChangeWidthAndHeight:!0,flip:this.editor.setting.get("flipObjectsWhileResizing")});if(!this.checkEnableUpdate(o,ps(c)))return;t=new lt(...c.transform).append(new lt(...s).invert()),this.updateControls(e[0])}else{const r=this.startSelectBRect,s=new lt().translate(r.x,r.y),o=vs(this.handleName,this.lastDragPoint,{width:r.width,height:r.height,transform:s.getArray()},{keepRatio:this.editor.hostEventManager.isShiftPressing,scaleFromCenter:this.editor.hostEventManager.isAltPressing,noChangeWidthAndHeight:!0,flip:this.editor.setting.get("flipObjectsWhileResizing")});t=new lt(...o.transform).append(s.clone().invert())}this.isResizeOp()?this.resizeGraphicsArray(t.getArray()):console.error("should not reach here, please put a issue")}resizeGraphicsArray(t){const e=this.editor.selectedElements.getItems();for(const r of e){const s=r.attrs.id,o=this.originWorldTransforms.get(s),c=ze(t,o),u=ze(wn(r.getParentWorldTransform()),c),{width:g,height:y}=this.originAttrsMap.get(s),x=ps({width:g,height:y,transform:u});r.updateAttrs(x),this.updatedAttrsMap.set(s,ht(x))}this.updateChildren(t),Di(this.editor,sr(e),this.originAttrsMap,this.updatedAttrsMap)}updateChildren(t){for(const e of this.childNodeSet){const r=e.attrs.id,s=this.originWorldTransforms.get(r),o=ze(t,s),c=ze(wn(e.getParentWorldTransform()),o),{width:u,height:g}=this.originAttrsMap.get(r),y=ps({width:u,height:g,transform:c});e.updateAttrs(y),this.updatedAttrsMap.set(r,ht(y))}}onEnd(t,e){if(this.editor.selectedElements.size()===0||!e)return;const r=this.editor.selectedElements.getItems();this.editor.commandManager.pushCommand(new Mi("Update Selected Graphics attributes by Control Handle",this.editor,this.originAttrsMap,this.updatedAttrsMap)),r.length===1&&(this.editor.controlHandleManager.setCustomHandles(r[0].getControlHandles(this.editor.zoomManager.getZoom(),!0)),this.editor.render()),this.editor.commandManager.enableRedoUndo(),this.editor.hostEventManager.enableDelete()}afterEnd(){this.originAttrsMap=new Map,this.updatedAttrsMap=new Map,this.lastDragPoint=null,this.editor.refLine.clear()}}class lf{constructor(t){S(this,"originWorldTfMap",new Map);S(this,"transaction");S(this,"selectedItems",[]);S(this,"lastPoint",null);S(this,"startRotation",0);S(this,"startBboxRotation",0);S(this,"dRotation",0);S(this,"selectedBoxCenter",null);S(this,"handleType","");S(this,"shiftPressHandler",()=>{this.rotateSelectedGraphics()});this.editor=t,this.transaction=new qt(t)}onActive(){this.editor.hostEventManager.on("shiftToggle",this.shiftPressHandler)}onInactive(){this.editor.hostEventManager.off("shiftToggle",this.shiftPressHandler)}onStart(t){this.selectedItems=this.editor.selectedElements.getItems({excludeLocked:!0});for(const s of this.selectedItems)this.transaction.recordOld(s.attrs.id,{transform:ht(s.attrs.transform)}),this.originWorldTfMap.set(s.attrs.id,s.getWorldTransform());const e=this.editor.selectedElements.getBoundingRect();this.selectedBoxCenter={x:e.x+e.width/2,y:e.y+e.height/2};const r=this.editor.getSceneCursorXY(t);this.startRotation=vn({x:0,y:-1},{x:r.x-this.selectedBoxCenter.x,y:r.y-this.selectedBoxCenter.y}),this.startBboxRotation=this.editor.selectedElements.getRotation()}onDrag(t){this.lastPoint=this.editor.getSceneCursorXY(t),this.rotateSelectedGraphics()}rotateSelectedGraphics(){const t=this.lastPoint;if(!t)return;const e=this.editor,r=this.selectedItems,{x:s,y:o}=this.selectedBoxCenter,c=vn({x:0,y:-1},{x:t.x-s,y:t.y-o});if(this.dRotation=c-this.startRotation,e.hostEventManager.isShiftPressing){const u=e.setting.get("lockRotation"),g=this.startBboxRotation+this.dRotation;this.dRotation=ie(g,u)-this.startBboxRotation}e.selectedElements.size()===1?e.setCursor(Fi(this.handleType,e.selectedBox.getBox())):e.setCursor({type:"rotation",degree:Ti(c)});for(const u of r)u.dRotate(this.dRotation,this.originWorldTfMap.get(u.attrs.id),{x:s,y:o}),this.transaction.update(u.attrs.id,{transform:[...u.attrs.transform]});this.transaction.updateParentSize(this.selectedItems),e.render()}onEnd(){this.dRotation!==0&&this.transaction.commit("Rotate Elements")}afterEnd(){this.transaction=new qt(this.editor),this.lastPoint=null,this.dRotation=0,this.selectedBoxCenter=null}}class df{constructor(t){S(this,"startPoint",{x:-1,y:-1});S(this,"isShiftPressingWhenStart",!1);S(this,"startSelectedGraphs",[]);S(this,"startPointWhenSpaceDown",null);S(this,"lastDragPointWhenSpaceDown",null);S(this,"lastMouseScenePoint");S(this,"lastMousePoint");this.editor=t}onActive(){}onInactive(){}onStart(t){this.isShiftPressingWhenStart=!1,this.editor.hostEventManager.isShiftPressing?(this.isShiftPressingWhenStart=!0,this.startSelectedGraphs=this.editor.selectedElements.getItems()):this.editor.selectedElements.clear(),this.startPoint=this.editor.getSceneCursorXY(t),this.editor.render(),this.editor.sceneGraph.setSelection(this.startPoint)}onDrag(t){this.lastMouseScenePoint=this.editor.getSceneCursorXY(t),this.lastMousePoint=this.lastMouseScenePoint,this.updateSelectionAndSelectSet()}updateSelectionAndSelectSet(){const{x:t,y:e}=this.lastMouseScenePoint;if(this.startPointWhenSpaceDown&&this.lastDragPointWhenSpaceDown){const{x:s,y:o}=this.startPointWhenSpaceDown,{x:c,y:u}=this.lastDragPointWhenSpaceDown,g=t-c,y=e-u;this.startPoint={x:s+g,y:o+y}}const r=ho(this.startPoint,this.lastMouseScenePoint);if(this.editor.sceneGraph.setSelection(r),this.isShiftPressingWhenStart){const s=sr(this.startSelectedGraphs),o=Pc(this.editor,s);this.editor.selectedElements.setItems(this.startSelectedGraphs),this.editor.selectedElements.toggleItems(o.filter(c=>!s.has(c.attrs.id)))}else{const s=Pc(this.editor);this.editor.selectedElements.setItems(s)}this.editor.render()}onEnd(){}afterEnd(){this.isShiftPressingWhenStart=!1,this.startSelectedGraphs=[],this.editor.sceneGraph.selection=null,this.editor.render(),this.startPointWhenSpaceDown=null,this.lastDragPointWhenSpaceDown=null}onSpaceToggle(t){this.editor.toolManager.isDragging()&&t?(this.startPointWhenSpaceDown=this.startPoint,this.lastDragPointWhenSpaceDown=this.lastMousePoint,this.updateSelectionAndSelectSet()):(this.startPointWhenSpaceDown=null,this.lastDragPointWhenSpaceDown=null)}}const Tc="select",Ac="v";class oi{constructor(t){S(this,"type",Tc);S(this,"hotkey",Ac);S(this,"cursor","default");S(this,"startPoint",{x:-1,y:-1});S(this,"currStrategy",null);S(this,"strategyMove");S(this,"strategyDrawSelection");S(this,"strategySelectRotation");S(this,"strategySelectResize");S(this,"graphShouldRemovedFromSelectedIfNotMoved",null);S(this,"handleHoverItemChange",()=>{this.editor.toolManager.isDragging()||this.editor.render()});S(this,"onComboClick",t=>{const e=t.pos,r=this.editor;if(r.controlHandleManager.getHandleInfoByPoint(e))return;const o=Bs(r,e);if(o){if(o instanceof Se)r.pathEditor.active(o);else if(o instanceof kr)r.textEditor.active({textGraphics:o,pos:o.getWorldPosition(),range:{start:0,end:o.getContentLength()}}),t.nativeEvent.preventDefault();else if(o instanceof kr)r.textEditor.active({textGraphics:o,pos:o.getWorldPosition()}),t.nativeEvent.preventDefault();else if(Pe(o)&&o.isGroup()){const c=o.getChildren();for(let u=c.length-1;u>=0;u--)if(c[u].hitTestChildren(e)){this.editor.hostEventManager.isShiftPressing?this.editor.selectedElements.toggleItems([c[u]]):this.editor.selectedElements.setItems([c[u]]),r.selectedElements.setHoverItem(c[u]);break}}}});S(this,"updateCursorAndHlHoverGraph",to(t=>{if(this.editor.canvasDragger.isActive())return;const r=this.editor.controlHandleManager.getHandleInfoByPoint(t);if(this.editor.setCursor((r==null?void 0:r.cursor)||"default"),r||!this.editor.hostEventManager.isShiftPressing&&this.editor.selectedBox.hitTest(t))this.editor.selectedElements.setHoverItem(null);else{const s=Bs(this.editor,t);this.editor.selectedElements.setHoverItem(s)}},20));this.editor=t,this.strategyMove=new cf(t),this.strategyDrawSelection=new df(t),this.strategySelectRotation=new lf(t),this.strategySelectResize=new hf(t)}onActive(){this.editor.selectedElements.on("hoverItemChange",this.handleHoverItemChange),this.editor.mouseEventManager.on("comboClick",this.onComboClick)}onInactive(){this.editor.selectedElements.setHighlightedItem(null),this.editor.selectedElements.off("hoverItemChange",this.handleHoverItemChange),this.editor.mouseEventManager.off("comboClick",this.onComboClick),this.updateCursorAndHlHoverGraph.cancel(),this.editor.render()}onMoveExcludeDrag(t,e){if(e||this.editor.textEditor.isActive())return;const r=this.editor.getSceneCursorXY(t);this.updateCursorAndHlHoverGraph(r),this.editor.selectedBox.setHoverByPoint(r)}onStart(t){if(this.currStrategy=null,this.graphShouldRemovedFromSelectedIfNotMoved=null,this.editor.hostEventManager.isDraggingCanvasBySpace)return;const e=this.editor.sceneGraph,r=this.editor.selectedElements,s=this.editor.hostEventManager.isShiftPressing;this.startPoint=this.editor.getSceneCursorXY(t);const o=this.editor.controlHandleManager.getHandleInfoByPoint(this.startPoint);if(o)Qu(o.cursor)?(this.strategySelectRotation.handleType=o.handleName,this.currStrategy=this.strategySelectRotation):this.currStrategy=this.strategySelectResize;else{const c=this.editor.selectedBox.hitTest(this.startPoint),u=Bs(this.editor,this.startPoint);u&&s&&r.getItems().includes(u)&&(this.graphShouldRemovedFromSelectedIfNotMoved=u),c?this.currStrategy=this.strategyMove:u?(s?r.getItems().includes(u)||r.toggleItems([u]):r.setItems([u]),this.editor.selectedBox.setHover(!0),e.render(),this.currStrategy=this.strategyMove):this.currStrategy=this.strategyDrawSelection}if(this.currStrategy)this.currStrategy.onActive(),this.currStrategy.onStart(t);else throw new Error("没有根据判断选择策略，代码有问题")}onDrag(t){if(!this.editor.hostEventManager.isDraggingCanvasBySpace)if(this.currStrategy)this.currStrategy.onDrag(t);else throw new Error("没有根据判断选择策略，代码有问题")}onEnd(t,e){if(this.editor.controlHandleManager.showCustomHandles(),this.editor.hostEventManager.isDraggingCanvasBySpace)return;!e&&this.graphShouldRemovedFromSelectedIfNotMoved&&(this.editor.selectedElements.toggleItems([this.graphShouldRemovedFromSelectedIfNotMoved]),this.editor.render());const r=this.currStrategy;if(r)r.onEnd(t,e),r.onInactive();else throw new Error("没有根据判断选择策略，代码有问题")}afterEnd(t,e){var s;this.editor.hostEventManager.isDraggingCanvasBySpace||this.editor.setCursor("default"),this.graphShouldRemovedFromSelectedIfNotMoved=null,(s=this.currStrategy)==null||s.afterEnd(t,e),this.currStrategy=null;const r=this.editor.getSceneCursorXY(t);this.editor.selectedBox.setHoverByPoint(r),this.updateCursorAndHlHoverGraph(r)}onCanvasDragActiveChange(t){t&&this.editor.selectedElements.setHoverItem(null)}onSpaceToggle(t){var e;(e=this.currStrategy)!=null&&e.onSpaceToggle&&this.currStrategy.onSpaceToggle(t)}onShiftToggle(t){var e;(e=this.currStrategy)!=null&&e.onShiftToggle&&this.currStrategy.onShiftToggle(t)}}S(oi,"type",Tc),S(oi,"hotkey",Ac);class uf{constructor(t){S(this,"toolCtorMap",new Map);S(this,"hotkeySet",new Set);S(this,"currentTool",null);S(this,"eventEmitter",new Le);S(this,"enableSwitchTool",!0);S(this,"keyBindingToken",[]);S(this,"_isDragging",!1);S(this,"enableToolTypes",[]);S(this,"currViewportPoint",{x:1/0,y:1/0});S(this,"_unbindEvent");this.editor=t,this.registerToolCtor(oi),this.registerToolCtor(Ts),this.registerToolCtor(Is),this.registerToolCtor(Ms),this.registerToolCtor(As),this.registerToolCtor(Es),this.registerToolCtor(Rs),this.registerToolCtor(bs),this.registerToolCtor(Dr),this.registerToolCtor(si),this.registerToolCtor(_s),this.registerToolCtor(ks),this.registerToolCtor(Ds),this.setEnableHotKeyTools([oi.type,Ts.type,Is.type,Ms.type,As.type,si.type,Ds.type,Es.type,_s.type,ks.type,Rs.type,bs.type]),this.setActiveTool(oi.type),this._unbindEvent=this.bindEvent()}unbindHotkey(){this.keyBindingToken.forEach(t=>{this.editor.keybindingManager.unregister(t)}),this.keyBindingToken=[]}setEnableHotKeyTools(t){this.enableToolTypes=t,this.eventEmitter.emit("changeEnableTools",[...t])}getEnableTools(){return[...this.enableToolTypes]}registerToolCtor(t){const e=t.type;this.toolCtorMap.has(e)&&console.warn(`tool "${e}" had exit, replace it!`),this.toolCtorMap.set(e,t);const r=t.hotkey;let s="",o;if(!r){console.log(`${e} has no hotkey`);return}typeof r=="string"?(s=`Key${r.toUpperCase()}`,o={keyCode:s}):(s=`${r.altKey?"alt+":""}${r.ctrlKey?"ctrl+":""}${r.shiftKey?"shift+":""}${r.metaKey?"meta+":""}${r.keyCode}`,o=r),this.hotkeySet.has(s)&&console.log(`register same hotkey: "${s}"`),this.hotkeySet.add(s);const c=this.editor.keybindingManager.register({key:o,actionName:e,when:()=>this.enableToolTypes.includes(e),action:()=>{this.setActiveTool(e)}});this.keyBindingToken.push(c)}getActiveToolName(){var t;return(t=this.currentTool)==null?void 0:t.type}bindEvent(){let t=!1,e={x:0,y:0},r=!1;const s=F=>{setTimeout(()=>{if(t=!1,this._isDragging=!1,r=!1,!(F.button!==0||this.editor.textEditor.isActive()||this.editor.hostEventManager.isSpacePressing)){if(t=!0,r=!0,!this.currentTool)throw new Error("there is no active tool");e={x:F.clientX,y:F.clientY},this.currentTool.onStart(F)}})},o=F=>{var R,z;if(this.currViewportPoint=this.editor.getCursorXY(F),!this.currentTool)throw new Error("未设置当前使用工具");if(t){if(!r)return;const G=F.clientX-e.x,V=F.clientY-e.y,j=((z=(R=this.currentTool).getDragBlockStep)==null?void 0:z.call(R))??this.editor.setting.get("dragBlockStep");!this._isDragging&&(Math.abs(G)>j||Math.abs(V)>j)&&(this._isDragging=!0),this._isDragging&&(this.enableSwitchTool=!1,this.editor.canvasDragger.disableDragBySpace(),this.currentTool.onDrag(F))}else{const G=this.editor.canvasElement!==F.target;this.currentTool.onMoveExcludeDrag(F,G)}},c=F=>{if(this.enableSwitchTool=!0,!!r){if(!this.currentTool)throw new Error("未设置当前使用工具");t&&(this.editor.canvasDragger.enableDragBySpace(),t=!1,this.currentTool.onEnd(F,this._isDragging),this.currentTool.afterEnd(F,this._isDragging)),this._isDragging=!1}},u=()=>{var F,R;(R=(F=this.currentTool)==null?void 0:F.onCommandChange)==null||R.call(F)},g=F=>{var R,z;(z=(R=this.currentTool)==null?void 0:R.onSpaceToggle)==null||z.call(R,F)},y=F=>{var R,z;(z=(R=this.currentTool)==null?void 0:R.onShiftToggle)==null||z.call(R,F)},x=F=>{var R,z;(z=(R=this.currentTool)==null?void 0:R.onAltToggle)==null||z.call(R,F)},C=(F,R)=>{var z,G;(G=(z=this.currentTool)==null?void 0:z.onViewportXOrYChange)==null||G.call(z,F,R)},A=F=>{var R,z;(z=(R=this.currentTool)==null?void 0:R.onCanvasDragActiveChange)==null||z.call(R,F)},_=this.editor.canvasElement;return _.addEventListener("pointerdown",s),window.addEventListener("pointermove",o),window.addEventListener("pointerup",c),this.editor.commandManager.on("change",u),this.editor.hostEventManager.on("spaceToggle",g),this.editor.hostEventManager.on("shiftToggle",y),this.editor.hostEventManager.on("altToggle",x),this.editor.viewportManager.on("xOrYChange",C),this.editor.canvasDragger.on("activeChange",A),()=>{_.removeEventListener("pointerdown",s),window.removeEventListener("pointermove",o),window.removeEventListener("pointerup",c),this.editor.commandManager.off("change",u),this.editor.hostEventManager.off("spaceToggle",g),this.editor.hostEventManager.off("shiftToggle",y),this.editor.hostEventManager.off("altToggle",x),this.editor.viewportManager.off("xOrYChange",C),this.editor.canvasDragger.off("activeChange",A)}}unbindEvent(){this._unbindEvent(),this._unbindEvent=Tr,this.unbindHotkey()}async setActiveTool(t){if(!this.enableSwitchTool||this.getActiveToolName()===t)return;if(!this.enableToolTypes.includes(t)){console.warn(`target tool "${t}" is not enable`);return}const e=this.toolCtorMap.get(t)||null;if(!e)throw new Error(`tool "${t}" is not registered`);const r=new e(this.editor);if(r.enableActive&&!await r.enableActive())return;const s=this.currentTool;this.currentTool=r,s&&s.onInactive(),this.setCursorWhenActive(),r.onActive(),this.eventEmitter.emit("switchTool",r.type)}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}destroy(){var t;(t=this.currentTool)==null||t.onInactive()}setCursorWhenActive(){this.currentTool&&this.editor.cursorManager.setCursor(this.currentTool.cursor)}isDragging(){return this._isDragging}getCurrPoint(){return this.editor.toScenePt(this.currViewportPoint.x,this.currViewportPoint.y)}}class ff{constructor(t){S(this,"normalControls",[]);S(this,"selectedControls",[]);S(this,"segControlsNeedDraw",[]);S(this,"drawControlHandles",to((t=[])=>{t=this.generateControls().concat(t),this.editor.controlHandleManager.setCustomHandles(t),this.editor.controlHandleManager.showCustomHandles()}));this.editor=t}getSegControlsNeedDraw(){return this.segControlsNeedDraw}getItemsNeedDraw(){const t=this.editor.pathEditor.getPath(),e=new Map,r=[];if(!t)return console.warn("path is no exist"),{segControlsNeedDrawMap:e,segControlsNeedDraw:r};const s=[...this.selectedControls,...this.normalControls];for(const o of s){const{type:c,pathIdx:u,segIdx:g}=o;if(u<0||u>=t.attrs.pathData.length)continue;const y=t.attrs.pathData[u],x=y.segs.length,C=y.closed;if(g<0||g>=x)continue;let A=e.get(u);A||(A=new Set,e.set(u,A)),A.add(g),r.push({pathIdx:u,segIdx:g});const _=g-1,F=g+1;c==="anchor"?(_>=0?(A.add(_),r.push({pathIdx:u,segIdx:_})):C&&(A.add(x-1),r.push({pathIdx:u,segIdx:x-1})),F<x?(A.add(F),r.push({pathIdx:u,segIdx:F})):C&&(A.add(0),r.push({pathIdx:u,segIdx:0}))):c==="in"?_>=0&&(A.add(_),r.push({pathIdx:u,segIdx:_})):(c==="out"||c==="curve")&&F<x&&(A.add(F),r.push({pathIdx:u,segIdx:F}))}return{segControlsNeedDrawMap:e,segControlsNeedDraw:r}}generateControls(){const t=this.editor.pathEditor.getPath();if(!t)return[];const e=4,r=6,s=this.editor.setting.get("handleStroke"),o=this.editor.zoomManager.getZoom(),c=t.attrs.pathData,{segControlsNeedDrawMap:u,segControlsNeedDraw:g}=this.getItemsNeedDraw();this.segControlsNeedDraw=g;const y=[],x=[];for(let C=0;C<c.length;C++){const A=c[C];for(let _=0;_<A.segs.length;_++){const F=t.getSeg(C,_,{applyTransform:!0}),R=F.point;let z=6,G="#fff",V=s;this.contains("anchor",C,_)&&(z=8,G=s,V="#fff");const j=new pe({cx:R.x,cy:R.y,type:["anchor",C,_].join("-"),graphics:new ni({objectName:"anchor",width:z,height:z,fill:[{type:vt.Solid,attrs:ge(G)}],stroke:[{type:vt.Solid,attrs:ge(V)}],strokeWidth:1},{advancedAttrs:this.editor.toViewportPt(R.x+z/2,R.y+z/2),doc:this.editor.doc}),padding:e,getCursor:()=>"default"});y.push(j);const U=u.get(C);if(!U||!U.has(_))continue;const N=ge(this.editor.setting.get("pathLineStroke")),Q=[Se.getHandleIn(F),Se.getHandleOut(F)];for(let Y=0;Y<Q.length;Y++){const Z=Q[Y];if(oo(Z,R))continue;const wt=Y===0&&this.contains("in",C,_)||Y===1&&this.contains("out",C,_),ut=Jd(R,Z),rt=new pe({cx:ut.x+ut.width/2,cy:ut.y+ut.height/2,type:"handleLine",rotation:ut.rotation,graphics:new Ss({objectName:"handleLine",height:ut.height,width:ut.width*o,stroke:[{type:vt.Solid,attrs:wt?ge(s):N}],strokeWidth:1},{advancedAttrs:{x:ut.x,y:ut.y},doc:this.editor.doc}),hitTest:()=>!1,getCursor:()=>"default"}),dt=wt?8.5:r,Ht=new pe({cx:Z.x,cy:Z.y,type:[Y===0?"in":"out",C,_].join("-"),graphics:new Cs({objectName:"pathHandle",width:dt,height:dt,fill:[{type:vt.Solid,attrs:ge(wt?s:"#fff")}],stroke:[{type:vt.Solid,attrs:ge(wt?"#fff":s)}],strokeWidth:wt?1.5:1,count:4},{advancedAttrs:this.editor.toViewportPt(Z.x+dt/2,Z.y+dt/2),doc:this.editor.doc}),padding:e,getCursor:()=>"default"});x.push(rt,Ht)}}}return y.concat(x)}contains(t,e,r){return this.selectedControls.some(s=>s.type===t&&s.pathIdx===e&&s.segIdx===r)}getSelectedControlsSize(){return this.selectedControls.length}getSelectedControls(){return ht(this.selectedControls)}setItems(t){this.selectedControls=t}clear(){this.selectedControls=[]}setNormalControls(t){this.normalControls=t}getNormalControls(){return ht(this.normalControls)}}class Po{constructor(t){S(this,"_active",!1);S(this,"path",null);S(this,"eventTokens",[]);S(this,"prevToolKeys",[]);S(this,"eventEmitter",new Le);S(this,"selectedControl");S(this,"onSelectedChange",t=>{t.length===0||t[0]===this.path||(this.inactive(),this.editor.toolManager.setActiveTool("select"))});this.editor=t,this.selectedControl=new ff(t)}getPath(){return this.path}isActive(){return this._active}active(t){this._active=!0,this.path=t;const e=this.editor;e.sceneGraph.showSelectedGraphsOutline=!1,e.sceneGraph.highlightLayersOnHover=!1,e.controlHandleManager.enableTransformControl=!1,this.unbindHotkeys(),this.bindHotkeys(),this.prevToolKeys=e.toolManager.getEnableTools(),e.toolManager.setEnableHotKeyTools([Dr.type,si.type]);const r=e.toolManager.getActiveToolName();r!==Dr.type&&r!==si.type&&e.toolManager.setActiveTool(Dr.type),e.selectedElements.on("itemsChange",this.onSelectedChange),e.pathEditor.drawControlHandles(),this.eventEmitter.emit("toggle",!0)}inactive(t){if(!this._active)return;this._active=!1,t!=="undo"&&this.removePathIfEmpty(),this.selectedControl.clear(),this.path=null;const e=this.editor;e.sceneGraph.showSelectedGraphsOutline=!0,e.sceneGraph.highlightLayersOnHover=!0,e.controlHandleManager.enableTransformControl=!0,this.unbindHotkeys(),e.toolManager.setEnableHotKeyTools(this.prevToolKeys),e.toolManager.setActiveTool(oi.type),e.selectedElements.off("itemsChange",this.onSelectedChange),e.controlHandleManager.clearCustomHandles(),e.render(),this.eventEmitter.emit("toggle",!1)}removePathIfEmpty(){const t=this.path;if(!t)return;const e=t.attrs.pathData;(e.length===0||e.every(r=>r.segs.length<=1))&&(Co(this.editor,[t]),this.editor.selectedElements.clear())}bindHotkeys(){const t=this.editor;this.eventTokens=[];let e=t.keybindingManager.registerWithHighPrior({key:[{keyCode:"Backspace"},{keyCode:"Delete"}],when:r=>!r.isToolDragging,actionName:"Path Delete",action:()=>{}});this.eventTokens.push(e),e=t.keybindingManager.registerWithHighPrior({key:{keyCode:"Escape"},when:r=>!r.isToolDragging,actionName:"Path Finish",action:()=>{this.selectedControl.getSelectedControlsSize()>0?(this.selectedControl.clear(),this.drawControlHandles(),this.editor.render()):this.inactive()}}),this.eventTokens.push(e),e=t.keybindingManager.registerWithHighPrior({key:{keyCode:"Enter"},when:r=>!r.isToolDragging,actionName:"Path End",action:()=>{this.inactive()}}),this.eventTokens.push(e)}unbindHotkeys(){for(const t of this.eventTokens)this.editor.keybindingManager.unregister(t);this.eventTokens=[]}static parseSelectedInfoStr(t){const e=t.split("-");return e.length!==3?null:{type:e[0],pathIdx:parseInt(e[1]),segIdx:parseInt(e[2])}}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}drawControlHandles(t=[]){this.selectedControl.drawControlHandles(t)}}var Ec={exports:{}};(function(i,t){(function(e,r){i.exports=r()})($t,function(){var e=function(){function r(_){return c.appendChild(_.dom),_}function s(_){for(var F=0;F<c.children.length;F++)c.children[F].style.display=F===_?"block":"none";o=_}var o=0,c=document.createElement("div");c.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",c.addEventListener("click",function(_){_.preventDefault(),s(++o%c.children.length)},!1);var u=(performance||Date).now(),g=u,y=0,x=r(new e.Panel("FPS","#0ff","#002")),C=r(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var A=r(new e.Panel("MB","#f08","#201"));return s(0),{REVISION:16,dom:c,addPanel:r,showPanel:s,begin:function(){u=(performance||Date).now()},end:function(){y++;var _=(performance||Date).now();if(C.update(_-u,200),_>g+1e3&&(x.update(1e3*y/(_-g),100),g=_,y=0,A)){var F=performance.memory;A.update(F.usedJSHeapSize/1048576,F.jsHeapSizeLimit/1048576)}return _},update:function(){u=this.end()},domElement:c,setMode:s}};return e.Panel=function(r,s,o){var c=1/0,u=0,g=Math.round,y=g(window.devicePixelRatio||1),x=80*y,C=48*y,A=3*y,_=2*y,F=3*y,R=15*y,z=74*y,G=30*y,V=document.createElement("canvas");V.width=x,V.height=C,V.style.cssText="width:80px;height:48px";var j=V.getContext("2d");return j.font="bold "+9*y+"px Helvetica,Arial,sans-serif",j.textBaseline="top",j.fillStyle=o,j.fillRect(0,0,x,C),j.fillStyle=s,j.fillText(r,A,_),j.fillRect(F,R,z,G),j.fillStyle=o,j.globalAlpha=.9,j.fillRect(F,R,z,G),{dom:V,update:function(U,N){c=Math.min(c,U),u=Math.max(u,U),j.fillStyle=o,j.globalAlpha=1,j.fillRect(0,0,x,R),j.fillStyle=s,j.fillText(g(U)+" "+r+" ("+g(c)+"-"+g(u)+")",A,_),j.drawImage(V,F+y,R,z-y,G,F,R,z-y,G),j.fillRect(F+z-y,R,y,G),j.fillStyle=o,j.globalAlpha=.9,j.fillRect(F+z-y,R,y,g((1-U/N)*G))}}},e})})(Ec);var gf=Ec.exports;const pf=Fn(gf);class mf{constructor(){S(this,"stats",new pf);S(this,"rafId",0)}start(t){const e=this.stats;e.showPanel(0),e.dom.style.left="300px",t.appendChild(e.dom);const r=()=>{e.begin(),e.end(),this.rafId=requestAnimationFrame(r)};this.rafId=requestAnimationFrame(r)}destroy(){cancelAnimationFrame(this.rafId),this.stats.dom.remove()}}const Ic=i=>{const t=[1,2,5,10,25,50,100,250,500,1e3,2500,5e3],e=50/i;for(let r=0,s=t.length;r<s;r++)if(t[r]>=e)return t[r];return t[0]};class yf{constructor(t){S(this,"visible",!1);this.editor=t}open(){this.visible=!0}close(){this.visible=!1}draw(){const t=this.editor.setting,e=t.get("rulerWidth"),r=this.editor.ctx,s=this.editor.viewportManager.getViewport(),{width:o,height:c}=s;r.save(),r.fillStyle=t.get("rulerBgColor"),r.fillRect(0,0,o,e),r.fillRect(0,0,e,c),this.drawSelectArea(),this.drawXRuler(),this.drawYRuler(),r.fillStyle=t.get("rulerBgColor"),r.fillRect(0,0,e,e),r.strokeStyle=t.get("rulerStroke"),r.beginPath(),r.moveTo(0,e+.5),r.lineTo(o,e+.5),r.stroke(),r.closePath(),r.beginPath(),r.moveTo(e+.5,0),r.lineTo(e+.5,c),r.stroke(),r.closePath(),r.restore()}drawSelectArea(){const t=this.editor.setting,e=t.get("rulerWidth"),r=this.editor.ctx,s=this.editor.zoomManager.getZoom(),o=this.editor.viewportManager.getViewport(),c=this.editor.selectedElements.getItems().map(u=>u.getBbox());r.fillStyle=t.get("rulerSelectedBgColor");for(const[u,g]of Ba(c.map(({minX:y,maxX:x})=>[y,x])))r.fillRect((u-o.x)*s,0,(g-u)*s,e);for(const[u,g]of Ba(c.map(({minY:y,maxY:x})=>[y,x])))r.fillRect(0,(u-o.y)*s,e,(g-u)*s)}drawXRuler(){const t=this.editor.setting,e=t.get("rulerWidth"),r=this.editor.ctx,s=this.editor.zoomManager.getZoom(),o=this.editor.viewportManager.getViewport(),c=Ic(s),u=e;let g=o.x+u/s;g=ie(g,c);const y=o.width;let{x}=this.editor.toScenePt(y,0);x=ie(x,c),r.textAlign="center";const C=e-t.get("rulerMarkSize");for(;g<=x;){r.strokeStyle=t.get("rulerMarkStroke"),r.fillStyle=t.get("rulerMarkStroke");const A=ds((g-o.x)*s);r.beginPath(),r.moveTo(A,C),r.lineTo(A,C+t.get("rulerMarkSize")),r.stroke(),r.closePath(),r.fillText(String(g),A,C-4),g+=c}}drawYRuler(){const t=this.editor.setting,e=t.get("rulerWidth"),r=this.editor.ctx,s=this.editor.zoomManager.getZoom(),o=this.editor.viewportManager.getViewport(),c=Ic(s),u=e;let g=o.y+u/s;g=ie(g,c);const y=o.height;let x=o.y+y/s;x=ie(x,c);const C=e-t.get("rulerMarkSize");for(r.textAlign="center",r.fillStyle=t.get("rulerMarkStroke");g<=x;){const A=ds((g-o.y)*s);r.beginPath(),r.moveTo(C,A),r.lineTo(C+t.get("rulerMarkSize"),A),r.stroke(),r.closePath(),Da(r,-Tn,C,A),r.fillText(String(g),C,A-3),Da(r,Tn,C,A),g+=c}}}class vf{constructor(t){this.editor=t}draw(){const t=this.editor.ctx;t.save();const{x:e,y:r,width:s,height:o}=this.editor.viewportManager.getViewport(),c=this.editor.zoomManager.getZoom(),u=this.editor.setting,g=this.editor.setting.get("gridViewX"),y=this.editor.setting.get("gridViewY");let x=ie(e,g);const C=ie(e+s/c,g);for(;x<=C;){t.strokeStyle=u.get("pixelGridLineColor");const F=ds((x-e)*c);t.beginPath(),t.moveTo(F,0),t.lineTo(F,o),t.stroke(),t.closePath(),x+=g}let A=ie(r,y);const _=ie(r+o/c,y);for(;A<=_;){t.strokeStyle=u.get("pixelGridLineColor");const F=ds((A-r)*c);t.beginPath(),t.moveTo(0,F),t.lineTo(s,F),t.stroke(),t.closePath(),A+=y}t.restore()}}const wf={[At.Graph]:Qt,[At.Rect]:Ce,[At.Ellipse]:ni,[At.Line]:Ss,[At.Text]:kr,[At.Path]:Se,[At.RegularPolygon]:Cs,[At.Star]:vo,[At.Frame]:ri,[At.Canvas]:ii,[At.Document]:Ja};class xf{constructor(t){S(this,"selection",null);S(this,"eventEmitter",new Le);S(this,"grid");S(this,"showBoxAndHandleWhenSelected",!0);S(this,"showSelectedGraphsOutline",!0);S(this,"highlightLayersOnHover",!0);S(this,"render",Su(()=>{var U,N,Q;const{viewportManager:t,canvasElement:e,ctx:r,setting:s,renderer:o}=this.editor,c=t.getViewport(),u=this.editor.zoomManager.getZoom(),g=this.editor.selectedElements,y=o||r,x=this.editor.imgManager,C=eo(),A=-c.x,_=-c.y,F=s.get("canvasBgColor");o?(console.log("🚀 Usando CanvasKit pipeline otimizada"),(U=o.clearBackground)==null||U.call(o,F,e.width,e.height),(N=o.setViewportTransform)==null||N.call(o,C,u,A,_)):(console.log("⚠️ Fallback Canvas2D"),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,e.width,e.height),r.save(),r.fillStyle=F,r.fillRect(0,0,e.width,e.height),r.restore(),r.scale(C*u,C*u),r.translate(A,_));const R=this.editor.doc.getCanvas(),z=u<=1;if(R){const Y=this.editor.viewportManager.getBbox();y.save(),R.draw({ctx:y,imgManager:x,smooth:z,viewportArea:Y}),y.restore()}if(r.save(),r.setTransform(1,0,0,1,0,0),r.scale(C,C),s.get("enablePixelGrid")&&u>=this.editor.setting.get("minPixelGridZoom")&&this.grid.draw(),this.highlightLayersOnHover&&s.get("highlightLayersOnHover")){const Y=g.getHighlightedItem();Y&&!g.hasItem(Y)&&this.drawGraphsOutline([Y],s.get("hoverOutlineStrokeWidth"),this.editor.setting.get("hoverOutlineStroke"))}const G=this.editor.selectedBox.updateBbox();if(this.showSelectedGraphsOutline&&(this.drawGraphsOutline(this.editor.selectedElements.getItems().filter(Y=>Y.isVisible()),s.get("selectedOutlineStrokeWidth"),this.editor.setting.get("hoverOutlineStroke")),this.editor.selectedBox.draw()),this.editor.pathEditor.isActive()){const Y=this.editor.pathEditor.getPath();Y&&this.drawGraphsOutline([Y],s.get("selectedOutlineStrokeWidth"),this.editor.setting.get("pathLineStroke"))}const V=4,j=this.editor.doc.graphicsStoreManager.getFrames();for(const Y of j){if(Pe(Y)&&Y.isGroup()||Y.isDeleted())continue;const Z=Y.getWorldPosition(),wt=this.editor.toViewportPt(Z.x,Z.y);Y.drawText(r,wt.x,wt.y-V)}if(this.showBoxAndHandleWhenSelected&&this.editor.controlHandleManager.draw(G),this.editor.textEditor.drawRange(),this.selection){r.save(),r.strokeStyle=s.get("selectionStroke"),r.fillStyle=s.get("selectionFill");const{x:Y,y:Z,width:wt,height:ut}=this.selection,{x:rt,y:dt}=this.editor.toViewportPt(Y,Z),Ht=wt*u,st=ut*u;r.fillRect(rt,dt,Ht,st),r.strokeRect(rt,dt,Ht,st),r.restore()}this.editor.refLine.drawRefLine(r),s.get("enableRuler")&&this.editor.ruler.draw(),r.restore(),o&&((Q=o.flush)==null||Q.call(o),console.log("✅ CanvasKit frame flushed")),this.eventEmitter.emit("render")}));this.editor=t,this.grid=new vf(t)}addItems(t){for(const e of t)this.editor.doc.addGraphics(e)}drawGraphsOutline(t,e,r){const s=this.editor.ctx,o=eo(),c=this.editor.viewportManager.getViewport(),u=this.editor.zoomManager.getZoom(),g=-c.x,y=-c.y;s.save(),s.setTransform(1,0,0,1,0,0),s.scale(o*u,o*u),s.translate(g,y),e/=u;for(const x of t)s.save(),x.drawOutline(s,r,e),s.restore();s.restore()}setSelection(t){this.selection=Object.assign({},this.selection,t)}toObjects(){const t=this.editor.doc.getCanvas();return t?t.toObject().children??[]:[]}toJSON(){const t=this.editor.doc.getAllGraphicsArr().filter(r=>!r.isDeleted()).map(r=>r.toJSON()),e={appVersion:this.editor.appVersion,paperId:this.editor.paperId,data:t};return JSON.stringify(e)}createGraphicsArr(t){const e=[];for(const r of t){const s=r.type,o=wf[s];if(!o){console.error(`Unsupported graphics type "${r.type}", ignore it`);continue}e.push(new o(r,{doc:this.editor.doc}))}return e}initGraphicsTree(t){var r;const e=this.editor.doc.getCanvas();for(const s of t){if(s instanceof ii)continue;const o=s.getParent()??e;o&&o!==s&&o.insertChild(s,(r=s.attrs.parentIndex)==null?void 0:r.position)}}load(t,e){const r=this.createGraphicsArr(t);e||this.editor.doc.clear(),this.addItems(r),this.initGraphicsTree(r)}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}class Sf{constructor(t){S(this,"box",null);S(this,"eventEmitter",new Le);S(this,"_hover",!1);S(this,"enableDrawSizeIndicator",!0);this.editor=t}isHover(){return this._hover}getBox(){return this.box?{...this.box}:null}updateBbox(){const t=this.editor.selectedElements,e=t.size();if(e>0)if(e===1){const r=t.getItems()[0],s=r.getSize();this.box={width:s.width,height:s.height,transform:r.getWorldTransform()}}else{const r=t.getBoundingRect();this.box={width:r.width,height:r.height,transform:[1,0,0,1,r.x,r.y]}}else this.box=null;return this.box}draw(){const t=this.box;if(!t)return;const e=this.editor.ctx,r=ir({x:0,y:0,width:t.width,height:t.height},t.transform).map(s=>this.editor.toViewportPt(s.x,s.y));this.drawBox(e,r),this.drawSizeIndicator(e,r,t)}drawBox(t,e){const r=this.editor.setting.get("selectBoxStroke"),s=this.editor.setting.get("selectBoxStrokeWidth");t.save(),t.strokeStyle=r,t.lineWidth=s,t.beginPath(),t.moveTo(e[0].x,e[0].y);for(let o=1;o<e.length;o++)t.lineTo(e[o].x,e[o].y);t.closePath(),t.stroke(),t.restore()}drawSizeIndicator(t,e,r){if(!this.enableDrawSizeIndicator)return;const s=this.editor.setting.get("sizeIndicatorMinSize");if(ne(e[0],e[1])<s&&ne(e[1],e[2])<s)return;let o=e[0],c=0;for(let dt=1;dt<e.length;dt++)e[dt].y>o.y&&(o=e[dt],c=dt);let u=1/0,g=e[0];for(let dt=0;dt<e.length;dt++){if(dt===c||oo(e[dt],o))continue;let Ht=vn({x:1,y:0},Hn(e[dt],o),!0);Ht>Math.PI/2&&(Ht=Math.PI-Ht),Ht<u&&(u=Ht,g=e[dt])}const y=so(o,g),[x,C]=Vd([o,g],y,this.editor.setting.get("sizeIndicatorOffset")),A=x.y>C.y?x:C,_=this.editor.setting.get("sizeIndicatorRectRadius"),F=this.editor.setting.get("sizeIndicatorRectPadding"),R=this.editor.setting.get("sizeIndicatorNumPrecision"),z=this.editor.setting.get("sizeIndicatorTextColor"),G=this.editor.setting.get("sizeIndicatorTextFontStyle"),V=sa(r.width,R),j=sa(r.height,R),U=`${V} × ${j}`;t.save(),t.font=G;const N=t.measureText(U),Q=N.width,Y=N.fontBoundingBoxAscent,Z=Y+N.fontBoundingBoxDescent,wt=new lt().translate(-Q/2,0).rotate(vn({x:0,y:1},Hn(A,y))).translate(A.x,A.y),ut=this.editor.setting.get("selectBoxStroke");t.fillStyle=ut,t.transform(...wt.getArray()),t.beginPath();const rt=uo({x:0,y:0,width:Q,height:Z},F);t.roundRect(rt.x,rt.y,rt.width,rt.height,_),t.fill(),t.translate(0,Y),t.fillStyle=z,t.fillText(U,0,0),t.restore()}hitTest(t){return this.box?lo(t,this.box,2/this.editor.zoomManager.getZoom()):!1}setHover(t){this._hover!==t&&(this._hover=t,this.eventEmitter.emit("hoverChange",t))}setHoverByPoint(t){const e=this.hitTest(t);this.setHover(e)}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}class Cf{constructor(t){S(this,"items",[]);S(this,"hoverItem",null);S(this,"highlightedItem",null);S(this,"eventEmitter",new Le);this.editor=t}setItems(t){const e=this.items;this.items=t,this.emitItemsChangeIfChanged(e,t)}getItems({excludeLocked:t=!1}={}){return t?this.items.filter(e=>!e.isLock()):[...this.items]}getIdSet(){return new Set(this.items.map(t=>t.attrs.id))}setItemsById(t){const e=this.editor.doc.getGraphicsArrByIds(t);e.length===0?console.warn("can not find element by id"):this.setItems(e)}isAllLocked(){return this.items.every(t=>t.isLock())}hasItem(t){return this.items.includes(t)}clear(){this.hoverItem&&this.items.includes(this.hoverItem)&&this.setHoverItem(null),this.setItems([])}toggleItems(t){const e=this.items,r=[];for(let s=0,o=e.length;s<o;s++){const c=e[s],u=t.indexOf(c);u===-1?r.push(c):t.splice(u,1)}r.push(...t),this.items=r,this.emitItemsChangeIfChanged(e,r)}emitItemsChangeIfChanged(t,e){Bd(t,e)||this.eventEmitter.emit("itemsChange",e)}toggleItemById(t,e){const r=this.editor.doc.getGraphicsById(t);if(!r){console.warn("can not find element by id");return}if(e!=null&&e.disableParentAndChildCoexist)if(Pe(r)&&r.isGroup())this.items=this.items.filter(s=>!s.containAncestor(t));else{const s=new Set(r.getParentIds());this.items=this.items.filter(o=>!s.has(o.attrs.id))}this.toggleItems([r])}size(){return this.items.length}isEmpty(){return this.items.length===0}getBoundingRect(){if(this.isEmpty())return null;const t=this.items.map(e=>e.getBbox());return Wn(On(t))}getRotation(){return this.items.length===0||this.items.length>1?0:this.items[0].getRotate()??0}getTransform(){return this.items.length===0||this.items.length>1?null:this.items[0].attrs.transform}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}removeFromScene(){this.isEmpty()||(Co(this.editor,this.items),this.clear(),this.editor.render())}selectAll(){var e,r;const t=((r=(e=this.items[0])==null?void 0:e.getParent)==null?void 0:r.call(e))??this.editor.doc.getCurrCanvas();for(let s=1;s<this.items.length;s++)if(t!==this.items[s].getParent())return;this.setItems(t.getChildren().filter(s=>!s.isLock()))}setHoverItem(t){const e=this.hoverItem;this.hoverItem=t,this.setHighlightedItem(t),e!==t&&this.eventEmitter.emit("hoverItemChange",t,this.hoverItem)}getHoverItem(){return this.hoverItem}setHighlightedItem(t){const e=this.highlightedItem;this.highlightedItem=t,e!==t&&this.eventEmitter.emit("highlightedItemChange",t,this.highlightedItem)}getHighlightedItem(){return this.highlightedItem}getParentIdSet(){return sr(this.items)}}class bf{constructor(t){S(this,"eventEmitter",new Le);S(this,"value",{canvasBgColor:"#f4f4f4",firstStroke:{type:vt.Solid,attrs:{r:0,g:0,b:0,a:1}},strokeWidth:1,firstFill:{type:vt.Solid,attrs:{r:217,g:217,b:217,a:1}},firstFrameFill:{type:vt.Solid,attrs:{r:255,g:255,b:255,a:1}},addedPaint:{type:vt.Solid,attrs:{r:0,g:0,b:0,a:.2}},defaultStarInnerScale:.3819660246372223,selectBoxStroke:"#1592fe",selectBoxStrokeWidth:1.2,sizeIndicatorMinSize:10,sizeIndicatorOffset:10,sizeIndicatorRectRadius:2,sizeIndicatorRectPadding:[0,4,0,4],sizeIndicatorTextColor:"#fff",sizeIndicatorTextFontStyle:"12px sans-serif",sizeIndicatorNumPrecision:2,selectionStroke:"#0f8eff",selectionFill:"#0f8eff33",selectionMode:"intersect",selectionHitPadding:4,highlightLayersOnHover:!0,hoverOutlineStrokeWidth:2,hoverOutlineStroke:"#1592fe",selectedOutlineStrokeWidth:1,handleStroke:"#1592fe",handleFill:"#fcfcfc",handleStrokeWidth:2,handleSize:7,neswHandleWidth:10,defaultFontSize:12,defaultFontFamily:"sans-serif",textFill:[{type:vt.Solid,attrs:{r:0,g:0,b:0,a:1}}],lockRotation:Math.PI/12,zoomStep:.2325,zoomMin:.015625,zoomMax:256,zoomLevels:[.015625,.03125,.0625,.125,.25,.5,1,2,4,8,16,32,64,128,256],drawGraphDefaultWidth:100,drawGraphDefaultHeight:100,enableRuler:!1,minStepInViewport:50,rulerBgColor:"#fff",rulerStroke:"#e6e6e6",rulerMarkStroke:"#c1c1c1",rulerSelectedBgColor:"#e6f5ff",rulerWidth:20,rulerMarkSize:4,enablePixelGrid:!0,snapToGrid:!0,minPixelGridZoom:8,pixelGridLineColor:"#cccccc55",gridViewX:1,gridViewY:1,gridSnapX:1,gridSnapY:1,snapToObjects:!0,dragBlockStep:4,offsetX:0,offsetY:0,zoomToFixPadding:40,invertZoomDirection:!1,smallNudge:1,bigNudge:10,moveElementsDelay:500,refLineTolerance:4,refLineStroke:"#f14f30ee",refLineStrokeWidth:1,refLinePointSize:5,keepToolSelectedAfterUse:!1,pencilCurveFitTolerance:1,pathLineStroke:"#a4a4a4",angleBase:{x:0,y:-1},flipObjectsWhileResizing:!0,comboClickMaxGap:350,comboClickDistanceTol:5,textEditorCursorSize:1.5,textEditorCursorLineStroke:"#000",textEditorSelectionFill:"#0069c433"});t=Qo(t,Object.keys(this.value)),this.value={...this.value,...t}}toggle(t){const e=this.value[t];typeof e=="boolean"?this.set(t,!e):console.warn(`toggle ${t} failed, value is not boolean`)}set(t,e){this.value[t]=e,this.eventEmitter.emit("update",this.getAttrs(),t)}get(t){return this.value[t]}getAttrs(){return{...this.value}}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}class _c{constructor(t){S(this,"range",{start:0,end:0});this.editor=t}setRange(t){this.range={start:t.start,end:t.end}}getRange(){return{...this.range}}getSortedRange(){const t=Math.min(this.range.start,this.range.end),e=Math.max(this.range.start,this.range.end);return{rangeLeft:t,rangeRight:e}}moveLeft(){if(this.range.start===this.range.end)this.dMove(-1);else{const{rangeLeft:t}=this.getSortedRange();this.setRange({start:t,end:t})}}getMaxRange(){const t=this.editor.textEditor.getTextGraphics();return t?t.getContentLength():1/0}moveRight(){if(this.range.start===this.range.end)this.getMaxRange()>this.range.end&&this.dMove(1);else{const{rangeRight:t}=this.getSortedRange();this.setRange({start:t,end:t})}}dMove(t){const e=Math.max(0,this.range.start+t),r=Math.max(0,this.range.end+t);this.setRange({start:e,end:r})}moveRangeEnd(t){const e=this.getMaxRange(),r=this.range.end+t;e+1>r&&r>=0&&this.setRange({start:this.range.start,end:r})}setRangeEnd(t){const e=t-this.range.end;this.moveRangeEnd(e)}getCursorLinePos(t){const e=t.getGlyphs(),r=this.getRange(),{height:s}=t.getContentMetrics(),c=(e[r.start]??{position:{x:0,y:0}}).position,u=t.getWorldTransform(),g=Ar(u,c),y=this.editor.toViewportPt(g.x,g.y),x=Ar(u,{x:c.x,y:c.y+s}),C=this.editor.toViewportPt(x.x,x.y);let A=null;if(r.end!==r.start){const F=(e[r.end]??{position:{x:0,y:0}}).position,R=Ar(u,F);A=this.editor.toViewportPt(R.x,R.y)}return{topInViewport:y,bottomInViewport:C,rightInViewport:A}}draw(t,e,r,s){const{ctx:o}=t,c=this.editor.setting.get("textEditorCursorLineStroke"),u=this.editor.setting.get("textEditorCursorSize");if(o.save(),!s)o.beginPath(),o.moveTo(e.x,e.y),o.lineTo(r.x,r.y),o.closePath(),o.lineWidth=u,o.strokeStyle=c,o.stroke();else{const g=this.editor.setting.get("textEditorSelectionFill");o.beginPath(),o.moveTo(e.x,e.y),o.lineTo(r.x,r.y);const y=r.x-e.x,x=r.y-e.y,C={x:s.x+y,y:s.y+x};o.lineTo(C.x,C.y),o.lineTo(s.x,s.y),o.closePath(),o.fillStyle=g,o.fill()}o.restore()}}const Pf={position:"fixed",width:"1px",zIndex:"-1",margin:0,padding:0,border:0,outline:0,opacity:0};class kc{constructor(t){S(this,"inputDom");S(this,"textGraphics",null);S(this,"rangeManager");S(this,"_active",!1);S(this,"transaction");this.editor=t,this.rangeManager=new _c(t),this.inputDom=this.createInputDom(),this.inactive(),this.bindEvent(),t.containerElement.appendChild(this.inputDom)}createInputDom(){const t=document.createElement("input");return t.tabIndex=-1,Object.assign(t.style,Pf),t}isActive(){return this._active}active(t){this._active=!0,this.editor.controlHandleManager.enableTransformControl=!1,this.editor.selectedBox.enableDrawSizeIndicator=!1,this.transaction=new qt(this.editor);let e=t.textGraphics;if(!t.textGraphics){const r=this.editor.setting.get("defaultFontSize"),s=this.editor.setting.get("defaultFontFamily");e=new kr({objectName:"",content:"",fontSize:r,fontFamily:s,width:0,height:r,enableRichText:!1,enableMarkdown:!1},{advancedAttrs:t.pos,doc:this.editor.doc}),this.textGraphics=e,this.editor.sceneGraph.addItems([e]),this.editor.doc.getCurrCanvas().insertChild(e)}this.textGraphics=e,this.editor.selectedElements.setItems([e]),this.transaction.recordOld(e.attrs.id,{content:e.attrs.content,width:e.attrs.width}),t.range?this.rangeManager.setRange(t.range):this.rangeManager.setRange({start:0,end:this.textGraphics.getContentLength()}),this.inputDom.value=this.textGraphics.attrs.content||"",this.inputDom.focus(),this.inputDom.select(),this.editor.render()}inactive(){this._active&&(this._active=!1,this.editor.controlHandleManager.enableTransformControl=!0,this.editor.selectedBox.enableDrawSizeIndicator=!0,this.textGraphics&&(this.transaction.update(this.textGraphics.attrs.id,{content:this.textGraphics.attrs.content}),this.transaction.commit("Update Text"),this.textGraphics.attrs.content===""&&Co(this.editor,[this.textGraphics])),this.textGraphics=null,this.inputDom.blur(),this.editor.render())}drawRange(){}bindEvent(){const t=this.inputDom;let e="",r="",s="";t.addEventListener("input",g=>{if(!this.isActive()||!this.textGraphics)return;const x=g.target.value;if(g.isComposing){e=x;return}if(e){const{start:A,end:_}=this.rangeManager.getRange();r=this.textGraphics.attrs.content.slice(0,A),s=this.textGraphics.attrs.content.slice(_),this.textGraphics.updateAttrs({content:r+e+s}),this.rangeManager.setRange({start:r.length+e.length,end:r.length+e.length}),e="",r="",s="",this.editor.render();return}this.textGraphics.updateAttrs({content:x}),this.rangeManager.setRange({start:x.length,end:x.length}),this.editor.render()}),t.addEventListener("keydown",g=>{this.isActive()&&(g.key==="ArrowLeft"?(g.shiftKey?this.rangeManager.moveRangeEnd(-1):this.rangeManager.moveLeft(),this.editor.render()):g.key==="ArrowRight"?(g.shiftKey?this.rangeManager.moveRangeEnd(1):this.rangeManager.moveRight(),this.editor.render()):g.key==="a"&&(g.metaKey||g.ctrlKey)?this.textGraphics&&(this.rangeManager.setRange({start:0,end:this.textGraphics.getContentLength()}),this.editor.render()):g.key==="Escape"&&this.inactive())}),t.addEventListener("blur",()=>{this.inactive()}),t.addEventListener("compositionend",()=>{e="",r="",s=""});const o=g=>{if(!this.isActive()||this.editor.canvasDragger.isActive()||!this.textGraphics)return;const y=g.pos;if(!this.textGraphics.hitTest(y))return;g.nativeEvent.preventDefault();const x=this.textGraphics.getCursorIndex(y);this.rangeManager.setRange({start:x,end:x}),this.editor.render()},c=g=>{if(!this.isActive()||this.editor.canvasDragger.isActive()||!this.textGraphics)return;const y=g.pos,x=this.textGraphics.getCursorIndex(y);this.rangeManager.setRangeEnd(x),this.editor.render()},u=g=>{this.updateCursor(g.pos)};this.editor.mouseEventManager.on("start",o),this.editor.mouseEventManager.on("drag",c),this.editor.mouseEventManager.on("move",u),this.editor.mouseEventManager.on("end",u)}updateCursor(t){!this.textGraphics||!this.textGraphics.hitTest(t)?this.editor.cursorManager.setCursor("default"):this.editor.cursorManager.setCursor("text")}getTextGraphics(){return this.textGraphics}isEditorInputDom(t){return t===this.inputDom}destroy(){this.inputDom.remove()}}class Mf{constructor(t){S(this,"scrollX",0);S(this,"scrollY",0);S(this,"eventEmitter",new Le);this.editor=t}getViewport(){return{x:this.scrollX,y:this.scrollY,width:parseFloat(this.editor.canvasElement.style.width),height:parseFloat(this.editor.canvasElement.style.height)}}setViewport({x:t,y:e,width:r,height:s}){const o=this.scrollX,c=this.scrollY,u=eo();t!==void 0&&(this.scrollX=t),e!==void 0&&(this.scrollY=e),r!==void 0&&(this.editor.canvasElement.width=r*u,this.editor.canvasElement.style.width=r+"px"),s!==void 0&&(this.editor.canvasElement.height=s*u,this.editor.canvasElement.style.height=s+"px"),(o!==t||c!==e)&&this.eventEmitter.emit("xOrYChange",t,e)}getCenter(){const{x:t,y:e,width:r,height:s}=this.getViewport(),o=this.editor.zoomManager.getZoom();return{x:t+r/2/o,y:e+s/2/o}}translate(t,e){this.scrollX+=t,this.scrollY+=e,this.eventEmitter.emit("xOrYChange",this.scrollX,this.scrollY)}getBbox(){const{x:t,y:e,width:r,height:s}=this.getViewport(),o=this.editor.zoomManager.getZoom();return{minX:t,minY:e,maxX:t+r/o,maxY:e+s/o}}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}class Tf{constructor(t){S(this,"zoom",1);S(this,"eventEmitter",new Le);this.editor=t}getZoom(){return this.zoom}setZoom(t){const e=this.zoom,r=this.editor.setting.get("zoomMax");t>r&&(t=r);const s=this.editor.setting.get("zoomMin");t<s&&(t=s),this.zoom=t,Promise.resolve().then(()=>{this.eventEmitter.emit("zoomChange",t,e)})}setZoomAndUpdateViewport(t){const e=this.zoom;this.setZoom(t),this.adjustScroll(e)}zoomIn(t){const e=this.zoom;let r;if(t!=null&&t.isLevelZoom){const s=this.editor.setting.get("zoomLevels"),[,o]=Rc(s,e);r=o}else{const s=t!=null&&t.deltaY?this.deltaYToZoomStep(t.deltaY):this.editor.setting.get("zoomStep");r=Math.min(e*(1+s),this.editor.setting.get("zoomMax"))}this.setZoom(r),this.adjustScroll(e,t==null?void 0:t.center)}zoomOut(t){const e=this.zoom;let r;if(t!=null&&t.isLevelZoom){const s=this.editor.setting.get("zoomLevels"),[o]=Rc(s,e);r=o}else{const s=t!=null&&t.deltaY?this.deltaYToZoomStep(t.deltaY):this.editor.setting.get("zoomStep");r=Math.max(e/(1+s),this.editor.setting.get("zoomMin"))}this.setZoom(r),this.adjustScroll(e,t==null?void 0:t.center)}deltaYToZoomStep(t){return Math.max(.05,.12937973*Math.log(Math.abs(t))-.33227472)}reset(){this.setZoom(1);const t=this.editor.viewportManager,e=t.getViewport();t.setViewport({x:-e.width/2,y:-e.height/2})}zoomRectToFit(t,e){const{setting:r,viewportManager:s}=this.editor,o=r.get("zoomToFixPadding"),c=s.getViewport(),u=this.editor.setting.get("enableRuler")?this.editor.setting.get("rulerWidth"):0,g=z=>{const G=z-o*2-u;return G>0?G:z},y=g(c.height),x=g(c.width),C=x/y,A=t.width/t.height;let _=C>A?y/t.height:x/t.width;_=e?Math.min(_,e):_;const F=t.x-((c.width+u)/_-t.width)/2,R=t.y-((c.height+u)/_-t.height)/2;this.setZoom(_),s.setViewport({x:F,y:R})}zoomToSelection(){const t=this.editor.selectedElements.getBoundingRect();t?this.zoomRectToFit(t):this.zoomToFit()}zoomToGraphics(t){const e=Wn(t.getBbox());this.zoomRectToFit(e)}zoomToFit(t){const e=this.editor.getCanvasBbox();if(!e){this.reset();return}this.zoomRectToFit(Wn(e),t)}getCanvasCenter(){const{width:t,height:e}=this.editor.viewportManager.getViewport();return{x:t/2,y:e/2}}adjustScroll(t,e){const r=this.editor.viewportManager,s=this.zoom,{x:o,y:c}=r.getViewport();e||(e=this.getCanvasCenter());const{x:u,y:g}=ia(e.x,e.y,t,o,c),y=u-e.x/s,x=g-e.y/s;r.setViewport({x:y,y:x})}on(t,e){this.eventEmitter.on(t,e)}off(t,e){this.eventEmitter.off(t,e)}}const Rc=(i,t)=>{let e=0,r=i.length-1;for(;e<=r;){const s=Math.floor((e+r)/2);if(i[s]===t){r=s-1,e=s+1;break}else i[s]<t?e=s+1:r=s-1}return r<0&&(r=0),e>=i.length&&(e=i.length-1),[i[r],i[e]]};class Dc{constructor(t){this.ctx=t}get fillStyle(){return this.ctx.fillStyle}set fillStyle(t){this.ctx.fillStyle=t}get strokeStyle(){return this.ctx.strokeStyle}set strokeStyle(t){this.ctx.strokeStyle=t}get globalAlpha(){return this.ctx.globalAlpha}set globalAlpha(t){this.ctx.globalAlpha=t}get lineWidth(){return this.ctx.lineWidth}set lineWidth(t){this.ctx.lineWidth=t}get font(){return this.ctx.font}set font(t){this.ctx.font=t}get fontKerning(){return this.ctx.fontKerning}set fontKerning(t){t!==void 0&&(this.ctx.fontKerning=t)}get imageSmoothingEnabled(){return this.ctx.imageSmoothingEnabled}set imageSmoothingEnabled(t){t!==void 0&&(this.ctx.imageSmoothingEnabled=t)}save(){this.ctx.save()}restore(){this.ctx.restore()}setTransform(t,e,r,s,o,c){this.ctx.setTransform(t,e,r,s,o,c)}transform(t,e,r,s,o,c){this.ctx.transform(t,e,r,s,o,c)}translate(t,e){this.ctx.translate(t,e)}scale(t,e){this.ctx.scale(t,e)}getTransform(){return this.ctx.getTransform()}clearRect(t,e,r,s){this.ctx.clearRect(t,e,r,s)}fillRect(t,e,r,s){this.ctx.fillRect(t,e,r,s)}strokeRect(t,e,r,s){this.ctx.strokeRect(t,e,r,s)}beginPath(){this.ctx.beginPath()}closePath(){this.ctx.closePath()}moveTo(t,e){this.ctx.moveTo(t,e)}lineTo(t,e){this.ctx.lineTo(t,e)}rect(t,e,r,s){this.ctx.rect(t,e,r,s)}roundRect(t,e,r,s,o){this.ctx.roundRect?this.ctx.roundRect(t,e,r,s,o):this.rect(t,e,r,s)}ellipse(t,e,r,s,o,c,u){this.ctx.ellipse(t,e,r,s,o,c,u)}bezierCurveTo(t,e,r,s,o,c){this.ctx.bezierCurveTo(t,e,r,s,o,c)}fill(){this.ctx.fill()}stroke(){this.ctx.stroke()}clip(){this.ctx.clip()}fillText(t,e,r){this.ctx.fillText(t,e,r)}measureText(t){return this.ctx.measureText(t)}drawImage(t,...e){this.ctx.drawImage(t,...e)}getOriginalContext(){return this.ctx}clearBackground(t,e,r){this.ctx.save(),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,e,r),this.ctx.restore()}setViewportTransform(t,e,r,s){this.ctx.setTransform(1,0,0,1,0,0),this.ctx.scale(t*e,t*e),this.ctx.translate(r,s)}flush(){}}class Af{constructor(t,e){S(this,"surface");S(this,"canvas");S(this,"paint");S(this,"strokePaint");S(this,"canvasKit");S(this,"_fillStyle","#000000");S(this,"_strokeStyle","#000000");S(this,"_globalAlpha",1);S(this,"_lineWidth",1);S(this,"_font","10px sans-serif");S(this,"currentPath",null);S(this,"stateStack",[]);this.canvasKit=t,this.surface=e,this.canvas=e.getCanvas(),this.paint=new t.Paint,this.paint.setStyle(t.PaintStyle.Fill),this.paint.setAntiAlias(!0),this.strokePaint=new t.Paint,this.strokePaint.setStyle(t.PaintStyle.Stroke),this.strokePaint.setAntiAlias(!0),this.updateFillColor(),this.updateStrokeColor()}parseColor(t){if(t.startsWith("#")){const e=t.slice(1),r=parseInt(e.slice(0,2),16)/255,s=parseInt(e.slice(2,4),16)/255,o=parseInt(e.slice(4,6),16)/255;return this.canvasKit.Color4f(r,s,o,this._globalAlpha)}return t==="black"?this.canvasKit.BLACK:t==="white"?this.canvasKit.WHITE:this.canvasKit.Color4f(0,0,0,this._globalAlpha)}updateFillColor(){const t=this.parseColor(this._fillStyle);this.paint.setColor(t)}updateStrokeColor(){const t=this.parseColor(this._strokeStyle);this.strokePaint.setColor(t),this.strokePaint.setStrokeWidth(this._lineWidth)}get fillStyle(){return this._fillStyle}set fillStyle(t){typeof t=="string"&&(this._fillStyle=t,this.updateFillColor())}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){typeof t=="string"&&(this._strokeStyle=t,this.updateStrokeColor())}get globalAlpha(){return this._globalAlpha}set globalAlpha(t){this._globalAlpha=t,this.updateFillColor(),this.updateStrokeColor()}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth=t,this.updateStrokeColor()}get font(){return this._font}set font(t){this._font=t}get fontKerning(){return"auto"}set fontKerning(t){}get imageSmoothingEnabled(){return!0}set imageSmoothingEnabled(t){}save(){this.canvas.save(),this.stateStack.push({fillStyle:this._fillStyle,strokeStyle:this._strokeStyle,globalAlpha:this._globalAlpha,lineWidth:this._lineWidth,font:this._font})}restore(){this.canvas.restore();const t=this.stateStack.pop();t&&(this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle,this._globalAlpha=t.globalAlpha,this._lineWidth=t.lineWidth,this._font=t.font,this.updateFillColor(),this.updateStrokeColor())}setTransform(t,e,r,s,o,c){const u=new Float32Array([t,r,o,e,s,c,0,0,1]);this.canvas.concat(u)}transform(t,e,r,s,o,c){const u=new Float32Array([t,r,o,e,s,c,0,0,1]);this.canvas.concat(u)}translate(t,e){this.canvas.translate(t,e)}scale(t,e){this.canvas.scale(t,e)}getTransform(){return new DOMMatrix}clearRect(t,e,r,s){if(t===0&&e===0)this.canvas.clear(this.canvasKit.WHITE);else{const o=this.canvasKit.LTRBRect(t,e,t+r,e+s),c=new this.canvasKit.Paint;c.setColor(this.canvasKit.WHITE),c.setStyle(this.canvasKit.PaintStyle.Fill),this.canvas.drawRect(o,c),c.delete()}}clearBackground(t,e,r){const s=this.parseColor(t);this.canvas.clear(s)}setViewportTransform(t,e,r,s){this.canvas.resetMatrix(),this.canvas.scale(t*e,t*e),this.canvas.translate(r,s)}flush(){this.surface.flush()}fillRect(t,e,r,s){const o=this.canvasKit.LTRBRect(t,e,t+r,e+s);this.canvas.drawRect(o,this.paint),this.surface.flush()}strokeRect(t,e,r,s){const o=this.canvasKit.LTRBRect(t,e,t+r,e+s);this.canvas.drawRect(o,this.strokePaint),this.surface.flush()}beginPath(){this.currentPath&&this.currentPath.delete(),this.currentPath=new this.canvasKit.Path}closePath(){this.currentPath&&this.currentPath.close()}moveTo(t,e){this.currentPath||this.beginPath(),this.currentPath.moveTo(t,e)}lineTo(t,e){this.currentPath||this.beginPath(),this.currentPath.lineTo(t,e)}rect(t,e,r,s){const o=this.canvasKit.LTRBRect(t,e,t+r,e+s);this.canvas.drawRect(o,this.paint)}roundRect(t,e,r,s,o){const c=this.canvasKit.LTRBRect(t,e,t+r,e+s),u=Array.isArray(o)?o[0]:o,g=this.canvasKit.RRectXY(c,u,u);this.canvas.drawRRect(g,this.paint)}ellipse(t,e,r,s,o,c,u){const g=this.canvasKit.LTRBRect(t-r,e-s,t+r,e+s);this.canvas.drawOval(g,this.paint)}bezierCurveTo(t,e,r,s,o,c){this.currentPath||this.beginPath(),this.currentPath.bezierCurveTo(t,e,r,s,o,c)}fill(){this.currentPath&&this.canvas.drawPath(this.currentPath,this.paint),this.surface.flush()}stroke(){this.currentPath&&this.canvas.drawPath(this.currentPath,this.strokePaint),this.surface.flush()}clip(){if(this.currentPath){const t=this.canvasKit.LTRBRect(-1e4,-1e4,1e4,1e4);this.canvas.clipRect(t)}}fillText(t,e,r){try{const s=new this.canvasKit.ParagraphStyle({textStyle:{color:this.parseColor(this._fillStyle),fontSize:this.parseFontSize(this._font),fontFamilies:[this.parseFontFamily(this._font)]},textAlign:this.canvasKit.TextAlign.Left}),o=this.canvasKit.ParagraphBuilder.Make(s,null);o.addText(t);const c=o.build(),u=Math.max(200,t.length*10);c.layout(u),this.canvas.drawParagraph(c,e,r),c.delete(),o.delete()}catch(s){console.warn("CanvasKit fillText error:",s,"- usando fallback")}this.surface.flush()}measureText(t){try{const e=new this.canvasKit.ParagraphStyle({textStyle:{color:this.canvasKit.BLACK,fontSize:this.parseFontSize(this._font),fontFamilies:[this.parseFontFamily(this._font)]},textAlign:this.canvasKit.TextAlign.Left}),r=this.canvasKit.ParagraphBuilder.Make(e,null);r.addText(t);const s=r.build();s.layout(1e4);const o=s.getMaxIntrinsicWidth(),c=s.getHeight();return s.delete(),r.delete(),{width:o,actualBoundingBoxLeft:0,actualBoundingBoxRight:o,actualBoundingBoxAscent:c*.8,actualBoundingBoxDescent:c*.2,fontBoundingBoxAscent:c*.8,fontBoundingBoxDescent:c*.2,alphabeticBaseline:0,emHeightAscent:c*.8,emHeightDescent:c*.2,hangingBaseline:c*.8,ideographicBaseline:-c*.2}}catch(e){return console.warn("CanvasKit measureText error:",e),{width:t.length*8,actualBoundingBoxLeft:0,actualBoundingBoxRight:t.length*8,actualBoundingBoxAscent:12,actualBoundingBoxDescent:3,fontBoundingBoxAscent:12,fontBoundingBoxDescent:3,alphabeticBaseline:0,emHeightAscent:12,emHeightDescent:3,hangingBaseline:12,ideographicBaseline:-3}}}parseFontSize(t){const e=t.match(/(\d+)px/);return e?parseInt(e[1]):12}parseFontFamily(t){const e=t.split(" ");return e[e.length-1]||"sans-serif"}drawImage(t,...e){console.warn("CanvasKit drawImage: implementação futura"),this.surface.flush()}getOriginalContext(){return null}dispose(){this.currentPath&&this.currentPath.delete(),this.paint.delete(),this.strokePaint.delete(),this.surface.delete()}}class Fs{static async createRenderer(t,e={}){console.log("🔍 RendererFactory.createRenderer CHAMADO"),console.log("🔍 Canvas:",t),console.log("🔍 Config recebida:",e);const{enableGPU:r=!0,wasmUrl:s}=e;if(console.log("🔍 enableGPU:",r),r){console.log("🔍 Tentando CanvasKit...");try{const c=await this.tryCreateCanvasKit(t,s);if(c)return console.log("🚀 CanvasKit renderer ativo (GPU acelerado)"),c}catch(c){console.warn("⚠️ CanvasKit falhou, usando Canvas2D fallback:",c)}}else console.log("🔍 enableGPU é false, pulando CanvasKit");console.log("📦 Canvas2D renderer ativo (CPU)");const o=t.getContext("2d");if(!o)throw new Error("Não foi possível obter contexto 2D do canvas");return new Dc(o)}static async tryCreateCanvasKit(t,e){console.log("🔍 tryCreateCanvasKit: Iniciando...");const r=await this.loadCanvasKit(e);if(!r)return console.log("❌ tryCreateCanvasKit: canvasKit é null"),null;console.log("✅ tryCreateCanvasKit: CanvasKit carregado"),t.id||(t.id="suika-canvas-"+Date.now(),console.log("🔧 Canvas ID criado:",t.id)),document.getElementById(t.id)||(console.log("⚠️ Canvas não está no DOM ainda, aguardando..."),await new Promise(u=>requestAnimationFrame(u))),console.log("🔍 Canvas no DOM:",!!document.getElementById(t.id)),console.log("🔍 Canvas dimensões:",t.width,"x",t.height),console.log("🔍 tryCreateCanvasKit: Verificando WebGL...");const o=t.getContext("webgl")||t.getContext("experimental-webgl");if(o){console.log("✅ WebGL context disponível");const u=o.getExtension("WEBGL_lose_context");u&&u.loseContext()}else console.log("⚠️ WebGL context não disponível, forçando software rendering");let c=null;if(o){console.log("🔍 tryCreateCanvasKit: Tentando MakeCanvasSurface com ID...");try{c=r.MakeCanvasSurface(t.id),c&&console.log("✅ tryCreateCanvasKit: WebGL surface criada com ID")}catch(u){console.log("⚠️ tryCreateCanvasKit: MakeCanvasSurface com ID falhou:",u)}}else if(console.log("🔧 WebGL indisponível, usando apenas software rendering"),r.MakeSWCanvasSurface)try{c=r.MakeSWCanvasSurface(t),c&&console.log("✅ tryCreateCanvasKit: Software surface criada com elemento")}catch(u){console.log("❌ tryCreateCanvasKit: Software com elemento falhou:",u)}if(!c){console.log("🔍 tryCreateCanvasKit: Tentando MakeCanvasSurface com elemento...");try{c=r.MakeCanvasSurface(t),c&&console.log("✅ tryCreateCanvasKit: WebGL surface criada com elemento")}catch(u){console.log("⚠️ tryCreateCanvasKit: MakeCanvasSurface com elemento falhou:",u)}}if(!c){if(console.log("🔍 tryCreateCanvasKit: Tentando todas as alternativas..."),o)try{c=r.MakeCanvasSurface(t),c&&console.log("✅ tryCreateCanvasKit: WebGL surface criada com elemento")}catch(u){console.log("⚠️ tryCreateCanvasKit: WebGL com elemento falhou:",u)}if(!c&&r.MakeSWCanvasSurface){console.log("🔍 tryCreateCanvasKit: Tentando software rendering como último recurso...");try{c=r.MakeSWCanvasSurface(t),c&&console.log("✅ tryCreateCanvasKit: Software surface criada com elemento")}catch(u){console.log("❌ tryCreateCanvasKit: Software rendering falhou:",u)}}}if(!c)throw new Error("Não foi possível criar surface CanvasKit (WebGL e Software falharam)");return console.log("🚀 tryCreateCanvasKit: Criando CanvasKitRenderer..."),new Af(r,c)}static async loadCanvasKit(t){if(this.canvasKitCache)return this.canvasKitCache;if(this.canvasKitLoadPromise)return this.canvasKitLoadPromise;this.canvasKitLoadPromise=this.doLoadCanvasKit(t);try{return this.canvasKitCache=await this.canvasKitLoadPromise,this.canvasKitCache}catch(e){throw this.canvasKitLoadPromise=null,e}}static async doLoadCanvasKit(t){console.log("🔍 doLoadCanvasKit: Iniciando carregamento...");try{console.log("🔍 doLoadCanvasKit: Importando canvaskit-wasm...");const e=await Promise.resolve().then(()=>If);console.log("✅ doLoadCanvasKit: Import bem-sucedido"),console.log("🔍 doLoadCanvasKit: Inicializando CanvasKit...");const r=t?await e.default({locateFile:s=>t.replace("canvaskit.js",s)}):await e.default({locateFile:s=>{if(console.log("🔍 CanvasKit locateFile chamado para:",s),s.endsWith(".wasm")){const o=`/canvaskit/${s}`;return console.log("🎯 WASM URL configurada:",o),o}return s}});return console.log("✅ CanvasKit carregado e inicializado com sucesso"),console.log("🔍 CanvasKit features:",{MakeCanvasSurface:!!r.MakeCanvasSurface,MakeSWCanvasSurface:!!r.MakeSWCanvasSurface,ParagraphBuilder:!!r.ParagraphBuilder}),r}catch(e){throw console.error("❌ Erro ao carregar CanvasKit:",e),e}}static async isCanvasKitAvailable(){try{return await this.loadCanvasKit(),!0}catch{return!1}}static createCanvas2DRenderer(t){const e=t.getContext("2d");if(!e)throw new Error("Não foi possível obter contexto 2D do canvas");return console.log("🔧 Canvas2D renderer forçado"),new Dc(e)}static clearCache(){this.canvasKitCache=null,this.canvasKitLoadPromise=null}}S(Fs,"canvasKitCache",null),S(Fs,"canvasKitLoadPromise",null);class Ef{constructor(t){S(this,"containerElement");S(this,"canvasElement");S(this,"ctx");S(this,"renderer");S(this,"appVersion","suika-editor_0.0.2");S(this,"paperId");S(this,"emitter",new Le);S(this,"doc");S(this,"sceneGraph");S(this,"controlHandleManager");S(this,"setting");S(this,"viewportManager");S(this,"canvasDragger");S(this,"toolManager");S(this,"commandManager");S(this,"zoomManager");S(this,"imgManager");S(this,"cursorManager");S(this,"mouseEventManager");S(this,"keybindingManager");S(this,"hostEventManager");S(this,"clipboard");S(this,"selectedElements");S(this,"selectedBox");S(this,"ruler");S(this,"refLine");S(this,"textEditor");S(this,"pathEditor");S(this,"perfMonitor");this.containerElement=t.containerElement,this.canvasElement=document.createElement("canvas"),this.containerElement.appendChild(this.canvasElement),this.ctx=this.canvasElement.getContext("2d"),console.log("🔍 SuikaEditor constructor - options.canvasKit:",t.canvasKit),this.initializeRenderer(t.canvasKit),this.setting=new bf(t.userPreference),t.offsetX&&this.setting.set("offsetX",t.offsetX),t.offsetY&&this.setting.set("offsetY",t.offsetY),this.mouseEventManager=new $u(this),this.keybindingManager=new tf(this),this.keybindingManager.bindEvent(),this.doc=new Ja({id:"0-0",objectName:"Document",width:0,height:0}),this.doc.setEditor(this),this.sceneGraph=new xf(this),this.cursorManager=new Ju(this),this.viewportManager=new Mf(this),this.commandManager=new aa(this),this.zoomManager=new Tf(this),this.imgManager=new Zu,this.selectedElements=new Cf(this),this.selectedBox=new Sf(this),this.ruler=new yf(this),this.refLine=new Br(this),this.controlHandleManager=new bu(this),this.controlHandleManager.bindEvents(),this.textEditor=new kc(this),this.pathEditor=new Po(this),this.hostEventManager=new Ku(this),this.hostEventManager.bindHotkeys(),this.canvasDragger=new ju(this),this.toolManager=new uf(this),this.clipboard=new Nu(this),this.clipboard.bindEvents(),this.imgManager.on("added",()=>{this.render()}),this.paperId=Pi();const e=new ii({objectName:"Canvas",width:0,height:0},{doc:this.doc});this.sceneGraph.addItems([e]),this.viewportManager.setViewport({x:-t.width/2,y:-t.height/2,width:t.width,height:t.height}),this.perfMonitor=new mf,t.showPerfMonitor&&this.perfMonitor.start(this.containerElement),Promise.resolve().then(()=>{this.render()})}setContents(t){if(this.sceneGraph.load(t.data),this.commandManager.clearRecords(),this.paperId=t.paperId??Pi(),!this.doc.getCurrCanvas()){const e=new ii({objectName:"Canvas",width:0,height:0},{doc:this.doc});this.sceneGraph.addItems([e])}this.zoomManager.zoomToFit(1)}destroy(){this.containerElement.removeChild(this.canvasElement),this.textEditor.destroy(),this.keybindingManager.destroy(),this.hostEventManager.destroy(),this.clipboard.destroy(),this.canvasDragger.destroy(),this.toolManager.unbindEvent(),this.toolManager.destroy(),this.perfMonitor.destroy(),this.controlHandleManager.unbindEvents(),this.emitter.emit("destroy")}setCursor(t){this.cursorManager.setCursor(t)}getCursor(){return this.cursorManager.getCursor()}toScenePt(t,e,r=!1){const s=this.zoomManager.getZoom(),{x:o,y:c}=this.viewportManager.getViewport();return ia(t,e,s,o,c,r)}toViewportPt(t,e){const r=this.zoomManager.getZoom(),{x:s,y:o}=this.viewportManager.getViewport();return Dd(t,e,r,s,o)}toSceneSize(t){const e=this.zoomManager.getZoom();return t/e}toViewportSize(t){const e=this.zoomManager.getZoom();return t*e}getCursorXY(t){return{x:t.clientX-this.setting.get("offsetX"),y:t.clientY-this.setting.get("offsetY")}}getSceneCursorXY(t,e=!1){const{x:r,y:s}=this.getCursorXY(t);return this.toScenePt(r,s,e)}render(){this.sceneGraph.render()}getCanvasBbox(){const e=this.doc.getCurrCanvas().getChildren().filter(r=>r.isVisible());return e.length===0?null:On(e.map(r=>r.getBbox()))}applyChanges(t){const e=[];for(const[,r]of t.added)e.push(r);this.sceneGraph.load(e,!0);for(const[r,s]of t.update){const o=this.doc.getGraphicsById(r);if(!o){console.warn(`graphics ${r} is not exist`);continue}o.updateAttrs(s)}for(const r of t.deleted){const s=this.doc.getGraphicsById(r);if(!s){console.warn(`graphics ${r} is not exist`);continue}s.setDeleted(!0),s.removeFromParent()}}async initializeRenderer(t){console.log("🔍 initializeRenderer CHAMADO com config:",t);try{console.log("🔍 initializeRenderer: Chamando RendererFactory.createRenderer..."),this.renderer=await Fs.createRenderer(this.canvasElement,t),console.log("🎨 Sistema de renderização inicializado:",this.renderer.constructor.name),this.testRendererBasics()}catch(e){console.error("❌ Erro ao inicializar renderer:",e),console.log("🔄 Criando fallback Canvas2D..."),this.renderer=Fs.createCanvas2DRenderer(this.canvasElement),console.log("🔄 Fallback Canvas2D criado")}}testRendererBasics(){if(this.renderer)try{this.renderer.beginPath(),this.renderer.moveTo(10,10),this.renderer.lineTo(50,50),this.renderer.font="16px Arial",this.renderer.fillStyle="#333333",console.log("✅ Renderer operations básicas funcionando")}catch(t){console.warn("⚠️ Erro nos testes básicos do renderer:",t)}}on(t,e){this.emitter.on(t,e)}off(t,e){this.emitter.off(t,e)}}var Bc={exports:{}};const Fc=Xc(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));(function(i,t){var e=(()=>{var r=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0;return typeof __filename<"u"&&(r=r||__filename),function(s={}){var o=s,c,u;o.ready=new Promise((n,a)=>{c=n,u=a}),function(n){n.Td=n.Td||[],n.Td.push(function(){n.MakeSWCanvasSurface=function(a){var h=a,f=typeof OffscreenCanvas<"u"&&h instanceof OffscreenCanvas;if(!(typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||f||(h=document.getElementById(a),h)))throw"Canvas with id "+a+" was not found";return(a=n.MakeSurface(h.width,h.height))&&(a.Ld=h),a},n.MakeCanvasSurface||(n.MakeCanvasSurface=n.MakeSWCanvasSurface),n.MakeSurface=function(a,h){var f={width:a,height:h,colorType:n.ColorType.RGBA_8888,alphaType:n.AlphaType.Unpremul,colorSpace:n.ColorSpace.SRGB},v=a*h*4,M=n._malloc(v);return(f=n.Surface._makeRasterDirect(f,M,4*a))&&(f.Ld=null,f.Hf=a,f.Df=h,f.Ff=v,f.bf=M,f.getCanvas().clear(n.TRANSPARENT)),f},n.MakeRasterDirectSurface=function(a,h,f){return n.Surface._makeRasterDirect(a,h.byteOffset,f)},n.Surface.prototype.flush=function(a){if(n.Md(this.Kd),this._flush(),this.Ld){var h=new Uint8ClampedArray(n.HEAPU8.buffer,this.bf,this.Ff);h=new ImageData(h,this.Hf,this.Df),a?this.Ld.getContext("2d").putImageData(h,0,0,a[0],a[1],a[2]-a[0],a[3]-a[1]):this.Ld.getContext("2d").putImageData(h,0,0)}},n.Surface.prototype.dispose=function(){this.bf&&n._free(this.bf),this.delete()},n.Md=n.Md||function(){},n.Te=n.Te||function(){return null}})}(o),function(n){n.Td=n.Td||[],n.Td.push(function(){function a(T,E,H){return T&&T.hasOwnProperty(E)?T[E]:H}function h(T){var E=en(_e);return _e[E]=T,E}function f(T){return T.naturalHeight||T.videoHeight||T.displayHeight||T.height}function v(T){return T.naturalWidth||T.videoWidth||T.displayWidth||T.width}function M(T,E,H,et){return T.bindTexture(T.TEXTURE_2D,E),et||H.alphaType!==n.AlphaType.Premul||T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),E}function B(T,E,H){H||E.alphaType!==n.AlphaType.Premul||T.pixelStorei(T.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),T.bindTexture(T.TEXTURE_2D,null)}n.GetWebGLContext=function(T,E){if(!T)throw"null canvas passed into makeWebGLContext";var H={alpha:a(E,"alpha",1),depth:a(E,"depth",1),stencil:a(E,"stencil",8),antialias:a(E,"antialias",0),premultipliedAlpha:a(E,"premultipliedAlpha",1),preserveDrawingBuffer:a(E,"preserveDrawingBuffer",0),preferLowPowerToHighPerformance:a(E,"preferLowPowerToHighPerformance",0),failIfMajorPerformanceCaveat:a(E,"failIfMajorPerformanceCaveat",0),enableExtensionsByDefault:a(E,"enableExtensionsByDefault",1),explicitSwapControl:a(E,"explicitSwapControl",0),renderViaOffscreenBackBuffer:a(E,"renderViaOffscreenBackBuffer",0)};if(H.majorVersion=E&&E.majorVersion?E.majorVersion:typeof WebGL2RenderingContext<"u"?2:1,H.explicitSwapControl)throw"explicitSwapControl is not supported";return T=Ji(T,H),T?(Sr(T),St.fe.getExtension("WEBGL_debug_renderer_info"),T):0},n.deleteContext=function(T){St===Xe[T]&&(St=null),typeof JSEvents=="object"&&JSEvents.ug(Xe[T].fe.canvas),Xe[T]&&Xe[T].fe.canvas&&(Xe[T].fe.canvas.zf=void 0),Xe[T]=null},n._setTextureCleanup({deleteTexture:function(T,E){var H=_e[E];H&&Xe[T].fe.deleteTexture(H),_e[E]=null}}),n.MakeWebGLContext=function(T){if(!this.Md(T))return null;var E=this._MakeGrContext();if(!E)return null;E.Kd=T;var H=E.delete.bind(E);return E.delete=(function(){n.Md(this.Kd),H()}).bind(E),St.ff=E},n.MakeGrContext=n.MakeWebGLContext,n.GrDirectContext.prototype.getResourceCacheLimitBytes=function(){n.Md(this.Kd),this._getResourceCacheLimitBytes()},n.GrDirectContext.prototype.getResourceCacheUsageBytes=function(){n.Md(this.Kd),this._getResourceCacheUsageBytes()},n.GrDirectContext.prototype.releaseResourcesAndAbandonContext=function(){n.Md(this.Kd),this._releaseResourcesAndAbandonContext()},n.GrDirectContext.prototype.setResourceCacheLimitBytes=function(T){n.Md(this.Kd),this._setResourceCacheLimitBytes(T)},n.MakeOnScreenGLSurface=function(T,E,H,et,ot,ft){return!this.Md(T.Kd)||(E=ot===void 0||ft===void 0?this._MakeOnScreenGLSurface(T,E,H,et):this._MakeOnScreenGLSurface(T,E,H,et,ot,ft),!E)?null:(E.Kd=T.Kd,E)},n.MakeRenderTarget=function(){var T=arguments[0];if(!this.Md(T.Kd))return null;if(arguments.length===3){var E=this._MakeRenderTargetWH(T,arguments[1],arguments[2]);if(!E)return null}else if(arguments.length===2){if(E=this._MakeRenderTargetII(T,arguments[1]),!E)return null}else return null;return E.Kd=T.Kd,E},n.MakeWebGLCanvasSurface=function(T,E,H){E=E||null;var et=T,ot=typeof OffscreenCanvas<"u"&&et instanceof OffscreenCanvas;if(!(typeof HTMLCanvasElement<"u"&&et instanceof HTMLCanvasElement||ot||(et=document.getElementById(T),et)))throw"Canvas with id "+T+" was not found";if(T=this.GetWebGLContext(et,H),!T||0>T)throw"failed to create webgl context: err "+T;return T=this.MakeWebGLContext(T),E=this.MakeOnScreenGLSurface(T,et.width,et.height,E),E||(E=et.cloneNode(!0),et.parentNode.replaceChild(E,et),E.classList.add("ck-replaced"),n.MakeSWCanvasSurface(E))},n.MakeCanvasSurface=n.MakeWebGLCanvasSurface,n.Surface.prototype.makeImageFromTexture=function(T,E){return n.Md(this.Kd),T=h(T),(E=this._makeImageFromTexture(this.Kd,T,E))&&(E.Le=T),E},n.Surface.prototype.makeImageFromTextureSource=function(T,E,H){E||(E={height:f(T),width:v(T),colorType:n.ColorType.RGBA_8888,alphaType:H?n.AlphaType.Premul:n.AlphaType.Unpremul}),E.colorSpace||(E.colorSpace=n.ColorSpace.SRGB),n.Md(this.Kd);var et=St.fe;return H=M(et,et.createTexture(),E,H),St.version===2?et.texImage2D(et.TEXTURE_2D,0,et.RGBA,E.width,E.height,0,et.RGBA,et.UNSIGNED_BYTE,T):et.texImage2D(et.TEXTURE_2D,0,et.RGBA,et.RGBA,et.UNSIGNED_BYTE,T),B(et,E),this._resetContext(),this.makeImageFromTexture(H,E)},n.Surface.prototype.updateTextureFromSource=function(T,E,H){if(T.Le){n.Md(this.Kd);var et=T.getImageInfo(),ot=St.fe,ft=M(ot,_e[T.Le],et,H);St.version===2?ot.texImage2D(ot.TEXTURE_2D,0,ot.RGBA,v(E),f(E),0,ot.RGBA,ot.UNSIGNED_BYTE,E):ot.texImage2D(ot.TEXTURE_2D,0,ot.RGBA,ot.RGBA,ot.UNSIGNED_BYTE,E),B(ot,et,H),this._resetContext(),_e[T.Le]=null,T.Le=h(ft),et.colorSpace=T.getColorSpace(),E=this._makeImageFromTexture(this.Kd,T.Le,et),H=T.Jd.Rd,ot=T.Jd.Yd,T.Jd.Rd=E.Jd.Rd,T.Jd.Yd=E.Jd.Yd,E.Jd.Rd=H,E.Jd.Yd=ot,E.delete(),et.colorSpace.delete()}},n.MakeLazyImageFromTextureSource=function(T,E,H){E||(E={height:f(T),width:v(T),colorType:n.ColorType.RGBA_8888,alphaType:H?n.AlphaType.Premul:n.AlphaType.Unpremul}),E.colorSpace||(E.colorSpace=n.ColorSpace.SRGB);var et={makeTexture:function(){var ot=St,ft=ot.fe,K=M(ft,ft.createTexture(),E,H);return ot.version===2?ft.texImage2D(ft.TEXTURE_2D,0,ft.RGBA,E.width,E.height,0,ft.RGBA,ft.UNSIGNED_BYTE,T):ft.texImage2D(ft.TEXTURE_2D,0,ft.RGBA,ft.RGBA,ft.UNSIGNED_BYTE,T),B(ft,E,H),h(K)},freeSrc:function(){}};return T.constructor.name==="VideoFrame"&&(et.freeSrc=function(){T.close()}),n.Image._makeFromGenerator(E,et)},n.Md=function(T){return T?Sr(T):!1},n.Te=function(){return St&&St.ff&&!St.ff.isDeleted()?St.ff:null}})}(o),function(n){function a(d,l,m,b,D){for(var O=0;O<d.length;O++)l[O*m+(O*D+b+m)%m]=d[O];return l}function h(d){for(var l=d*d,m=Array(l);l--;)m[l]=l%(d+1)===0?1:0;return m}function f(d){return d?d.constructor===Float32Array&&d.length===4:!1}function v(d){return(T(255*d[3])<<24|T(255*d[0])<<16|T(255*d[1])<<8|T(255*d[2])<<0)>>>0}function M(d){if(d&&d._ck)return d;if(d instanceof Float32Array){for(var l=Math.floor(d.length/4),m=new Uint32Array(l),b=0;b<l;b++)m[b]=v(d.slice(4*b,4*(b+1)));return m}if(d instanceof Uint32Array)return d;if(d instanceof Array&&d[0]instanceof Float32Array)return d.map(v)}function B(d){if(d===void 0)return 1;var l=parseFloat(d);return d&&d.indexOf("%")!==-1?l/100:l}function T(d){return Math.round(Math.max(0,Math.min(d||0,255)))}function E(d,l){l&&l._ck||n._free(d)}function H(d,l,m){if(!d||!d.length)return Ft;if(d&&d._ck)return d.byteOffset;var b=n[l].BYTES_PER_ELEMENT;return m||(m=n._malloc(d.length*b)),n[l].set(d,m/b),m}function et(d){var l={be:Ft,count:d.length,colorType:n.ColorType.RGBA_F32};if(d instanceof Float32Array)l.be=H(d,"HEAPF32"),l.count=d.length/4;else if(d instanceof Uint32Array)l.be=H(d,"HEAPU32"),l.colorType=n.ColorType.RGBA_8888;else if(d instanceof Array){if(d&&d.length){for(var m=n._malloc(16*d.length),b=0,D=m/4,O=0;O<d.length;O++)for(var q=0;4>q;q++)n.HEAPF32[D+b]=d[O][q],b++;d=m}else d=Ft;l.be=d}else throw"Invalid argument to copyFlexibleColorArray, Not a color array "+typeof d;return l}function ot(d){if(!d)return Ft;var l=Mo.toTypedArray();if(d.length){if(d.length===6||d.length===9)return H(d,"HEAPF32",Cr),d.length===6&&n.HEAPF32.set(Uf,6+Cr/4),Cr;if(d.length===16)return l[0]=d[0],l[1]=d[1],l[2]=d[3],l[3]=d[4],l[4]=d[5],l[5]=d[7],l[6]=d[12],l[7]=d[13],l[8]=d[15],Cr;throw"invalid matrix size"}if(d.m11===void 0)throw"invalid matrix argument";return l[0]=d.m11,l[1]=d.m21,l[2]=d.m41,l[3]=d.m12,l[4]=d.m22,l[5]=d.m42,l[6]=d.m14,l[7]=d.m24,l[8]=d.m44,Cr}function ft(d){if(!d)return Ft;var l=To.toTypedArray();if(d.length){if(d.length!==16&&d.length!==6&&d.length!==9)throw"invalid matrix size";return d.length===16?H(d,"HEAPF32",xi):(l.fill(0),l[0]=d[0],l[1]=d[1],l[3]=d[2],l[4]=d[3],l[5]=d[4],l[7]=d[5],l[10]=1,l[12]=d[6],l[13]=d[7],l[15]=d[8],d.length===6&&(l[12]=0,l[13]=0,l[15]=1),xi)}if(d.m11===void 0)throw"invalid matrix argument";return l[0]=d.m11,l[1]=d.m21,l[2]=d.m31,l[3]=d.m41,l[4]=d.m12,l[5]=d.m22,l[6]=d.m32,l[7]=d.m42,l[8]=d.m13,l[9]=d.m23,l[10]=d.m33,l[11]=d.m43,l[12]=d.m14,l[13]=d.m24,l[14]=d.m34,l[15]=d.m44,xi}function K(d,l){return H(d,"HEAPF32",l||Qr)}function yt(d,l,m,b){var D=Ao.toTypedArray();return D[0]=d,D[1]=l,D[2]=m,D[3]=b,Qr}function It(d){for(var l=new Float32Array(4),m=0;4>m;m++)l[m]=n.HEAPF32[d/4+m];return l}function Et(d,l){return H(d,"HEAPF32",l||ue)}function Je(d,l){return H(d,"HEAPF32",l||_o)}function be(){for(var d=0,l=0;l<arguments.length-1;l+=2)d+=arguments[l]*arguments[l+1];return d}function Qi(d,l,m){for(var b=Array(d.length),D=0;D<m;D++)for(var O=0;O<m;O++){for(var q=0,ct=0;ct<m;ct++)q+=d[m*D+ct]*l[m*ct+O];b[D*m+O]=q}return b}function qi(d,l){for(var m=Qi(l[0],l[1],d),b=2;b<l.length;)m=Qi(m,l[b],d),b++;return m}n.Color=function(d,l,m,b){return b===void 0&&(b=1),n.Color4f(T(d)/255,T(l)/255,T(m)/255,b)},n.ColorAsInt=function(d,l,m,b){return b===void 0&&(b=255),(T(b)<<24|T(d)<<16|T(l)<<8|T(m)<<0&268435455)>>>0},n.Color4f=function(d,l,m,b){return b===void 0&&(b=1),Float32Array.of(d,l,m,b)},Object.defineProperty(n,"TRANSPARENT",{get:function(){return n.Color4f(0,0,0,0)}}),Object.defineProperty(n,"BLACK",{get:function(){return n.Color4f(0,0,0,1)}}),Object.defineProperty(n,"WHITE",{get:function(){return n.Color4f(1,1,1,1)}}),Object.defineProperty(n,"RED",{get:function(){return n.Color4f(1,0,0,1)}}),Object.defineProperty(n,"GREEN",{get:function(){return n.Color4f(0,1,0,1)}}),Object.defineProperty(n,"BLUE",{get:function(){return n.Color4f(0,0,1,1)}}),Object.defineProperty(n,"YELLOW",{get:function(){return n.Color4f(1,1,0,1)}}),Object.defineProperty(n,"CYAN",{get:function(){return n.Color4f(0,1,1,1)}}),Object.defineProperty(n,"MAGENTA",{get:function(){return n.Color4f(1,0,1,1)}}),n.getColorComponents=function(d){return[Math.floor(255*d[0]),Math.floor(255*d[1]),Math.floor(255*d[2]),d[3]]},n.parseColorString=function(d,l){if(d=d.toLowerCase(),d.startsWith("#")){switch(l=255,d.length){case 9:l=parseInt(d.slice(7,9),16);case 7:var m=parseInt(d.slice(1,3),16),b=parseInt(d.slice(3,5),16),D=parseInt(d.slice(5,7),16);break;case 5:l=17*parseInt(d.slice(4,5),16);case 4:m=17*parseInt(d.slice(1,2),16),b=17*parseInt(d.slice(2,3),16),D=17*parseInt(d.slice(3,4),16)}return n.Color(m,b,D,l/255)}return d.startsWith("rgba")?(d=d.slice(5,-1),d=d.split(","),n.Color(+d[0],+d[1],+d[2],B(d[3]))):d.startsWith("rgb")?(d=d.slice(4,-1),d=d.split(","),n.Color(+d[0],+d[1],+d[2],B(d[3]))):d.startsWith("gray(")||d.startsWith("hsl")||!l||(d=l[d],d===void 0)?n.BLACK:d},n.multiplyByAlpha=function(d,l){return d=d.slice(),d[3]=Math.max(0,Math.min(d[3]*l,1)),d},n.Malloc=function(d,l){var m=n._malloc(l*d.BYTES_PER_ELEMENT);return{_ck:!0,length:l,byteOffset:m,qe:null,subarray:function(b,D){return b=this.toTypedArray().subarray(b,D),b._ck=!0,b},toTypedArray:function(){return this.qe&&this.qe.length?this.qe:(this.qe=new d(n.HEAPU8.buffer,m,l),this.qe._ck=!0,this.qe)}}},n.Free=function(d){n._free(d.byteOffset),d.byteOffset=Ft,d.toTypedArray=null,d.qe=null};var Cr=Ft,Mo,xi=Ft,To,Qr=Ft,Ao,Pn,ue=Ft,Oc,br=Ft,Gc,Eo=Ft,zc,Io=Ft,Gs,Zi=Ft,Kc,_o=Ft,$c,jc=Ft,Uf=Float32Array.of(0,0,1),Ft=0;n.onRuntimeInitialized=function(){function d(l,m,b,D,O,q,ct){q||(q=4*D.width,D.colorType===n.ColorType.RGBA_F16?q*=2:D.colorType===n.ColorType.RGBA_F32&&(q*=4));var Ct=q*D.height,xt=O?O.byteOffset:n._malloc(Ct);if(ct?!l._readPixels(D,xt,q,m,b,ct):!l._readPixels(D,xt,q,m,b))return O||n._free(xt),null;if(O)return O.toTypedArray();switch(D.colorType){case n.ColorType.RGBA_8888:case n.ColorType.RGBA_F16:l=new Uint8Array(n.HEAPU8.buffer,xt,Ct).slice();break;case n.ColorType.RGBA_F32:l=new Float32Array(n.HEAPU8.buffer,xt,Ct).slice();break;default:return null}return n._free(xt),l}Ao=n.Malloc(Float32Array,4),Qr=Ao.byteOffset,To=n.Malloc(Float32Array,16),xi=To.byteOffset,Mo=n.Malloc(Float32Array,9),Cr=Mo.byteOffset,Kc=n.Malloc(Float32Array,12),_o=Kc.byteOffset,$c=n.Malloc(Float32Array,12),jc=$c.byteOffset,Pn=n.Malloc(Float32Array,4),ue=Pn.byteOffset,Oc=n.Malloc(Float32Array,4),br=Oc.byteOffset,Gc=n.Malloc(Float32Array,3),Eo=Gc.byteOffset,zc=n.Malloc(Float32Array,3),Io=zc.byteOffset,Gs=n.Malloc(Int32Array,4),Zi=Gs.byteOffset,n.ColorSpace.SRGB=n.ColorSpace._MakeSRGB(),n.ColorSpace.DISPLAY_P3=n.ColorSpace._MakeDisplayP3(),n.ColorSpace.ADOBE_RGB=n.ColorSpace._MakeAdobeRGB(),n.GlyphRunFlags={IsWhiteSpace:n._GlyphRunFlags_isWhiteSpace},n.Path.MakeFromCmds=function(l){var m=H(l,"HEAPF32"),b=n.Path._MakeFromCmds(m,l.length);return E(m,l),b},n.Path.MakeFromVerbsPointsWeights=function(l,m,b){var D=H(l,"HEAPU8"),O=H(m,"HEAPF32"),q=H(b,"HEAPF32"),ct=n.Path._MakeFromVerbsPointsWeights(D,l.length,O,m.length,q,b&&b.length||0);return E(D,l),E(O,m),E(q,b),ct},n.Path.prototype.addArc=function(l,m,b){return l=Et(l),this._addArc(l,m,b),this},n.Path.prototype.addCircle=function(l,m,b,D){return this._addCircle(l,m,b,!!D),this},n.Path.prototype.addOval=function(l,m,b){return b===void 0&&(b=1),l=Et(l),this._addOval(l,!!m,b),this},n.Path.prototype.addPath=function(){var l=Array.prototype.slice.call(arguments),m=l[0],b=!1;if(typeof l[l.length-1]=="boolean"&&(b=l.pop()),l.length===1)this._addPath(m,1,0,0,0,1,0,0,0,1,b);else if(l.length===2)l=l[1],this._addPath(m,l[0],l[1],l[2],l[3],l[4],l[5],l[6]||0,l[7]||0,l[8]||1,b);else if(l.length===7||l.length===10)this._addPath(m,l[1],l[2],l[3],l[4],l[5],l[6],l[7]||0,l[8]||0,l[9]||1,b);else return null;return this},n.Path.prototype.addPoly=function(l,m){var b=H(l,"HEAPF32");return this._addPoly(b,l.length/2,m),E(b,l),this},n.Path.prototype.addRect=function(l,m){return l=Et(l),this._addRect(l,!!m),this},n.Path.prototype.addRRect=function(l,m){return l=Je(l),this._addRRect(l,!!m),this},n.Path.prototype.addVerbsPointsWeights=function(l,m,b){var D=H(l,"HEAPU8"),O=H(m,"HEAPF32"),q=H(b,"HEAPF32");this._addVerbsPointsWeights(D,l.length,O,m.length,q,b&&b.length||0),E(D,l),E(O,m),E(q,b)},n.Path.prototype.arc=function(l,m,b,D,O,q){return l=n.LTRBRect(l-b,m-b,l+b,m+b),O=(O-D)/Math.PI*180-360*!!q,q=new n.Path,q.addArc(l,D/Math.PI*180,O),this.addPath(q,!0),q.delete(),this},n.Path.prototype.arcToOval=function(l,m,b,D){return l=Et(l),this._arcToOval(l,m,b,D),this},n.Path.prototype.arcToRotated=function(l,m,b,D,O,q,ct){return this._arcToRotated(l,m,b,!!D,!!O,q,ct),this},n.Path.prototype.arcToTangent=function(l,m,b,D,O){return this._arcToTangent(l,m,b,D,O),this},n.Path.prototype.close=function(){return this._close(),this},n.Path.prototype.conicTo=function(l,m,b,D,O){return this._conicTo(l,m,b,D,O),this},n.Path.prototype.computeTightBounds=function(l){this._computeTightBounds(ue);var m=Pn.toTypedArray();return l?(l.set(m),l):m.slice()},n.Path.prototype.cubicTo=function(l,m,b,D,O,q){return this._cubicTo(l,m,b,D,O,q),this},n.Path.prototype.dash=function(l,m,b){return this._dash(l,m,b)?this:null},n.Path.prototype.getBounds=function(l){this._getBounds(ue);var m=Pn.toTypedArray();return l?(l.set(m),l):m.slice()},n.Path.prototype.lineTo=function(l,m){return this._lineTo(l,m),this},n.Path.prototype.moveTo=function(l,m){return this._moveTo(l,m),this},n.Path.prototype.offset=function(l,m){return this._transform(1,0,l,0,1,m,0,0,1),this},n.Path.prototype.quadTo=function(l,m,b,D){return this._quadTo(l,m,b,D),this},n.Path.prototype.rArcTo=function(l,m,b,D,O,q,ct){return this._rArcTo(l,m,b,D,O,q,ct),this},n.Path.prototype.rConicTo=function(l,m,b,D,O){return this._rConicTo(l,m,b,D,O),this},n.Path.prototype.rCubicTo=function(l,m,b,D,O,q){return this._rCubicTo(l,m,b,D,O,q),this},n.Path.prototype.rLineTo=function(l,m){return this._rLineTo(l,m),this},n.Path.prototype.rMoveTo=function(l,m){return this._rMoveTo(l,m),this},n.Path.prototype.rQuadTo=function(l,m,b,D){return this._rQuadTo(l,m,b,D),this},n.Path.prototype.stroke=function(l){return l=l||{},l.width=l.width||1,l.miter_limit=l.miter_limit||4,l.cap=l.cap||n.StrokeCap.Butt,l.join=l.join||n.StrokeJoin.Miter,l.precision=l.precision||1,this._stroke(l)?this:null},n.Path.prototype.transform=function(){if(arguments.length===1){var l=arguments[0];this._transform(l[0],l[1],l[2],l[3],l[4],l[5],l[6]||0,l[7]||0,l[8]||1)}else if(arguments.length===6||arguments.length===9)l=arguments,this._transform(l[0],l[1],l[2],l[3],l[4],l[5],l[6]||0,l[7]||0,l[8]||1);else throw"transform expected to take 1 or 9 arguments. Got "+arguments.length;return this},n.Path.prototype.trim=function(l,m,b){return this._trim(l,m,!!b)?this:null},n.Image.prototype.encodeToBytes=function(l,m){var b=n.Te();return l=l||n.ImageFormat.PNG,m=m||100,b?this._encodeToBytes(l,m,b):this._encodeToBytes(l,m)},n.Image.prototype.makeShaderCubic=function(l,m,b,D,O){return O=ot(O),this._makeShaderCubic(l,m,b,D,O)},n.Image.prototype.makeShaderOptions=function(l,m,b,D,O){return O=ot(O),this._makeShaderOptions(l,m,b,D,O)},n.Image.prototype.readPixels=function(l,m,b,D,O){var q=n.Te();return d(this,l,m,b,D,O,q)},n.Canvas.prototype.clear=function(l){n.Md(this.Kd),l=K(l),this._clear(l)},n.Canvas.prototype.clipRRect=function(l,m,b){n.Md(this.Kd),l=Je(l),this._clipRRect(l,m,b)},n.Canvas.prototype.clipRect=function(l,m,b){n.Md(this.Kd),l=Et(l),this._clipRect(l,m,b)},n.Canvas.prototype.concat=function(l){n.Md(this.Kd),l=ft(l),this._concat(l)},n.Canvas.prototype.drawArc=function(l,m,b,D,O){n.Md(this.Kd),l=Et(l),this._drawArc(l,m,b,D,O)},n.Canvas.prototype.drawAtlas=function(l,m,b,D,O,q,ct){if(l&&D&&m&&b&&m.length===b.length){n.Md(this.Kd),O||(O=n.BlendMode.SrcOver);var Ct=H(m,"HEAPF32"),xt=H(b,"HEAPF32"),Ot=b.length/4,zt=H(M(q),"HEAPU32");if(ct&&"B"in ct&&"C"in ct)this._drawAtlasCubic(l,xt,Ct,zt,Ot,O,ct.B,ct.C,D);else{let k=n.FilterMode.Linear,tt=n.MipmapMode.None;ct&&(k=ct.filter,"mipmap"in ct&&(tt=ct.mipmap)),this._drawAtlasOptions(l,xt,Ct,zt,Ot,O,k,tt,D)}E(Ct,m),E(xt,b),E(zt,q)}},n.Canvas.prototype.drawCircle=function(l,m,b,D){n.Md(this.Kd),this._drawCircle(l,m,b,D)},n.Canvas.prototype.drawColor=function(l,m){n.Md(this.Kd),l=K(l),m!==void 0?this._drawColor(l,m):this._drawColor(l)},n.Canvas.prototype.drawColorInt=function(l,m){n.Md(this.Kd),this._drawColorInt(l,m||n.BlendMode.SrcOver)},n.Canvas.prototype.drawColorComponents=function(l,m,b,D,O){n.Md(this.Kd),l=yt(l,m,b,D),O!==void 0?this._drawColor(l,O):this._drawColor(l)},n.Canvas.prototype.drawDRRect=function(l,m,b){n.Md(this.Kd),l=Je(l,_o),m=Je(m,jc),this._drawDRRect(l,m,b)},n.Canvas.prototype.drawImage=function(l,m,b,D){n.Md(this.Kd),this._drawImage(l,m,b,D||null)},n.Canvas.prototype.drawImageCubic=function(l,m,b,D,O,q){n.Md(this.Kd),this._drawImageCubic(l,m,b,D,O,q||null)},n.Canvas.prototype.drawImageOptions=function(l,m,b,D,O,q){n.Md(this.Kd),this._drawImageOptions(l,m,b,D,O,q||null)},n.Canvas.prototype.drawImageNine=function(l,m,b,D,O){n.Md(this.Kd),m=H(m,"HEAP32",Zi),b=Et(b),this._drawImageNine(l,m,b,D,O||null)},n.Canvas.prototype.drawImageRect=function(l,m,b,D,O){n.Md(this.Kd),Et(m,ue),Et(b,br),this._drawImageRect(l,ue,br,D,!!O)},n.Canvas.prototype.drawImageRectCubic=function(l,m,b,D,O,q){n.Md(this.Kd),Et(m,ue),Et(b,br),this._drawImageRectCubic(l,ue,br,D,O,q||null)},n.Canvas.prototype.drawImageRectOptions=function(l,m,b,D,O,q){n.Md(this.Kd),Et(m,ue),Et(b,br),this._drawImageRectOptions(l,ue,br,D,O,q||null)},n.Canvas.prototype.drawLine=function(l,m,b,D,O){n.Md(this.Kd),this._drawLine(l,m,b,D,O)},n.Canvas.prototype.drawOval=function(l,m){n.Md(this.Kd),l=Et(l),this._drawOval(l,m)},n.Canvas.prototype.drawPaint=function(l){n.Md(this.Kd),this._drawPaint(l)},n.Canvas.prototype.drawParagraph=function(l,m,b){n.Md(this.Kd),this._drawParagraph(l,m,b)},n.Canvas.prototype.drawPatch=function(l,m,b,D,O){if(24>l.length)throw"Need 12 cubic points";if(m&&4>m.length)throw"Need 4 colors";if(b&&8>b.length)throw"Need 4 shader coordinates";n.Md(this.Kd);const q=H(l,"HEAPF32"),ct=m?H(M(m),"HEAPU32"):Ft,Ct=b?H(b,"HEAPF32"):Ft;D||(D=n.BlendMode.Modulate),this._drawPatch(q,ct,Ct,D,O),E(Ct,b),E(ct,m),E(q,l)},n.Canvas.prototype.drawPath=function(l,m){n.Md(this.Kd),this._drawPath(l,m)},n.Canvas.prototype.drawPicture=function(l){n.Md(this.Kd),this._drawPicture(l)},n.Canvas.prototype.drawPoints=function(l,m,b){n.Md(this.Kd);var D=H(m,"HEAPF32");this._drawPoints(l,D,m.length/2,b),E(D,m)},n.Canvas.prototype.drawRRect=function(l,m){n.Md(this.Kd),l=Je(l),this._drawRRect(l,m)},n.Canvas.prototype.drawRect=function(l,m){n.Md(this.Kd),l=Et(l),this._drawRect(l,m)},n.Canvas.prototype.drawRect4f=function(l,m,b,D,O){n.Md(this.Kd),this._drawRect4f(l,m,b,D,O)},n.Canvas.prototype.drawShadow=function(l,m,b,D,O,q,ct){n.Md(this.Kd);var Ct=H(O,"HEAPF32"),xt=H(q,"HEAPF32");m=H(m,"HEAPF32",Eo),b=H(b,"HEAPF32",Io),this._drawShadow(l,m,b,D,Ct,xt,ct),E(Ct,O),E(xt,q)},n.getShadowLocalBounds=function(l,m,b,D,O,q,ct){return l=ot(l),b=H(b,"HEAPF32",Eo),D=H(D,"HEAPF32",Io),this._getShadowLocalBounds(l,m,b,D,O,q,ue)?(m=Pn.toTypedArray(),ct?(ct.set(m),ct):m.slice()):null},n.Canvas.prototype.drawTextBlob=function(l,m,b,D){n.Md(this.Kd),this._drawTextBlob(l,m,b,D)},n.Canvas.prototype.drawVertices=function(l,m,b){n.Md(this.Kd),this._drawVertices(l,m,b)},n.Canvas.prototype.getDeviceClipBounds=function(l){this._getDeviceClipBounds(Zi);var m=Gs.toTypedArray();return l?l.set(m):l=m.slice(),l},n.Canvas.prototype.getLocalToDevice=function(){this._getLocalToDevice(xi);for(var l=xi,m=Array(16),b=0;16>b;b++)m[b]=n.HEAPF32[l/4+b];return m},n.Canvas.prototype.getTotalMatrix=function(){this._getTotalMatrix(Cr);for(var l=Array(9),m=0;9>m;m++)l[m]=n.HEAPF32[Cr/4+m];return l},n.Canvas.prototype.makeSurface=function(l){return l=this._makeSurface(l),l.Kd=this.Kd,l},n.Canvas.prototype.readPixels=function(l,m,b,D,O){return n.Md(this.Kd),d(this,l,m,b,D,O)},n.Canvas.prototype.saveLayer=function(l,m,b,D){return m=Et(m),this._saveLayer(l||null,m,b||null,D||0)},n.Canvas.prototype.writePixels=function(l,m,b,D,O,q,ct,Ct){if(l.byteLength%(m*b))throw"pixels length must be a multiple of the srcWidth * srcHeight";n.Md(this.Kd);var xt=l.byteLength/(m*b);q=q||n.AlphaType.Unpremul,ct=ct||n.ColorType.RGBA_8888,Ct=Ct||n.ColorSpace.SRGB;var Ot=xt*m;return xt=H(l,"HEAPU8"),m=this._writePixels({width:m,height:b,colorType:ct,alphaType:q,colorSpace:Ct},xt,Ot,D,O),E(xt,l),m},n.ColorFilter.MakeBlend=function(l,m,b){return l=K(l),b=b||n.ColorSpace.SRGB,n.ColorFilter._MakeBlend(l,m,b)},n.ColorFilter.MakeMatrix=function(l){if(!l||l.length!==20)throw"invalid color matrix";var m=H(l,"HEAPF32"),b=n.ColorFilter._makeMatrix(m);return E(m,l),b},n.ContourMeasure.prototype.getPosTan=function(l,m){return this._getPosTan(l,ue),l=Pn.toTypedArray(),m?(m.set(l),m):l.slice()},n.ImageFilter.prototype.getOutputBounds=function(l,m,b){return l=Et(l,ue),m=ot(m),this._getOutputBounds(l,m,Zi),m=Gs.toTypedArray(),b?(b.set(m),b):m.slice()},n.ImageFilter.MakeDropShadow=function(l,m,b,D,O,q){return O=K(O,Qr),n.ImageFilter._MakeDropShadow(l,m,b,D,O,q)},n.ImageFilter.MakeDropShadowOnly=function(l,m,b,D,O,q){return O=K(O,Qr),n.ImageFilter._MakeDropShadowOnly(l,m,b,D,O,q)},n.ImageFilter.MakeImage=function(l,m,b,D){if(b=Et(b,ue),D=Et(D,br),"B"in m&&"C"in m)return n.ImageFilter._MakeImageCubic(l,m.B,m.C,b,D);const O=m.filter;let q=n.MipmapMode.None;return"mipmap"in m&&(q=m.mipmap),n.ImageFilter._MakeImageOptions(l,O,q,b,D)},n.ImageFilter.MakeMatrixTransform=function(l,m,b){if(l=ot(l),"B"in m&&"C"in m)return n.ImageFilter._MakeMatrixTransformCubic(l,m.B,m.C,b);const D=m.filter;let O=n.MipmapMode.None;return"mipmap"in m&&(O=m.mipmap),n.ImageFilter._MakeMatrixTransformOptions(l,D,O,b)},n.Paint.prototype.getColor=function(){return this._getColor(Qr),It(Qr)},n.Paint.prototype.setColor=function(l,m){m=m||null,l=K(l),this._setColor(l,m)},n.Paint.prototype.setColorComponents=function(l,m,b,D,O){O=O||null,l=yt(l,m,b,D),this._setColor(l,O)},n.Path.prototype.getPoint=function(l,m){return this._getPoint(l,ue),l=Pn.toTypedArray(),m?(m[0]=l[0],m[1]=l[1],m):l.slice(0,2)},n.Picture.prototype.makeShader=function(l,m,b,D,O){return D=ot(D),O=Et(O),this._makeShader(l,m,b,D,O)},n.Picture.prototype.cullRect=function(l){this._cullRect(ue);var m=Pn.toTypedArray();return l?(l.set(m),l):m.slice()},n.PictureRecorder.prototype.beginRecording=function(l,m){return l=Et(l),this._beginRecording(l,!!m)},n.Surface.prototype.getCanvas=function(){var l=this._getCanvas();return l.Kd=this.Kd,l},n.Surface.prototype.makeImageSnapshot=function(l){return n.Md(this.Kd),l=H(l,"HEAP32",Zi),this._makeImageSnapshot(l)},n.Surface.prototype.makeSurface=function(l){return n.Md(this.Kd),l=this._makeSurface(l),l.Kd=this.Kd,l},n.Surface.prototype.Gf=function(l,m){return this.He||(this.He=this.getCanvas()),requestAnimationFrame((function(){n.Md(this.Kd),l(this.He),this.flush(m)}).bind(this))},n.Surface.prototype.requestAnimationFrame||(n.Surface.prototype.requestAnimationFrame=n.Surface.prototype.Gf),n.Surface.prototype.Cf=function(l,m){this.He||(this.He=this.getCanvas()),requestAnimationFrame((function(){n.Md(this.Kd),l(this.He),this.flush(m),this.dispose()}).bind(this))},n.Surface.prototype.drawOnce||(n.Surface.prototype.drawOnce=n.Surface.prototype.Cf),n.PathEffect.MakeDash=function(l,m){if(m||(m=0),!l.length||l.length%2===1)throw"Intervals array must have even length";var b=H(l,"HEAPF32");return m=n.PathEffect._MakeDash(b,l.length,m),E(b,l),m},n.PathEffect.MakeLine2D=function(l,m){return m=ot(m),n.PathEffect._MakeLine2D(l,m)},n.PathEffect.MakePath2D=function(l,m){return l=ot(l),n.PathEffect._MakePath2D(l,m)},n.Shader.MakeColor=function(l,m){return m=m||null,l=K(l),n.Shader._MakeColor(l,m)},n.Shader.Blend=n.Shader.MakeBlend,n.Shader.Color=n.Shader.MakeColor,n.Shader.MakeLinearGradient=function(l,m,b,D,O,q,ct,Ct){Ct=Ct||null;var xt=et(b),Ot=H(D,"HEAPF32");ct=ct||0,q=ot(q);var zt=Pn.toTypedArray();return zt.set(l),zt.set(m,2),l=n.Shader._MakeLinearGradient(ue,xt.be,xt.colorType,Ot,xt.count,O,ct,q,Ct),E(xt.be,b),D&&E(Ot,D),l},n.Shader.MakeRadialGradient=function(l,m,b,D,O,q,ct,Ct){Ct=Ct||null;var xt=et(b),Ot=H(D,"HEAPF32");return ct=ct||0,q=ot(q),l=n.Shader._MakeRadialGradient(l[0],l[1],m,xt.be,xt.colorType,Ot,xt.count,O,ct,q,Ct),E(xt.be,b),D&&E(Ot,D),l},n.Shader.MakeSweepGradient=function(l,m,b,D,O,q,ct,Ct,xt,Ot){Ot=Ot||null;var zt=et(b),k=H(D,"HEAPF32");return ct=ct||0,Ct=Ct||0,xt=xt||360,q=ot(q),l=n.Shader._MakeSweepGradient(l,m,zt.be,zt.colorType,k,zt.count,O,Ct,xt,ct,q,Ot),E(zt.be,b),D&&E(k,D),l},n.Shader.MakeTwoPointConicalGradient=function(l,m,b,D,O,q,ct,Ct,xt,Ot){Ot=Ot||null;var zt=et(O),k=H(q,"HEAPF32");xt=xt||0,Ct=ot(Ct);var tt=Pn.toTypedArray();return tt.set(l),tt.set(b,2),l=n.Shader._MakeTwoPointConicalGradient(ue,m,D,zt.be,zt.colorType,k,zt.count,ct,xt,Ct,Ot),E(zt.be,O),q&&E(k,q),l},n.Vertices.prototype.bounds=function(l){this._bounds(ue);var m=Pn.toTypedArray();return l?(l.set(m),l):m.slice()},n.Td&&n.Td.forEach(function(l){l()})},n.computeTonalColors=function(d){var l=H(d.ambient,"HEAPF32"),m=H(d.spot,"HEAPF32");this._computeTonalColors(l,m);var b={ambient:It(l),spot:It(m)};return E(l,d.ambient),E(m,d.spot),b},n.LTRBRect=function(d,l,m,b){return Float32Array.of(d,l,m,b)},n.XYWHRect=function(d,l,m,b){return Float32Array.of(d,l,d+m,l+b)},n.LTRBiRect=function(d,l,m,b){return Int32Array.of(d,l,m,b)},n.XYWHiRect=function(d,l,m,b){return Int32Array.of(d,l,d+m,l+b)},n.RRectXY=function(d,l,m){return Float32Array.of(d[0],d[1],d[2],d[3],l,m,l,m,l,m,l,m)},n.MakeAnimatedImageFromEncoded=function(d){d=new Uint8Array(d);var l=n._malloc(d.byteLength);return n.HEAPU8.set(d,l),(d=n._decodeAnimatedImage(l,d.byteLength))?d:null},n.MakeImageFromEncoded=function(d){d=new Uint8Array(d);var l=n._malloc(d.byteLength);return n.HEAPU8.set(d,l),(d=n._decodeImage(l,d.byteLength))?d:null};var ts=null;n.MakeImageFromCanvasImageSource=function(d){var l=d.width,m=d.height;ts||(ts=document.createElement("canvas")),ts.width=l,ts.height=m;var b=ts.getContext("2d",{willReadFrequently:!0});return b.drawImage(d,0,0),d=b.getImageData(0,0,l,m),n.MakeImage({width:l,height:m,alphaType:n.AlphaType.Unpremul,colorType:n.ColorType.RGBA_8888,colorSpace:n.ColorSpace.SRGB},d.data,4*l)},n.MakeImage=function(d,l,m){var b=n._malloc(l.length);return n.HEAPU8.set(l,b),n._MakeImage(d,b,l.length,m)},n.MakeVertices=function(d,l,m,b,D,O){var q=D&&D.length||0,ct=0;return m&&m.length&&(ct|=1),b&&b.length&&(ct|=2),O===void 0||O||(ct|=4),d=new n._VerticesBuilder(d,l.length/2,q,ct),H(l,"HEAPF32",d.positions()),d.texCoords()&&H(m,"HEAPF32",d.texCoords()),d.colors()&&H(M(b),"HEAPU32",d.colors()),d.indices()&&H(D,"HEAPU16",d.indices()),d.detach()},n.Matrix={},n.Matrix.identity=function(){return h(3)},n.Matrix.invert=function(d){var l=d[0]*d[4]*d[8]+d[1]*d[5]*d[6]+d[2]*d[3]*d[7]-d[2]*d[4]*d[6]-d[1]*d[3]*d[8]-d[0]*d[5]*d[7];return l?[(d[4]*d[8]-d[5]*d[7])/l,(d[2]*d[7]-d[1]*d[8])/l,(d[1]*d[5]-d[2]*d[4])/l,(d[5]*d[6]-d[3]*d[8])/l,(d[0]*d[8]-d[2]*d[6])/l,(d[2]*d[3]-d[0]*d[5])/l,(d[3]*d[7]-d[4]*d[6])/l,(d[1]*d[6]-d[0]*d[7])/l,(d[0]*d[4]-d[1]*d[3])/l]:null},n.Matrix.mapPoints=function(d,l){for(var m=0;m<l.length;m+=2){var b=l[m],D=l[m+1],O=d[6]*b+d[7]*D+d[8],q=d[3]*b+d[4]*D+d[5];l[m]=(d[0]*b+d[1]*D+d[2])/O,l[m+1]=q/O}return l},n.Matrix.multiply=function(){return qi(3,arguments)},n.Matrix.rotated=function(d,l,m){l=l||0,m=m||0;var b=Math.sin(d);return d=Math.cos(d),[d,-b,be(b,m,1-d,l),b,d,be(-b,l,1-d,m),0,0,1]},n.Matrix.scaled=function(d,l,m,b){m=m||0,b=b||0;var D=a([d,l],h(3),3,0,1);return a([m-d*m,b-l*b],D,3,2,0)},n.Matrix.skewed=function(d,l,m,b){m=m||0,b=b||0;var D=a([d,l],h(3),3,1,-1);return a([-d*m,-l*b],D,3,2,0)},n.Matrix.translated=function(d,l){return a(arguments,h(3),3,2,0)},n.Vector={},n.Vector.dot=function(d,l){return d.map(function(m,b){return m*l[b]}).reduce(function(m,b){return m+b})},n.Vector.lengthSquared=function(d){return n.Vector.dot(d,d)},n.Vector.length=function(d){return Math.sqrt(n.Vector.lengthSquared(d))},n.Vector.mulScalar=function(d,l){return d.map(function(m){return m*l})},n.Vector.add=function(d,l){return d.map(function(m,b){return m+l[b]})},n.Vector.sub=function(d,l){return d.map(function(m,b){return m-l[b]})},n.Vector.dist=function(d,l){return n.Vector.length(n.Vector.sub(d,l))},n.Vector.normalize=function(d){return n.Vector.mulScalar(d,1/n.Vector.length(d))},n.Vector.cross=function(d,l){return[d[1]*l[2]-d[2]*l[1],d[2]*l[0]-d[0]*l[2],d[0]*l[1]-d[1]*l[0]]},n.M44={},n.M44.identity=function(){return h(4)},n.M44.translated=function(d){return a(d,h(4),4,3,0)},n.M44.scaled=function(d){return a(d,h(4),4,0,1)},n.M44.rotated=function(d,l){return n.M44.rotatedUnitSinCos(n.Vector.normalize(d),Math.sin(l),Math.cos(l))},n.M44.rotatedUnitSinCos=function(d,l,m){var b=d[0],D=d[1];d=d[2];var O=1-m;return[O*b*b+m,O*b*D-l*d,O*b*d+l*D,0,O*b*D+l*d,O*D*D+m,O*D*d-l*b,0,O*b*d-l*D,O*D*d+l*b,O*d*d+m,0,0,0,0,1]},n.M44.lookat=function(d,l,m){l=n.Vector.normalize(n.Vector.sub(l,d)),m=n.Vector.normalize(m),m=n.Vector.normalize(n.Vector.cross(l,m));var b=n.M44.identity();return a(m,b,4,0,0),a(n.Vector.cross(m,l),b,4,1,0),a(n.Vector.mulScalar(l,-1),b,4,2,0),a(d,b,4,3,0),d=n.M44.invert(b),d===null?n.M44.identity():d},n.M44.perspective=function(d,l,m){var b=1/(l-d);return m/=2,m=Math.cos(m)/Math.sin(m),[m,0,0,0,0,m,0,0,0,0,(l+d)*b,2*l*d*b,0,0,-1,1]},n.M44.rc=function(d,l,m){return d[4*l+m]},n.M44.multiply=function(){return qi(4,arguments)},n.M44.invert=function(d){var l=d[0],m=d[4],b=d[8],D=d[12],O=d[1],q=d[5],ct=d[9],Ct=d[13],xt=d[2],Ot=d[6],zt=d[10],k=d[14],tt=d[3],kt=d[7],jt=d[11];d=d[15];var fe=l*q-m*O,pn=l*ct-b*O,mn=l*Ct-D*O,Be=m*ct-b*q,it=m*Ct-D*q,w=b*Ct-D*ct,I=xt*kt-Ot*tt,$=xt*jt-zt*tt,J=xt*d-k*tt,nt=Ot*jt-zt*kt,at=Ot*d-k*kt,pt=zt*d-k*jt,Yt=fe*pt-pn*at+mn*nt+Be*J-it*$+w*I,Ut=1/Yt;return Yt===0||Ut===1/0?null:(fe*=Ut,pn*=Ut,mn*=Ut,Be*=Ut,it*=Ut,w*=Ut,I*=Ut,$*=Ut,J*=Ut,nt*=Ut,at*=Ut,pt*=Ut,l=[q*pt-ct*at+Ct*nt,ct*J-O*pt-Ct*$,O*at-q*J+Ct*I,q*$-O*nt-ct*I,b*at-m*pt-D*nt,l*pt-b*J+D*$,m*J-l*at-D*I,l*nt-m*$+b*I,kt*w-jt*it+d*Be,jt*mn-tt*w-d*pn,tt*it-kt*mn+d*fe,kt*pn-tt*Be-jt*fe,zt*it-Ot*w-k*Be,xt*w-zt*mn+k*pn,Ot*mn-xt*it-k*fe,xt*Be-Ot*pn+zt*fe],l.every(function(Dn){return!isNaN(Dn)&&Dn!==1/0&&Dn!==-1/0})?l:null)},n.M44.transpose=function(d){return[d[0],d[4],d[8],d[12],d[1],d[5],d[9],d[13],d[2],d[6],d[10],d[14],d[3],d[7],d[11],d[15]]},n.M44.mustInvert=function(d){if(d=n.M44.invert(d),d===null)throw"Matrix not invertible";return d},n.M44.setupCamera=function(d,l,m){var b=n.M44.lookat(m.eye,m.coa,m.up);return m=n.M44.perspective(m.near,m.far,m.angle),l=[(d[2]-d[0])/2,(d[3]-d[1])/2,l],d=n.M44.multiply(n.M44.translated([(d[0]+d[2])/2,(d[1]+d[3])/2,0]),n.M44.scaled(l)),n.M44.multiply(d,m,b,n.M44.mustInvert(d))},n.ColorMatrix={},n.ColorMatrix.identity=function(){var d=new Float32Array(20);return d[0]=1,d[6]=1,d[12]=1,d[18]=1,d},n.ColorMatrix.scaled=function(d,l,m,b){var D=new Float32Array(20);return D[0]=d,D[6]=l,D[12]=m,D[18]=b,D};var Xf=[[6,7,11,12],[0,10,2,12],[0,1,5,6]];n.ColorMatrix.rotated=function(d,l,m){var b=n.ColorMatrix.identity();return d=Xf[d],b[d[0]]=m,b[d[1]]=l,b[d[2]]=-l,b[d[3]]=m,b},n.ColorMatrix.postTranslate=function(d,l,m,b,D){return d[4]+=l,d[9]+=m,d[14]+=b,d[19]+=D,d},n.ColorMatrix.concat=function(d,l){for(var m=new Float32Array(20),b=0,D=0;20>D;D+=5){for(var O=0;4>O;O++)m[b++]=d[D]*l[O]+d[D+1]*l[O+5]+d[D+2]*l[O+10]+d[D+3]*l[O+15];m[b++]=d[D]*l[4]+d[D+1]*l[9]+d[D+2]*l[14]+d[D+3]*l[19]+d[D+4]}return m},function(d){d.Td=d.Td||[],d.Td.push(function(){function l(k){return k&&(k.dir=k.dir===0?d.TextDirection.RTL:d.TextDirection.LTR),k}function m(k){if(!k||!k.length)return[];for(var tt=[],kt=0;kt<k.length;kt+=5){var jt=d.LTRBRect(k[kt],k[kt+1],k[kt+2],k[kt+3]),fe=d.TextDirection.LTR;k[kt+4]===0&&(fe=d.TextDirection.RTL),tt.push({rect:jt,dir:fe})}return d._free(k.byteOffset),tt}function b(k){return k=k||{},k.weight===void 0&&(k.weight=d.FontWeight.Normal),k.width=k.width||d.FontWidth.Normal,k.slant=k.slant||d.FontSlant.Upright,k}function D(k){if(!k||!k.length)return Ft;for(var tt=[],kt=0;kt<k.length;kt++){var jt=O(k[kt]);tt.push(jt)}return H(tt,"HEAPU32")}function O(k){if(Ct[k])return Ct[k];var tt=re(k)+1,kt=d._malloc(tt);return ve(k,rt,kt,tt),Ct[k]=kt}function q(k){if(k._colorPtr=K(k.color),k._foregroundColorPtr=Ft,k._backgroundColorPtr=Ft,k._decorationColorPtr=Ft,k.foregroundColor&&(k._foregroundColorPtr=K(k.foregroundColor,xt)),k.backgroundColor&&(k._backgroundColorPtr=K(k.backgroundColor,Ot)),k.decorationColor&&(k._decorationColorPtr=K(k.decorationColor,zt)),Array.isArray(k.fontFamilies)&&k.fontFamilies.length?(k._fontFamiliesPtr=D(k.fontFamilies),k._fontFamiliesLen=k.fontFamilies.length):(k._fontFamiliesPtr=Ft,k._fontFamiliesLen=0),k.locale){var tt=k.locale;k._localePtr=O(tt),k._localeLen=re(tt)+1}else k._localePtr=Ft,k._localeLen=0;if(Array.isArray(k.shadows)&&k.shadows.length){tt=k.shadows;var kt=tt.map(function(it){return it.color||d.BLACK}),jt=tt.map(function(it){return it.blurRadius||0});k._shadowLen=tt.length;for(var fe=d._malloc(8*tt.length),pn=fe/4,mn=0;mn<tt.length;mn++){var Be=tt[mn].offset||[0,0];d.HEAPF32[pn]=Be[0],d.HEAPF32[pn+1]=Be[1],pn+=2}k._shadowColorsPtr=et(kt).be,k._shadowOffsetsPtr=fe,k._shadowBlurRadiiPtr=H(jt,"HEAPF32")}else k._shadowLen=0,k._shadowColorsPtr=Ft,k._shadowOffsetsPtr=Ft,k._shadowBlurRadiiPtr=Ft;Array.isArray(k.fontFeatures)&&k.fontFeatures.length?(tt=k.fontFeatures,kt=tt.map(function(it){return it.name}),jt=tt.map(function(it){return it.value}),k._fontFeatureLen=tt.length,k._fontFeatureNamesPtr=D(kt),k._fontFeatureValuesPtr=H(jt,"HEAPU32")):(k._fontFeatureLen=0,k._fontFeatureNamesPtr=Ft,k._fontFeatureValuesPtr=Ft),Array.isArray(k.fontVariations)&&k.fontVariations.length?(tt=k.fontVariations,kt=tt.map(function(it){return it.axis}),jt=tt.map(function(it){return it.value}),k._fontVariationLen=tt.length,k._fontVariationAxesPtr=D(kt),k._fontVariationValuesPtr=H(jt,"HEAPF32")):(k._fontVariationLen=0,k._fontVariationAxesPtr=Ft,k._fontVariationValuesPtr=Ft)}function ct(k){d._free(k._fontFamiliesPtr),d._free(k._shadowColorsPtr),d._free(k._shadowOffsetsPtr),d._free(k._shadowBlurRadiiPtr),d._free(k._fontFeatureNamesPtr),d._free(k._fontFeatureValuesPtr),d._free(k._fontVariationAxesPtr),d._free(k._fontVariationValuesPtr)}d.Paragraph.prototype.getRectsForRange=function(k,tt,kt,jt){return k=this._getRectsForRange(k,tt,kt,jt),m(k)},d.Paragraph.prototype.getRectsForPlaceholders=function(){var k=this._getRectsForPlaceholders();return m(k)},d.Paragraph.prototype.getGlyphInfoAt=function(k){return l(this._getGlyphInfoAt(k))},d.Paragraph.prototype.getClosestGlyphInfoAtCoordinate=function(k,tt){return l(this._getClosestGlyphInfoAtCoordinate(k,tt))},d.TypefaceFontProvider.prototype.registerFont=function(k,tt){if(k=d.Typeface.MakeFreeTypeFaceFromData(k),!k)return null;tt=O(tt),this._registerFont(k,tt)},d.ParagraphStyle=function(k){if(k.disableHinting=k.disableHinting||!1,k.ellipsis){var tt=k.ellipsis;k._ellipsisPtr=O(tt),k._ellipsisLen=re(tt)+1}else k._ellipsisPtr=Ft,k._ellipsisLen=0;return k.heightMultiplier==null&&(k.heightMultiplier=-1),k.maxLines=k.maxLines||0,k.replaceTabCharacters=k.replaceTabCharacters||!1,tt=(tt=k.strutStyle)||{},tt.strutEnabled=tt.strutEnabled||!1,tt.strutEnabled&&Array.isArray(tt.fontFamilies)&&tt.fontFamilies.length?(tt._fontFamiliesPtr=D(tt.fontFamilies),tt._fontFamiliesLen=tt.fontFamilies.length):(tt._fontFamiliesPtr=Ft,tt._fontFamiliesLen=0),tt.fontStyle=b(tt.fontStyle),tt.fontSize==null&&(tt.fontSize=-1),tt.heightMultiplier==null&&(tt.heightMultiplier=-1),tt.halfLeading=tt.halfLeading||!1,tt.leading=tt.leading||0,tt.forceStrutHeight=tt.forceStrutHeight||!1,k.strutStyle=tt,k.textAlign=k.textAlign||d.TextAlign.Start,k.textDirection=k.textDirection||d.TextDirection.LTR,k.textHeightBehavior=k.textHeightBehavior||d.TextHeightBehavior.All,k.textStyle=d.TextStyle(k.textStyle),k.applyRoundingHack=k.applyRoundingHack!==!1,k},d.TextStyle=function(k){return k.color||(k.color=d.BLACK),k.decoration=k.decoration||0,k.decorationThickness=k.decorationThickness||0,k.decorationStyle=k.decorationStyle||d.DecorationStyle.Solid,k.textBaseline=k.textBaseline||d.TextBaseline.Alphabetic,k.fontSize==null&&(k.fontSize=-1),k.letterSpacing=k.letterSpacing||0,k.wordSpacing=k.wordSpacing||0,k.heightMultiplier==null&&(k.heightMultiplier=-1),k.halfLeading=k.halfLeading||!1,k.fontStyle=b(k.fontStyle),k};var Ct={},xt=d._malloc(16),Ot=d._malloc(16),zt=d._malloc(16);d.ParagraphBuilder.Make=function(k,tt){return q(k.textStyle),tt=d.ParagraphBuilder._Make(k,tt),ct(k.textStyle),tt},d.ParagraphBuilder.MakeFromFontProvider=function(k,tt){return q(k.textStyle),tt=d.ParagraphBuilder._MakeFromFontProvider(k,tt),ct(k.textStyle),tt},d.ParagraphBuilder.MakeFromFontCollection=function(k,tt){return q(k.textStyle),tt=d.ParagraphBuilder._MakeFromFontCollection(k,tt),ct(k.textStyle),tt},d.ParagraphBuilder.ShapeText=function(k,tt,kt){let jt=0;for(const fe of tt)jt+=fe.length;if(jt!==k.length)throw"Accumulated block lengths must equal text.length";return d.ParagraphBuilder._ShapeText(k,tt,kt)},d.ParagraphBuilder.prototype.pushStyle=function(k){q(k),this._pushStyle(k),ct(k)},d.ParagraphBuilder.prototype.pushPaintStyle=function(k,tt,kt){q(k),this._pushPaintStyle(k,tt,kt),ct(k)},d.ParagraphBuilder.prototype.addPlaceholder=function(k,tt,kt,jt,fe){kt=kt||d.PlaceholderAlignment.Baseline,jt=jt||d.TextBaseline.Alphabetic,this._addPlaceholder(k||0,tt||0,kt,jt,fe||0)},d.ParagraphBuilder.prototype.setWordsUtf8=function(k){var tt=H(k,"HEAPU32");this._setWordsUtf8(tt,k&&k.length||0),E(tt,k)},d.ParagraphBuilder.prototype.setWordsUtf16=function(k){var tt=H(k,"HEAPU32");this._setWordsUtf16(tt,k&&k.length||0),E(tt,k)},d.ParagraphBuilder.prototype.setGraphemeBreaksUtf8=function(k){var tt=H(k,"HEAPU32");this._setGraphemeBreaksUtf8(tt,k&&k.length||0),E(tt,k)},d.ParagraphBuilder.prototype.setGraphemeBreaksUtf16=function(k){var tt=H(k,"HEAPU32");this._setGraphemeBreaksUtf16(tt,k&&k.length||0),E(tt,k)},d.ParagraphBuilder.prototype.setLineBreaksUtf8=function(k){var tt=H(k,"HEAPU32");this._setLineBreaksUtf8(tt,k&&k.length||0),E(tt,k)},d.ParagraphBuilder.prototype.setLineBreaksUtf16=function(k){var tt=H(k,"HEAPU32");this._setLineBreaksUtf16(tt,k&&k.length||0),E(tt,k)}})}(o),n.Td=n.Td||[],n.Td.push(function(){n.Path.prototype.op=function(d,l){return this._op(d,l)?this:null},n.Path.prototype.simplify=function(){return this._simplify()?this:null}}),n.Td=n.Td||[],n.Td.push(function(){n.Canvas.prototype.drawText=function(d,l,m,b,D){var O=re(d),q=n._malloc(O+1);ve(d,rt,q,O+1),this._drawSimpleText(q,O,l,m,D,b),n._free(q)},n.Canvas.prototype.drawGlyphs=function(d,l,m,b,D,O){if(!(2*d.length<=l.length))throw"Not enough positions for the array of gyphs";n.Md(this.Kd);const q=H(d,"HEAPU16"),ct=H(l,"HEAPF32");this._drawGlyphs(d.length,q,ct,m,b,D,O),E(ct,l),E(q,d)},n.Font.prototype.getGlyphBounds=function(d,l,m){var b=H(d,"HEAPU16"),D=n._malloc(16*d.length);return this._getGlyphWidthBounds(b,d.length,Ft,D,l||null),l=new Float32Array(n.HEAPU8.buffer,D,4*d.length),E(b,d),m?(m.set(l),n._free(D),m):(d=Float32Array.from(l),n._free(D),d)},n.Font.prototype.getGlyphIDs=function(d,l,m){l||(l=d.length);var b=re(d)+1,D=n._malloc(b);return ve(d,rt,D,b),d=n._malloc(2*l),l=this._getGlyphIDs(D,b-1,l,d),n._free(D),0>l?(n._free(d),null):(D=new Uint16Array(n.HEAPU8.buffer,d,l),m?(m.set(D),n._free(d),m):(m=Uint16Array.from(D),n._free(d),m))},n.Font.prototype.getGlyphIntercepts=function(d,l,m,b){var D=H(d,"HEAPU16"),O=H(l,"HEAPF32");return this._getGlyphIntercepts(D,d.length,!(d&&d._ck),O,l.length,!(l&&l._ck),m,b)},n.Font.prototype.getGlyphWidths=function(d,l,m){var b=H(d,"HEAPU16"),D=n._malloc(4*d.length);return this._getGlyphWidthBounds(b,d.length,D,Ft,l||null),l=new Float32Array(n.HEAPU8.buffer,D,d.length),E(b,d),m?(m.set(l),n._free(D),m):(d=Float32Array.from(l),n._free(D),d)},n.FontMgr.FromData=function(){if(!arguments.length)return null;var d=arguments;if(d.length===1&&Array.isArray(d[0])&&(d=arguments[0]),!d.length)return null;for(var l=[],m=[],b=0;b<d.length;b++){var D=new Uint8Array(d[b]),O=H(D,"HEAPU8");l.push(O),m.push(D.byteLength)}return l=H(l,"HEAPU32"),m=H(m,"HEAPU32"),d=n.FontMgr._fromData(l,m,d.length),n._free(l),n._free(m),d},n.Typeface.MakeFreeTypeFaceFromData=function(d){d=new Uint8Array(d);var l=H(d,"HEAPU8");return(d=n.Typeface._MakeFreeTypeFaceFromData(l,d.byteLength))?d:null},n.Typeface.prototype.getGlyphIDs=function(d,l,m){l||(l=d.length);var b=re(d)+1,D=n._malloc(b);return ve(d,rt,D,b),d=n._malloc(2*l),l=this._getGlyphIDs(D,b-1,l,d),n._free(D),0>l?(n._free(d),null):(D=new Uint16Array(n.HEAPU8.buffer,d,l),m?(m.set(D),n._free(d),m):(m=Uint16Array.from(D),n._free(d),m))},n.TextBlob.MakeOnPath=function(d,l,m,b){if(d&&d.length&&l&&l.countPoints()){if(l.countPoints()===1)return this.MakeFromText(d,m);b||(b=0);var D=m.getGlyphIDs(d);D=m.getGlyphWidths(D);var O=[];l=new n.ContourMeasureIter(l,!1,1);for(var q=l.next(),ct=new Float32Array(4),Ct=0;Ct<d.length&&q;Ct++){var xt=D[Ct];if(b+=xt/2,b>q.length()){if(q.delete(),q=l.next(),!q){d=d.substring(0,Ct);break}b=xt/2}q.getPosTan(b,ct);var Ot=ct[2],zt=ct[3];O.push(Ot,zt,ct[0]-xt/2*Ot,ct[1]-xt/2*zt),b+=xt/2}return d=this.MakeFromRSXform(d,O,m),q&&q.delete(),l.delete(),d}},n.TextBlob.MakeFromRSXform=function(d,l,m){var b=re(d)+1,D=n._malloc(b);return ve(d,rt,D,b),d=H(l,"HEAPF32"),m=n.TextBlob._MakeFromRSXform(D,b-1,d,m),n._free(D),m||null},n.TextBlob.MakeFromRSXformGlyphs=function(d,l,m){var b=H(d,"HEAPU16");return l=H(l,"HEAPF32"),m=n.TextBlob._MakeFromRSXformGlyphs(b,2*d.length,l,m),E(b,d),m||null},n.TextBlob.MakeFromGlyphs=function(d,l){var m=H(d,"HEAPU16");return l=n.TextBlob._MakeFromGlyphs(m,2*d.length,l),E(m,d),l||null},n.TextBlob.MakeFromText=function(d,l){var m=re(d)+1,b=n._malloc(m);return ve(d,rt,b,m),d=n.TextBlob._MakeFromText(b,m-1,l),n._free(b),d||null},n.MallocGlyphIDs=function(d){return n.Malloc(Uint16Array,d)}}),n.Td=n.Td||[],n.Td.push(function(){n.MakePicture=function(d){d=new Uint8Array(d);var l=n._malloc(d.byteLength);return n.HEAPU8.set(d,l),(d=n._MakePicture(l,d.byteLength))?d:null}}),n.Td=n.Td||[],n.Td.push(function(){n.RuntimeEffect.Make=function(d,l){return n.RuntimeEffect._Make(d,{onError:l||function(m){console.log("RuntimeEffect error",m)}})},n.RuntimeEffect.MakeForBlender=function(d,l){return n.RuntimeEffect._MakeForBlender(d,{onError:l||function(m){console.log("RuntimeEffect error",m)}})},n.RuntimeEffect.prototype.makeShader=function(d,l){var m=!d._ck,b=H(d,"HEAPF32");return l=ot(l),this._makeShader(b,4*d.length,m,l)},n.RuntimeEffect.prototype.makeShaderWithChildren=function(d,l,m){var b=!d._ck,D=H(d,"HEAPF32");m=ot(m);for(var O=[],q=0;q<l.length;q++)O.push(l[q].Jd.Rd);return l=H(O,"HEAPU32"),this._makeShaderWithChildren(D,4*d.length,b,l,O.length,m)},n.RuntimeEffect.prototype.makeBlender=function(d){var l=!d._ck,m=H(d,"HEAPF32");return this._makeBlender(m,4*d.length,l)}}),function(){function d(it){for(var w=0;w<it.length;w++)if(it[w]!==void 0&&!Number.isFinite(it[w]))return!1;return!0}function l(it){var w=n.getColorComponents(it);it=w[0];var I=w[1],$=w[2];return w=w[3],w===1?(it=it.toString(16).toLowerCase(),I=I.toString(16).toLowerCase(),$=$.toString(16).toLowerCase(),it=it.length===1?"0"+it:it,I=I.length===1?"0"+I:I,$=$.length===1?"0"+$:$,"#"+it+I+$):(w=w===0||w===1?w:w.toFixed(8),"rgba("+it+", "+I+", "+$+", "+w+")")}function m(it){return n.parseColorString(it,pn)}function b(it){if(it=mn.exec(it),!it)return null;var w=parseFloat(it[4]),I=16;switch(it[5]){case"em":case"rem":I=16*w;break;case"pt":I=4*w/3;break;case"px":I=w;break;case"pc":I=16*w;break;case"in":I=96*w;break;case"cm":I=96*w/2.54;break;case"mm":I=3.7795275590551185*w;break;case"q":I=.9448818897637796*w;break;case"%":I=.21333333333333335*w}return{style:it[1],variant:it[2],weight:it[3],sizePx:I,family:it[6].trim()}}function D(it){this.Ld=it,this.Od=new n.Paint,this.Od.setAntiAlias(!0),this.Od.setStrokeMiter(10),this.Od.setStrokeCap(n.StrokeCap.Butt),this.Od.setStrokeJoin(n.StrokeJoin.Miter),this.Re="10px monospace",this.me=new n.Font(null,10),this.me.setSubpixel(!0),this.ae=this.ge=n.BLACK,this.ve=0,this.Je=n.TRANSPARENT,this.xe=this.we=0,this.Ke=this.ie=1,this.Ie=0,this.ue=[],this.Nd=n.BlendMode.SrcOver,this.Od.setStrokeWidth(this.Ke),this.Od.setBlendMode(this.Nd),this.Qd=new n.Path,this.Sd=n.Matrix.identity(),this.lf=[],this.Be=[],this.le=function(){this.Qd.delete(),this.Od.delete(),this.me.delete(),this.Be.forEach(function(w){w.le()})},Object.defineProperty(this,"currentTransform",{enumerable:!0,get:function(){return{a:this.Sd[0],c:this.Sd[1],e:this.Sd[2],b:this.Sd[3],d:this.Sd[4],f:this.Sd[5]}},set:function(w){w.a&&this.setTransform(w.a,w.b,w.c,w.d,w.e,w.f)}}),Object.defineProperty(this,"fillStyle",{enumerable:!0,get:function(){return f(this.ae)?l(this.ae):this.ae},set:function(w){typeof w=="string"?this.ae=m(w):w.te&&(this.ae=w)}}),Object.defineProperty(this,"font",{enumerable:!0,get:function(){return this.Re},set:function(w){var I=b(w),$=I.family;I.typeface=Be[$]?Be[$][(I.style||"normal")+"|"+(I.variant||"normal")+"|"+(I.weight||"normal")]||Be[$]["*"]:null,I&&(this.me.setSize(I.sizePx),this.me.setTypeface(I.typeface),this.Re=w)}}),Object.defineProperty(this,"globalAlpha",{enumerable:!0,get:function(){return this.ie},set:function(w){!isFinite(w)||0>w||1<w||(this.ie=w)}}),Object.defineProperty(this,"globalCompositeOperation",{enumerable:!0,get:function(){switch(this.Nd){case n.BlendMode.SrcOver:return"source-over";case n.BlendMode.DstOver:return"destination-over";case n.BlendMode.Src:return"copy";case n.BlendMode.Dst:return"destination";case n.BlendMode.Clear:return"clear";case n.BlendMode.SrcIn:return"source-in";case n.BlendMode.DstIn:return"destination-in";case n.BlendMode.SrcOut:return"source-out";case n.BlendMode.DstOut:return"destination-out";case n.BlendMode.SrcATop:return"source-atop";case n.BlendMode.DstATop:return"destination-atop";case n.BlendMode.Xor:return"xor";case n.BlendMode.Plus:return"lighter";case n.BlendMode.Multiply:return"multiply";case n.BlendMode.Screen:return"screen";case n.BlendMode.Overlay:return"overlay";case n.BlendMode.Darken:return"darken";case n.BlendMode.Lighten:return"lighten";case n.BlendMode.ColorDodge:return"color-dodge";case n.BlendMode.ColorBurn:return"color-burn";case n.BlendMode.HardLight:return"hard-light";case n.BlendMode.SoftLight:return"soft-light";case n.BlendMode.Difference:return"difference";case n.BlendMode.Exclusion:return"exclusion";case n.BlendMode.Hue:return"hue";case n.BlendMode.Saturation:return"saturation";case n.BlendMode.Color:return"color";case n.BlendMode.Luminosity:return"luminosity"}},set:function(w){switch(w){case"source-over":this.Nd=n.BlendMode.SrcOver;break;case"destination-over":this.Nd=n.BlendMode.DstOver;break;case"copy":this.Nd=n.BlendMode.Src;break;case"destination":this.Nd=n.BlendMode.Dst;break;case"clear":this.Nd=n.BlendMode.Clear;break;case"source-in":this.Nd=n.BlendMode.SrcIn;break;case"destination-in":this.Nd=n.BlendMode.DstIn;break;case"source-out":this.Nd=n.BlendMode.SrcOut;break;case"destination-out":this.Nd=n.BlendMode.DstOut;break;case"source-atop":this.Nd=n.BlendMode.SrcATop;break;case"destination-atop":this.Nd=n.BlendMode.DstATop;break;case"xor":this.Nd=n.BlendMode.Xor;break;case"lighter":this.Nd=n.BlendMode.Plus;break;case"plus-lighter":this.Nd=n.BlendMode.Plus;break;case"plus-darker":throw"plus-darker is not supported";case"multiply":this.Nd=n.BlendMode.Multiply;break;case"screen":this.Nd=n.BlendMode.Screen;break;case"overlay":this.Nd=n.BlendMode.Overlay;break;case"darken":this.Nd=n.BlendMode.Darken;break;case"lighten":this.Nd=n.BlendMode.Lighten;break;case"color-dodge":this.Nd=n.BlendMode.ColorDodge;break;case"color-burn":this.Nd=n.BlendMode.ColorBurn;break;case"hard-light":this.Nd=n.BlendMode.HardLight;break;case"soft-light":this.Nd=n.BlendMode.SoftLight;break;case"difference":this.Nd=n.BlendMode.Difference;break;case"exclusion":this.Nd=n.BlendMode.Exclusion;break;case"hue":this.Nd=n.BlendMode.Hue;break;case"saturation":this.Nd=n.BlendMode.Saturation;break;case"color":this.Nd=n.BlendMode.Color;break;case"luminosity":this.Nd=n.BlendMode.Luminosity;break;default:return}this.Od.setBlendMode(this.Nd)}}),Object.defineProperty(this,"imageSmoothingEnabled",{enumerable:!0,get:function(){return!0},set:function(){}}),Object.defineProperty(this,"imageSmoothingQuality",{enumerable:!0,get:function(){return"high"},set:function(){}}),Object.defineProperty(this,"lineCap",{enumerable:!0,get:function(){switch(this.Od.getStrokeCap()){case n.StrokeCap.Butt:return"butt";case n.StrokeCap.Round:return"round";case n.StrokeCap.Square:return"square"}},set:function(w){switch(w){case"butt":this.Od.setStrokeCap(n.StrokeCap.Butt);break;case"round":this.Od.setStrokeCap(n.StrokeCap.Round);break;case"square":this.Od.setStrokeCap(n.StrokeCap.Square)}}}),Object.defineProperty(this,"lineDashOffset",{enumerable:!0,get:function(){return this.Ie},set:function(w){isFinite(w)&&(this.Ie=w)}}),Object.defineProperty(this,"lineJoin",{enumerable:!0,get:function(){switch(this.Od.getStrokeJoin()){case n.StrokeJoin.Miter:return"miter";case n.StrokeJoin.Round:return"round";case n.StrokeJoin.Bevel:return"bevel"}},set:function(w){switch(w){case"miter":this.Od.setStrokeJoin(n.StrokeJoin.Miter);break;case"round":this.Od.setStrokeJoin(n.StrokeJoin.Round);break;case"bevel":this.Od.setStrokeJoin(n.StrokeJoin.Bevel)}}}),Object.defineProperty(this,"lineWidth",{enumerable:!0,get:function(){return this.Od.getStrokeWidth()},set:function(w){0>=w||!w||(this.Ke=w,this.Od.setStrokeWidth(w))}}),Object.defineProperty(this,"miterLimit",{enumerable:!0,get:function(){return this.Od.getStrokeMiter()},set:function(w){0>=w||!w||this.Od.setStrokeMiter(w)}}),Object.defineProperty(this,"shadowBlur",{enumerable:!0,get:function(){return this.ve},set:function(w){0>w||!isFinite(w)||(this.ve=w)}}),Object.defineProperty(this,"shadowColor",{enumerable:!0,get:function(){return l(this.Je)},set:function(w){this.Je=m(w)}}),Object.defineProperty(this,"shadowOffsetX",{enumerable:!0,get:function(){return this.we},set:function(w){isFinite(w)&&(this.we=w)}}),Object.defineProperty(this,"shadowOffsetY",{enumerable:!0,get:function(){return this.xe},set:function(w){isFinite(w)&&(this.xe=w)}}),Object.defineProperty(this,"strokeStyle",{enumerable:!0,get:function(){return l(this.ge)},set:function(w){typeof w=="string"?this.ge=m(w):w.te&&(this.ge=w)}}),this.arc=function(w,I,$,J,nt,at){k(this.Qd,w,I,$,$,0,J,nt,at)},this.arcTo=function(w,I,$,J,nt){xt(this.Qd,w,I,$,J,nt)},this.beginPath=function(){this.Qd.delete(),this.Qd=new n.Path},this.bezierCurveTo=function(w,I,$,J,nt,at){var pt=this.Qd;d([w,I,$,J,nt,at])&&(pt.isEmpty()&&pt.moveTo(w,I),pt.cubicTo(w,I,$,J,nt,at))},this.clearRect=function(w,I,$,J){this.Od.setStyle(n.PaintStyle.Fill),this.Od.setBlendMode(n.BlendMode.Clear),this.Ld.drawRect(n.XYWHRect(w,I,$,J),this.Od),this.Od.setBlendMode(this.Nd)},this.clip=function(w,I){typeof w=="string"?(I=w,w=this.Qd):w&&w.af&&(w=w.Ud),w||(w=this.Qd),w=w.copy(),I&&I.toLowerCase()==="evenodd"?w.setFillType(n.FillType.EvenOdd):w.setFillType(n.FillType.Winding),this.Ld.clipPath(w,n.ClipOp.Intersect,!0),w.delete()},this.closePath=function(){Ot(this.Qd)},this.createImageData=function(){if(arguments.length===1){var w=arguments[0];return new ct(new Uint8ClampedArray(4*w.width*w.height),w.width,w.height)}if(arguments.length===2){w=arguments[0];var I=arguments[1];return new ct(new Uint8ClampedArray(4*w*I),w,I)}throw"createImageData expects 1 or 2 arguments, got "+arguments.length},this.createLinearGradient=function(w,I,$,J){if(d(arguments)){var nt=new Ct(w,I,$,J);return this.Be.push(nt),nt}},this.createPattern=function(w,I){return w=new jt(w,I),this.Be.push(w),w},this.createRadialGradient=function(w,I,$,J,nt,at){if(d(arguments)){var pt=new fe(w,I,$,J,nt,at);return this.Be.push(pt),pt}},this.drawImage=function(w){w instanceof q&&(w=w.tf());var I=this.Qe();if(arguments.length===3||arguments.length===5)var $=n.XYWHRect(arguments[1],arguments[2],arguments[3]||w.width(),arguments[4]||w.height()),J=n.XYWHRect(0,0,w.width(),w.height());else if(arguments.length===9)$=n.XYWHRect(arguments[5],arguments[6],arguments[7],arguments[8]),J=n.XYWHRect(arguments[1],arguments[2],arguments[3],arguments[4]);else throw"invalid number of args for drawImage, need 3, 5, or 9; got "+arguments.length;this.Ld.drawImageRect(w,J,$,I,!1),I.dispose()},this.ellipse=function(w,I,$,J,nt,at,pt,Yt){k(this.Qd,w,I,$,J,nt,at,pt,Yt)},this.Qe=function(){var w=this.Od.copy();if(w.setStyle(n.PaintStyle.Fill),f(this.ae)){var I=n.multiplyByAlpha(this.ae,this.ie);w.setColor(I)}else I=this.ae.te(this.Sd),w.setColor(n.Color(0,0,0,this.ie)),w.setShader(I);return w.dispose=function(){this.delete()},w},this.fill=function(w,I){if(typeof w=="string"?(I=w,w=this.Qd):w&&w.af&&(w=w.Ud),I==="evenodd")this.Qd.setFillType(n.FillType.EvenOdd);else{if(I!=="nonzero"&&I)throw"invalid fill rule";this.Qd.setFillType(n.FillType.Winding)}w||(w=this.Qd),I=this.Qe();var $=this.ye(I);$&&(this.Ld.save(),this.re(),this.Ld.drawPath(w,$),this.Ld.restore(),$.dispose()),this.Ld.drawPath(w,I),I.dispose()},this.fillRect=function(w,I,$,J){var nt=this.Qe(),at=this.ye(nt);at&&(this.Ld.save(),this.re(),this.Ld.drawRect(n.XYWHRect(w,I,$,J),at),this.Ld.restore(),at.dispose()),this.Ld.drawRect(n.XYWHRect(w,I,$,J),nt),nt.dispose()},this.fillText=function(w,I,$){var J=this.Qe();w=n.TextBlob.MakeFromText(w,this.me);var nt=this.ye(J);nt&&(this.Ld.save(),this.re(),this.Ld.drawTextBlob(w,I,$,nt),this.Ld.restore(),nt.dispose()),this.Ld.drawTextBlob(w,I,$,J),w.delete(),J.dispose()},this.getImageData=function(w,I,$,J){return(w=this.Ld.readPixels(w,I,{width:$,height:J,colorType:n.ColorType.RGBA_8888,alphaType:n.AlphaType.Unpremul,colorSpace:n.ColorSpace.SRGB}))?new ct(new Uint8ClampedArray(w.buffer),$,J):null},this.getLineDash=function(){return this.ue.slice()},this.mf=function(w){var I=n.Matrix.invert(this.Sd);return n.Matrix.mapPoints(I,w),w},this.isPointInPath=function(w,I,$){var J=arguments;if(J.length===3)var nt=this.Qd;else if(J.length===4)nt=J[0],w=J[1],I=J[2],$=J[3];else throw"invalid arg count, need 3 or 4, got "+J.length;return!isFinite(w)||!isFinite(I)||($=$||"nonzero",$!=="nonzero"&&$!=="evenodd")?!1:(J=this.mf([w,I]),w=J[0],I=J[1],nt.setFillType($==="nonzero"?n.FillType.Winding:n.FillType.EvenOdd),nt.contains(w,I))},this.isPointInStroke=function(w,I){var $=arguments;if($.length===2)var J=this.Qd;else if($.length===3)J=$[0],w=$[1],I=$[2];else throw"invalid arg count, need 2 or 3, got "+$.length;return!isFinite(w)||!isFinite(I)?!1:($=this.mf([w,I]),w=$[0],I=$[1],J=J.copy(),J.setFillType(n.FillType.Winding),J.stroke({width:this.lineWidth,miter_limit:this.miterLimit,cap:this.Od.getStrokeCap(),join:this.Od.getStrokeJoin(),precision:.3}),$=J.contains(w,I),J.delete(),$)},this.lineTo=function(w,I){tt(this.Qd,w,I)},this.measureText=function(w){w=this.me.getGlyphIDs(w),w=this.me.getGlyphWidths(w);let I=0;for(const $ of w)I+=$;return{width:I}},this.moveTo=function(w,I){var $=this.Qd;d([w,I])&&$.moveTo(w,I)},this.putImageData=function(w,I,$,J,nt,at,pt){if(d([I,$,J,nt,at,pt])){if(J===void 0)this.Ld.writePixels(w.data,w.width,w.height,I,$);else if(J=J||0,nt=nt||0,at=at||w.width,pt=pt||w.height,0>at&&(J+=at,at=Math.abs(at)),0>pt&&(nt+=pt,pt=Math.abs(pt)),0>J&&(at+=J,J=0),0>nt&&(pt+=nt,nt=0),!(0>=at||0>=pt)){w=n.MakeImage({width:w.width,height:w.height,alphaType:n.AlphaType.Unpremul,colorType:n.ColorType.RGBA_8888,colorSpace:n.ColorSpace.SRGB},w.data,4*w.width);var Yt=n.XYWHRect(J,nt,at,pt);I=n.XYWHRect(I+J,$+nt,at,pt),$=n.Matrix.invert(this.Sd),this.Ld.save(),this.Ld.concat($),this.Ld.drawImageRect(w,Yt,I,null,!1),this.Ld.restore(),w.delete()}}},this.quadraticCurveTo=function(w,I,$,J){var nt=this.Qd;d([w,I,$,J])&&(nt.isEmpty()&&nt.moveTo(w,I),nt.quadTo(w,I,$,J))},this.rect=function(w,I,$,J){var nt=this.Qd;w=n.XYWHRect(w,I,$,J),d(w)&&nt.addRect(w)},this.resetTransform=function(){this.Qd.transform(this.Sd);var w=n.Matrix.invert(this.Sd);this.Ld.concat(w),this.Sd=this.Ld.getTotalMatrix()},this.restore=function(){var w=this.lf.pop();if(w){var I=n.Matrix.multiply(this.Sd,n.Matrix.invert(w.Jf));this.Qd.transform(I),this.Od.delete(),this.Od=w.ag,this.ue=w.Zf,this.Ke=w.mg,this.ge=w.lg,this.ae=w.fs,this.we=w.jg,this.xe=w.kg,this.ve=w.sb,this.Je=w.ig,this.ie=w.ga,this.Nd=w.Qf,this.Ie=w.$f,this.Re=w.Pf,this.Ld.restore(),this.Sd=this.Ld.getTotalMatrix()}},this.rotate=function(w){if(isFinite(w)){var I=n.Matrix.rotated(-w);this.Qd.transform(I),this.Ld.rotate(w/Math.PI*180,0,0),this.Sd=this.Ld.getTotalMatrix()}},this.save=function(){if(this.ae.se){var w=this.ae.se();this.Be.push(w)}else w=this.ae;if(this.ge.se){var I=this.ge.se();this.Be.push(I)}else I=this.ge;this.lf.push({Jf:this.Sd.slice(),Zf:this.ue.slice(),mg:this.Ke,lg:I,fs:w,jg:this.we,kg:this.xe,sb:this.ve,ig:this.Je,ga:this.ie,$f:this.Ie,Qf:this.Nd,ag:this.Od.copy(),Pf:this.Re}),this.Ld.save()},this.scale=function(w,I){if(d(arguments)){var $=n.Matrix.scaled(1/w,1/I);this.Qd.transform($),this.Ld.scale(w,I),this.Sd=this.Ld.getTotalMatrix()}},this.setLineDash=function(w){for(var I=0;I<w.length;I++)if(!isFinite(w[I])||0>w[I])return;w.length%2===1&&Array.prototype.push.apply(w,w),this.ue=w},this.setTransform=function(w,I,$,J,nt,at){d(arguments)&&(this.resetTransform(),this.transform(w,I,$,J,nt,at))},this.re=function(){var w=n.Matrix.invert(this.Sd);this.Ld.concat(w),this.Ld.concat(n.Matrix.translated(this.we,this.xe)),this.Ld.concat(this.Sd)},this.ye=function(w){var I=n.multiplyByAlpha(this.Je,this.ie);if(!n.getColorComponents(I)[3]||!(this.ve||this.xe||this.we))return null;w=w.copy(),w.setColor(I);var $=n.MaskFilter.MakeBlur(n.BlurStyle.Normal,this.ve/2,!1);return w.setMaskFilter($),w.dispose=function(){$.delete(),this.delete()},w},this.cf=function(){var w=this.Od.copy();if(w.setStyle(n.PaintStyle.Stroke),f(this.ge)){var I=n.multiplyByAlpha(this.ge,this.ie);w.setColor(I)}else I=this.ge.te(this.Sd),w.setColor(n.Color(0,0,0,this.ie)),w.setShader(I);if(w.setStrokeWidth(this.Ke),this.ue.length){var $=n.PathEffect.MakeDash(this.ue,this.Ie);w.setPathEffect($)}return w.dispose=function(){$&&$.delete(),this.delete()},w},this.stroke=function(w){w=w?w.Ud:this.Qd;var I=this.cf(),$=this.ye(I);$&&(this.Ld.save(),this.re(),this.Ld.drawPath(w,$),this.Ld.restore(),$.dispose()),this.Ld.drawPath(w,I),I.dispose()},this.strokeRect=function(w,I,$,J){var nt=this.cf(),at=this.ye(nt);at&&(this.Ld.save(),this.re(),this.Ld.drawRect(n.XYWHRect(w,I,$,J),at),this.Ld.restore(),at.dispose()),this.Ld.drawRect(n.XYWHRect(w,I,$,J),nt),nt.dispose()},this.strokeText=function(w,I,$){var J=this.cf();w=n.TextBlob.MakeFromText(w,this.me);var nt=this.ye(J);nt&&(this.Ld.save(),this.re(),this.Ld.drawTextBlob(w,I,$,nt),this.Ld.restore(),nt.dispose()),this.Ld.drawTextBlob(w,I,$,J),w.delete(),J.dispose()},this.translate=function(w,I){if(d(arguments)){var $=n.Matrix.translated(-w,-I);this.Qd.transform($),this.Ld.translate(w,I),this.Sd=this.Ld.getTotalMatrix()}},this.transform=function(w,I,$,J,nt,at){w=[w,$,nt,I,J,at,0,0,1],I=n.Matrix.invert(w),this.Qd.transform(I),this.Ld.concat(w),this.Sd=this.Ld.getTotalMatrix()},this.addHitRegion=function(){},this.clearHitRegions=function(){},this.drawFocusIfNeeded=function(){},this.removeHitRegion=function(){},this.scrollPathIntoView=function(){},Object.defineProperty(this,"canvas",{value:null,writable:!1})}function O(it){this.df=it,this.Kd=new D(it.getCanvas()),this.Se=[],this.decodeImage=function(w){if(w=n.MakeImageFromEncoded(w),!w)throw"Invalid input";return this.Se.push(w),new q(w)},this.loadFont=function(w,I){if(w=n.Typeface.MakeFreeTypeFaceFromData(w),!w)return null;this.Se.push(w);var $=(I.style||"normal")+"|"+(I.variant||"normal")+"|"+(I.weight||"normal");I=I.family,Be[I]||(Be[I]={"*":w}),Be[I][$]=w},this.makePath2D=function(w){return w=new kt(w),this.Se.push(w.Ud),w},this.getContext=function(w){return w==="2d"?this.Kd:null},this.toDataURL=function(w,I){this.df.flush();var $=this.df.makeImageSnapshot();if($){w=w||"image/png";var J=n.ImageFormat.PNG;if(w==="image/jpeg"&&(J=n.ImageFormat.JPEG),I=$.encodeToBytes(J,I||.92)){if($.delete(),w="data:"+w+";base64,",typeof Buffer<"u")I=Buffer.from(I).toString("base64");else{$=0,J=I.length;for(var nt="",at;$<J;)at=I.slice($,Math.min($+32768,J)),nt+=String.fromCharCode.apply(null,at),$+=32768;I=btoa(nt)}return w+I}}},this.dispose=function(){this.Kd.le(),this.Se.forEach(function(w){w.delete()}),this.df.dispose()}}function q(it){this.width=it.width(),this.height=it.height(),this.naturalWidth=this.width,this.naturalHeight=this.height,this.tf=function(){return it}}function ct(it,w,I){if(!w||I===0)throw"invalid dimensions, width and height must be non-zero";if(it.length%4)throw"arr must be a multiple of 4";I=I||it.length/(4*w),Object.defineProperty(this,"data",{value:it,writable:!1}),Object.defineProperty(this,"height",{value:I,writable:!1}),Object.defineProperty(this,"width",{value:w,writable:!1})}function Ct(it,w,I,$){this.Wd=null,this.ce=[],this.Zd=[],this.addColorStop=function(J,nt){if(0>J||1<J||!isFinite(J))throw"offset must be between 0 and 1 inclusively";nt=m(nt);var at=this.Zd.indexOf(J);if(at!==-1)this.ce[at]=nt;else{for(at=0;at<this.Zd.length&&!(this.Zd[at]>J);at++);this.Zd.splice(at,0,J),this.ce.splice(at,0,nt)}},this.se=function(){var J=new Ct(it,w,I,$);return J.ce=this.ce.slice(),J.Zd=this.Zd.slice(),J},this.le=function(){this.Wd&&(this.Wd.delete(),this.Wd=null)},this.te=function(J){var nt=[it,w,I,$];n.Matrix.mapPoints(J,nt),J=nt[0];var at=nt[1],pt=nt[2];return nt=nt[3],this.le(),this.Wd=n.Shader.MakeLinearGradient([J,at],[pt,nt],this.ce,this.Zd,n.TileMode.Clamp)}}function xt(it,w,I,$,J,nt){if(d([w,I,$,J,nt])){if(0>nt)throw"radii cannot be negative";it.isEmpty()&&it.moveTo(w,I),it.arcToTangent(w,I,$,J,nt)}}function Ot(it){if(!it.isEmpty()){var w=it.getBounds();(w[3]-w[1]||w[2]-w[0])&&it.close()}}function zt(it,w,I,$,J,nt,at){at=(at-nt)/Math.PI*180,nt=nt/Math.PI*180,w=n.LTRBRect(w-$,I-J,w+$,I+J),1e-5>Math.abs(Math.abs(at)-360)?(I=at/2,it.arcToOval(w,nt,I,!1),it.arcToOval(w,nt+I,I,!1)):it.arcToOval(w,nt,at,!1)}function k(it,w,I,$,J,nt,at,pt,Yt){if(d([w,I,$,J,nt,at,pt])){if(0>$||0>J)throw"radii cannot be negative";var Ut=2*Math.PI,Dn=at%Ut;0>Dn&&(Dn+=Ut);var es=Dn-at;at=Dn,pt+=es,!Yt&&pt-at>=Ut?pt=at+Ut:Yt&&at-pt>=Ut?pt=at-Ut:!Yt&&at>pt?pt=at+(Ut-(at-pt)%Ut):Yt&&at<pt&&(pt=at-(Ut-(pt-at)%Ut)),nt?(Yt=n.Matrix.rotated(nt,w,I),nt=n.Matrix.rotated(-nt,w,I),it.transform(nt),zt(it,w,I,$,J,at,pt),it.transform(Yt)):zt(it,w,I,$,J,at,pt)}}function tt(it,w,I){d([w,I])&&(it.isEmpty()&&it.moveTo(w,I),it.lineTo(w,I))}function kt(it){this.Ud=null,this.Ud=typeof it=="string"?n.Path.MakeFromSVGString(it):it&&it.af?it.Ud.copy():new n.Path,this.af=function(){return this.Ud},this.addPath=function(w,I){I||(I={a:1,c:0,e:0,b:0,d:1,f:0}),this.Ud.addPath(w.Ud,[I.a,I.c,I.e,I.b,I.d,I.f])},this.arc=function(w,I,$,J,nt,at){k(this.Ud,w,I,$,$,0,J,nt,at)},this.arcTo=function(w,I,$,J,nt){xt(this.Ud,w,I,$,J,nt)},this.bezierCurveTo=function(w,I,$,J,nt,at){var pt=this.Ud;d([w,I,$,J,nt,at])&&(pt.isEmpty()&&pt.moveTo(w,I),pt.cubicTo(w,I,$,J,nt,at))},this.closePath=function(){Ot(this.Ud)},this.ellipse=function(w,I,$,J,nt,at,pt,Yt){k(this.Ud,w,I,$,J,nt,at,pt,Yt)},this.lineTo=function(w,I){tt(this.Ud,w,I)},this.moveTo=function(w,I){var $=this.Ud;d([w,I])&&$.moveTo(w,I)},this.quadraticCurveTo=function(w,I,$,J){var nt=this.Ud;d([w,I,$,J])&&(nt.isEmpty()&&nt.moveTo(w,I),nt.quadTo(w,I,$,J))},this.rect=function(w,I,$,J){var nt=this.Ud;w=n.XYWHRect(w,I,$,J),d(w)&&nt.addRect(w)}}function jt(it,w){switch(this.Wd=null,it instanceof q&&(it=it.tf()),this.Ef=it,this._transform=n.Matrix.identity(),w===""&&(w="repeat"),w){case"repeat-x":this.ze=n.TileMode.Repeat,this.Ae=n.TileMode.Decal;break;case"repeat-y":this.ze=n.TileMode.Decal,this.Ae=n.TileMode.Repeat;break;case"repeat":this.Ae=this.ze=n.TileMode.Repeat;break;case"no-repeat":this.Ae=this.ze=n.TileMode.Decal;break;default:throw"invalid repetition mode "+w}this.setTransform=function(I){I=[I.a,I.c,I.e,I.b,I.d,I.f,0,0,1],d(I)&&(this._transform=I)},this.se=function(){var I=new jt;return I.ze=this.ze,I.Ae=this.Ae,I},this.le=function(){this.Wd&&(this.Wd.delete(),this.Wd=null)},this.te=function(){return this.le(),this.Wd=this.Ef.makeShaderCubic(this.ze,this.Ae,.3333333333333333,.3333333333333333,this._transform)}}function fe(it,w,I,$,J,nt){this.Wd=null,this.ce=[],this.Zd=[],this.addColorStop=function(at,pt){if(0>at||1<at||!isFinite(at))throw"offset must be between 0 and 1 inclusively";pt=m(pt);var Yt=this.Zd.indexOf(at);if(Yt!==-1)this.ce[Yt]=pt;else{for(Yt=0;Yt<this.Zd.length&&!(this.Zd[Yt]>at);Yt++);this.Zd.splice(Yt,0,at),this.ce.splice(Yt,0,pt)}},this.se=function(){var at=new fe(it,w,I,$,J,nt);return at.ce=this.ce.slice(),at.Zd=this.Zd.slice(),at},this.le=function(){this.Wd&&(this.Wd.delete(),this.Wd=null)},this.te=function(at){var pt=[it,w,$,J];n.Matrix.mapPoints(at,pt);var Yt=pt[0],Ut=pt[1],Dn=pt[2];pt=pt[3];var es=(Math.abs(at[0])+Math.abs(at[4]))/2;return at=I*es,es*=nt,this.le(),this.Wd=n.Shader.MakeTwoPointConicalGradient([Yt,Ut],at,[Dn,pt],es,this.ce,this.Zd,n.TileMode.Clamp)}}n._testing={};var pn={aliceblue:Float32Array.of(.941,.973,1,1),antiquewhite:Float32Array.of(.98,.922,.843,1),aqua:Float32Array.of(0,1,1,1),aquamarine:Float32Array.of(.498,1,.831,1),azure:Float32Array.of(.941,1,1,1),beige:Float32Array.of(.961,.961,.863,1),bisque:Float32Array.of(1,.894,.769,1),black:Float32Array.of(0,0,0,1),blanchedalmond:Float32Array.of(1,.922,.804,1),blue:Float32Array.of(0,0,1,1),blueviolet:Float32Array.of(.541,.169,.886,1),brown:Float32Array.of(.647,.165,.165,1),burlywood:Float32Array.of(.871,.722,.529,1),cadetblue:Float32Array.of(.373,.62,.627,1),chartreuse:Float32Array.of(.498,1,0,1),chocolate:Float32Array.of(.824,.412,.118,1),coral:Float32Array.of(1,.498,.314,1),cornflowerblue:Float32Array.of(.392,.584,.929,1),cornsilk:Float32Array.of(1,.973,.863,1),crimson:Float32Array.of(.863,.078,.235,1),cyan:Float32Array.of(0,1,1,1),darkblue:Float32Array.of(0,0,.545,1),darkcyan:Float32Array.of(0,.545,.545,1),darkgoldenrod:Float32Array.of(.722,.525,.043,1),darkgray:Float32Array.of(.663,.663,.663,1),darkgreen:Float32Array.of(0,.392,0,1),darkgrey:Float32Array.of(.663,.663,.663,1),darkkhaki:Float32Array.of(.741,.718,.42,1),darkmagenta:Float32Array.of(.545,0,.545,1),darkolivegreen:Float32Array.of(.333,.42,.184,1),darkorange:Float32Array.of(1,.549,0,1),darkorchid:Float32Array.of(.6,.196,.8,1),darkred:Float32Array.of(.545,0,0,1),darksalmon:Float32Array.of(.914,.588,.478,1),darkseagreen:Float32Array.of(.561,.737,.561,1),darkslateblue:Float32Array.of(.282,.239,.545,1),darkslategray:Float32Array.of(.184,.31,.31,1),darkslategrey:Float32Array.of(.184,.31,.31,1),darkturquoise:Float32Array.of(0,.808,.82,1),darkviolet:Float32Array.of(.58,0,.827,1),deeppink:Float32Array.of(1,.078,.576,1),deepskyblue:Float32Array.of(0,.749,1,1),dimgray:Float32Array.of(.412,.412,.412,1),dimgrey:Float32Array.of(.412,.412,.412,1),dodgerblue:Float32Array.of(.118,.565,1,1),firebrick:Float32Array.of(.698,.133,.133,1),floralwhite:Float32Array.of(1,.98,.941,1),forestgreen:Float32Array.of(.133,.545,.133,1),fuchsia:Float32Array.of(1,0,1,1),gainsboro:Float32Array.of(.863,.863,.863,1),ghostwhite:Float32Array.of(.973,.973,1,1),gold:Float32Array.of(1,.843,0,1),goldenrod:Float32Array.of(.855,.647,.125,1),gray:Float32Array.of(.502,.502,.502,1),green:Float32Array.of(0,.502,0,1),greenyellow:Float32Array.of(.678,1,.184,1),grey:Float32Array.of(.502,.502,.502,1),honeydew:Float32Array.of(.941,1,.941,1),hotpink:Float32Array.of(1,.412,.706,1),indianred:Float32Array.of(.804,.361,.361,1),indigo:Float32Array.of(.294,0,.51,1),ivory:Float32Array.of(1,1,.941,1),khaki:Float32Array.of(.941,.902,.549,1),lavender:Float32Array.of(.902,.902,.98,1),lavenderblush:Float32Array.of(1,.941,.961,1),lawngreen:Float32Array.of(.486,.988,0,1),lemonchiffon:Float32Array.of(1,.98,.804,1),lightblue:Float32Array.of(.678,.847,.902,1),lightcoral:Float32Array.of(.941,.502,.502,1),lightcyan:Float32Array.of(.878,1,1,1),lightgoldenrodyellow:Float32Array.of(.98,.98,.824,1),lightgray:Float32Array.of(.827,.827,.827,1),lightgreen:Float32Array.of(.565,.933,.565,1),lightgrey:Float32Array.of(.827,.827,.827,1),lightpink:Float32Array.of(1,.714,.757,1),lightsalmon:Float32Array.of(1,.627,.478,1),lightseagreen:Float32Array.of(.125,.698,.667,1),lightskyblue:Float32Array.of(.529,.808,.98,1),lightslategray:Float32Array.of(.467,.533,.6,1),lightslategrey:Float32Array.of(.467,.533,.6,1),lightsteelblue:Float32Array.of(.69,.769,.871,1),lightyellow:Float32Array.of(1,1,.878,1),lime:Float32Array.of(0,1,0,1),limegreen:Float32Array.of(.196,.804,.196,1),linen:Float32Array.of(.98,.941,.902,1),magenta:Float32Array.of(1,0,1,1),maroon:Float32Array.of(.502,0,0,1),mediumaquamarine:Float32Array.of(.4,.804,.667,1),mediumblue:Float32Array.of(0,0,.804,1),mediumorchid:Float32Array.of(.729,.333,.827,1),mediumpurple:Float32Array.of(.576,.439,.859,1),mediumseagreen:Float32Array.of(.235,.702,.443,1),mediumslateblue:Float32Array.of(.482,.408,.933,1),mediumspringgreen:Float32Array.of(0,.98,.604,1),mediumturquoise:Float32Array.of(.282,.82,.8,1),mediumvioletred:Float32Array.of(.78,.082,.522,1),midnightblue:Float32Array.of(.098,.098,.439,1),mintcream:Float32Array.of(.961,1,.98,1),mistyrose:Float32Array.of(1,.894,.882,1),moccasin:Float32Array.of(1,.894,.71,1),navajowhite:Float32Array.of(1,.871,.678,1),navy:Float32Array.of(0,0,.502,1),oldlace:Float32Array.of(.992,.961,.902,1),olive:Float32Array.of(.502,.502,0,1),olivedrab:Float32Array.of(.42,.557,.137,1),orange:Float32Array.of(1,.647,0,1),orangered:Float32Array.of(1,.271,0,1),orchid:Float32Array.of(.855,.439,.839,1),palegoldenrod:Float32Array.of(.933,.91,.667,1),palegreen:Float32Array.of(.596,.984,.596,1),paleturquoise:Float32Array.of(.686,.933,.933,1),palevioletred:Float32Array.of(.859,.439,.576,1),papayawhip:Float32Array.of(1,.937,.835,1),peachpuff:Float32Array.of(1,.855,.725,1),peru:Float32Array.of(.804,.522,.247,1),pink:Float32Array.of(1,.753,.796,1),plum:Float32Array.of(.867,.627,.867,1),powderblue:Float32Array.of(.69,.878,.902,1),purple:Float32Array.of(.502,0,.502,1),rebeccapurple:Float32Array.of(.4,.2,.6,1),red:Float32Array.of(1,0,0,1),rosybrown:Float32Array.of(.737,.561,.561,1),royalblue:Float32Array.of(.255,.412,.882,1),saddlebrown:Float32Array.of(.545,.271,.075,1),salmon:Float32Array.of(.98,.502,.447,1),sandybrown:Float32Array.of(.957,.643,.376,1),seagreen:Float32Array.of(.18,.545,.341,1),seashell:Float32Array.of(1,.961,.933,1),sienna:Float32Array.of(.627,.322,.176,1),silver:Float32Array.of(.753,.753,.753,1),skyblue:Float32Array.of(.529,.808,.922,1),slateblue:Float32Array.of(.416,.353,.804,1),slategray:Float32Array.of(.439,.502,.565,1),slategrey:Float32Array.of(.439,.502,.565,1),snow:Float32Array.of(1,.98,.98,1),springgreen:Float32Array.of(0,1,.498,1),steelblue:Float32Array.of(.275,.51,.706,1),tan:Float32Array.of(.824,.706,.549,1),teal:Float32Array.of(0,.502,.502,1),thistle:Float32Array.of(.847,.749,.847,1),tomato:Float32Array.of(1,.388,.278,1),transparent:Float32Array.of(0,0,0,0),turquoise:Float32Array.of(.251,.878,.816,1),violet:Float32Array.of(.933,.51,.933,1),wheat:Float32Array.of(.961,.871,.702,1),white:Float32Array.of(1,1,1,1),whitesmoke:Float32Array.of(.961,.961,.961,1),yellow:Float32Array.of(1,1,0,1),yellowgreen:Float32Array.of(.604,.804,.196,1)};n._testing.parseColor=m,n._testing.colorToString=l;var mn=RegExp("(italic|oblique|normal|)\\s*(small-caps|normal|)\\s*(bold|bolder|lighter|[1-9]00|normal|)\\s*([\\d\\.]+)(px|pt|pc|in|cm|mm|%|em|ex|ch|rem|q)(.+)"),Be={"Noto Mono":{"*":null},monospace:{"*":null}};n._testing.parseFontString=b,n.MakeCanvas=function(it,w){return(it=n.MakeSurface(it,w))?new O(it):null},n.ImageData=function(){if(arguments.length===2){var it=arguments[0],w=arguments[1];return new ct(new Uint8ClampedArray(4*it*w),it,w)}if(arguments.length===3){var I=arguments[0];if(I.prototype.constructor!==Uint8ClampedArray)throw"bytes must be given as a Uint8ClampedArray";if(it=arguments[1],w=arguments[2],I%4)throw"bytes must be given in a multiple of 4";if(I%it)throw"bytes must divide evenly by width";if(w&&w!==I/(4*it))throw"invalid height given";return new ct(I,it,I/(4*it))}throw"invalid number of arguments - takes 2 or 3, saw "+arguments.length}}()}(o);var g=Object.assign({},o),y="./this.program",x=(n,a)=>{throw a},C=typeof window=="object",A=typeof importScripts=="function",_=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",F="",R,z,G;if(_){var V=Fc,j=Fc;F=A?j.dirname(F)+"/":__dirname+"/",R=(n,a)=>(n=n.startsWith("file://")?new URL(n):j.normalize(n),V.readFileSync(n,a?void 0:"utf8")),G=n=>(n=R(n,!0),n.buffer||(n=new Uint8Array(n)),n),z=(n,a,h,f=!0)=>{n=n.startsWith("file://")?new URL(n):j.normalize(n),V.readFile(n,f?void 0:"utf8",(v,M)=>{v?h(v):a(f?M.buffer:M)})},!o.thisProgram&&1<process.argv.length&&(y=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),x=(n,a)=>{throw process.exitCode=n,a},o.inspect=()=>"[Emscripten Module object]"}else(C||A)&&(A?F=self.location.href:typeof document<"u"&&document.currentScript&&(F=document.currentScript.src),r&&(F=r),F.indexOf("blob:")!==0?F=F.substr(0,F.replace(/[?#].*/,"").lastIndexOf("/")+1):F="",R=n=>{var a=new XMLHttpRequest;return a.open("GET",n,!1),a.send(null),a.responseText},A&&(G=n=>{var a=new XMLHttpRequest;return a.open("GET",n,!1),a.responseType="arraybuffer",a.send(null),new Uint8Array(a.response)}),z=(n,a,h)=>{var f=new XMLHttpRequest;f.open("GET",n,!0),f.responseType="arraybuffer",f.onload=()=>{f.status==200||f.status==0&&f.response?a(f.response):h()},f.onerror=h,f.send(null)});var U=o.print||console.log.bind(console),N=o.printErr||console.error.bind(console);Object.assign(o,g),g=null,o.thisProgram&&(y=o.thisProgram),o.quit&&(x=o.quit);var Q;o.wasmBinary&&(Q=o.wasmBinary),o.noExitRuntime,typeof WebAssembly!="object"&&ar("no native wasm support detected");var Y,Z,wt=!1,ut,rt,dt,Ht,st,_t,mt,Xt;function He(){var n=Y.buffer;o.HEAP8=ut=new Int8Array(n),o.HEAP16=dt=new Int16Array(n),o.HEAP32=st=new Int32Array(n),o.HEAPU8=rt=new Uint8Array(n),o.HEAPU16=Ht=new Uint16Array(n),o.HEAPU32=_t=new Uint32Array(n),o.HEAPF32=mt=new Float32Array(n),o.HEAPF64=Xt=new Float64Array(n)}var Kt,Tt=[],We=[],Me=[];function Zt(){var n=o.preRun.shift();Tt.unshift(n)}var Ke=0,Lt=null;function ar(n){throw o.onAbort&&o.onAbort(n),n="Aborted("+n+")",N(n),wt=!0,n=new WebAssembly.RuntimeError(n+". Build with -sASSERTIONS for more info."),u(n),n}function ai(n){return n.startsWith("data:application/octet-stream;base64,")}var me;if(me="canvaskit.wasm",!ai(me)){var Fr=me;me=o.locateFile?o.locateFile(Fr,F):F+Fr}function Lr(n){if(n==me&&Q)return new Uint8Array(Q);if(G)return G(n);throw"both async and sync fetching of the wasm failed"}function Hr(n){if(!Q&&(C||A)){if(typeof fetch=="function"&&!n.startsWith("file://"))return fetch(n,{credentials:"same-origin"}).then(a=>{if(!a.ok)throw"failed to load wasm binary file at '"+n+"'";return a.arrayBuffer()}).catch(()=>Lr(n));if(z)return new Promise((a,h)=>{z(n,f=>a(new Uint8Array(f)),h)})}return Promise.resolve().then(()=>Lr(n))}function cr(n,a,h){return Hr(n).then(f=>WebAssembly.instantiate(f,a)).then(f=>f).then(h,f=>{N("failed to asynchronously prepare wasm: "+f),ar(f)})}function ci(n,a){var h=me;return Q||typeof WebAssembly.instantiateStreaming!="function"||ai(h)||h.startsWith("file://")||_||typeof fetch!="function"?cr(h,n,a):fetch(h,{credentials:"same-origin"}).then(f=>WebAssembly.instantiateStreaming(f,n).then(a,function(v){return N("wasm streaming compile failed: "+v),N("falling back to ArrayBuffer instantiation"),cr(h,n,a)}))}function Wr(n){this.name="ExitStatus",this.message=`Program terminated with exit(${n})`,this.status=n}var hr=n=>{for(;0<n.length;)n.shift()(o)},lr=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,on=(n,a,h)=>{var f=a+h;for(h=a;n[h]&&!(h>=f);)++h;if(16<h-a&&n.buffer&&lr)return lr.decode(n.subarray(a,h));for(f="";a<h;){var v=n[a++];if(v&128){var M=n[a++]&63;if((v&224)==192)f+=String.fromCharCode((v&31)<<6|M);else{var B=n[a++]&63;v=(v&240)==224?(v&15)<<12|M<<6|B:(v&7)<<18|M<<12|B<<6|n[a++]&63,65536>v?f+=String.fromCharCode(v):(v-=65536,f+=String.fromCharCode(55296|v>>10,56320|v&1023))}}else f+=String.fromCharCode(v)}return f},dr={};function Or(n){for(;n.length;){var a=n.pop();n.pop()(a)}}function an(n){return this.fromWireType(st[n>>2])}var cn={},hn={},$n={},qe=void 0;function xn(n){throw new qe(n)}function Oe(n,a,h){function f(T){T=h(T),T.length!==n.length&&xn("Mismatched type converter count");for(var E=0;E<n.length;++E)$e(n[E],T[E])}n.forEach(function(T){$n[T]=a});var v=Array(a.length),M=[],B=0;a.forEach((T,E)=>{hn.hasOwnProperty(T)?v[E]=hn[T]:(M.push(T),cn.hasOwnProperty(T)||(cn[T]=[]),cn[T].push(()=>{v[E]=hn[T],++B,B===M.length&&f(v)}))}),M.length===0&&f(v)}function ln(n){switch(n){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError(`Unknown type size: ${n}`)}}var jn=void 0;function Vt(n){for(var a="";rt[n];)a+=jn[rt[n++]];return a}var he=void 0;function Rt(n){throw new he(n)}function hi(n,a,h={}){var f=a.name;if(n||Rt(`type "${f}" must have a positive integer typeid pointer`),hn.hasOwnProperty(n)){if(h.Wf)return;Rt(`Cannot register type '${f}' twice`)}hn[n]=a,delete $n[n],cn.hasOwnProperty(n)&&(a=cn[n],delete cn[n],a.forEach(v=>v()))}function $e(n,a,h={}){if(!("argPackAdvance"in a))throw new TypeError("registerType registeredInstance requires argPackAdvance");hi(n,a,h)}function Vn(n){Rt(n.Jd.Vd.Pd.name+" instance already deleted")}var In=!1;function Gr(){}function Nn(n){--n.count.value,n.count.value===0&&(n.Yd?n.ee.ke(n.Yd):n.Vd.Pd.ke(n.Rd))}function _n(n,a,h){return a===h?n:h.$d===void 0?null:(n=_n(n,a,h.$d),n===null?null:h.Mf(n))}var je={},dn=[];function Yn(){for(;dn.length;){var n=dn.pop();n.Jd.Ee=!1,n.delete()}}var Ze=void 0,Sn={};function Un(n,a){for(a===void 0&&Rt("ptr should not be undefined");n.$d;)a=n.Oe(a),n=n.$d;return Sn[a]}function kn(n,a){return a.Vd&&a.Rd||xn("makeClassHandle requires ptr and ptrType"),!!a.ee!=!!a.Yd&&xn("Both smartPtrType and smartPtr must be specified"),a.count={value:1},Cn(Object.create(n,{Jd:{value:a}}))}function Cn(n){return typeof FinalizationRegistry>"u"?(Cn=a=>a,n):(In=new FinalizationRegistry(a=>{Nn(a.Jd)}),Cn=a=>{var h=a.Jd;return h.Yd&&In.register(a,{Jd:h},a),a},Gr=a=>{In.unregister(a)},Cn(n))}function Ve(){}function bn(n){if(n===void 0)return"_unknown";n=n.replace(/[^a-zA-Z0-9_]/g,"$");var a=n.charCodeAt(0);return 48<=a&&57>=a?`_${n}`:n}function ur(n,a){return n=bn(n),{[n]:function(){return a.apply(this,arguments)}}[n]}function tn(n,a,h){if(n[a].Xd===void 0){var f=n[a];n[a]=function(){return n[a].Xd.hasOwnProperty(arguments.length)||Rt(`Function '${h}' called with an invalid number of arguments (${arguments.length}) - expects one of (${n[a].Xd})!`),n[a].Xd[arguments.length].apply(this,arguments)},n[a].Xd=[],n[a].Xd[f.Ce]=f}}function zr(n,a,h){o.hasOwnProperty(n)?((h===void 0||o[n].Xd!==void 0&&o[n].Xd[h]!==void 0)&&Rt(`Cannot register public name '${n}' twice`),tn(o,n,n),o.hasOwnProperty(h)&&Rt(`Cannot register multiple overloads of a function with the same number of arguments (${h})!`),o[n].Xd[h]=a):(o[n]=a,h!==void 0&&(o[n].tg=h))}function Hi(n,a,h,f,v,M,B,T){this.name=n,this.constructor=a,this.Fe=h,this.ke=f,this.$d=v,this.Rf=M,this.Oe=B,this.Mf=T,this.cg=[]}function Kr(n,a,h){for(;a!==h;)a.Oe||Rt(`Expected null or instance of ${h.name}, got an instance of ${a.name}`),n=a.Oe(n),a=a.$d;return n}function li(n,a){return a===null?(this.gf&&Rt(`null is not a valid ${this.name}`),0):(a.Jd||Rt(`Cannot pass "${jr(a)}" as a ${this.name}`),a.Jd.Rd||Rt(`Cannot pass deleted object as a pointer of type ${this.name}`),Kr(a.Jd.Rd,a.Jd.Vd.Pd,this.Pd))}function $r(n,a){if(a===null){if(this.gf&&Rt(`null is not a valid ${this.name}`),this.Ve){var h=this.hf();return n!==null&&n.push(this.ke,h),h}return 0}if(a.Jd||Rt(`Cannot pass "${jr(a)}" as a ${this.name}`),a.Jd.Rd||Rt(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.Ue&&a.Jd.Vd.Ue&&Rt(`Cannot convert argument of type ${a.Jd.ee?a.Jd.ee.name:a.Jd.Vd.name} to parameter type ${this.name}`),h=Kr(a.Jd.Rd,a.Jd.Vd.Pd,this.Pd),this.Ve)switch(a.Jd.Yd===void 0&&Rt("Passing raw pointer to smart pointer is illegal"),this.hg){case 0:a.Jd.ee===this?h=a.Jd.Yd:Rt(`Cannot convert argument of type ${a.Jd.ee?a.Jd.ee.name:a.Jd.Vd.name} to parameter type ${this.name}`);break;case 1:h=a.Jd.Yd;break;case 2:if(a.Jd.ee===this)h=a.Jd.Yd;else{var f=a.clone();h=this.dg(h,Ee(function(){f.delete()})),n!==null&&n.push(this.ke,h)}break;default:Rt("Unsupporting sharing policy")}return h}function le(n,a){return a===null?(this.gf&&Rt(`null is not a valid ${this.name}`),0):(a.Jd||Rt(`Cannot pass "${jr(a)}" as a ${this.name}`),a.Jd.Rd||Rt(`Cannot pass deleted object as a pointer of type ${this.name}`),a.Jd.Vd.Ue&&Rt(`Cannot convert argument of type ${a.Jd.Vd.name} to parameter type ${this.name}`),Kr(a.Jd.Rd,a.Jd.Vd.Pd,this.Pd))}function Ne(n,a,h,f,v,M,B,T,E,H,et){this.name=n,this.Pd=a,this.gf=h,this.Ue=f,this.Ve=v,this.bg=M,this.hg=B,this.vf=T,this.hf=E,this.dg=H,this.ke=et,v||a.$d!==void 0?this.toWireType=$r:(this.toWireType=f?li:le,this.de=null)}function di(n,a,h){o.hasOwnProperty(n)||xn("Replacing nonexistant public symbol"),o[n].Xd!==void 0&&h!==void 0?o[n].Xd[h]=a:(o[n]=a,o[n].Ce=h)}var Wi=(n,a)=>{var h=[];return function(){if(h.length=0,Object.assign(h,arguments),n.includes("j")){var f=o["dynCall_"+n];f=h&&h.length?f.apply(null,[a].concat(h)):f.call(null,a)}else f=Kt.get(a).apply(null,h);return f}};function ce(n,a){n=Vt(n);var h=n.includes("j")?Wi(n,a):Kt.get(a);return typeof h!="function"&&Rt(`unknown function pointer with signature ${n}: ${a}`),h}var ui=void 0;function de(n){n=Hc(n);var a=Vt(n);return nr(n),a}function Xn(n,a){function h(M){v[M]||hn[M]||($n[M]?$n[M].forEach(h):(f.push(M),v[M]=!0))}var f=[],v={};throw a.forEach(h),new ui(`${n}: `+f.map(de).join([", "]))}function fr(n,a,h,f,v){var M=a.length;2>M&&Rt("argTypes array size mismatch! Must at least get return value and 'this' types!");var B=a[1]!==null&&h!==null,T=!1;for(h=1;h<a.length;++h)if(a[h]!==null&&a[h].de===void 0){T=!0;break}var E=a[0].name!=="void",H=M-2,et=Array(H),ot=[],ft=[];return function(){if(arguments.length!==H&&Rt(`function ${n} called with ${arguments.length} arguments, expected ${H} args!`),ft.length=0,ot.length=B?2:1,ot[0]=v,B){var K=a[1].toWireType(ft,this);ot[1]=K}for(var yt=0;yt<H;++yt)et[yt]=a[yt+2].toWireType(ft,arguments[yt]),ot.push(et[yt]);if(yt=f.apply(null,ot),T)Or(ft);else for(var It=B?1:2;It<a.length;It++){var Et=It===1?K:et[It-2];a[It].de!==null&&a[It].de(Et)}return K=E?a[0].fromWireType(yt):void 0,K}}function gr(n,a){for(var h=[],f=0;f<n;f++)h.push(_t[a+4*f>>2]);return h}function fi(){this.je=[void 0],this.sf=[]}var Te=new fi;function ye(n){n>=Te.Ge&&--Te.get(n).wf===0&&Te.Bf(n)}var Ae=n=>(n||Rt("Cannot use deleted val. handle = "+n),Te.get(n).value),Ee=n=>{switch(n){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return Te.Af({wf:1,value:n})}};function Oi(n,a,h){switch(a){case 0:return function(f){return this.fromWireType((h?ut:rt)[f])};case 1:return function(f){return this.fromWireType((h?dt:Ht)[f>>1])};case 2:return function(f){return this.fromWireType((h?st:_t)[f>>2])};default:throw new TypeError("Unknown integer type: "+n)}}function Jn(n,a){var h=hn[n];return h===void 0&&Rt(a+" has unknown type "+de(n)),h}function jr(n){if(n===null)return"null";var a=typeof n;return a==="object"||a==="array"||a==="function"?n.toString():""+n}function pr(n,a){switch(a){case 2:return function(h){return this.fromWireType(mt[h>>2])};case 3:return function(h){return this.fromWireType(Xt[h>>3])};default:throw new TypeError("Unknown float type: "+n)}}function gi(n,a,h){switch(a){case 0:return h?function(f){return ut[f]}:function(f){return rt[f]};case 1:return h?function(f){return dt[f>>1]}:function(f){return Ht[f>>1]};case 2:return h?function(f){return st[f>>2]}:function(f){return _t[f>>2]};default:throw new TypeError("Unknown integer type: "+n)}}var ve=(n,a,h,f)=>{if(!(0<f))return 0;var v=h;f=h+f-1;for(var M=0;M<n.length;++M){var B=n.charCodeAt(M);if(55296<=B&&57343>=B){var T=n.charCodeAt(++M);B=65536+((B&1023)<<10)|T&1023}if(127>=B){if(h>=f)break;a[h++]=B}else{if(2047>=B){if(h+1>=f)break;a[h++]=192|B>>6}else{if(65535>=B){if(h+2>=f)break;a[h++]=224|B>>12}else{if(h+3>=f)break;a[h++]=240|B>>18,a[h++]=128|B>>12&63}a[h++]=128|B>>6&63}a[h++]=128|B&63}}return a[h]=0,h-v},re=n=>{for(var a=0,h=0;h<n.length;++h){var f=n.charCodeAt(h);127>=f?a++:2047>=f?a+=2:55296<=f&&57343>=f?(a+=4,++h):a+=3}return a},mr=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Gi=(n,a)=>{for(var h=n>>1,f=h+a/2;!(h>=f)&&Ht[h];)++h;if(h<<=1,32<h-n&&mr)return mr.decode(rt.subarray(n,h));for(h="",f=0;!(f>=a/2);++f){var v=dt[n+2*f>>1];if(v==0)break;h+=String.fromCharCode(v)}return h},zi=(n,a,h)=>{if(h===void 0&&(h=2147483647),2>h)return 0;h-=2;var f=a;h=h<2*n.length?h/2:n.length;for(var v=0;v<h;++v)dt[a>>1]=n.charCodeAt(v),a+=2;return dt[a>>1]=0,a-f},Ki=n=>2*n.length,$i=(n,a)=>{for(var h=0,f="";!(h>=a/4);){var v=st[n+4*h>>2];if(v==0)break;++h,65536<=v?(v-=65536,f+=String.fromCharCode(55296|v>>10,56320|v&1023)):f+=String.fromCharCode(v)}return f},ji=(n,a,h)=>{if(h===void 0&&(h=2147483647),4>h)return 0;var f=a;h=f+h-4;for(var v=0;v<n.length;++v){var M=n.charCodeAt(v);if(55296<=M&&57343>=M){var B=n.charCodeAt(++v);M=65536+((M&1023)<<10)|B&1023}if(st[a>>2]=M,a+=4,a+4>h)break}return st[a>>2]=0,a-f},yr=n=>{for(var a=0,h=0;h<n.length;++h){var f=n.charCodeAt(h);55296<=f&&57343>=f&&++h,a+=4}return a},Vr={};function un(n){var a=Vr[n];return a===void 0?Vt(n):a}var Qn=[];function Nr(){function n(a){a.$$$embind_global$$$=a;var h=typeof $$$embind_global$$$=="object"&&a.$$$embind_global$$$==a;return h||delete a.$$$embind_global$$$,h}if(typeof globalThis=="object")return globalThis;if(typeof $$$embind_global$$$=="object"||(typeof $t=="object"&&n($t)?$$$embind_global$$$=$t:typeof self=="object"&&n(self)&&($$$embind_global$$$=self),typeof $$$embind_global$$$=="object"))return $$$embind_global$$$;throw Error("unable to get global object.")}function Vi(n){var a=Qn.length;return Qn.push(n),a}function Ni(n,a){for(var h=Array(n),f=0;f<n;++f)h[f]=Jn(_t[a+4*f>>2],"parameter "+f);return h}var pi=[];function Yi(n){var a=Array(n+1);return function(h,f,v){a[0]=h;for(var M=0;M<n;++M){var B=Jn(_t[f+4*M>>2],"parameter "+M);a[M+1]=B.readValueFromPointer(v),v+=B.argPackAdvance}return h=new(h.bind.apply(h,a)),Ee(h)}}var vr={};function Ui(n){var a=n.getExtension("ANGLE_instanced_arrays");a&&(n.vertexAttribDivisor=function(h,f){a.vertexAttribDivisorANGLE(h,f)},n.drawArraysInstanced=function(h,f,v,M){a.drawArraysInstancedANGLE(h,f,v,M)},n.drawElementsInstanced=function(h,f,v,M,B){a.drawElementsInstancedANGLE(h,f,v,M,B)})}function Xi(n){var a=n.getExtension("OES_vertex_array_object");a&&(n.createVertexArray=function(){return a.createVertexArrayOES()},n.deleteVertexArray=function(h){a.deleteVertexArrayOES(h)},n.bindVertexArray=function(h){a.bindVertexArrayOES(h)},n.isVertexArray=function(h){return a.isVertexArrayOES(h)})}function qn(n){var a=n.getExtension("WEBGL_draw_buffers");a&&(n.drawBuffers=function(h,f){a.drawBuffersWEBGL(h,f)})}var Ye=1,Ue=[],se=[],wr=[],Ie=[],_e=[],Ge=[],xr=[],Xe=[],fn=[],te=[],Yr={},Ur={},Zn=4;function Gt(n){tr||(tr=n)}function en(n){for(var a=Ye++,h=n.length;h<a;h++)n[h]=null;return a}function Ji(n,a){n.Ge||(n.Ge=n.getContext,n.getContext=function(f,v){return v=n.Ge(f,v),f=="webgl"==v instanceof WebGLRenderingContext?v:null});var h=1<a.majorVersion?n.getContext("webgl2",a):n.getContext("webgl",a);return h?mi(h,a):0}function mi(n,a){var h=en(Xe),f={handle:h,attributes:a,version:a.majorVersion,fe:n};return n.canvas&&(n.canvas.zf=f),Xe[h]=f,(typeof a.Nf>"u"||a.Nf)&&yi(f),h}function Sr(n){return St=Xe[n],o.rg=W=St&&St.fe,!(n&&!W)}function yi(n){if(n||(n=St),!n.Xf){n.Xf=!0;var a=n.fe;Ui(a),Xi(a),qn(a),a.pf=a.getExtension("WEBGL_draw_instanced_base_vertex_base_instance"),a.uf=a.getExtension("WEBGL_multi_draw_instanced_base_vertex_base_instance"),2<=n.version&&(a.qf=a.getExtension("EXT_disjoint_timer_query_webgl2")),(2>n.version||!a.qf)&&(a.qf=a.getExtension("EXT_disjoint_timer_query")),a.sg=a.getExtension("WEBGL_multi_draw"),(a.getSupportedExtensions()||[]).forEach(function(h){h.includes("lose_context")||h.includes("debug")||a.getExtension(h)})}}var St,tr,er={},vi=()=>{if(!Xr){var n={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:y||"./this.program"},a;for(a in er)er[a]===void 0?delete n[a]:n[a]=er[a];var h=[];for(a in n)h.push(`${a}=${n[a]}`);Xr=h}return Xr},Xr,p=[null,[],[]];function P(n){W.bindVertexArray(xr[n])}function L(n,a){for(var h=0;h<n;h++){var f=st[a+4*h>>2];W.deleteVertexArray(xr[f]),xr[f]=null}}var X=[];function Mt(n,a,h,f){W.drawElements(n,a,h,f)}function gt(n,a,h,f){for(var v=0;v<n;v++){var M=W[h](),B=M&&en(f);M?(M.name=B,f[B]=M):Gt(1282),st[a+4*v>>2]=B}}function Bt(n,a){gt(n,a,"createVertexArray",xr)}function Dt(n,a,h){if(a){var f=void 0;switch(n){case 36346:f=1;break;case 36344:h!=0&&h!=1&&Gt(1280);return;case 34814:case 36345:f=0;break;case 34466:var v=W.getParameter(34467);f=v?v.length:0;break;case 33309:if(2>St.version){Gt(1282);return}f=2*(W.getSupportedExtensions()||[]).length;break;case 33307:case 33308:if(2>St.version){Gt(1280);return}f=n==33307?3:0}if(f===void 0)switch(v=W.getParameter(n),typeof v){case"number":f=v;break;case"boolean":f=v?1:0;break;case"string":Gt(1280);return;case"object":if(v===null)switch(n){case 34964:case 35725:case 34965:case 36006:case 36007:case 32873:case 34229:case 36662:case 36663:case 35053:case 35055:case 36010:case 35097:case 35869:case 32874:case 36389:case 35983:case 35368:case 34068:f=0;break;default:Gt(1280);return}else{if(v instanceof Float32Array||v instanceof Uint32Array||v instanceof Int32Array||v instanceof Array){for(n=0;n<v.length;++n)switch(h){case 0:st[a+4*n>>2]=v[n];break;case 2:mt[a+4*n>>2]=v[n];break;case 4:ut[a+n>>0]=v[n]?1:0}return}try{f=v.name|0}catch(M){Gt(1280),N("GL_INVALID_ENUM in glGet"+h+"v: Unknown object returned from WebGL getParameter("+n+")! (error: "+M+")");return}}break;default:Gt(1280),N("GL_INVALID_ENUM in glGet"+h+"v: Native code calling glGet"+h+"v("+n+") and it returns "+v+" of type "+typeof v+"!");return}switch(h){case 1:h=f,_t[a>>2]=h,_t[a+4>>2]=(h-_t[a>>2])/4294967296;break;case 0:st[a>>2]=f;break;case 2:mt[a>>2]=f;break;case 4:ut[a>>0]=f?1:0}}else Gt(1281)}var Nt=n=>{var a=re(n)+1,h=Ws(a);return h&&ve(n,rt,h,a),h};function Wt(n){return n.slice(-1)=="]"&&n.lastIndexOf("[")}function oe(n){return n-=5120,n==0?ut:n==1?rt:n==2?dt:n==4?st:n==6?mt:n==5||n==28922||n==28520||n==30779||n==30782?_t:Ht}function we(n,a,h,f,v){n=oe(n);var M=31-Math.clz32(n.BYTES_PER_ELEMENT),B=Zn;return n.subarray(v>>M,v+f*(h*({5:3,6:4,8:2,29502:3,29504:4,26917:2,26918:2,29846:3,29847:4}[a-6402]||1)*(1<<M)+B-1&-B)>>M)}function Pt(n){var a=W.Kf;if(a){var h=a.Ne[n];return typeof h=="number"&&(a.Ne[n]=h=W.getUniformLocation(a,a.xf[n]+(0<h?"["+h+"]":""))),h}Gt(1282)}var Jt=[],ee=[],nn=n=>n%4===0&&(n%100!==0||n%400===0),gn=[31,29,31,30,31,30,31,31,30,31,30,31],Rn=[31,28,31,30,31,30,31,31,30,31,30,31];function Ls(n){var a=Array(re(n)+1);return ve(n,a,0,a.length),a}var wi=(n,a,h,f)=>{function v(K,yt,It){for(K=typeof K=="number"?K.toString():K||"";K.length<yt;)K=It[0]+K;return K}function M(K,yt){return v(K,yt,"0")}function B(K,yt){function It(Je){return 0>Je?-1:0<Je?1:0}var Et;return(Et=It(K.getFullYear()-yt.getFullYear()))===0&&(Et=It(K.getMonth()-yt.getMonth()))===0&&(Et=It(K.getDate()-yt.getDate())),Et}function T(K){switch(K.getDay()){case 0:return new Date(K.getFullYear()-1,11,29);case 1:return K;case 2:return new Date(K.getFullYear(),0,3);case 3:return new Date(K.getFullYear(),0,2);case 4:return new Date(K.getFullYear(),0,1);case 5:return new Date(K.getFullYear()-1,11,31);case 6:return new Date(K.getFullYear()-1,11,30)}}function E(K){var yt=K.oe;for(K=new Date(new Date(K.pe+1900,0,1).getTime());0<yt;){var It=K.getMonth(),Et=(nn(K.getFullYear())?gn:Rn)[It];if(yt>Et-K.getDate())yt-=Et-K.getDate()+1,K.setDate(1),11>It?K.setMonth(It+1):(K.setMonth(0),K.setFullYear(K.getFullYear()+1));else{K.setDate(K.getDate()+yt);break}}return It=new Date(K.getFullYear()+1,0,4),yt=T(new Date(K.getFullYear(),0,4)),It=T(It),0>=B(yt,K)?0>=B(It,K)?K.getFullYear()+1:K.getFullYear():K.getFullYear()-1}var H=st[f+40>>2];f={pg:st[f>>2],og:st[f+4>>2],Ze:st[f+8>>2],jf:st[f+12>>2],$e:st[f+16>>2],pe:st[f+20>>2],he:st[f+24>>2],oe:st[f+28>>2],vg:st[f+32>>2],ng:st[f+36>>2],qg:H&&H?on(rt,H):""},h=h?on(rt,h):"",H={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var et in H)h=h.replace(new RegExp(et,"g"),H[et]);var ot="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),ft="January February March April May June July August September October November December".split(" ");H={"%a":K=>ot[K.he].substring(0,3),"%A":K=>ot[K.he],"%b":K=>ft[K.$e].substring(0,3),"%B":K=>ft[K.$e],"%C":K=>M((K.pe+1900)/100|0,2),"%d":K=>M(K.jf,2),"%e":K=>v(K.jf,2," "),"%g":K=>E(K).toString().substring(2),"%G":K=>E(K),"%H":K=>M(K.Ze,2),"%I":K=>(K=K.Ze,K==0?K=12:12<K&&(K-=12),M(K,2)),"%j":K=>{for(var yt=0,It=0;It<=K.$e-1;yt+=(nn(K.pe+1900)?gn:Rn)[It++]);return M(K.jf+yt,3)},"%m":K=>M(K.$e+1,2),"%M":K=>M(K.og,2),"%n":()=>`
`,"%p":K=>0<=K.Ze&&12>K.Ze?"AM":"PM","%S":K=>M(K.pg,2),"%t":()=>"	","%u":K=>K.he||7,"%U":K=>M(Math.floor((K.oe+7-K.he)/7),2),"%V":K=>{var yt=Math.floor((K.oe+7-(K.he+6)%7)/7);if(2>=(K.he+371-K.oe-2)%7&&yt++,yt)yt==53&&(It=(K.he+371-K.oe)%7,It==4||It==3&&nn(K.pe)||(yt=1));else{yt=52;var It=(K.he+7-K.oe-1)%7;(It==4||It==5&&nn(K.pe%400-1))&&yt++}return M(yt,2)},"%w":K=>K.he,"%W":K=>M(Math.floor((K.oe+7-(K.he+6)%7)/7),2),"%y":K=>(K.pe+1900).toString().substring(2),"%Y":K=>K.pe+1900,"%z":K=>{K=K.ng;var yt=0<=K;return K=Math.abs(K)/60,(yt?"+":"-")+("0000"+(K/60*100+K%60)).slice(-4)},"%Z":K=>K.qg,"%%":()=>"%"},h=h.replace(/%%/g,"\0\0");for(et in H)h.includes(et)&&(h=h.replace(new RegExp(et,"g"),H[et](f)));return h=h.replace(/\0\0/g,"%"),et=Ls(h),et.length>a?0:(ut.set(et,n),et.length-1)};qe=o.InternalError=class extends Error{constructor(n){super(n),this.name="InternalError"}};for(var Jr=Array(256),Hs=0;256>Hs;++Hs)Jr[Hs]=String.fromCharCode(Hs);jn=Jr,he=o.BindingError=class extends Error{constructor(n){super(n),this.name="BindingError"}},Ve.prototype.isAliasOf=function(n){if(!(this instanceof Ve&&n instanceof Ve))return!1;var a=this.Jd.Vd.Pd,h=this.Jd.Rd,f=n.Jd.Vd.Pd;for(n=n.Jd.Rd;a.$d;)h=a.Oe(h),a=a.$d;for(;f.$d;)n=f.Oe(n),f=f.$d;return a===f&&h===n},Ve.prototype.clone=function(){if(this.Jd.Rd||Vn(this),this.Jd.Me)return this.Jd.count.value+=1,this;var n=Cn,a=Object,h=a.create,f=Object.getPrototypeOf(this),v=this.Jd;return n=n(h.call(a,f,{Jd:{value:{count:v.count,Ee:v.Ee,Me:v.Me,Rd:v.Rd,Vd:v.Vd,Yd:v.Yd,ee:v.ee}}})),n.Jd.count.value+=1,n.Jd.Ee=!1,n},Ve.prototype.delete=function(){this.Jd.Rd||Vn(this),this.Jd.Ee&&!this.Jd.Me&&Rt("Object already scheduled for deletion"),Gr(this),Nn(this.Jd),this.Jd.Me||(this.Jd.Yd=void 0,this.Jd.Rd=void 0)},Ve.prototype.isDeleted=function(){return!this.Jd.Rd},Ve.prototype.deleteLater=function(){return this.Jd.Rd||Vn(this),this.Jd.Ee&&!this.Jd.Me&&Rt("Object already scheduled for deletion"),dn.push(this),dn.length===1&&Ze&&Ze(Yn),this.Jd.Ee=!0,this},o.getInheritedInstanceCount=function(){return Object.keys(Sn).length},o.getLiveInheritedInstances=function(){var n=[],a;for(a in Sn)Sn.hasOwnProperty(a)&&n.push(Sn[a]);return n},o.flushPendingDeletes=Yn,o.setDelayFunction=function(n){Ze=n,dn.length&&Ze&&Ze(Yn)},Ne.prototype.Sf=function(n){return this.vf&&(n=this.vf(n)),n},Ne.prototype.nf=function(n){this.ke&&this.ke(n)},Ne.prototype.argPackAdvance=8,Ne.prototype.readValueFromPointer=an,Ne.prototype.deleteObject=function(n){n!==null&&n.delete()},Ne.prototype.fromWireType=function(n){function a(){return this.Ve?kn(this.Pd.Fe,{Vd:this.bg,Rd:h,ee:this,Yd:n}):kn(this.Pd.Fe,{Vd:this,Rd:n})}var h=this.Sf(n);if(!h)return this.nf(n),null;var f=Un(this.Pd,h);if(f!==void 0)return f.Jd.count.value===0?(f.Jd.Rd=h,f.Jd.Yd=n,f.clone()):(f=f.clone(),this.nf(n),f);if(f=this.Pd.Rf(h),f=je[f],!f)return a.call(this);f=this.Ue?f.If:f.pointerType;var v=_n(h,this.Pd,f.Pd);return v===null?a.call(this):this.Ve?kn(f.Pd.Fe,{Vd:f,Rd:v,ee:this,Yd:n}):kn(f.Pd.Fe,{Vd:f,Rd:v})},ui=o.UnboundTypeError=function(n,a){var h=ur(a,function(f){this.name=a,this.message=f,f=Error(f).stack,f!==void 0&&(this.stack=this.toString()+`
`+f.replace(/^Error(:[^\n]*)?\n/,""))});return h.prototype=Object.create(n.prototype),h.prototype.constructor=h,h.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},h}(Error,"UnboundTypeError"),Object.assign(fi.prototype,{get(n){return this.je[n]},has(n){return this.je[n]!==void 0},Af(n){var a=this.sf.pop()||this.je.length;return this.je[a]=n,a},Bf(n){this.je[n]=void 0,this.sf.push(n)}}),Te.je.push({value:void 0},{value:null},{value:!0},{value:!1}),Te.Ge=Te.je.length,o.count_emval_handles=function(){for(var n=0,a=Te.Ge;a<Te.je.length;++a)Te.je[a]!==void 0&&++n;return n};for(var W,rn=0;32>rn;++rn)X.push(Array(rn));var _f=new Float32Array(288);for(rn=0;288>rn;++rn)Jt[rn]=_f.subarray(0,rn+1);var kf=new Int32Array(288);for(rn=0;288>rn;++rn)ee[rn]=kf.subarray(0,rn+1);var Rf={T:function(){return 0},Bb:()=>{},Db:function(){return 0},yb:()=>{},zb:()=>{},U:function(){},Ab:()=>{},C:function(n){var a=dr[n];delete dr[n];var h=a.hf,f=a.ke,v=a.rf,M=v.map(B=>B.Vf).concat(v.map(B=>B.fg));Oe([n],M,B=>{var T={};return v.forEach((E,H)=>{var et=B[H],ot=E.Tf,ft=E.Uf,K=B[H+v.length],yt=E.eg,It=E.gg;T[E.Of]={read:Et=>et.fromWireType(ot(ft,Et)),write:(Et,Je)=>{var be=[];yt(It,Et,K.toWireType(be,Je)),Or(be)}}}),[{name:a.name,fromWireType:function(E){var H={},et;for(et in T)H[et]=T[et].read(E);return f(E),H},toWireType:function(E,H){for(var et in T)if(!(et in H))throw new TypeError(`Missing field: "${et}"`);var ot=h();for(et in T)T[et].write(ot,H[et]);return E!==null&&E.push(f,ot),ot},argPackAdvance:8,readValueFromPointer:an,de:f}]})},qb:function(){},Hb:function(n,a,h,f,v){var M=ln(h);a=Vt(a),$e(n,{name:a,fromWireType:function(B){return!!B},toWireType:function(B,T){return T?f:v},argPackAdvance:8,readValueFromPointer:function(B){if(h===1)var T=ut;else if(h===2)T=dt;else if(h===4)T=st;else throw new TypeError("Unknown boolean type size: "+a);return this.fromWireType(T[B>>M])},de:null})},m:function(n,a,h,f,v,M,B,T,E,H,et,ot,ft){et=Vt(et),M=ce(v,M),T&&(T=ce(B,T)),H&&(H=ce(E,H)),ft=ce(ot,ft);var K=bn(et);zr(K,function(){Xn(`Cannot construct ${et} due to unbound types`,[f])}),Oe([n,a,h],f?[f]:[],function(yt){if(yt=yt[0],f)var It=yt.Pd,Et=It.Fe;else Et=Ve.prototype;yt=ur(K,function(){if(Object.getPrototypeOf(this)!==Je)throw new he("Use 'new' to construct "+et);if(be.ne===void 0)throw new he(et+" has no accessible constructor");var qi=be.ne[arguments.length];if(qi===void 0)throw new he(`Tried to invoke ctor of ${et} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(be.ne).toString()}) parameters instead!`);return qi.apply(this,arguments)});var Je=Object.create(Et,{constructor:{value:yt}});yt.prototype=Je;var be=new Hi(et,yt,Je,ft,It,M,T,H);be.$d&&(be.$d.Pe===void 0&&(be.$d.Pe=[]),be.$d.Pe.push(be)),It=new Ne(et,be,!0,!1,!1),Et=new Ne(et+"*",be,!1,!1,!1);var Qi=new Ne(et+" const*",be,!1,!0,!1);return je[n]={pointerType:Et,If:Qi},di(K,yt),[It,Et,Qi]})},f:function(n,a,h,f,v,M,B){var T=gr(h,f);a=Vt(a),M=ce(v,M),Oe([],[n],function(E){function H(){Xn(`Cannot call ${et} due to unbound types`,T)}E=E[0];var et=`${E.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]);var ot=E.Pd.constructor;return ot[a]===void 0?(H.Ce=h-1,ot[a]=H):(tn(ot,a,et),ot[a].Xd[h-1]=H),Oe([],T,function(ft){if(ft=[ft[0],null].concat(ft.slice(1)),ft=fr(et,ft,null,M,B),ot[a].Xd===void 0?(ft.Ce=h-1,ot[a]=ft):ot[a].Xd[h-1]=ft,E.Pd.Pe)for(const K of E.Pd.Pe)K.constructor.hasOwnProperty(a)||(K.constructor[a]=ft);return[]}),[]})},A:function(n,a,h,f,v,M){var B=gr(a,h);v=ce(f,v),Oe([],[n],function(T){T=T[0];var E=`constructor ${T.name}`;if(T.Pd.ne===void 0&&(T.Pd.ne=[]),T.Pd.ne[a-1]!==void 0)throw new he(`Cannot register multiple constructors with identical number of parameters (${a-1}) for class '${T.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return T.Pd.ne[a-1]=()=>{Xn(`Cannot construct ${T.name} due to unbound types`,B)},Oe([],B,function(H){return H.splice(1,0,null),T.Pd.ne[a-1]=fr(E,H,null,v,M),[]}),[]})},b:function(n,a,h,f,v,M,B,T){var E=gr(h,f);a=Vt(a),M=ce(v,M),Oe([],[n],function(H){function et(){Xn(`Cannot call ${ot} due to unbound types`,E)}H=H[0];var ot=`${H.name}.${a}`;a.startsWith("@@")&&(a=Symbol[a.substring(2)]),T&&H.Pd.cg.push(a);var ft=H.Pd.Fe,K=ft[a];return K===void 0||K.Xd===void 0&&K.className!==H.name&&K.Ce===h-2?(et.Ce=h-2,et.className=H.name,ft[a]=et):(tn(ft,a,ot),ft[a].Xd[h-2]=et),Oe([],E,function(yt){return yt=fr(ot,yt,H,M,B),ft[a].Xd===void 0?(yt.Ce=h-2,ft[a]=yt):ft[a].Xd[h-2]=yt,[]}),[]})},t:function(n,a,h){n=Vt(n),Oe([],[a],function(f){return f=f[0],o[n]=f.fromWireType(h),[]})},Gb:function(n,a){a=Vt(a),$e(n,{name:a,fromWireType:function(h){var f=Ae(h);return ye(h),f},toWireType:function(h,f){return Ee(f)},argPackAdvance:8,readValueFromPointer:an,de:null})},l:function(n,a,h,f){function v(){}h=ln(h),a=Vt(a),v.values={},$e(n,{name:a,constructor:v,fromWireType:function(M){return this.constructor.values[M]},toWireType:function(M,B){return B.value},argPackAdvance:8,readValueFromPointer:Oi(a,h,f),de:null}),zr(a,v)},c:function(n,a,h){var f=Jn(n,"enum");a=Vt(a),n=f.constructor,f=Object.create(f.constructor.prototype,{value:{value:h},constructor:{value:ur(`${f.name}_${a}`,function(){})}}),n.values[h]=f,n[a]=f},W:function(n,a,h){h=ln(h),a=Vt(a),$e(n,{name:a,fromWireType:function(f){return f},toWireType:function(f,v){return v},argPackAdvance:8,readValueFromPointer:pr(a,h),de:null})},y:function(n,a,h,f,v,M){var B=gr(a,h);n=Vt(n),v=ce(f,v),zr(n,function(){Xn(`Cannot call ${n} due to unbound types`,B)},a-1),Oe([],B,function(T){return T=[T[0],null].concat(T.slice(1)),di(n,fr(n,T,null,v,M),a-1),[]})},E:function(n,a,h,f,v){a=Vt(a),v===-1&&(v=4294967295),v=ln(h);var M=T=>T;if(f===0){var B=32-8*h;M=T=>T<<B>>>B}h=a.includes("unsigned")?function(T,E){return E>>>0}:function(T,E){return E},$e(n,{name:a,fromWireType:M,toWireType:h,argPackAdvance:8,readValueFromPointer:gi(a,v,f!==0),de:null})},s:function(n,a,h){function f(M){M>>=2;var B=_t;return new v(B.buffer,B[M+1],B[M])}var v=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][a];h=Vt(h),$e(n,{name:h,fromWireType:f,argPackAdvance:8,readValueFromPointer:f},{Wf:!0})},q:function(n,a,h,f,v,M,B,T,E,H,et,ot){h=Vt(h),M=ce(v,M),T=ce(B,T),H=ce(E,H),ot=ce(et,ot),Oe([n],[a],function(ft){return ft=ft[0],[new Ne(h,ft.Pd,!1,!1,!0,ft,f,M,T,H,ot)]})},V:function(n,a){a=Vt(a);var h=a==="std::string";$e(n,{name:a,fromWireType:function(f){var v=_t[f>>2],M=f+4;if(h)for(var B=M,T=0;T<=v;++T){var E=M+T;if(T==v||rt[E]==0){if(B=B?on(rt,B,E-B):"",H===void 0)var H=B;else H+="\0",H+=B;B=E+1}}else{for(H=Array(v),T=0;T<v;++T)H[T]=String.fromCharCode(rt[M+T]);H=H.join("")}return nr(f),H},toWireType:function(f,v){v instanceof ArrayBuffer&&(v=new Uint8Array(v));var M=typeof v=="string";M||v instanceof Uint8Array||v instanceof Uint8ClampedArray||v instanceof Int8Array||Rt("Cannot pass non-string to std::string");var B=h&&M?re(v):v.length,T=Ws(4+B+1),E=T+4;if(_t[T>>2]=B,h&&M)ve(v,rt,E,B+1);else if(M)for(M=0;M<B;++M){var H=v.charCodeAt(M);255<H&&(nr(E),Rt("String has UTF-16 code units that do not fit in 8 bits")),rt[E+M]=H}else for(M=0;M<B;++M)rt[E+M]=v[M];return f!==null&&f.push(nr,T),T},argPackAdvance:8,readValueFromPointer:an,de:function(f){nr(f)}})},N:function(n,a,h){if(h=Vt(h),a===2)var f=Gi,v=zi,M=Ki,B=()=>Ht,T=1;else a===4&&(f=$i,v=ji,M=yr,B=()=>_t,T=2);$e(n,{name:h,fromWireType:function(E){for(var H=_t[E>>2],et=B(),ot,ft=E+4,K=0;K<=H;++K){var yt=E+4+K*a;(K==H||et[yt>>T]==0)&&(ft=f(ft,yt-ft),ot===void 0?ot=ft:(ot+="\0",ot+=ft),ft=yt+a)}return nr(E),ot},toWireType:function(E,H){typeof H!="string"&&Rt(`Cannot pass non-string to C++ string type ${h}`);var et=M(H),ot=Ws(4+et+a);return _t[ot>>2]=et>>T,v(H,ot+4,et+a),E!==null&&E.push(nr,ot),ot},argPackAdvance:8,readValueFromPointer:an,de:function(E){nr(E)}})},D:function(n,a,h,f,v,M){dr[n]={name:Vt(a),hf:ce(h,f),ke:ce(v,M),rf:[]}},e:function(n,a,h,f,v,M,B,T,E,H){dr[n].rf.push({Of:Vt(a),Vf:h,Tf:ce(f,v),Uf:M,fg:B,eg:ce(T,E),gg:H})},Ib:function(n,a){a=Vt(a),$e(n,{Yf:!0,name:a,argPackAdvance:0,fromWireType:function(){},toWireType:function(){}})},Fb:()=>!0,ub:()=>{throw 1/0},F:function(n,a,h){n=Ae(n),a=Jn(a,"emval::as");var f=[],v=Ee(f);return _t[h>>2]=v,a.toWireType(f,n)},Z:function(n,a,h,f,v){n=Qn[n],a=Ae(a),h=un(h);var M=[];return _t[f>>2]=Ee(M),n(a,h,M,v)},w:function(n,a,h,f){n=Qn[n],a=Ae(a),h=un(h),n(a,h,null,f)},d:ye,K:function(n){return n===0?Ee(Nr()):(n=un(n),Ee(Nr()[n]))},u:function(n,a){var h=Ni(n,a),f=h[0];a=f.name+"_$"+h.slice(1).map(function(B){return B.name}).join("_")+"$";var v=pi[a];if(v!==void 0)return v;var M=Array(n-1);return v=Vi((B,T,E,H)=>{for(var et=0,ot=0;ot<n-1;++ot)M[ot]=h[ot+1].readValueFromPointer(H+et),et+=h[ot+1].argPackAdvance;for(B=B[T].apply(B,M),ot=0;ot<n-1;++ot)h[ot+1].Lf&&h[ot+1].Lf(M[ot]);if(!f.Yf)return f.toWireType(E,B)}),pi[a]=v},z:function(n,a){return n=Ae(n),a=Ae(a),Ee(n[a])},p:function(n){4<n&&(Te.get(n).wf+=1)},J:function(n,a,h,f){n=Ae(n);var v=vr[a];return v||(v=Yi(a),vr[a]=v),v(n,h,f)},H:function(){return Ee([])},g:function(n){return Ee(un(n))},G:function(){return Ee({})},kb:function(n){return n=Ae(n),!n},B:function(n){var a=Ae(n);Or(a),ye(n)},i:function(n,a,h){n=Ae(n),a=Ae(a),h=Ae(h),n[a]=h},h:function(n,a){return n=Jn(n,"_emval_take_value"),n=n.readValueFromPointer(a),Ee(n)},nb:function(){return-52},ob:function(){},a:()=>{ar("")},Eb:()=>performance.now(),vb:n=>{var a=rt.length;if(n>>>=0,2147483648<n)return!1;for(var h=1;4>=h;h*=2){var f=a*(1+.2/h);f=Math.min(f,n+100663296);var v=Math;f=Math.max(n,f);t:{v=v.min.call(v,2147483648,f+(65536-f%65536)%65536)-Y.buffer.byteLength+65535>>>16;try{Y.grow(v),He();var M=1;break t}catch{}M=void 0}if(M)return!0}return!1},lb:function(){return St?St.handle:0},wb:(n,a)=>{var h=0;return vi().forEach(function(f,v){var M=a+h;for(v=_t[n+4*v>>2]=M,M=0;M<f.length;++M)ut[v++>>0]=f.charCodeAt(M);ut[v>>0]=0,h+=f.length+1}),0},xb:(n,a)=>{var h=vi();_t[n>>2]=h.length;var f=0;return h.forEach(function(v){f+=v.length+1}),_t[a>>2]=f,0},Jb:n=>{x(n,new Wr(n))},M:()=>52,mb:function(){return 52},Cb:()=>52,pb:function(){return 70},S:(n,a,h,f)=>{for(var v=0,M=0;M<h;M++){var B=_t[a>>2],T=_t[a+4>>2];a+=8;for(var E=0;E<T;E++){var H=rt[B+E],et=p[n];H===0||H===10?((n===1?U:N)(on(et,0)),et.length=0):et.push(H)}v+=T}return _t[f>>2]=v,0},aa:function(n){W.activeTexture(n)},ba:function(n,a){W.attachShader(se[n],Ge[a])},ca:function(n,a,h){W.bindAttribLocation(se[n],a,h?on(rt,h):"")},da:function(n,a){n==35051?W.ef=a:n==35052&&(W.De=a),W.bindBuffer(n,Ue[a])},$:function(n,a){W.bindFramebuffer(n,wr[a])},fc:function(n,a){W.bindRenderbuffer(n,Ie[a])},Rb:function(n,a){W.bindSampler(n,fn[a])},ea:function(n,a){W.bindTexture(n,_e[a])},zc:P,Cc:P,fa:function(n,a,h,f){W.blendColor(n,a,h,f)},ga:function(n){W.blendEquation(n)},ha:function(n,a){W.blendFunc(n,a)},$b:function(n,a,h,f,v,M,B,T,E,H){W.blitFramebuffer(n,a,h,f,v,M,B,T,E,H)},ia:function(n,a,h,f){2<=St.version?h&&a?W.bufferData(n,rt,f,h,a):W.bufferData(n,a,f):W.bufferData(n,h?rt.subarray(h,h+a):a,f)},ja:function(n,a,h,f){2<=St.version?h&&W.bufferSubData(n,a,rt,f,h):W.bufferSubData(n,a,rt.subarray(f,f+h))},gc:function(n){return W.checkFramebufferStatus(n)},Q:function(n){W.clear(n)},_:function(n,a,h,f){W.clearColor(n,a,h,f)},R:function(n){W.clearStencil(n)},sb:function(n,a,h,f){return W.clientWaitSync(te[n],a,(h>>>0)+4294967296*f)},ka:function(n,a,h,f){W.colorMask(!!n,!!a,!!h,!!f)},la:function(n){W.compileShader(Ge[n])},ma:function(n,a,h,f,v,M,B,T){2<=St.version?W.De||!B?W.compressedTexImage2D(n,a,h,f,v,M,B,T):W.compressedTexImage2D(n,a,h,f,v,M,rt,T,B):W.compressedTexImage2D(n,a,h,f,v,M,T?rt.subarray(T,T+B):null)},na:function(n,a,h,f,v,M,B,T,E){2<=St.version?W.De||!T?W.compressedTexSubImage2D(n,a,h,f,v,M,B,T,E):W.compressedTexSubImage2D(n,a,h,f,v,M,B,rt,E,T):W.compressedTexSubImage2D(n,a,h,f,v,M,B,E?rt.subarray(E,E+T):null)},Zb:function(n,a,h,f,v){W.copyBufferSubData(n,a,h,f,v)},oa:function(n,a,h,f,v,M,B,T){W.copyTexSubImage2D(n,a,h,f,v,M,B,T)},pa:function(){var n=en(se),a=W.createProgram();return a.name=n,a.Ye=a.We=a.Xe=0,a.kf=1,se[n]=a,n},qa:function(n){var a=en(Ge);return Ge[a]=W.createShader(n),a},ra:function(n){W.cullFace(n)},sa:function(n,a){for(var h=0;h<n;h++){var f=st[a+4*h>>2],v=Ue[f];v&&(W.deleteBuffer(v),v.name=0,Ue[f]=null,f==W.ef&&(W.ef=0),f==W.De&&(W.De=0))}},hc:function(n,a){for(var h=0;h<n;++h){var f=st[a+4*h>>2],v=wr[f];v&&(W.deleteFramebuffer(v),v.name=0,wr[f]=null)}},ta:function(n){if(n){var a=se[n];a?(W.deleteProgram(a),a.name=0,se[n]=null):Gt(1281)}},ic:function(n,a){for(var h=0;h<n;h++){var f=st[a+4*h>>2],v=Ie[f];v&&(W.deleteRenderbuffer(v),v.name=0,Ie[f]=null)}},Sb:function(n,a){for(var h=0;h<n;h++){var f=st[a+4*h>>2],v=fn[f];v&&(W.deleteSampler(v),v.name=0,fn[f]=null)}},ua:function(n){if(n){var a=Ge[n];a?(W.deleteShader(a),Ge[n]=null):Gt(1281)}},_b:function(n){if(n){var a=te[n];a?(W.deleteSync(a),a.name=0,te[n]=null):Gt(1281)}},va:function(n,a){for(var h=0;h<n;h++){var f=st[a+4*h>>2],v=_e[f];v&&(W.deleteTexture(v),v.name=0,_e[f]=null)}},Ac:L,Dc:L,wa:function(n){W.depthMask(!!n)},xa:function(n){W.disable(n)},ya:function(n){W.disableVertexAttribArray(n)},za:function(n,a,h){W.drawArrays(n,a,h)},xc:function(n,a,h,f){W.drawArraysInstanced(n,a,h,f)},vc:function(n,a,h,f,v){W.pf.drawArraysInstancedBaseInstanceWEBGL(n,a,h,f,v)},tc:function(n,a){for(var h=X[n],f=0;f<n;f++)h[f]=st[a+4*f>>2];W.drawBuffers(h)},Aa:Mt,yc:function(n,a,h,f,v){W.drawElementsInstanced(n,a,h,f,v)},wc:function(n,a,h,f,v,M,B){W.pf.drawElementsInstancedBaseVertexBaseInstanceWEBGL(n,a,h,f,v,M,B)},nc:function(n,a,h,f,v,M){Mt(n,f,v,M)},Ba:function(n){W.enable(n)},Ca:function(n){W.enableVertexAttribArray(n)},Xb:function(n,a){return(n=W.fenceSync(n,a))?(a=en(te),n.name=a,te[a]=n,a):0},Da:function(){W.finish()},Ea:function(){W.flush()},jc:function(n,a,h,f){W.framebufferRenderbuffer(n,a,h,Ie[f])},kc:function(n,a,h,f,v){W.framebufferTexture2D(n,a,h,_e[f],v)},Fa:function(n){W.frontFace(n)},Ga:function(n,a){gt(n,a,"createBuffer",Ue)},lc:function(n,a){gt(n,a,"createFramebuffer",wr)},mc:function(n,a){gt(n,a,"createRenderbuffer",Ie)},Tb:function(n,a){gt(n,a,"createSampler",fn)},Ha:function(n,a){gt(n,a,"createTexture",_e)},Bc:Bt,Ec:Bt,bc:function(n){W.generateMipmap(n)},Ia:function(n,a,h){h?st[h>>2]=W.getBufferParameter(n,a):Gt(1281)},Ja:function(){var n=W.getError()||tr;return tr=0,n},Ka:function(n,a){Dt(n,a,2)},cc:function(n,a,h,f){n=W.getFramebufferAttachmentParameter(n,a,h),(n instanceof WebGLRenderbuffer||n instanceof WebGLTexture)&&(n=n.name|0),st[f>>2]=n},L:function(n,a){Dt(n,a,0)},La:function(n,a,h,f){n=W.getProgramInfoLog(se[n]),n===null&&(n="(unknown error)"),a=0<a&&f?ve(n,rt,f,a):0,h&&(st[h>>2]=a)},Ma:function(n,a,h){if(h)if(n>=Ye)Gt(1281);else if(n=se[n],a==35716)n=W.getProgramInfoLog(n),n===null&&(n="(unknown error)"),st[h>>2]=n.length+1;else if(a==35719){if(!n.Ye)for(a=0;a<W.getProgramParameter(n,35718);++a)n.Ye=Math.max(n.Ye,W.getActiveUniform(n,a).name.length+1);st[h>>2]=n.Ye}else if(a==35722){if(!n.We)for(a=0;a<W.getProgramParameter(n,35721);++a)n.We=Math.max(n.We,W.getActiveAttrib(n,a).name.length+1);st[h>>2]=n.We}else if(a==35381){if(!n.Xe)for(a=0;a<W.getProgramParameter(n,35382);++a)n.Xe=Math.max(n.Xe,W.getActiveUniformBlockName(n,a).length+1);st[h>>2]=n.Xe}else st[h>>2]=W.getProgramParameter(n,a);else Gt(1281)},dc:function(n,a,h){h?st[h>>2]=W.getRenderbufferParameter(n,a):Gt(1281)},Na:function(n,a,h,f){n=W.getShaderInfoLog(Ge[n]),n===null&&(n="(unknown error)"),a=0<a&&f?ve(n,rt,f,a):0,h&&(st[h>>2]=a)},Ob:function(n,a,h,f){n=W.getShaderPrecisionFormat(n,a),st[h>>2]=n.rangeMin,st[h+4>>2]=n.rangeMax,st[f>>2]=n.precision},Oa:function(n,a,h){h?a==35716?(n=W.getShaderInfoLog(Ge[n]),n===null&&(n="(unknown error)"),st[h>>2]=n?n.length+1:0):a==35720?(n=W.getShaderSource(Ge[n]),st[h>>2]=n?n.length+1:0):st[h>>2]=W.getShaderParameter(Ge[n],a):Gt(1281)},P:function(n){var a=Yr[n];if(!a){switch(n){case 7939:a=W.getSupportedExtensions()||[],a=a.concat(a.map(function(f){return"GL_"+f})),a=Nt(a.join(" "));break;case 7936:case 7937:case 37445:case 37446:(a=W.getParameter(n))||Gt(1280),a=a&&Nt(a);break;case 7938:a=W.getParameter(7938),a=2<=St.version?"OpenGL ES 3.0 ("+a+")":"OpenGL ES 2.0 ("+a+")",a=Nt(a);break;case 35724:a=W.getParameter(35724);var h=a.match(/^WebGL GLSL ES ([0-9]\.[0-9][0-9]?)(?:$| .*)/);h!==null&&(h[1].length==3&&(h[1]+="0"),a="OpenGL ES GLSL ES "+h[1]+" ("+a+")"),a=Nt(a);break;default:Gt(1280)}Yr[n]=a}return a},jb:function(n,a){if(2>St.version)return Gt(1282),0;var h=Ur[n];if(h)return 0>a||a>=h.length?(Gt(1281),0):h[a];switch(n){case 7939:return h=W.getSupportedExtensions()||[],h=h.concat(h.map(function(f){return"GL_"+f})),h=h.map(function(f){return Nt(f)}),h=Ur[n]=h,0>a||a>=h.length?(Gt(1281),0):h[a];default:return Gt(1280),0}},Pa:function(n,a){if(a=a?on(rt,a):"",n=se[n]){var h=n,f=h.Ne,v=h.yf,M;if(!f)for(h.Ne=f={},h.xf={},M=0;M<W.getProgramParameter(h,35718);++M){var B=W.getActiveUniform(h,M),T=B.name;B=B.size;var E=Wt(T);E=0<E?T.slice(0,E):T;var H=h.kf;for(h.kf+=B,v[E]=[B,H],T=0;T<B;++T)f[H]=T,h.xf[H++]=E}if(h=n.Ne,f=0,v=a,M=Wt(a),0<M&&(f=parseInt(a.slice(M+1))>>>0,v=a.slice(0,M)),(v=n.yf[v])&&f<v[0]&&(f+=v[1],h[f]=h[f]||W.getUniformLocation(n,a)))return f}else Gt(1281);return-1},Pb:function(n,a,h){for(var f=X[a],v=0;v<a;v++)f[v]=st[h+4*v>>2];W.invalidateFramebuffer(n,f)},Qb:function(n,a,h,f,v,M,B){for(var T=X[a],E=0;E<a;E++)T[E]=st[h+4*E>>2];W.invalidateSubFramebuffer(n,T,f,v,M,B)},Yb:function(n){return W.isSync(te[n])},Qa:function(n){return(n=_e[n])?W.isTexture(n):0},Ra:function(n){W.lineWidth(n)},Sa:function(n){n=se[n],W.linkProgram(n),n.Ne=0,n.yf={}},rc:function(n,a,h,f,v,M){W.uf.multiDrawArraysInstancedBaseInstanceWEBGL(n,st,a>>2,st,h>>2,st,f>>2,_t,v>>2,M)},sc:function(n,a,h,f,v,M,B,T){W.uf.multiDrawElementsInstancedBaseVertexBaseInstanceWEBGL(n,st,a>>2,h,st,f>>2,st,v>>2,st,M>>2,_t,B>>2,T)},Ta:function(n,a){n==3317&&(Zn=a),W.pixelStorei(n,a)},uc:function(n){W.readBuffer(n)},Ua:function(n,a,h,f,v,M,B){if(2<=St.version)if(W.ef)W.readPixels(n,a,h,f,v,M,B);else{var T=oe(M);W.readPixels(n,a,h,f,v,M,T,B>>31-Math.clz32(T.BYTES_PER_ELEMENT))}else(B=we(M,v,h,f,B))?W.readPixels(n,a,h,f,v,M,B):Gt(1280)},ec:function(n,a,h,f){W.renderbufferStorage(n,a,h,f)},ac:function(n,a,h,f,v){W.renderbufferStorageMultisample(n,a,h,f,v)},Ub:function(n,a,h){W.samplerParameterf(fn[n],a,h)},Vb:function(n,a,h){W.samplerParameteri(fn[n],a,h)},Wb:function(n,a,h){W.samplerParameteri(fn[n],a,st[h>>2])},Va:function(n,a,h,f){W.scissor(n,a,h,f)},Wa:function(n,a,h,f){for(var v="",M=0;M<a;++M){var B=f?st[f+4*M>>2]:-1,T=st[h+4*M>>2];B=T?on(rt,T,0>B?void 0:B):"",v+=B}W.shaderSource(Ge[n],v)},Xa:function(n,a,h){W.stencilFunc(n,a,h)},Ya:function(n,a,h,f){W.stencilFuncSeparate(n,a,h,f)},Za:function(n){W.stencilMask(n)},_a:function(n,a){W.stencilMaskSeparate(n,a)},$a:function(n,a,h){W.stencilOp(n,a,h)},ab:function(n,a,h,f){W.stencilOpSeparate(n,a,h,f)},bb:function(n,a,h,f,v,M,B,T,E){if(2<=St.version)if(W.De)W.texImage2D(n,a,h,f,v,M,B,T,E);else if(E){var H=oe(T);W.texImage2D(n,a,h,f,v,M,B,T,H,E>>31-Math.clz32(H.BYTES_PER_ELEMENT))}else W.texImage2D(n,a,h,f,v,M,B,T,null);else W.texImage2D(n,a,h,f,v,M,B,T,E?we(T,B,f,v,E):null)},cb:function(n,a,h){W.texParameterf(n,a,h)},db:function(n,a,h){W.texParameterf(n,a,mt[h>>2])},eb:function(n,a,h){W.texParameteri(n,a,h)},fb:function(n,a,h){W.texParameteri(n,a,st[h>>2])},oc:function(n,a,h,f,v){W.texStorage2D(n,a,h,f,v)},gb:function(n,a,h,f,v,M,B,T,E){if(2<=St.version)if(W.De)W.texSubImage2D(n,a,h,f,v,M,B,T,E);else if(E){var H=oe(T);W.texSubImage2D(n,a,h,f,v,M,B,T,H,E>>31-Math.clz32(H.BYTES_PER_ELEMENT))}else W.texSubImage2D(n,a,h,f,v,M,B,T,null);else H=null,E&&(H=we(T,B,v,M,E)),W.texSubImage2D(n,a,h,f,v,M,B,T,H)},hb:function(n,a){W.uniform1f(Pt(n),a)},ib:function(n,a,h){if(2<=St.version)a&&W.uniform1fv(Pt(n),mt,h>>2,a);else{if(288>=a)for(var f=Jt[a-1],v=0;v<a;++v)f[v]=mt[h+4*v>>2];else f=mt.subarray(h>>2,h+4*a>>2);W.uniform1fv(Pt(n),f)}},Zc:function(n,a){W.uniform1i(Pt(n),a)},_c:function(n,a,h){if(2<=St.version)a&&W.uniform1iv(Pt(n),st,h>>2,a);else{if(288>=a)for(var f=ee[a-1],v=0;v<a;++v)f[v]=st[h+4*v>>2];else f=st.subarray(h>>2,h+4*a>>2);W.uniform1iv(Pt(n),f)}},$c:function(n,a,h){W.uniform2f(Pt(n),a,h)},ad:function(n,a,h){if(2<=St.version)a&&W.uniform2fv(Pt(n),mt,h>>2,2*a);else{if(144>=a)for(var f=Jt[2*a-1],v=0;v<2*a;v+=2)f[v]=mt[h+4*v>>2],f[v+1]=mt[h+(4*v+4)>>2];else f=mt.subarray(h>>2,h+8*a>>2);W.uniform2fv(Pt(n),f)}},Yc:function(n,a,h){W.uniform2i(Pt(n),a,h)},Xc:function(n,a,h){if(2<=St.version)a&&W.uniform2iv(Pt(n),st,h>>2,2*a);else{if(144>=a)for(var f=ee[2*a-1],v=0;v<2*a;v+=2)f[v]=st[h+4*v>>2],f[v+1]=st[h+(4*v+4)>>2];else f=st.subarray(h>>2,h+8*a>>2);W.uniform2iv(Pt(n),f)}},Wc:function(n,a,h,f){W.uniform3f(Pt(n),a,h,f)},Vc:function(n,a,h){if(2<=St.version)a&&W.uniform3fv(Pt(n),mt,h>>2,3*a);else{if(96>=a)for(var f=Jt[3*a-1],v=0;v<3*a;v+=3)f[v]=mt[h+4*v>>2],f[v+1]=mt[h+(4*v+4)>>2],f[v+2]=mt[h+(4*v+8)>>2];else f=mt.subarray(h>>2,h+12*a>>2);W.uniform3fv(Pt(n),f)}},Uc:function(n,a,h,f){W.uniform3i(Pt(n),a,h,f)},Tc:function(n,a,h){if(2<=St.version)a&&W.uniform3iv(Pt(n),st,h>>2,3*a);else{if(96>=a)for(var f=ee[3*a-1],v=0;v<3*a;v+=3)f[v]=st[h+4*v>>2],f[v+1]=st[h+(4*v+4)>>2],f[v+2]=st[h+(4*v+8)>>2];else f=st.subarray(h>>2,h+12*a>>2);W.uniform3iv(Pt(n),f)}},Sc:function(n,a,h,f,v){W.uniform4f(Pt(n),a,h,f,v)},Rc:function(n,a,h){if(2<=St.version)a&&W.uniform4fv(Pt(n),mt,h>>2,4*a);else{if(72>=a){var f=Jt[4*a-1],v=mt;h>>=2;for(var M=0;M<4*a;M+=4){var B=h+M;f[M]=v[B],f[M+1]=v[B+1],f[M+2]=v[B+2],f[M+3]=v[B+3]}}else f=mt.subarray(h>>2,h+16*a>>2);W.uniform4fv(Pt(n),f)}},Fc:function(n,a,h,f,v){W.uniform4i(Pt(n),a,h,f,v)},Gc:function(n,a,h){if(2<=St.version)a&&W.uniform4iv(Pt(n),st,h>>2,4*a);else{if(72>=a)for(var f=ee[4*a-1],v=0;v<4*a;v+=4)f[v]=st[h+4*v>>2],f[v+1]=st[h+(4*v+4)>>2],f[v+2]=st[h+(4*v+8)>>2],f[v+3]=st[h+(4*v+12)>>2];else f=st.subarray(h>>2,h+16*a>>2);W.uniform4iv(Pt(n),f)}},Hc:function(n,a,h,f){if(2<=St.version)a&&W.uniformMatrix2fv(Pt(n),!!h,mt,f>>2,4*a);else{if(72>=a)for(var v=Jt[4*a-1],M=0;M<4*a;M+=4)v[M]=mt[f+4*M>>2],v[M+1]=mt[f+(4*M+4)>>2],v[M+2]=mt[f+(4*M+8)>>2],v[M+3]=mt[f+(4*M+12)>>2];else v=mt.subarray(f>>2,f+16*a>>2);W.uniformMatrix2fv(Pt(n),!!h,v)}},Ic:function(n,a,h,f){if(2<=St.version)a&&W.uniformMatrix3fv(Pt(n),!!h,mt,f>>2,9*a);else{if(32>=a)for(var v=Jt[9*a-1],M=0;M<9*a;M+=9)v[M]=mt[f+4*M>>2],v[M+1]=mt[f+(4*M+4)>>2],v[M+2]=mt[f+(4*M+8)>>2],v[M+3]=mt[f+(4*M+12)>>2],v[M+4]=mt[f+(4*M+16)>>2],v[M+5]=mt[f+(4*M+20)>>2],v[M+6]=mt[f+(4*M+24)>>2],v[M+7]=mt[f+(4*M+28)>>2],v[M+8]=mt[f+(4*M+32)>>2];else v=mt.subarray(f>>2,f+36*a>>2);W.uniformMatrix3fv(Pt(n),!!h,v)}},Jc:function(n,a,h,f){if(2<=St.version)a&&W.uniformMatrix4fv(Pt(n),!!h,mt,f>>2,16*a);else{if(18>=a){var v=Jt[16*a-1],M=mt;f>>=2;for(var B=0;B<16*a;B+=16){var T=f+B;v[B]=M[T],v[B+1]=M[T+1],v[B+2]=M[T+2],v[B+3]=M[T+3],v[B+4]=M[T+4],v[B+5]=M[T+5],v[B+6]=M[T+6],v[B+7]=M[T+7],v[B+8]=M[T+8],v[B+9]=M[T+9],v[B+10]=M[T+10],v[B+11]=M[T+11],v[B+12]=M[T+12],v[B+13]=M[T+13],v[B+14]=M[T+14],v[B+15]=M[T+15]}}else v=mt.subarray(f>>2,f+64*a>>2);W.uniformMatrix4fv(Pt(n),!!h,v)}},Kc:function(n){n=se[n],W.useProgram(n),W.Kf=n},Lc:function(n,a){W.vertexAttrib1f(n,a)},Mc:function(n,a){W.vertexAttrib2f(n,mt[a>>2],mt[a+4>>2])},Nc:function(n,a){W.vertexAttrib3f(n,mt[a>>2],mt[a+4>>2],mt[a+8>>2])},Oc:function(n,a){W.vertexAttrib4f(n,mt[a>>2],mt[a+4>>2],mt[a+8>>2],mt[a+12>>2])},pc:function(n,a){W.vertexAttribDivisor(n,a)},qc:function(n,a,h,f,v){W.vertexAttribIPointer(n,a,h,f,v)},Pc:function(n,a,h,f,v,M){W.vertexAttribPointer(n,a,h,!!f,v,M)},Qc:function(n,a,h,f){W.viewport(n,a,h,f)},rb:function(n,a,h,f){W.waitSync(te[n],a,(h>>>0)+4294967296*f)},j:Bf,n:zf,k:Df,I:$f,Lb:jf,Y:Vf,X:Yf,O:Wf,o:Gf,x:Hf,r:Lf,v:Of,Kb:Nf,Mb:Kf,Nb:Ff,tb:(n,a,h,f)=>wi(n,a,h,f)};(function(){function n(h){if(Z=h=h.exports,Y=Z.bd,He(),Kt=Z.dd,We.unshift(Z.cd),Ke--,o.monitorRunDependencies&&o.monitorRunDependencies(Ke),Ke==0&&Lt){var f=Lt;Lt=null,f()}return h}var a={a:Rf};if(Ke++,o.monitorRunDependencies&&o.monitorRunDependencies(Ke),o.instantiateWasm)try{return o.instantiateWasm(a,n)}catch(h){N("Module.instantiateWasm callback failed with error: "+h),u(h)}return ci(a,function(h){n(h.instance)}).catch(u),{}})();var nr=o._free=n=>(nr=o._free=Z.ed)(n),Ws=o._malloc=n=>(Ws=o._malloc=Z.fd)(n),Hc=n=>(Hc=Z.gd)(n);o.__embind_initialize_bindings=()=>(o.__embind_initialize_bindings=Z.hd)();var ke=(n,a)=>(ke=Z.id)(n,a),Re=()=>(Re=Z.jd)(),De=n=>(De=Z.kd)(n);o.dynCall_viji=(n,a,h,f,v)=>(o.dynCall_viji=Z.ld)(n,a,h,f,v),o.dynCall_vijiii=(n,a,h,f,v,M,B)=>(o.dynCall_vijiii=Z.md)(n,a,h,f,v,M,B),o.dynCall_viiiiij=(n,a,h,f,v,M,B,T)=>(o.dynCall_viiiiij=Z.nd)(n,a,h,f,v,M,B,T),o.dynCall_jiiiijiiiii=(n,a,h,f,v,M,B,T,E,H,et,ot)=>(o.dynCall_jiiiijiiiii=Z.od)(n,a,h,f,v,M,B,T,E,H,et,ot),o.dynCall_viiij=(n,a,h,f,v,M)=>(o.dynCall_viiij=Z.pd)(n,a,h,f,v,M),o.dynCall_jii=(n,a,h)=>(o.dynCall_jii=Z.qd)(n,a,h),o.dynCall_vij=(n,a,h,f)=>(o.dynCall_vij=Z.rd)(n,a,h,f),o.dynCall_iiij=(n,a,h,f,v)=>(o.dynCall_iiij=Z.sd)(n,a,h,f,v),o.dynCall_iiiij=(n,a,h,f,v,M)=>(o.dynCall_iiiij=Z.td)(n,a,h,f,v,M),o.dynCall_viij=(n,a,h,f,v)=>(o.dynCall_viij=Z.ud)(n,a,h,f,v),o.dynCall_ji=(n,a)=>(o.dynCall_ji=Z.vd)(n,a),o.dynCall_iij=(n,a,h,f)=>(o.dynCall_iij=Z.wd)(n,a,h,f),o.dynCall_jiiiiii=(n,a,h,f,v,M,B)=>(o.dynCall_jiiiiii=Z.xd)(n,a,h,f,v,M,B),o.dynCall_jiiiiji=(n,a,h,f,v,M,B,T)=>(o.dynCall_jiiiiji=Z.yd)(n,a,h,f,v,M,B,T),o.dynCall_iijj=(n,a,h,f,v,M)=>(o.dynCall_iijj=Z.zd)(n,a,h,f,v,M),o.dynCall_iiiji=(n,a,h,f,v,M)=>(o.dynCall_iiiji=Z.Ad)(n,a,h,f,v,M),o.dynCall_iiji=(n,a,h,f,v)=>(o.dynCall_iiji=Z.Bd)(n,a,h,f,v),o.dynCall_iijjiii=(n,a,h,f,v,M,B,T,E)=>(o.dynCall_iijjiii=Z.Cd)(n,a,h,f,v,M,B,T,E),o.dynCall_vijjjii=(n,a,h,f,v,M,B,T,E,H)=>(o.dynCall_vijjjii=Z.Dd)(n,a,h,f,v,M,B,T,E,H),o.dynCall_jiji=(n,a,h,f,v)=>(o.dynCall_jiji=Z.Ed)(n,a,h,f,v),o.dynCall_viijii=(n,a,h,f,v,M,B)=>(o.dynCall_viijii=Z.Fd)(n,a,h,f,v,M,B),o.dynCall_iiiiij=(n,a,h,f,v,M,B)=>(o.dynCall_iiiiij=Z.Gd)(n,a,h,f,v,M,B),o.dynCall_iiiiijj=(n,a,h,f,v,M,B,T,E)=>(o.dynCall_iiiiijj=Z.Hd)(n,a,h,f,v,M,B,T,E),o.dynCall_iiiiiijj=(n,a,h,f,v,M,B,T,E,H)=>(o.dynCall_iiiiiijj=Z.Id)(n,a,h,f,v,M,B,T,E,H);function Df(n,a,h,f){var v=Re();try{return Kt.get(n)(a,h,f)}catch(M){if(De(v),M!==M+0)throw M;ke(1,0)}}function Bf(n,a){var h=Re();try{return Kt.get(n)(a)}catch(f){if(De(h),f!==f+0)throw f;ke(1,0)}}function Ff(n,a,h,f,v,M,B,T,E,H){var et=Re();try{Kt.get(n)(a,h,f,v,M,B,T,E,H)}catch(ot){if(De(et),ot!==ot+0)throw ot;ke(1,0)}}function Lf(n,a,h,f){var v=Re();try{Kt.get(n)(a,h,f)}catch(M){if(De(v),M!==M+0)throw M;ke(1,0)}}function Hf(n,a,h){var f=Re();try{Kt.get(n)(a,h)}catch(v){if(De(f),v!==v+0)throw v;ke(1,0)}}function Wf(n){var a=Re();try{Kt.get(n)()}catch(h){if(De(a),h!==h+0)throw h;ke(1,0)}}function Of(n,a,h,f,v){var M=Re();try{Kt.get(n)(a,h,f,v)}catch(B){if(De(M),B!==B+0)throw B;ke(1,0)}}function Gf(n,a){var h=Re();try{Kt.get(n)(a)}catch(f){if(De(h),f!==f+0)throw f;ke(1,0)}}function zf(n,a,h){var f=Re();try{return Kt.get(n)(a,h)}catch(v){if(De(f),v!==v+0)throw v;ke(1,0)}}function Kf(n,a,h,f,v,M,B){var T=Re();try{Kt.get(n)(a,h,f,v,M,B)}catch(E){if(De(T),E!==E+0)throw E;ke(1,0)}}function $f(n,a,h,f,v){var M=Re();try{return Kt.get(n)(a,h,f,v)}catch(B){if(De(M),B!==B+0)throw B;ke(1,0)}}function jf(n,a,h,f,v,M){var B=Re();try{return Kt.get(n)(a,h,f,v,M)}catch(T){if(De(B),T!==T+0)throw T;ke(1,0)}}function Vf(n,a,h,f,v,M,B){var T=Re();try{return Kt.get(n)(a,h,f,v,M,B)}catch(E){if(De(T),E!==E+0)throw E;ke(1,0)}}function Nf(n,a,h,f,v,M){var B=Re();try{Kt.get(n)(a,h,f,v,M)}catch(T){if(De(B),T!==T+0)throw T;ke(1,0)}}function Yf(n,a,h,f,v,M,B,T,E,H){var et=Re();try{return Kt.get(n)(a,h,f,v,M,B,T,E,H)}catch(ot){if(De(et),ot!==ot+0)throw ot;ke(1,0)}}var Os;Lt=function n(){Os||Wc(),Os||(Lt=n)};function Wc(){function n(){if(!Os&&(Os=!0,o.calledRun=!0,!wt)){if(hr(We),c(o),o.onRuntimeInitialized&&o.onRuntimeInitialized(),o.postRun)for(typeof o.postRun=="function"&&(o.postRun=[o.postRun]);o.postRun.length;){var a=o.postRun.shift();Me.unshift(a)}hr(Me)}}if(!(0<Ke)){if(o.preRun)for(typeof o.preRun=="function"&&(o.preRun=[o.preRun]);o.preRun.length;)Zt();hr(Tt),0<Ke||(o.setStatus?(o.setStatus("Running..."),setTimeout(function(){setTimeout(function(){o.setStatus("")},1),n()},1)):n())}}if(o.preInit)for(typeof o.preInit=="function"&&(o.preInit=[o.preInit]);0<o.preInit.length;)o.preInit.pop()();return Wc(),s.ready}})();i.exports=e})(Bc);var Lc=Bc.exports;const If=Qe({__proto__:null,default:Fn(Lc)},[Lc]);bt.AddGraphCmd=Bn,bt.AlignType=ae,bt.ArrangeType=An,bt.CommandManager=aa,bt.DEFAULT_IMAGE=mo,bt.DEFAULT_IMAGE_PAINT=Ta,bt.DEFAULT_IMAGE_SRC=mu,bt.DEFAULT_PAINTS=pu,bt.DEFAULT_SOLID_PAINT=Ma,bt.GraphicsObjectSuffix=En,bt.GraphicsType=At,bt.MacroCmd=Wd,bt.MutateGraphsAndRecord=wo,bt.PaintType=vt,bt.RangeManager=_c,bt.SetGraphsAttrsCmd=Ln,bt.SuikaEditor=Ef,bt.SuikaEllipse=ni,bt.SuikaFrame=ri,bt.SuikaGraphics=Qt,bt.SuikaLine=Ss,bt.SuikaPath=Se,bt.SuikaRect=Ce,bt.SuikaRegularPolygon=Cs,bt.SuikaStar=vo,bt.SuikaText=kr,bt.TextEditor=kc,bt.Transaction=qt,bt.UpdateGraphicsAttrsCmd=Mi,bt.alignAndRecord=Rr,bt.arrangeAndRecord=Li,bt.exportService=Bu,bt.flipHorizontalAndRecord=ja,bt.flipVerticalAndRecord=Va,bt.groupAndRecord=Ya,bt.importService=Hu,bt.isFrameGraphics=Pe,bt.isPaintsShouldRender=yo,bt.ungroupAndRecord=Ua,Object.defineProperty(bt,Symbol.toStringTag,{value:"Module"})});
